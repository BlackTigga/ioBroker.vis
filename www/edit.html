<!DOCTYPE html>
<html manifest="cache.manifest" xmlns="http://www.w3.org/1999/html">
<head>

    <!-- vis Version 1.1.3 -->

    <!--
		Use FireFox or Chrome with --allow-file-access-from-files flag to test DashUI local.
		Before you start Chrome anew all other instances should be closed.
		For local start lib directory from ccu.io is required and datastore in ../ directory.
	-->
    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/custom-light/jquery-ui.min.css" id="commonTheme">

    <meta charset="utf-8"/>

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"/>

    <link href="img/faviconEdit.png" rel="shortcut icon" type="image/x-icon"/>
    <link href="img/faviconEdit.png" rel="apple-touch-icon" />

    <title>Edit vis</title>

    <link rel="stylesheet" type="text/css" href="lib/css/fancytree/ui.fancytree.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/css/superfish/superfish.css" />
    <link rel="stylesheet" type="text/css" href="lib/css/jquery.multiselect-1.13.css" />
    <link rel="stylesheet" type="text/css" href="lib/css/jquery.jgrowl.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/css/farbtastic.css" />
    <link rel="stylesheet" type="text/css" href="js/fm/fileManager.css" />

    <link rel="stylesheet" type="text/css" href="css/backgrounds.css" />
    <link rel="stylesheet" type="text/css" href="css/vis.css" />
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <link rel="stylesheet" type="text/css" href="css/vis-editor.css" />
    <link rel="stylesheet" type="text/css" href="../../lib/css/iob/selectID.css" />

    <script type="text/javascript" src="../../lib/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui-1.11.4.full.min.js"></script>
    <script type="text/javascript" src="lib/js/jquery.fancytree-all.min.js"></script>
    <script type="text/javascript" src="lib/js/colResizable-1.5.min.js"></script>
    <script type="text/javascript" src="../../lib/js/selectID.js"></script>
    <script type="text/javascript" src="../../lib/js/socket.io.js"></script>
    <script type="text/javascript" src="lib/js/translate.js"></script>
    <script type="text/javascript" src="lib/js/jquery.multiselect-1.13.min.js"></script>
    <script type="text/javascript" src="lib/js/loStorage.js"></script>
    <script type="text/javascript" src="lib/js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="lib/js/dropzone.js"></script>
    <script type="text/javascript" src="lib/js/can.custom.min.js"></script>
    <script type="text/javascript" src="lib/js/html2canvas.min.js"></script>
    <script type="text/javascript" src="lib/js/jquery.jgrowl.min.js"></script>
    <script type="text/javascript" src="lib/js/superclick.js"></script>
    <script type="text/javascript" src="lib/ace/ace.js"></script>
    <script type="text/javascript" src="lib/ace/ext-language_tools.js"></script>
    <script type="text/javascript" src="lib/js/farbtastic.js"></script>
    <script type="text/javascript" src="lib/js/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="js/fm/fileManager.js"></script>
    <script type="text/javascript" src="js/config.js"></script> <!-- this file must be before vis.js -->
    <script type="text/javascript" src="js/words.js"></script>
    <script type="text/javascript" src="js/visAbout.js"></script>
    <script type="text/javascript" src="_socket/info.js"></script>
    <script type="text/javascript" src="js/conn.js"></script>
    <script type="text/javascript" src="js/visUtils.js"></script>
    <script type="text/javascript" src="js/vis.js"></script>
    <script type="text/javascript" src="js/visEditWelcome.js"></script>
    <script type="text/javascript" src="js/visEdit.js"></script>
    <script type="text/javascript" src="js/visEditExt.js"></script>
    <script type="text/javascript" src="js/visEditInspect.js"></script>
    <script type="text/javascript" src="js/visEditTemplates.js"></script>
</head>
<body >

<!-- ---------------------------------------  DO NOT EDIT INSIDE THIS LINE - BEGIN ------------------------------------------- -->
<!-- --------------basic.html--- START -->
<link rel="stylesheet" type="text/css" href="widgets/basic/css/table.css" />
<script type="text/javascript" src="widgets/basic/js/table.js"></script>

<script type="text/javascript">
    'use strict';

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            // Bars
            "src":              {"en": "Source",                    "de": "Quelle",                 "ru": "Адрес"},
            "refreshInterval":  {"en": "Refresh interval(ms)",      "de": "Updatezeit(ms)",         "ru": "Интервал обновления(ms)"},
            "is_comma":         {"en": "Divider comma",             "de": "Komme als Trennung",     "ru": "Запятая-разделитель"},
            "is_tdp":           {"en": "Use thousands separator",  "de": "Tausender Trennzeichen",  "ru": "Use thousands separator"},
            "digits":           {"en": "Digits after comma",        "de": "Zeichen nach Komma",     "ru": "Знаков после запятой"},
            "oid":              {"en": "Object ID",                 "de": "Object ID",              "ru": "ID Объекта"},
            "html_prepend":     {"en": "Prepend value",             "de": "Voranstellen HTML",      "ru": "Префикс значения"},
            "html_append":      {"en": "Append to value",           "de": "HTML anhängen",          "ru": "Суффикс значения"},
            "html_append_singular": {
                "en": "Append to value (Singular)",
                "de": "HTML anhängen (Singulär)",
                "ru": "Суффикс значения(един.ч.)"
            },
            "html_append_plural": {
                "en": "Append to value (Plural)",
                "de": "HTML anhängen(Plüral)",
                "ru": "Суффикс значения(множ.ч.)"
            },
            "html_prepend_tooltip":    {
                "en": "Write HTML code here that will be placed before,\x0Ae.g. <b> ",
                "de": "HTML Kod, der wird vom dem Wert platziert,\x0Az.B. <b>",
                "ru": "HTML код будет помещён перед значением,\x0Aнапример <b>"
            },
            "html_append_tooltip":     {
                "en": "Write HTML code here that will be placed before,\x0Ae.g. </b>",
                "de": "HTML Kod, der wird vom dem Wert platziert,\x0Az.B. </b>",
                "ru": "HTML код будет помещён после значения,\x0Aнапример </b>"
            },
            "stretch":          {"en": "Stretch",                   "de": "Strecken",               "ru": "Растянуть"},
            "factor":           {"en": "Multiplex factor",          "de": "Multiplikation",         "ru": "Множитеть"},
            "class_true":       {"en": "Class if quality 'true'",   "de": "Klasse bei Qualität 'true'", "ru": "Класс, если качество 'true'"},
            "class_false":      {"en": "Class if quality 'false'",  "de": "Klasse bei Qualität 'false'", "ru": "Класс, если качество 'false'"},
            "test_html":        {"en": "Text for test",             "de": "Testtext",               "ru": "Тестовый текст"},
            "test_html_tooltip": {
                "en": "You can specify the test text if value is now empty to visualise settings.\x0AIt is valid only during edit.",
                "de": "Man kann noch Testtext setzen um die Einstellungen visuell zu sehen.\x0ADas ist nur während Edit gültig.",
                "ru": "Можно задать тестовый текст, что бы видеть настройки визуально.\x0AОн действителен только во время редактирования."
            },
            "html":             {"en": "HTML",                      "de": "HTML",                   "ru": "HTML"},
            "oid-quality":      {"en": "Quality ID",                "de": "Qualität ID",            "ru": "ID-Качество"},
            "oid-quality_tooltip":     {
                "en": "You can set additionally Quality ID to indicate if the value valid or not.",
                "de": "Man kann noch zusätzlich Qualität ID setzetn um zu zeigen ob das Wert aktuell ist.",
                "ru": "Можно дополнительно установить ID-Качества, что бы показать актуальное значение или нет."},
            "title":            {"en": "Title",                     "de": "Titel",                  "ru": "Заголовок"},
            "title_font":       {"en": "Title font name",           "de": "Titelschriftname",       "ru": "Шрифт заголовка"},
            "title_color":      {"en": "Title color",               "de": "Titelfarbe",             "ru": "Цвет заголовка"},
            "title_back":       {"en": "Title backg. color",        "de": "Titelhintergrund",       "ru": "Цвет фона текста"},
            "title_top":        {"en": "Title top padding",         "de": "Titel-Oben-Abstand",     "ru": "Отступ заголовка сверху"},
            "title_left":       {"en": "Title left padding",        "de": "Titel-Links-Abstand",    "ru": "Отступ заголовка слева"},
            "header_height":    {"en": "Header height",             "de": "Kopfhöhe",               "ru": "Высота заголовока"},
            "header_color":     {"en": "Header color",              "de": "Kopffarbe",              "ru": "Цвет фона заголовка"},
            "refreshOnWakeUp":  {"en": "Refresh on wake up",        "de": "Update bei Aufwachen",   "ru": "Обновлять при выходе из сна"},
            "refreshOnViewChange": {"en": "Refresh on view change", "de": "Update bei Viewwechsel", "ru": "Обновлять при смене страницы"},
            "refreshWithNoQuery": {"en": "Do not add anything to URL", "de": "Addiere nichst zu URL", "ru": "Ничего не добавлять к URL"},
            "src_":             {"en": "URL, by value=",            "de": "URL falls Wert=",        "ru": "Адрес при значении "},
            "nav_view":         {"en": "View to navigate",          "de": "View zum Navigieren",    "ru": "Перейти на страницу"},
            "group_effects":    {"en": "Show/Hide Effects",         "de": "Anzeige Effekte",        "ru": "Эффекты появления/исчезновения"},
            "group_extended":   {"en": "Extended settings",         "de": "Erweiterte Eistellungen", "ru": "Расширенные настройки"},
            "body-background":  {"en": "Background color by changing", "de": "Hintegrund by Wechsel", "ru": "Фон при смене страниц"},
            "sync":             {"en": "Hide and show together:",   "de": "Anzeigen und verbergen gleichzeitig", "ru": "Появления и исчезновение вместе"},
            // Effects
            "show":             {"en": "show",                      "de": "show",                   "ru": "show"},
            "blind":            {"en": "blind",                     "de": "blind",                  "ru": "blind"},
            "bounce":           {"en": "bounce",                    "de": "bounce",                 "ru": "bounce"},
            "clip":             {"en": "clip",                      "de": "clip",                   "ru": "clip"},
            "drop":             {"en": "drop",                      "de": "drop",                   "ru": "drop"},
            "explode":          {"en": "explode",                   "de": "explode",                "ru": "explode"},
            "fade":             {"en": "fade",                      "de": "fade",                   "ru": "fade"},
            "fold":             {"en": "fold",                      "de": "fold",                   "ru": "fold"},
            "highlight":        {"en": "highlight",                 "de": "highlight",              "ru": "highlight"},
            "puff":             {"en": "puff",                      "de": "puff",                   "ru": "puff"},
            "pulsate":          {"en": "pulsate",                   "de": "pulsate",                "ru": "pulsate"},
            "scale":            {"en": "scale",                     "de": "scale",                  "ru": "scale"},
            "shake":            {"en": "shake",                     "de": "shake",                  "ru": "shake"},
            "size":             {"en": "size",                      "de": "size",                   "ru": "size"},
            "slide":            {"en": "slide",                     "de": "slide",                  "ru": "slide"},
            "is_milliseconds":  {"en": "Milliseconds",              "de": "Millisekunden",          "ru": "Миллисекунды"},
            "is_milliseconds_tooltip": {
                "en": "Is object is milliseconds from 1970.01.01 00:00:00. Normally no.",
                "de": "Ob das Wert die Milleskunden seit 1970.01.01 00:00:00 ist. Normalerweise nicht.",
                "ru": "Является ли значение объекта миллисекундами с 1970.01.01 00:00:00. Обычно нет."
            },
            "format_date":      {"en": "Dateformat",                "de": "Datumformat",            "ru": "Формат даты"},
            "format_date_tooltip": {
                "en": "Dateformat",
                "de": "Datumformat",
                "ru": "Формат даты"
            },
            "show_interval":    {"en": "As interval",               "de": "Als Intervall",          "ru": "Как интервал"},
            "hide_effect":      {"en": "Hide effect",               "de": "Verbergeneffekt",        "ru": "Эффект скрытия"},
            "hide_duration":    {"en": "Hide duration(ms)",         "de": "Verbergendauer",         "ru": "Длительность скрытия(мс)"},
            "hide_options":     {"en": "Hide options",              "de": "Verbergenoptionen",      "ru": "Опции скрытия"},
            "show_effect":      {"en": "Show effect",               "de": "Anzeigeeffekt",          "ru": "Эффект появления"},
            "show_duration":    {"en": "Show duration(ms)",         "de": "Anzeigedauer",           "ru": "Длительность появления(мс)"},
            "show_options":     {"en": "Show options",              "de": "Anzeigeoptionen",        "ru": "Опции появления"},
            "left":             {"en": "left",                      "de": "links",                  "ru": "лево"},
            "right":            {"en": "right",                     "de": "rechts",                 "ru": "право"},
            "top":              {"en": "top",                       "de": "oben",                   "ru": "верх"},
            "bottom":           {"en": "bottom",                    "de": "unten",                  "ru": "низ"},

            "contains_view":    {"en": "Contains view",             "de": "Viewname",               "ru": "Имя страницы"},
            "persistent":       {"en": "Persistent",                "de": "Bleibend",               "ru": "Постоянно"},
            "persistent_tooltip": {
                "en": "If persistent the view will not be destroyed when inactive, just hide.\nElsewise the view will be destroyed, if inactive.",
                "de": "Falls 'Bleibend', dann wird die View nicht zerstört, sondern nur versteckt wenn inaktive. Sonst wird die View immer wieder kreiert und zerstört.",
                "ru": "Если выбранно 'Постоянно', то страница не будет уничтожаться, если она не активна. В противном случае страница будет создаваться и разрушаться."},
            "notIfInvisible":       {"en": "Only if visible",                "de": "Nur falls sichtbar",               "ru": "Только если видимо"},
            "notIfInvisible_tooltip": {
                "en": "View will be used only if this widget is visible",
                "de": "Die View wird nur benutzt, wenn dieses Widget sichtbar ist",
                "ru": "Страница будет использоваться только в том случае, если виден этот виджет"
            },
            "valuelist":        {"en": "Values list",               "de": "Wertenliste",            "ru": "Список значений"},
            "valuelist_tooltip": {
                "en": "Divide values with semicolon, like 'ok;warning;alram'. Every text accordingly for value 0,1,2 and so on\nTo have ';' in text use §§ instead.",
                "de": "Die Werte mit Semikolon trennen, wie 'ok;Warnung;Alarm'. Jeder Text ist entsprechend für das Wert 0,1,2 usw.\nUm ';' im Text zu haben, schrein '§§'.",
                "ru": "Разделять значения точкой запятой, например 'ok;Внимание;Тревога'. Каждый текст соответственно для значения 0,1,2 итд.\nДля написания ';' в тексте используй '§§'."
            },
            "html_false":       {"en": "HTML by 'false'",           "de": "HTML bei 'false'",       "ru": "HTML если 0"},
            "html_true":        {"en": "HTML by 'true'",            "de": "HTML bei 'true'",        "ru": "HTML если 1"},
            "text_false":       {"en": "Text by 'false'",           "de": "Text bei 'false'",       "ru": "Текст если 0"},
            "text_true":        {"en": "Text by 'true'",            "de": "Text bei 'true'",        "ru": "Текст если 1"},
            "svg_false":        {"en": "SVG by 'false'",            "de": "SVG bei 'false'",        "ru": "SVG если 0"},
            "svg_true":         {"en": "SVG by 'true'",             "de": "SVG bei 'true'",         "ru": "SVG если 1"},
            "svg_opacity":      {"en": "Opacity",                   "de": "Durchsichtigkeit",       "ru": "Прозрачность"},
            "html_closed":      {"en": "HTML by 'closed'",          "de": "HTML bei 'zu'",          "ru": "HTML если закрыто"},
            "html_open":        {"en": "HTML by 'open'",            "de": "HTML bei 'auf'",         "ru": "HTML если открыто"},
            "html_tilt":        {"en": "HTML by 'tilted'",          "de": "HTML bei 'gekippt'",     "ru": "HTML если наклоненно"},
            "html_tilt_tooltip": {
                "en": "0 - Closed, 1 - tilt, 2 - open",
                "de": "0- Zu, 1 - gekippt, 2 - auf",
                "ru": "0 - закрыто, 1 - откинуто, 2 - открыто"
            },
            "color":            {"en": "Color",                     "de": "Farbe",                  "ru": "Цвет"},
            "shadow":           {"en": "Opacity",                   "de": "Durchsichtigkeit",       "ru": "Тень"},
            "shadow_tooltip":   {
                "en": "CSS Shadow, like '10px 10px 5px #888888'",
                "de": "CSS Shatten, wie '10px 10px 5px #888888'",
                "ru": "CSS Тень, как '10px 10px 5px #888888'"
            },
            "reverse":          {"en": "Revers value",              "de": "Wert umkehren",          "ru": "Перевернуть значение"},
            "border":           {"en": "Border",                    "de": "Rand",                   "ru": "Окантовка"},
            "border_tooltip":   {
                "en": "CSS border, like 'green 5px solid'",
                "de": "CSS Rand, wie 'green 5px solid'",
                "ru": "CSS бордюр, как 'green 5px solid'"
            },
            "test_text":        {"en": "Test text",                 "de": "Testtext",               "ru": "Тестовый текст"},
            "max_width":        {"en": "Max. width",                "de": "Maximale Breite",        "ru": "Максимальная ширина"},
            "style":            {"en": "Style for ",                "de": "Stil für ",              "ru": "Стиль для "},
            "style_tooltip":    {
                "en": "Write here css style, like: 'color:red;background:white'",
                "de": "Hier muss CSS Stil stehen, wie 'color:red;background:white'",
                "ru": "CSS Стиль, например: 'color:red;background:white'"},
            "count":            {"en": "Values number to",          "de": "Wertsanzahl bis",        "ru": "Количество значений до"},
            "test_list":        {"en": "Test value",                "de": "Testwert",               "ru": "Тестовое значение"},
            "urlValue":         {"en": "Call URL on click",         "de": "Rufe URL bei click",     "ru": "Вызвать URL при нажатии"},
            "group_ccontrol":   {"en": "Advanced control",          "de": "Extrasteuerung",         "ru": "Продвинутое управление"},
            "urlFalse":         {"en": "URL on false",              "de": "URL bei false",          "ru": "URL при false"},
            "urlTrue":          {"en": "URL on true",               "de": "URL bei true",           "ru": "URL при true"},
            "oidFalse":         {"en": "Object ID on false",        "de": "Objekt ID bei false",    "ru": "ID объекта при false"},
            "oidTrue":          {"en": "Object ID on true",         "de": "Objekt ID bei true",     "ru": "ID объекта при true"},
            "oidTrueValue":     {"en": "Value for OÍD on true",     "de": "Wert für ID bei false",  "ru": "Значение для ID при false"},
            "oidFalseValue":    {"en": "Value for OÍD on false",    "de": "Wert für ID bei true",   "ru": "Значение для ID при true"},
            "square":           {"en": "square",                    "de": "square",                 "ru": "квадрат"},
            "pentagone":        {"en": "pentagone",                 "de": "pentagone",              "ru": "Пятиуголник"},
            "hexagone":         {"en": "hexagone",                  "de": "hexagone",               "ru": "Шестиугольник"},
            "octagone":         {"en": "octagone",                  "de": "octagone",               "ru": "Восьмиугольник"},
            "circle":           {"en": "circle",                    "de": "Kreis",                  "ru": "Круг"},
            "svgType":          {"en": "Type",                      "de": "Typ",                    "ru": "Тип"},
            "strokeColor":      {"en": "Stroke color",              "de": "Liniefarbe",             "ru": "Цвет линии"},
            "fill":             {"en": "Fill color",                "de": "Füllfarbe",              "ru": "Цвет заливки"},
            "strokeWidth":      {"en": "Stroke width",              "de": "Liniebreite",            "ru": "Ширина линии"},
            "rotate":           {"en": "Rotate",                    "de": "Drehen",                 "ru": "Повернуть на"},
            "no_control":       {"en": "Read only",                 "de": "Nur Anzeige",            "ru": "Только показывать"},
            "numeric":          {"en": "Number",                    "de": "Nummer",                 "ru": "Число"},
            "autoSet":          {"en": "Auto set",                  "de": "Auto-setzen",            "ru": "Авто запись"},
            "autoSet_tooltip":  {
                "en": "Without 'Auto set' you must press ENTER,\x0ato write the value.",
                "de": "Ohne 'Auto-setzen' man muss danach ENTER drucken,\x0A um das Wert zu schreiben.",
                "ru": "Без 'Авто записи' нужно нажать ENTER,\x0Aчто бы записать значение."
            },
            "group_views":      {"en": "Views",                     "de": "Views",                  "ru": "Страницы"},
            "group_frames":     {"en": "iFrames",                   "de": "iFrames",                "ru": "iFrames"},
            "horizontal":       {"en": "horizontal",                "de": "horizontal",             "ru": "горизонтально"},
            "vertical":         {"en": "vertical",                  "de": "senkrecht",              "ru": "вертикально"},
            "orientation":      {"en": "Orientation",               "de": "Ausrichtung ",           "ru": "Направление"},
            "noSandbox":        {"en": "No sandbox",                "de": "Kein Sandkasten",        "ru": "Не запускать в песочнице"},
            "scrollX":          {"en": "Scroll X",                  "de": "Scroll X",               "ru": "Scroll X"},
            "scrollY":          {"en": "Scroll Y",                  "de": "Scroll Y",               "ru": "Scroll Y"},
            "seamless":         {"en": "Seamless",                  "de": "Kein Rahmen",            "ru": "Без рамки"},
            "filters":          {"en": "Filters",                   "de": "Filter",                 "ru": "Фильтры"},
            "filters_Tooltip":  {
                "en": "Divided by semicolon,\x0Ae.g: light;control",
                "de": "Geteilt mir Semikolon\x0Az.B.: Licht;Steuerung",
                "ru": "Разделять точкой запятой\x0Aнапример: Свет;Управление"
            },
            "Select ID":        {"en": "Select ID",                 "de": "ID auswählen",           "ru": "Выбрать ID"},
            "redirect_url":     {"en": "Redirect URL",              "de": "Weiterleiten nach Logout", "ru": "Перейти на URL после выхода"},
            "in_app_close":     {"en": "Close mobile APP",          "de": "Mobiles APP schliessen", "ru": "Закрыть мобильное приложение"},
            "en-US":            {"en": "english",                   "de": "Englisch",               "ru": "английский"},
            "ru-RU":            {"en": "russian",                   "de": "Russisch",               "ru": "русский"},
            "continuous":       {"en": "Continuous",                "de": "Immer zuhören",          "ru": "Непрерывно"},
            "keywords":         {"en": "Keywords",                  "de": "Schlüsselworte",         "ru": "Ключевые слова"},
            "noImage":          {"en": "No image",                  "de": "Kein Bild",              "ru": "Без картинки"},
            "imageInactive":    {"en": "Inactive",                  "de": "Inaktiv",                "ru": "Не активно"},
            "imageActive":      {"en": "Active",                    "de": "Aktiv",                  "ru": "Активно"},
            "imageStarted":     {"en": "Started",                   "de": "Gestartet",              "ru": "Запущено"},
            "imageDetected":    {"en": "Detected",                  "de": "Gefunden",               "ru": "Обнаружено"},
            "imageSent":        {"en": "Sent",                      "de": "Gesedet",                "ru": "Отослано"},
            "imageHeightPx":    {"en": "Height (px)",               "de": "Höhe (px)",              "ru": "Высота (px)"},
            "imageWidthPx":     {"en": "Width (px)",                "de": "Breite (px)",            "ru": "Ширина (px)"},
            "noText":           {"en": "No help text",              "de": "Keine Hilfetext",        "ru": "Без текста помощи"},
            "noResults":        {"en": "No results",                "de": "Keine Ergebnise",        "ru": "Без результатов"},
            "keyWordColor":     {"en": "Key word color",            "de": "Schlüsselworte-Farbe",   "ru": "Цвет ключевых слов"},
            "keyWordColor_tooltip": {
                "en": "Text color, if key word found",
                "de": "Textfarbe, wenn im Text Schlüsselwort gefunden ist.",
                "ru": "Цвет текста, когда обнаружено ключевое слово"
            },
            "textSentColor":    {"en": "Text sent color",           "de": "Gesendet-Farbe",         "ru": "Цвет отосланного текста"},
            "textSentColor_tooltip": {
                "en": "Text color, when text sent to processing it",
                "de": "Textfarbe, wenn Text ist für Abarbeitung gesendet.",
                "ru": "Цвет текста, когда текст отослан на обработку"
            },
            "speechMode":       {"en": "Speech mode",               "de": "Sprachmodus",            "ru": "Режим речи"},
            "single":           {"en": "single",                    "de": "Ein mal",                "ru": "Одиночный"},
            "startstop":        {"en": "start/stop",                "de": "Start/Stop",             "ru": "Старт/стоп"},
            "line":             {"en": "line",                      "de": "Linie",                  "ru": "линия"},
            "triangle":         {"en": "triangle",                  "de": "Dreieck",                "ru": "треугольник"},
            "star":             {"en": "star",                      "de": "Stern",                  "ru": "звезда"},
            "arrow":            {"en": "arrow",                     "de": "Pfeil",                  "ru": "стрела"},
            "scaleWidth":       {"en": "Scale width",               "de": "breiten Skala",          "ru": "Масштаб по ширине"},
            "scaleHeight":      {"en": "Scale height",              "de": "höhen Skala",            "ru": "Масштаб по высоте"},
            "autoFocus": {
                "en": "Auto focus",
                "de": "Autofokus",
                "ru": "Автофокус",
                "pt": "Auto-foco",
                "nl": "Autofocus",
                "fr": "Mise au point automatique",
                "it": "Messa a fuoco automatica",
                "es": "Enfoque automático",
                "pl": "Automatyczne ustawianie ostrości",
                "zh-cn": "自动对焦"
            }
        });
    }

    $.extend(true, systemDictionary, {
        "Edit note":    {"en": "Edit note",     "de": "Meldung eingeben",   "ru": "Сообщение"},
        "Clear":        {"en": "Clear",         "de": "Löschen",            "ru": "Очистить"},
        "Ok":           {"en": "Ok",            "de": "Ok",                 "ru": "Ok"},
        "Cancel":       {"en": "Cancel",        "de": "Abbrechen",          "ru": "Отмена"},
        "all":          {"en": "all",           "de": "Alle",               "ru": "Все"},
        "just&nbsp;now":  {"en": "just&nbsp;now", "de": "gerade&nbsp;jetzt", "ru": "только&nbsp;что"},
        "for&nbsp;%s&nbsp;min.":  {"en": "for&nbsp;%s&nbsp;min.", "de": "vor&nbsp;%s&nbsp;Min.", "ru": "%s&nbsp;мин. назад"},
        "for&nbsp;%s&nbsp;hr.&nbsp;and&nbsp;%s&nbsp;min.": {
            "en": "for&nbsp;%s&nbsp;hr.&nbsp;and&nbsp;%s&nbsp;min.",
            "de": "vor&nbsp;%s&nbsp;St.&nbsp;und&nbsp;%s&nbsp;Min.",
            "ru": "%s&nbsp;часов&nbsp;и&nbsp;%s&nbsp;мин. назад"
        },
        "yesterday":              {"en": "yesterday", "de": "gestern", "ru": "вчера"},
        "for&nbsp;%s&nbsp;hours": {"en": "for&nbsp;%s&nbsp;hours", "de": "vor&nbsp;%s&nbsp;Stunden", "ru": "%s&nbsp;часов назад"},
        "click to create":        {"en": "click to create", "de": "klicken um zu erzeugen", "ru": "нажать что бы создать"},
        "This option works only in APP": {
            "en": "This option works only in APP",
            "de": "Funktioniert nur im APP",
            "ru": "Работает только в мобильном приложении"
        },
        "info_start": {
            "en": "Click on the microphone icon and begin speaking.",
            "de": "Klicken Sie das Mikrophon an und sagen Sie etwas.",
            "ru": "Нажмите на микрофон и начинайте говорить."
        },
        "info_speak_now": {
            "en": "Speak now.",
            "de": "Sage etwas.",
            "ru": "Говорите."
        },
        "info_no_speech": {
            "en": "No speech was detected. You may need to adjust your <a href=\"//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892\">microphone settings</a>.",
            "de": "No speech was detected. You may need to adjust your <a href=\"//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892\">microphone settings</a>.",
            "ru": "Речи не обнаружено. Может надо настроить микрофон <a href=\"//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892\">Настройки микрофона</a>."
        },
        "info_no_microphone": {
            "en": "No microphone was found. Ensure that a microphone is installed and that <a href=\"//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892\"> microphone settings</a> are configured correctly.",
            "de": "No microphone was found. Ensure that a microphone is installed and that <a href=\"//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892\"> microphone settings</a> are configured correctly.",
            "ru": "No microphone was found. Ensure that a microphone is installed and that <a href=\"//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892\"> microphone settings</a> are configured correctly."
        },
        "info_allow": {
            "en": "Click the \"Allow\" button above to enable your microphone.",
            "de": "Click the \"Allow\" button above to enable your microphone.",
            "ru": "Нажмите на кнопку \"разрешить\" сверху, что бы активировать микрофон."
        },
        "info_denied": {
            "en": "Permission to use microphone was denied.",
            "de": "Permission to use microphone was denied.",
            "ru": "Доступ к микрофону был запрещён."
        },
        "info_blocked": {
            "en": "Permission to use microphone is blocked. To change, go to chrome://settings/contentExceptions#media-stream",
            "de": "Permission to use microphone is blocked. To change, go to chrome://settings/contentExceptions#media-stream",
            "ru": "Доступ к микрофону блокирован. Что бы изменить настройки идите <a href=\"chrome://settings/contentExceptions#media-stream\">сюда</a>"
        },
        "info_upgrade": {
            "en": "Web Speech API is not supported by this browser. Upgrade to<a href=\"//www.google.com/chrome\">Chrome</a> version 25 or later.",
            "de": "Web Speech API is not supported by this browser. Upgrade to<a href=\"//www.google.com/chrome\">Chrome</a> version 25 or later.",
            "ru": "Web Speech API не поддерживается этим браузером. Обновите до <a href=\"//www.google.com/chrome\">Chrome</a> версии 25 или новее."
        }
    });

    vis.binds.stateful = {
        view: function (el, viewArr, persistent, notIfInvisible) {
            var $this = $(el);
            var oid   = $this.attr('data-oid');
            var timer = null;

            function draw(val) {
                timer = null;
                var view = viewArr[val];
                if (!persistent) {
                    $this.parent().find('div.vis-view').remove();
                } else {
                    $this.parent().find('div.vis-view').hide().appendTo($('#vis_container'));
                }
                if (vis.views[view]) {
                    vis.renderView(view, view, true, function (_view) {
                        var $view = $('#visview_' + _view);
                        $view.show().data('persistent', persistent);
                        if (!$this.find('#visview_' + _view).length) {
                            $view.appendTo($this);
                        }
                    });
                }
                vis.destroyUnusedViews();
            }

            function onChange(e, newVal) {
                if (newVal === 'true'  || newVal === true)  newVal = 1;
                if (newVal === 'false' || newVal === false) newVal = 0;
                if (notIfInvisible && !$this.is(':visible')) {
                    return;
                }

                if (timer) {
                    clearTimeout(timer)
                }
                timer = setTimeout(function () {
                    draw(newVal);
                }, 50);
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);
            }
        },
        iframe: function (el, srcArr, refreshInterval) {
            var $this = $(el).parent().find('iframe');
            var oid   = $this.attr('data-oid');
            refreshInterval = parseInt(refreshInterval, 10) || 0;

            function onChange (e, newVal) {
                if (newVal === 'true'  || newVal === true)  newVal = 1;
                if (newVal === 'false' || newVal === false) newVal = 0;
                $this.attr('src', srcArr[newVal]);
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                if (vis.states[oid + '.val'] !== undefined) {
                    var val = vis.states[oid + '.val'];
                    if (val === 'true'  || val === true)  val = 1;
                    if (val === 'false' || val === false) val = 0;
                    $this.attr('src', srcArr[val]);
                }

                if (refreshInterval > 0) {
                    setInterval(function () {
                        var val = vis.states[oid + '.val'] || 0;
                        if (val === 'true'  || val === true)  val = 1;
                        if (val === 'false' || val === false) val = 0;
                        var src = srcArr[val];
                        $this.attr('src', src + (src.match(/\?/) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                    }, refreshInterval);
                }
            }
        },
        image: function (el, srcArr, refreshInterval) {
            var $this = $(el).parent().find('img');
            var oid = $this.attr('data-oid');
            refreshInterval = parseInt(refreshInterval, 10) || 0;

            function onChange (e, newVal) {
                if (newVal === 'true'  || newVal === true)  newVal = 1;
                if (newVal === 'false' || newVal === false) newVal = 0;
                $this.attr('src', srcArr[newVal]);
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                if (vis.states[oid + '.val'] !== undefined) {
                    var val = vis.states[oid + '.val'];
                    if (val === 'true'  || val === true)  val = 1;
                    if (val === 'false' || val === false) val = 0;
                    $this.attr('src', srcArr[val]);
                }

                if (refreshInterval > 0) {
                    setInterval(function () {
                        var val = vis.states[oid + '.val'] || 0;
                        if (val === 'true'  || val === true)  val = 1;
                        if (val === 'false' || val === false) val = 0;

                        var src = srcArr[val];
                        if (src) $this.attr('src', src + ((src.indexOf('?') !== -1) ? '&' : '?') + '_vis_refts=' + ((new Date()).getTime()));
                    }, refreshInterval);
                }
            }

        },
        value: function (values, oid) {
            if (oid !== 'nothing_selected' && vis.states.attr(oid + '.val') !== undefined) {
                var val = vis.states.attr(oid + '.val');
                if (val === 'true'  || val === true)  val = 1;
                if (val === 'false' || val === false) val = 0;
                return values[val];
            } else {
                return values[0];
            }
        }
    };
    vis.binds.container = function (el, view) {
        var $this = $(el);
        if (vis.views[view]) {
            vis.renderView(view, view, true, function (_view) {
                $('#visview_' + _view).appendTo($this).show();
            });
        }
    };
    vis.binds.basic = {
        isFullScreen: false,
        filterDropdown: function (el, filters, hideEffect, hideDuration, showEffect, showDuration) {
            var $this = $(el);
            if (filters) {
                filters = filters.split(';');
                for (var i = 0; i < filters.length; i++) {
                    $this.find('select').append('<option value="' + filters[i] + '">' + filters[i] + '</option>');
                }
            }

            if (vis.viewsActiveFilter[vis.activeView]) {
                $this.find('select option[value="' + vis.viewsActiveFilter[vis.activeView] + '"]').attr('selected', true);
            }

            $this.find('select').change(function () {
                vis.changeFilter(null, $this.find('select option:selected').val(), hideEffect, hideDuration, showEffect, showDuration);
            });
        },
        state: function (el, oid) {
            var $this = $(el);
            oid = oid ? oid : $this.attr('data-oid');
            var val = $this.attr('data-val');

            if (oid) {
                $this.attr('data-ctrl-oid', oid);
            }

            if (val === 'true')  val = true;
            if (val === 'false') val = false;

            if (!vis.editMode) {
                var moved = false;
                $this.on('click touchend', function (e) {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    if (moved) return;

                    var oid = $(this).attr('data-ctrl-oid');

                    if ($(this).attr('url-value')) {
                        vis.conn.httpGet($(this).attr('url-value'));
                    }

                    if (oid) {
                        var val = $(this).attr('data-val');
                        if (val === undefined || val === null) val = false;
                        if (val === 'true')  val = true;
                        if (val === 'false') val = false;
                        if (parseFloat(val).toString() == val) val = parseFloat(val);

                        if (oid) vis.setValue(oid, val);
                    }
                }).on('touchmove', function () {
                    moved = true;
                }).on('touchstart', function () {
                    moved = false;
                });
            }
        },
        pressed: null,
        pressedNext: null,
        increment: function (el, minmax, delay, interval) {

            function fInterval($that) {
                vis.binds.basic.pressedNext = true;
                vis.binds.basic.pressed = null;
                var oid = $that.attr('data-oid');
                if (!vis.editMode) {
                    var step = parseFloat($that.attr('data-vis-step'));
                    var tmp  = parseFloat(vis.states[oid + '.val']) + step;
                    if (step < 0) {
                        if (tmp >= minmax) {
                            vis.setValue($that.attr('data-oid'), tmp);
                            vis.binds.basic.pressed = _setTimeout(fInterval, interval, $that);
                        }
                    } else {
                        if (tmp <= minmax) {
                            vis.setValue($that.attr('data-oid'), tmp);
                            vis.binds.basic.pressed = _setTimeout(fInterval, interval, $that);
                        }
                    }
                }
            }

            function intervalStart(e) {
                vis.binds.basic.pressedNext = false;
                var $this = $(this);
                var oid = $this.attr('data-oid');

                if (vis.binds.basic.pressed) {
                    clearInterval(vis.binds.basic.pressed);
                    vis.binds.basic.pressed = null;
                }

                vis.binds.basic.pressed = setTimeout(fInterval, delay, $this);
            }

            if (!vis.editMode) {
                var moved = false;
                $(el).on('click touchend', function (e) {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    if (moved) return;

                    if (vis.binds.basic.pressed) {
                        clearInterval(vis.binds.basic.pressed);
                        vis.binds.basic.pressed = null;
                    }

                    if (vis.binds.basic.pressedNext) {
                        vis.binds.basic.pressedNext = false;
                        return;
                    }
                    var $this = $(this);
                    var oid = $this.attr('data-oid');
                    var step = parseFloat($this.attr('data-vis-step'));
                    var tmp  = parseFloat(vis.states[oid + '.val']) + step;
                    if (step < 0) {
                        if (minmax === undefined || tmp >= minmax) {
                            vis.setValue($this.attr('data-oid'), tmp);
                        }
                    } else {
                        if (minmax === undefined || tmp <= minmax) {
                            vis.setValue($this.attr('data-oid'), tmp);
                        }
                    }
                }).on('touchmove', function () {
                    moved = true;
                }).on('touchstart', function () {
                    moved = false;
                });
            }

            if (interval) {
                $(el).on('mousedown', intervalStart)
                    .on('touchstart', intervalStart)
                    .on('touchend', function () {
                        if (vis.binds.basic.pressed) {
                            clearInterval(vis.binds.basic.pressed);
                            vis.binds.basic.pressed = null;
                        }
                    })
                    .on('mouseup', function () {
                        if (vis.binds.basic.pressed) {
                            clearInterval(vis.binds.basic.pressed);
                            vis.binds.basic.pressed = null;
                        }
                    }).data('destroy', function (id, $widget) {
                    $widget && $widget.off('mousedown').off('touchstart').off('touchend').off('mouseup');
                });
            }
        },
        navigation: function (el, options) {
            if (!vis.editMode && options.nav_view) {
                var $this = $(el);
                var moved = false;
                $this.on('click touchend', function (e) {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    if (moved) return;

                    if (options.background) $('body').css({background: options.background});

                    vis.changeView(options.nav_view, options.nav_view, options.hideOptions, options.showOptions, options.sync);
                    //e.preventDefault();
                    //return false;
                }).on('touchmove', function () {
                    moved = true;
                }).on('touchstart', function () {
                    moved = false;
                });
            }
        },
        hideOnFalse: function (el) {
            var $this = $(el);
            var oid   = $this.attr('data-oid');

            function onChange (e, newVal) {
                if (newVal === null || newVal === false || newVal === 0 || newVal === 'false' || !parseInt(newVal, 10)) {
                    if (!vis.editMode) {
                        $this.hide();
                    }
                } else {
                    $this.show();
                }
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $this.data('bound', [oid + '.val'])
                // remember bind handler
                    .data('bindHandler', onChange);

                if (!vis.editMode) {
                    var newVal = vis.states.attr(oid + '.val');
                    if (newVal === null || newVal === false || newVal === 0 || newVal === 'false' || parseInt(newVal, 10) === 0) {
                        $this.hide();
                    }
                }
            }

        },
        /*hideOnTrue: function (el) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                if (newVal === true || parseFloat(newVal) > 0) {
                    if (!vis.editMode) {
                        $this.hide();
                    }
                } else {
                    $this.show();
                }
            });
            if (!vis.editMode) {
                if (parseFloat(vis.states.attr(oid + '.val')) !== 0 && vis.states.attr(oid + '.val') !== false) {
                    $this.hide();
                }
            }
        },
        showOnValue: function (el, val) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            vis.states.bind(oid + '.val', function (e, newVal, oldVal) {
                if (newVal != val) {
                    if (!vis.editMode) {
                        $this.hide();
                    }
                } else {
                    $this.show();
                }
            });
            if (!vis.editMode) {
                if (vis.states.attr(oid + '.val') != val) {
                    $this.hide();
                }
            }
        },*/
        _onChange: function (el, oid, wid) {
            var $this = $(el);
            // If still working
            //console.log(oid + ' ' + vis.states.attr(oid + '.val') + ' (' + vis.states.attr(oid + '.ack') + ') - ' + wid + ' ' + vis.states.attr(wid + '.val') + ' (' + vis.states.attr(wid + '.ack') + ')');

            if (wid && (vis.states.attr(wid + '.val') === true)) return;

            var val = vis.states.attr(oid + '.val');

            if (val === 'false') {
                val = false;
            } else if (val === 'true') {
                val = true;
            } else if (typeof val === 'string') {
                var f = parseFloat(val);
                if (f == val) {
                    val = f;
                } else if (val !== '') {
                    val = true;
                } else {
                    val = false;
                }
            }

            if ($this.data('data-numeric')) {
                $this.prop('checked', (val > (($this.data('data-max') - $this.data('data-min')) / 2)));
            } else {
                $this.prop('checked', val);
            }
        },
        checkbox: function (el, numeric, min, max) {
            var $this = $(el);
            var oid   = $this.data('oid'); // Object ID
            var wid   = $this.data('oid-working'); // Work ID

            function onChange() {
                vis.binds.basic._onChange(el, oid, wid);
            }
            if (oid) {
                var bound = [];
                vis.states.bind(oid + '.val', onChange);
                bound.push(oid + '.val');
                if (wid) {
                    vis.states.bind(wid + '.val', onChange);
                    bound.push(wid + '.val');
                }

                // remember all ids, that bound
                $this.closest('.vis-widget')
                    .data('bound', bound)
                    // remember bind handler
                    .data('bindHandler', onChange);
            }

            if (numeric) {
                if (min !== undefined && min !== null && min !== '') {
                    min = parseFloat(min);
                } else {
                    min = 0;
                }

                if (max !== undefined && max !== null && max !== '') {
                    max = parseFloat(max);
                } else {
                    max = 1;
                }
            } else {
                min = false;
                max = true;
            }

            $this.data('min',     min);
            $this.data('max',     max);
            $this.data('numeric', numeric);

            vis.binds.basic._onChange(el, oid, wid);

            if (!vis.editMode) {
                $this.change(function () {
                    var $this_ = $(this);
                    if ($this_.prop('checked')) {
                        vis.setValue($this_.data('oid'), $this_.data('max'));
                    } else {
                        vis.setValue($this_.data('oid'), $this_.data('min'));
                    }
                });
            }
        },
        input: function (el, data) {
            var $this = $(el);
            var oid   = $this.data('oid'); // Object ID
            var wid   = $this.data('oid-working'); // Work ID

            function onChange(e, val) {
                $this.val(val);
            }

            if (oid) {
                var bound = [oid + '.val'];
                vis.states.bind(oid + '.val', onChange);
                if (wid) {
                    bound.push(wid + '.val');
                    vis.states.bind(wid + '.val', onChange);
                }
                // remember all ids, that bound
                $this.closest('.vis-widget')
                    .data('bound', bound)
                    // remember bind handler
                    .data('bindHandler', onChange);
            }

            if (data.numeric) {
                $this.attr('type', 'number');
                if (data.min !== undefined && data.min !== null && data.min !== '') {
                    data.min = parseFloat(data.min);
                } else {
                    data.min = null;
                }

                if (data.max !== undefined && data.max !== null && data.max !== '') {
                    data.max = parseFloat(data.max);
                } else {
                    data.max = null;
                }
            }

            $this.val(vis.states[oid + '.val'] === undefined ? '' : vis.states[oid + '.val']);

            setTimeout(function () {
                $this.css('text-align', $this.parent().parent().css('text-align'));
                $this.css('color', $this.parent().parent().css('color'));
                $this.css('background', $this.parent().parent().css('background'));
                $this.css('border', '0');
                $this.css('text-font', $this.parent().parent().css('text-font'));
            }, 0);

            if (!vis.editMode) {
                $this.change(function () {
                    var $this_ = $(this);
                    if (data.numeric) {
                        var value = parseFloat($this_.val());
                        if (data.min !== null && value < data.min) {
                            value = data.min;
                            $this_.val(value);
                        } else if (data.max !== null && value > data.max) {
                            value = data.max;
                            $this_.val(value);
                        }
                        vis.setValue($this_.data('oid'), value);
                    } else {
                        vis.setValue($this_.data('oid'), $this_.val());
                    }
                });
                if (data.autoSet) {
                    $this.keyup(function(e) {
                        var timer = $this.data('timer');
                        if (timer) clearTimeout(timer);
                        $this.data('timer', setTimeout(function () {
                            $this.trigger('change');
                        }), 1000);
                    });
                }
            }
        },
        select: function (el, invert) {
            var $this = $(el).prev();
            var oid   = $this.attr('data-oid');
            var val   = vis.states[oid + '.val'];

            if (val === 'false') {
                val = false;
            } else if (val === 'true') {
                val = true;
            } else if (typeof val === 'string') {
                var f = parseFloat(val);
                if (f == val) {
                    val = f;
                } else if (val !== '') {
                    val = true;
                } else {
                    val = false;
                }
            }

            if (invert) val = !val;

            $this.val(val ? 1 : 0);

            if (!vis.editMode) {
                if (oid !== 'nothing_selected') {
                    $this.change(function () {
                        var val = $this.find('option:selected').val();
                        if (invert) val = !val;
                        vis.setValue(oid, val);
                    });
                }
            }
            if (oid !== 'nothing_selected') {

            }
            function onChange(e, newVal, oldVal) {
                if (newVal === 'false') {
                    newVal = false;
                } else if (newVal === 'true') {
                    newVal = true;
                } else if (typeof newVal === 'string') {
                    var f = parseFloat(newVal);
                    if (f == newVal) {
                        newVal = f;
                    } else if (newVal !== '') {
                        newVal = true;
                    } else {
                        newVal = false;
                    }
                }
                if (oldVal === 'false') {
                    oldVal = false;
                } else if (oldVal === 'true') {
                    oldVal = true;
                } else if (typeof oldVal === 'string') {
                    var f = parseFloat(oldVal);
                    if (f == oldVal) {
                        oldVal = f;
                    } else if (oldVal !== '') {
                        oldVal = true;
                    } else {
                        oldVal = false;
                    }
                }

                if (newVal == oldVal) return;

                if (newVal === 'false' || newVal === false || parseFloat(newVal) === 0) {
                    if ($this.find('option[value="1"]').prop('selected')) {
                        $this.find('option[value="1"]').prop('selected', false);
                        $this.find('option[value="0"]').prop('selected', true);
                        $this.trigger('change');
                    }
                } else {
                    if ($this.find('option[value="0"]').prop('selected')) {
                        $this.find('option[value="0"]').prop('selected', false);
                        $this.find('option[value="1"]').prop('selected', true);
                        $this.trigger('change');
                    }
                }
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);
                // remember all ids, that bound
                $this.closest('.vis-widget')
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);
            }
        },
        pushbutton: function(el, oid) {
            if (!vis.editMode) {
                var $this = $(el);
                oid = oid || $this.data('oid');

                $this.on('mousedown touchstart', function (e) {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    vis.setValue(oid, true);
                });
                $this.on('mouseup touchend touchcancel', function (e) {
                    // Protect against two events
                    if (vis.detectBounce(this, true)) return;

                    vis.setValue(oid, false);
                });
            }
        },
        toggle: function (el, oid) {
            var $this = $(el);
            oid = oid || $this.data('oid');
            var min = $this.data('min');
            var max = $this.data('max');

            var urlTrue     = $this.data('url-true');
            var urlFalse    = $this.data('url-false');
            var oidTrue     = $this.data('oid-true');
            var oidFalse    = $this.data('oid-false');
            var oidTrueVal  = $this.data('oid-true-value');
            var oidFalseVal = $this.data('oid-false-value');
            var readOnly    = $this.data('read-only');

            if (min === '') min = undefined;
            if (max === '') max = undefined;

            if ((oid || oidTrue || urlTrue) && !vis.editMode && !readOnly) {
                var moved = false;
                $this.on('click touchend', function () {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    if (moved) return;

                    var val;

                    if (oidTrue || urlTrue) {
                        if (!oidFalse && oidTrue) oidFalse = oidTrue;
                        if (!urlFalse && urlTrue) urlFalse = urlTrue;

                        if (!oid || oid === 'nothing_selected') {
                            val = !$(this).data('state');
                            // remember state
                            $(this).data('state', val);
                        } else {
                            val = vis.states[oid + '.val'];
                            if (max !== undefined) {
                                if (max === 'true')  max = true;
                                if (max === 'false') max = false;
                                if (val === 'true')  val = true;
                                if (val === 'false') val = false;
                                val = (val == max);
                            } else {
                                val = (val === 1 || val === '1' || val === true || val === 'true');
                            }
                            val = !val; // invert
                        }
                        if (min === undefined || min === 'false' || min === null) min = false;
                        if (max === undefined || max === 'true'  || max === null) max = true;

                        if (oidTrue) {
                            if (val) {
                                if (oidTrueVal === undefined || oidTrueVal === null) oidTrueVal = max;
                                if (oidTrueVal === 'false') oidTrueVal = false;
                                if (oidTrueVal === 'true')  oidTrueVal = true;
                                var f = parseFloat(oidTrueVal);
                                if (f.toString() == oidTrueVal) oidTrueVal = f;
                                vis.setValue(oidTrue,  oidTrueVal);
                            } else {
                                if (oidFalseVal === undefined || oidFalseVal === null) oidFalseVal = min;
                                if (oidFalseVal === 'false') oidFalseVal = false;
                                if (oidFalseVal === 'true')  oidFalseVal = true;
                                var f = parseFloat(oidFalseVal);
                                if (f.toString() == oidFalseVal) oidFalseVal = f;
                                vis.setValue(oidFalse, oidFalseVal);
                            }
                        }

                        if (urlTrue) {
                            if (val) {
                                vis.conn.httpGet(urlTrue)
                            } else {
                                vis.conn.httpGet(urlFalse);
                            }
                        }

                        // show new state
                        if (!oid || oid === 'nothing_selected') {
                            var img = $(this).data('img-class');
                            if (val) {
                                if ($(this).data('as-button')) $(this).addClass('ui-state-active');
                                val = $(this).data('img-true');
                            } else {
                                val = $(this).data('img-false');
                                if ($(this).data('as-button')) $(this).removeClass('ui-state-active');
                            }
                            $(this).find('.' + img).attr('src', val);
                        }
                    } else {
                        var val = vis.states[oid + '.val'];
                        if ((min === undefined && (val === null || val === '' || val === undefined || val === false || val === 'false')) ||
                            (min !== undefined && min == val)) {
                            vis.setValue(oid, max !== undefined ? max : true);
                        } else
                        if ((max === undefined && (val === true || val === 'true')) ||
                            (max !== undefined && val == max))
                        {
                            vis.setValue(oid, min !== undefined ? min : false);
                        } else {
                            val = parseFloat(val);
                            if (min !== undefined && max !== undefined) {
                                if (val >= (max - min) / 2) {
                                    val = min;
                                } else {
                                    val = max;
                                }
                            } else {
                                if (val >= 0.5) {
                                    val = 0;
                                } else {
                                    val = 1;
                                }
                            }
                            vis.setValue(oid, val);
                        }
                    }
                }).on('touchmove', function () {
                    moved = true;
                }).on('touchstart', function () {
                    moved = false;
                }).data('destroy', function (id, $widget) {
                    $widget.off('click touchend').off('touchmove').off('touchstart');
                });
            }
        },
        iframeRefresh: function (el, src, refreshInterval, refreshOnWakeUp, refreshOnViewChange, refreshWithNoQuery) {
            var widgetView;
            if (src && typeof src === 'object') {
                widgetView = refreshInterval;
                refreshInterval     = src.refreshInterval;
                refreshOnWakeUp     = src.refreshOnWakeUp;
                refreshOnViewChange = src.refreshOnViewChange;
                refreshWithNoQuery  = src.refreshWithNoQuery;
                src                 = src.src;
            } else if (refreshInterval && typeof refreshInterval === 'object') {
                widgetView = refreshOnWakeUp;
                refreshInterval     = refreshInterval.refreshInterval;
                refreshOnWakeUp     = refreshInterval.refreshOnWakeUp;
                refreshOnViewChange = refreshInterval.refreshOnViewChange;
                refreshWithNoQuery  = refreshInterval.refreshWithNoQuery;
            }
            refreshOnViewChange = refreshOnViewChange === true || refreshOnViewChange === 'true';
            refreshOnWakeUp     = refreshOnWakeUp     === true || refreshOnWakeUp     === 'true';
            refreshWithNoQuery  = refreshWithNoQuery  === true || refreshWithNoQuery  === 'true';

            if (!vis.editMode && src) {
                var $this = $(el).parent().find('iframe');
                refreshInterval = parseInt(refreshInterval, 10) || 0;

                if (refreshOnViewChange) {
                    widgetView = widgetView || vis.activeView;
                    vis.navChangeCallbacks.push(function (view) {
                        if (view === widgetView) {
                            $this.attr('src', src + (refreshWithNoQuery ? '' : ((src.indexOf('?') !== -1) ? '&' : '?') + '_refts=' + ((new Date()).getTime())));
                        }
                    });
                }
                if (refreshInterval > 0) {
                    setInterval(function () {
                        if ($this.is(':visible')) {
                            var p = $this.parents(':hidden');
                            if (!p.length || p[0].tagName === 'BODY' || p[0].id === 'materialdesign-vuetify-container') {
                                $this.attr('src', src + (refreshWithNoQuery ? '' : ((src.indexOf('?') !== -1) ? '&' : '?') + '_refts=' + ((new Date()).getTime())));
                            }
                        }
                    }, refreshInterval);
                }
                if (refreshOnWakeUp) {
                    vis.onWakeUp(function () {
                        // TODO this does not work. :(
                        $this.attr('src', src + (refreshWithNoQuery ? '' : ((src.indexOf('?') !== -1) ? '&' : '?') + '_refts=' + ((new Date()).getTime())));
                    });
                }
            }
        },
        htmlRefresh: function (el, html, refreshInterval) {
            refreshInterval = parseInt(refreshInterval, 10) || 0;
            if (html && !vis.editMode && refreshInterval > 0) {
                var $this = $(el);
                setInterval(function () {
                    if ($this.is(':visible')) {
                        var p = $this.parents(':hidden');
                        if (!p.length || p[0].tagName === 'BODY' || p[0].id === 'materialdesign-vuetify-container') {
                            $this.html(html);
                        }
                    }
                }, refreshInterval);
            }
        },
        imgRefresh: function (el, src, refreshInterval, refreshOnWakeUp, refreshOnViewChange, refreshWithNoQuery) {
            var widgetView;
            if (src && typeof src === 'object') {
                widgetView = refreshInterval;
                refreshInterval     = src.refreshInterval;
                refreshOnWakeUp     = src.refreshOnWakeUp;
                refreshOnViewChange = src.refreshOnViewChange;
                refreshWithNoQuery  = src.refreshWithNoQuery;
                src                 = src.src;
            } else if (refreshInterval && typeof refreshInterval === 'object') {
                widgetView = refreshOnWakeUp;
                refreshInterval     = refreshInterval.refreshInterval;
                refreshOnWakeUp     = refreshInterval.refreshOnWakeUp;
                refreshOnViewChange = refreshInterval.refreshOnViewChange;
                refreshWithNoQuery  = refreshInterval.refreshWithNoQuery;
            }
            refreshOnViewChange = refreshOnViewChange === true || refreshOnViewChange === 'true';
            refreshOnWakeUp     = refreshOnWakeUp     === true || refreshOnWakeUp     === 'true';
            refreshWithNoQuery  = refreshWithNoQuery  === true || refreshWithNoQuery  === 'true';

            if (!vis.editMode && src) {
                var $this = $(el).parent().find('img');
                refreshInterval = parseInt(refreshInterval, 10) || 0;

                if (refreshOnViewChange) {
                    widgetView = widgetView || vis.activeView;
                    vis.navChangeCallbacks.push(function (view) {
                        if (view === widgetView) {
                            $this.attr('src', src + (refreshWithNoQuery ? '' : ((src.indexOf('?') !== -1) ? '&' : '?') + '_refts=' + ((new Date()).getTime())));
                        }
                    });
                }
                if (refreshInterval > 0) {
                    setInterval(function () {
                        if ($this.is(':visible')) {
                            var p = $this.parents(':hidden');
                            if (!p.length || p[0].tagName === 'BODY' || p[0].id === 'materialdesign-vuetify-container') {
                                $this[0].src = src + (refreshWithNoQuery ? '' : ((src.indexOf('?') !== -1) ? '&' : '?') + '_refts=' + ((new Date()).getTime()));
                            }
                        }
                    }, refreshInterval);
                }
                if (refreshOnWakeUp) {
                    //console.log("refreshOnWakeUp!");
                    vis.onWakeUp(function () {
                        // TODO this does not work. :(
                        //console.log("wakeup refresh!");
                        $this[0].src = src + (refreshWithNoQuery ? '' : ((src.indexOf('?') !== -1) ? '&' : '?') + '_refts=' + ((new Date()).getTime()));
                        //console.log($this.attr('src'));
                    });
                }
            }
        },
        showSvg: function (myClass, view, wid, oid, opacity, svg_false, svg_true, style, no_control) {
            var $wid = $('#' + wid);

            var id = $wid.attr('id');
            if (id && id.match(/_removed$/)) return;

            if (!$wid.length) {
                return setTimeout(function () {
                    vis.binds.basic.showSvg(myClass, view, wid, oid, opacity, svg_false, svg_true, style, no_control);
                }, 100);
            }

            $wid.find('svg').remove();
            var str = vis.states.attr(oid + '.val');
            if (typeof str === 'string') str = str.toLowerCase();
            var val = parseFloat(str);
            var sText = '<svg version="1.1" style="width:100%;height:100%" xmlns="http://www.w3.org/2000/svg" data-oid="' + oid + '">';
            if (vis.editMode) {
                if (opacity === undefined || opacity === null || opacity === '') opacity = 1;

                if (parseFloat(opacity) < 0.2) opacity = 0.2;
            }
            if (val === 0 || str === 'false' || str === '0' || str === 'off' || str === false || str === null || str === undefined) {
                // try to analyse
                sText += svg_false;
            } else {
                sText += svg_true;
            }
            sText += '</svg>';
            $wid.find('.vis-widget-body').append(sText);

            if (style) $wid.css(style);

            var moved = false;

            function onSvgClick() {
                // Protect against two events
                if (vis.detectBounce(this)) return;

                if (moved) return;

                var val = vis.states[oid + '.val'];
                if (val === null || val === '' || val === undefined || val === false || val === "false") {
                    vis.setValue(oid, true);
                } else if (val === true || val === "true") {
                    vis.setValue(oid, false);
                } else {
                    val = parseFloat(val);
                    if (val >= 0.5) {
                        val = 1;
                    } else {
                        val = 0;
                    }
                    vis.setValue(oid, 1 - val);
                }
            }

            function onChange (e, newVal) {
                if (newVal === 'true'  || newVal === true)  newVal = 1;
                if (newVal === 'false' || newVal === false || newVal === '0') newVal = 0;
                var $svg = $('#' + wid).find('svg');

                $svg.html(newVal ? svg_true : svg_false);

                if (!vis.editMode && !no_control) {
                    $svg.children().unbind('click touchend touchmove touchstart').on('click touchend', onSvgClick)
                        .on('touchmove', function () {
                            moved = true;
                        }).on('touchstart', function () {
                        moved = false;
                    });
                } else if (vis.editMode){
                    $svg.children().unbind('click touchstart').on('click touchstart', function () {
                        vis.inspectWidgets([wid]);
                    });
                }
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);
                // remember all ids, that bound
                $wid.data('bound', [oid + '.val'])
                // remember bind handler
                    .data('bindHandler', onChange);
            }
            var $svg = $wid.find('svg');
            if (!vis.editMode && !no_control) {
                $svg.children().off('click touchend').on('click touchend', onSvgClick).off('touchmove').on('touchmove', function () {
                    moved = true;
                }).on('touchstart', function () {
                    moved = false;
                });
            } else if (vis.editMode){
                $svg.children().off('click touchstart').on('click touchstart', function () {
                    vis.inspectWidgets([wid]);
                });
            }
            $wid.data('destroy', function (id, $widget) {
                $widget.find('svg').children().off('click touchend').off('touchmove').off('click touchstart');
            });
        },
        editNote: function (wid, max_width, min_width, min_height, oid) {
            if (vis.editMode) return;

            max_width  = max_width  ? parseInt(max_width,  10) : 400;
            min_width  = min_width  ? parseInt(min_width,  10) : 40;
            min_height = min_height ? parseInt(min_height, 10) : 15;

            var $this = $('#div_' + wid);
            $('body').append('<div id="dlg_' + wid + '" title="' + _('Edit note') + '">' +
                '<textarea style="resize: none; width:95%; height:92%" id="text_' + wid + '">' + $this.text().trim() + '</textarea></div>');

            var buttons = {};
            buttons[_('Clear')] = function () {
                $('#text_' + $(this).attr('data-wid')).val("");
            };

            buttons[_('Ok')] = function () {
                var dlg  = $(this);
                var oid  = dlg.attr('data-oid');
                var wid  = dlg.attr('data-wid');
                var text = $('#text_' + wid).val();
                text = text.replace('\n', '<br>\n');

                if (!oid) $('#div_' + wid).html(text);
                /*if (!text) {
                 $('#' + wid).css({width: min_width, height: min_height});
                 }
                 else {
                 $('#' + wid).css({width: max_width, height: 'auto'});
                 }*/

                if (oid) vis.setValue(oid, text);

                dlg.dialog('close');
                dlg.remove();
            };

            buttons[_('Cancel')] = function () {
                $(this).dialog('close');
                $(this).remove();
            };

            $('#dlg_' + wid).attr('data-oid', oid).attr('data-wid', wid).dialog({
                width:   500,
                height:  300,
                modal:   true,
                buttons: buttons
            });
        },
        formatFloat: function (data, val) {
            if (vis.editMode && data.attr('test_html') !== undefined && data.attr('test_html') !== '') {
                val = parseFloat(data.attr('test_html'));
            } else if(val === undefined || val === null){
                val = parseFloat(vis.states.attr(data.oid + '.val'));
            }else {
                val = parseFloat(val);
            }
            if (data.factor !== undefined && data.factor !== '') val = val * parseFloat(data.factor);
            if (data.digits !== undefined && data.digits !== '') val = val.toFixed(parseFloat(data.digits, 10));

            if (data.attr('is_tdp')) {
                val = this.formatValue(val, data.digits ? parseInt(data.digits) : 2, data.attr('is_comma') ? ".," : ",.");
            } else if (data.attr('is_comma')) {
                val = '' + val;
                val = val.replace('.', ',');
            }

            return val;
        },
        extractWidth: function (css, multiplier) {
            // extract from "2px solid #aabbcc" => 2px
            var m = css.match(/([0-9])+(px|em)?/);
            if (m) {
                if (m[1] && m[2]) {
                    return parseInt(m[1], 10) * (multiplier || 1) + m[2];
                } else {
                    return parseInt(m[1], 10) * (multiplier || 1);
                }
            }
        },
        getCalc: function (data, val) {
            var min = (data.min || data.min === 0) ? parseFloat(data.min) : 0;
            var max = (data.max || data.max === 0) ? parseFloat(data.max) : 100;
            val = parseFloat(vis.states.attr(data.oid + '.val')) || 0;
            val = (val - min) / (max - min);
            return (data.border) ? ('calc(' + Math.round(val * 100) + '% - ' + vis.binds.basic.extractWidth(data.border, 2) + ')') : (Math.round(val * 100) + '%');
        },

        formatValue: function formatValue(value, decimals, _format) {
            if (typeof decimals !== 'number') {
                decimals = 2;
                _format = decimals;
            }
            var format = (_format === undefined) ? '.,' : _format;
            if (typeof value !== 'number') value = parseFloat(value);
            return isNaN(value) ? '' : value.toFixed(decimals || 0).replace(format[0], format[1]).replace(/\B(?=(\d{3})+(?!\d))/g, format[0]);
        },

        formatIntervalHelper: function (value, type) {
            var singular;
            var plural;
            var special24;
            if (vis.language === 'de') {
                if (type === 'seconds') {
                    singular = 'Sekunde';
                    plural   = 'Sekunden';
                } else if (type === 'minutes') {
                    singular = 'Minute';
                    plural   = 'Minuten';
                } else if (type === 'hours') {
                    singular = 'Stunde';
                    plural   = 'Stunden';
                } else if (type === 'days') {
                    singular = 'Tag';
                    plural   = 'Tagen';
                }
            } else
            if (vis.language === 'ru') {
                if (type === 'seconds') {
                    singular  = 'секунду';
                    plural    = 'секунд';
                    special24 = 'секунды';
                } else if (type === 'minutes') {
                    singular  = 'минуту';
                    plural    = 'минут';
                    special24 = 'минуты';
                } else if (type === 'hours') {
                    singular  = 'час';
                    plural    = 'часов';
                    special24 = 'часа';
                } else if (type === 'days') {
                    singular  = 'день';
                    plural    = 'дней';
                    special24 = 'дня';
                }
            } else {
                if (type === 'seconds') {
                    singular = 'second';
                    plural   = 'seconds';
                } else if (type === 'minutes') {
                    singular = 'minute';
                    plural   = 'minutes';
                } else if (type === 'hours') {
                    singular = 'hour';
                    plural   = 'hours';
                } else if (type === 'days') {
                    singular = 'day';
                    plural   = 'days';
                }
            }

            if (value === 1) {
                if (vis.language === 'de') {
                    if (type === 'days') {
                        return 'einem ' + singular;
                    } else {
                        return 'einer ' + singular;
                    }
                } else if (vis.language === 'ru') {
                    if (type === 'days' || type === 'hours') {
                        return 'один ' + singular;
                    } else {
                        return 'одну ' + singular;
                    }
                } else {
                    return 'one ' + singular;
                }
            } else {
                if (vis.language === 'de') {
                    return value + ' ' + plural;
                } else if (vis.language === 'ru') {
                    var d = value % 10;
                    if (d === 1 && value !== 11) {
                        return value + ' ' + singular;
                    } else
                    if (d >= 2 && d <= 4 && (value > 20 || value < 10)) {
                        return value + ' ' + special24;
                    } else {
                        return value + ' ' + plural;
                    }
                } else {
                    return value + ' ' + plural;
                }
            }
        },
        formatInterval: function (timestamp, isMomentJs) {
            if (isMomentJs && typeof moment !== 'undefined') {
                return moment(new Date(timestamp)).fromNow();
            }
            var diff = new Date().getTime() - timestamp;
            diff = Math.round(diff / 1000);
            var text;
            if (diff <= 60) {
                if (vis.language === 'de') {
                    text = 'vor ' + vis.binds.basic.formatIntervalHelper(diff, 'seconds');
                } else if (vis.language === 'ru') {
                    text = vis.binds.basic.formatIntervalHelper(diff, 'seconds') + ' назад';
                } else {
                    text = vis.binds.basic.formatIntervalHelper(diff, 'seconds') + ' ago';
                }
            } else if (diff < 3600) {
                var m = Math.floor(diff / 60);
                var s = diff - m * 60;
                text = '';
                if (vis.language === 'de') {
                    text = 'vor ' + vis.binds.basic.formatIntervalHelper(m, 'minutes');
                } else if (vis.language === 'ru') {
                    text = vis.binds.basic.formatIntervalHelper(m, 'minutes');
                } else {
                    text = vis.binds.basic.formatIntervalHelper(m, 'minutes');
                }

                if (m < 5) {
                    // add seconds
                    if (vis.language === 'de') {
                        text += ' und ' + vis.binds.basic.formatIntervalHelper(s, 'seconds');
                    } else if (vis.language === 'ru') {
                        text += ' и ' + vis.binds.basic.formatIntervalHelper(s, 'seconds');
                    } else {
                        text += ' and ' + vis.binds.basic.formatIntervalHelper(s, 'seconds');
                    }
                }

                if (vis.language === 'de') {
                    // nothing
                } else if (vis.language === 'ru') {
                    text += ' назад';
                } else {
                    text += ' ago';
                }
            } else if (diff < 3600 * 24) {
                var h = Math.floor(diff / 3600);
                var m = Math.floor((diff - h * 3600) / 60);
                text = '';
                if (vis.language === 'de') {
                    text = 'vor ' + vis.binds.basic.formatIntervalHelper(h, 'hours');
                } else if (vis.language === 'ru') {
                    text = vis.binds.basic.formatIntervalHelper(h, 'hours');
                } else {
                    text = vis.binds.basic.formatIntervalHelper(h, 'hours');
                }

                if (h < 10) {
                    // add seconds
                    if (vis.language === 'de') {
                        text += ' und ' + vis.binds.basic.formatIntervalHelper(m, 'minutes');
                    } else if (vis.language === 'ru') {
                        text += ' и ' + vis.binds.basic.formatIntervalHelper(m, 'minutes');
                    } else {
                        text += ' and ' + vis.binds.basic.formatIntervalHelper(m, 'minutes');
                    }
                }

                if (vis.language === 'de') {
                    // nothing
                } else if (vis.language === 'ru') {
                    text += ' назад';
                } else {
                    text += ' ago';
                }
            } else {
                var d = Math.floor(diff / (3600 * 24));
                var h = Math.floor((diff - d * (3600 * 24)) / 3600);
                text = '';
                if (vis.language === 'de') {
                    text = 'vor ' + vis.binds.basic.formatIntervalHelper(d, 'days');
                } else if (vis.language === 'ru') {
                    text = vis.binds.basic.formatIntervalHelper(d, 'days');
                } else {
                    text = vis.binds.basic.formatIntervalHelper(d, 'days');
                }

                if (d < 3) {
                    // add seconds
                    if (vis.language === 'de') {
                        text += ' und ' + vis.binds.basic.formatIntervalHelper(h, 'hours');
                    } else if (vis.language === 'ru') {
                        text += ' и ' + vis.binds.basic.formatIntervalHelper(h, 'hours');
                    } else {
                        text += ' and ' + vis.binds.basic.formatIntervalHelper(h, 'hours');
                    }
                }

                if (vis.language === 'de') {
                    // nothing
                } else if (vis.language === 'ru') {
                    text += ' назад';
                } else {
                    text += ' ago';
                }
            }
            return text;
        },
        startUpdateInterval: function () {
            if (vis.binds.basic.updateInterval) return;
            vis.binds.basic.updateInterval = setInterval(function () {
                $('.time-interval').each(function () {
                    $(this).html(vis.binds.basic.formatInterval($(this).data('time'), $(this).data('moment')))
                });
            }, 15000);
        },
        formatDate: function (dateObj, format, interval, isMomentJs) {
            if (typeof format === 'boolean') {
                interval = format;
                format = 'auto';
            }

            if (format === 'auto') format = (vis.dateFormat || 'DD.MM.YYYY') + ' hh:mm:ss';

            format = format || vis.dateFormat || 'DD.MM.YYYY';

            if (!dateObj) return '';
            var text = typeof dateObj;
            if (text === 'string') {
		dateObj = new Date(dateObj);
            }
            if (text !== 'object') {
                var i = parseInt(dateObj, 10);
                if (i == dateObj) {
                    i = dateObj;
                    // if greater than 2000.01.01 00:00:00
                    if (i > 946681200000) {
                        dateObj = new Date(dateObj);
                    } else {
                        dateObj = new Date(dateObj * 1000);
                    }
                } else {
                    dateObj = new Date(dateObj);
                }
            }
            if (interval) {
                vis.binds.basic.startUpdateInterval();
                return '<span class="time-interval" data-time="' + dateObj.getTime() + '" data-moment="' + (isMomentJs || false) + '">' + vis.binds.basic.formatInterval(dateObj.getTime(), isMomentJs) + '</span>';
            }

            var v;

            // Year
            if (format.indexOf('YYYY') !== -1 || format.indexOf('JJJJ') !== -1 || format.indexOf('ГГГГ') !== -1) {
                v = dateObj.getFullYear();
                format = format.replace('YYYY', v);
                format = format.replace('JJJJ', v);
                format = format.replace('ГГГГ', v);
            } else if (format.indexOf('YY') !== -1 || format.indexOf('JJ') !== -1 || format.indexOf('ГГ') !== -1) {
                v = dateObj.getFullYear() % 100;
                format = format.replace('YY', v);
                format = format.replace('JJ', v);
                format = format.replace('ГГ', v);
            }
            // Month
            if (format.indexOf('MM') !== -1 || format.indexOf('ММ') !== -1) {
                v =  dateObj.getMonth() + 1;
                if (v < 10) v = '0' + v;
                format = format.replace('MM', v);
                format = format.replace('ММ', v);
            } else if (format.indexOf('M') !== -1 || format.indexOf('М') !== -1) {
                v =  dateObj.getMonth() + 1;
                format = format.replace('M', v);
                format = format.replace('М', v);
            }

            // Day
            if (format.indexOf('DD') !== -1 || format.indexOf('TT') !== -1 || format.indexOf('ДД') !== -1) {
                v =  dateObj.getDate();
                if (v < 10) v = '0' + v;
                format = format.replace('DD', v);
                format = format.replace('TT', v);
                format = format.replace('ДД', v);
            } else if (format.indexOf('D') !== -1 || format.indexOf('TT') !== -1 || format.indexOf('Д') !== -1) {
                v =  dateObj.getDate();
                format = format.replace('D', v);
                format = format.replace('T', v);
                format = format.replace('Д', v);
            }

            // hours
            if (format.indexOf('hh') !== -1 || format.indexOf('SS') !== -1 || format.indexOf('чч') !== -1) {
                v =  dateObj.getHours();
                if (v < 10) v = '0' + v;
                format = format.replace('hh', v);
                format = format.replace('SS', v);
                format = format.replace('чч', v);
            } else if (format.indexOf('h') !== -1 || format.indexOf('S') !== -1 || format.indexOf('ч') !== -1) {
                v =  dateObj.getHours();
                format = format.replace('h', v);
                format = format.replace('S', v);
                format = format.replace('ч', v);
            }

            // minutes
            if (format.indexOf('mm') !== -1 || format.indexOf('мм') !== -1) {
                v =  dateObj.getMinutes();
                if (v < 10) v = '0' + v;
                format = format.replace('mm', v);
                format = format.replace('мм', v);
            } else if (format.indexOf('m') !== -1 ||  format.indexOf('м') !== -1) {
                v =  dateObj.getMinutes();
                format = format.replace('m', v);
                format = format.replace('v', v);
            }

            // milliseconds
            if (format.indexOf('sss') !== -1 || format.indexOf('ссс') !== -1) {
                v =  dateObj.getMilliseconds();
                if (v < 10) {
                    v = '00' + v;
                } else if (v < 100) {
                    v = '0' + v;
                }
                format = format.replace('sss', v);
                format = format.replace('ссс', v);
            }

            // seconds
            if (format.indexOf('ss') !== -1 || format.indexOf('сс') !== -1) {
                v =  dateObj.getSeconds();
                if (v < 10) v = '0' + v;
                format = format.replace('ss', v);
                format = format.replace('cc', v);
            } else if (format.indexOf('s') !== -1 || format.indexOf('с') !== -1) {
                v =  dateObj.getHours();
                format = format.replace('s', v);
                format = format.replace('с', v);
            }

            return format;
        },
        detectScreen: function (wid) {
            if (vis.navChangeCallbacks.indexOf(vis.binds.basic.detectScreen) === -1) {
                vis.navChangeCallbacks.push(vis.binds.basic.detectScreen);
            }

            function onResize () {
                if (vis.editMode) {
                    $('.vis-resolution-width').html(vis.views[vis.activeView].settings.sizex  || $(window).width());
                    $('.vis-resolution-height').html(vis.views[vis.activeView].settings.sizey || $(window).height());
                    $('.vis-resolution-default-view').html(vis.findNearestResolution(vis.views[vis.activeView].settings.sizex || $(window).width(), vis.views[vis.activeView].settings.sizey || $(window).height()));
                } else {
                    $('.vis-resolution-width').html($(window).width());
                    $('.vis-resolution-height').html($(window).height());
                    $('.vis-resolution-default-view').html(vis.findNearestResolution());
                }
            }

            setTimeout(function () {
                $(window).bind('resize', onResize);
                if (vis.editMode) {
                    $('.vis-resolution-width').html(vis.views[vis.activeView].settings.sizex  || $(window).width());
                    $('.vis-resolution-height').html(vis.views[vis.activeView].settings.sizey || $(window).height());
                    $('.vis-resolution-default-view').html(vis.findNearestResolution(vis.views[vis.activeView].settings.sizex || $(window).width(), vis.views[vis.activeView].settings.sizey || $(window).height()));
                } else {
                    $('.vis-resolution-width').html($(window).width());
                    $('.vis-resolution-height').html($(window).height());
                    $('.vis-resolution-default-view').html(vis.findNearestResolution());
                }
            }, 100);

            if (vis.editMode) {
                $('#' + wid).data('destroy', function () {
                    $(window).unbind('resize', onResize);
                });
            }
        },
        createScreenText: function () {
            setTimeout(function () {
                $('.basic-click-create-instance').unbind('click').click(function () {
                    if (!vis.instance) {
                        vis.generateInstance();
                        if (vis.instance) {
                            $(this).html(vis.instance).removeClass('basic-click-create-instance').css({
                                'font-weight': 'inherit',
                                cursor: 'inherit'
                            });
                        } else {
                            window.alert('Cannot generate!');
                        }
                    }
                });
            }, 500);
            return '<span class="basic-click-create-instance" style="font-weight: bold; cursor: pointer">' + _('click to create') + '</span>';
        },
        isFalse: function (val, min, max) {
            if (min !== undefined && min !== null && min !== '') {
                if (val === 'true') {
                    val = true;
                }
                if (val === 'false') {
                    val = false;
                }
                if (max !== undefined && max !== null && max !== '') {
                    if (max === 'false') {
                        max = false;
                    }
                    if (max === 'true') {
                        max = true;
                    }
                    return val != max;
                } else {
                    if (min === 'false') {
                        min = false;
                    }
                    if (min === 'true') {
                        min = true;
                    }
                    return val == min;
                }
            }
            if (val === undefined || val === null || val === false || val === 'false' || val === 'FALSE' || val === 'False' || val === 'OFF' || val === 'Off' || val === 'off' || val === '') return true;
            if (val === '0' || val === 0) return true;
            var f = parseFloat(val);
            if (f.toString() !== 'NaN') return !f;
            return false;
        },
        circlePoints: function (radius, num, step) {
            var isArray = false;
            if (step === true) {
                isArray = true;
                step = 0;
            }
            step = step || 360 / num;
            var points = [];
            var text = '';
            for (var i = 0; i < num; i++) {
                var point = {x:Math.sin(Math.PI / 180 * (i * step - 180)) * radius, y:Math.cos(Math.PI / 180 * (i * step - 180)) * radius};
                points.push(point);
                text += point.x + ', ' + point.y + ' ';
            }
            if (isArray) return points;
            return text;
        },
        createValueGesture: function (widgetID, view, data, style) {
            var $div = $('#' + widgetID);
            // if nothing found => wait
            if (!$div.length) {
                return setTimeout(function () {
                    vis.binds.basic.createValueGesture(widgetID, view, data, style);
                }, 100);
            }
            var $content = $('#' + widgetID + ' .vis-widget-body');
            function refresh(val, x, y) {
                var text;
                if (val === null){
                    $div.hide();
                    return;
                }
                text = data.html_prepend || '';
                text += vis.binds.basic.formatFloat(data,val);
                text += parseFloat(vis.binds.basic.formatFloat(data,val)) === 1 ? data.html_append_singular || '' : data.html_append_plural || '';
                $content.html(text);
                $div.css({left: parseInt(x)  -$div.width() / 2 + 'px', top: parseInt(y) - $div.height() / 2 + 'px'}).show();
            }
            if (vis.editMode){
                refresh(data.test_html || 0, $div.position().left + $div.width() / 2, $div.position().top + $div.height() / 2);
            } else {
                refresh(null, 0, 0);
            }

            // subscribe top value updates
            $div.on('gestureUpdate', function(event, evData){
                refresh(evData.val, evData.x, evData.y);
            });
        },
        speech2text: function (wid, view, data, style) {
            var $div = $('#' + wid);
            // if nothing found => wait
            if (!$div.length) {
                return setTimeout(function () {
                    vis.binds.basic.speech2text(wid, view, data, style);
                }, 100);
            }

            if (typeof webkitSpeechRecognition === 'undefined') {
                console.error('Browser does not support speech 2 text');
                $div.find('.mic-info-text').html(_('info_upgrade'));
                return;
            }

            var _data ={
                continuous:     data.speechMode === 'continuous' || data.speechMode === 'startstop',
                speechMode:     data.speechMode,
                oid:            data.oid,
                language:       data.language,
                finalTranscript: '',
                lastText:       '',
                recognition:    null,
                ignoreOnEnd:    false,
                timer:          null,
                words:          data.keywords ? data.keywords.toLowerCase().split(/[\s,;]+/g) : null,
                textSentColor:  data.textSentColor,
                keyWordColor:   data.keyWordColor,
                imageInactive:  data.imageInactive,
                imageActive:    data.imageActive    || data.imageInactive,
                imageStarted:   data.imageStarted   || data.imageInactive,
                imageDetected:  data.imageDetected  || data.imageInactive,
                imageSent:      data.imageSent      || data.imageInactive,
                $text:          $div.find('.mic-info-text'),
                $result:        $div.find('.mic-results'),
                $image:         $div.find('.mic-image')
            };
            data = null;

            function findKeyWord(text) {
                var found = false;
                if (_data.words) {
                    found = false;
                    var wwords = text.toLowerCase().split(' ');
                    for (var w = 0; w < _data.words.length; w++) {
                        var pos = wwords.indexOf(_data.words[w]);
                        if (pos !== -1) {
                            var offset = 0;
                            for (var p = 0; p < pos; p++) {
                                offset += wwords[p].length + 1;
                            }
                            text = text.substring(0, offset) + '<b>' + text.substring(offset, offset + wwords[pos].length) + '</b>' + text.substring(offset + wwords[pos].length);
                            found = true;
                            break;
                        }
                    }
                } else {
                    return true;
                }
                return found ? text : false;
            }

            function startRecognition() {
                if (_data.recognition) {
                    if (_data.speechMode === 'startstop') {
                        _data.recognition.onend = null;
                        _data.recognition.stop();
                        _data.recognition = null;
                        _data.$text.html(_('info_start')).show();
                        _data.$image.attr('src', _data.imageInactive);
                        _data.$result.hide();
                    }
                    return;
                }

                _data.recognition                 = new webkitSpeechRecognition();
                _data.recognition.continuous      = _data.continuous;
                _data.recognition.interimResults  = true;
                _data.recognition.maxAlternatives = 1;
                var startTimestamp = new Date();


                _data.recognition.onstart = function() {
                    _data.$text.html(_('info_speak_now')).show();
                    _data.$image.attr('src', _data.imageActive);
                    _data.$result.hide();
                };

                _data.recognition.onerror  = function(event) {
                    _data.$result.hide();
                    _data.$text.show();
                    _data.$image.attr('src', _data.imageInactive);
                    if (event.error === 'no-speech') {
                        _data.$text.html(_('info_no_speech'));
                        //_data.ignoreOnEnd = true;
                    }
                    if (event.error === 'audio-capture') {
                        _data.$text.html(_('info_no_microphone'));
                        _data.ignoreOnEnd = true;
                    }
                    if (event.error === 'not-allowed') {
                        if (event.timeStamp - startTimestamp < 100) {
                            _data.$text.html(_('info_blocked'));
                        } else {
                            _data.$text.html(_('info_denied'));
                        }
                        _data.ignoreOnEnd = true;
                    }
                };

                _data.recognition.onend    = function() {
                    // console.log('onend');
                    _data.recognition.stop();
                    _data.recognition = null;
                    if (!_data.ignoreOnEnd) {
                        setTimeout(function () {
                            _data.$image.attr('src', _data.imageInactive);
                            if (_data.continuous) {
                                _data.$result.hide();
                                _data.$text.html(_('info_speak_now')).show();
                                startRecognition();
                            } else {
                                _data.$result.hide();
                                _data.$text.html(_('info_start')).show();
                            }
                        }, 1000);
                    }
                };

                _data.recognition.onresult = function(event) {
                    var interimTranscript = '';

                    if (typeof event.results === 'undefined') {
                        _data.recognition.onend = null;
                        _data.recognition.stop();
                        return;
                    }

                    for (var i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            _data.finalTranscript += event.results[i][0].transcript;
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }

                    if (_data.$image.attr('src') === _data.imageActive) _data.$image.attr('src', _data.imageStarted);

                    //final_transcript = capitalize(final_transcript);
                    _data.$text.hide();
                    var text = _data.finalTranscript || interimTranscript;
                    var found = findKeyWord(text);

                    if (!_data.originalColor) _data.originalColor = _data.$result.css('color');

                    if (found) {
                        text = found;
                        if (_data.$image.attr('src') === _data.imageStarted) _data.$image.attr('src', _data.imageDetected);
                        _data.$result.addClass('mic-keyword-found');
                        if (_data.keyWordColor) _data.$result.css({color: _data.keyWordColor});
                    }

                    _data.$result.html(text).show();

                    if (_data.finalTranscript) {
                        if (_data.timer) clearTimeout(_data.timer);

                        if (found) {
                            _data.$image.attr('src', _data.imageSent);
                            if (_data.textSentColor) _data.$result.css({color: _data.textSentColor});
                            _data.$result.addClass('mic-text-sent');
                            vis.setValue(_data.oid, _data.finalTranscript);
                        }

                        _data.finalTranscript = '';
                        _data.lastText = '';

                        setTimeout(function () {
                            _data.$image.attr('src', _data.imageActive);
                            _data.$result.css({color: _data.originalColor});
                            _data.$result.hide().removeClass('mic-keyword-found mic-text-sent');
                            _data.$text.html(_('info_speak_now')).show();
                        }, 1000);
                    } else {
                        _data.lastText = interimTranscript;

                        if (_data.timer) clearTimeout(_data.timer);
                        _data.timer = setTimeout(function () {
                            _data.timer = null;
                            _data.recognition.onend = null;
                            _data.recognition.stop();
                            _data.recognition = null;

                            var found = findKeyWord(_data.lastText);
                            if (found) {
                                _data.$image.attr('src', _data.imageSent);
                                if (_data.textSentColor) _data.$result.css({color: _data.textSentColor});
                                _data.$result.addClass('mic-text-sent');
                                vis.setValue(_data.oid, _data.finalTranscript);
                            }

                            _data.finalTranscript = '';
                            _data.lastText = '';

                            setTimeout(function () {
                                _data.$image.attr('src', _data.imageActive);
                                _data.$result.css({color: _data.originalColor});
                                _data.$result.hide().removeClass('mic-keyword-found mic-text-sent');
                                _data.$text.html(_('info_speak_now')).show();
                                startRecognition();
                            }, 1000);
                        }, 3000);
                    }
                };

                _data.recognition.lang     = _data.language;

                _data.recognition.start();
            }

            if (_data.speechMode === 'continuous') {
                if (!vis.editMode) {
                    startRecognition();
                } else {
                    $div.find('.mic-info-text').html(_('info_start'));
                }
            } else {
                $div.find('.mic-info-text').html(_('info_start'));
                if (!vis.editMode) {
                    $div.click(function () {
                        startRecognition();
                    });
                }
            }
        },
        getTimeInterval: function (oldTime, hoursToShow) {
            var result = '';

            var newTime = new Date ();

            if (!oldTime) return '';
            if (typeof oldTime === 'string') {
                oldTime = new Date(oldTime);
            } else {// 2000.01.01 00:00:00 = 946681200000
                if (typeof oldTime === 'number') oldTime = oldTime > 946681200000 ? new Date(oldTime) : new Date(oldTime * 1000);
            }

            var seconds = (newTime.getTime() - oldTime.getTime()) / 1000;

            if (hoursToShow && (seconds / 3600) > hoursToShow) return '';

            if (seconds < 60) {
                result = _('just&nbsp;now');
            } else
            if (seconds <= 3600)
                result = _('for&nbsp;%s&nbsp;min.', Math.floor (seconds / 60));
            else
            if (seconds <= 3600 * 24)
                result = _('for&nbsp;%s&nbsp;hr.&nbsp;and&nbsp;%s&nbsp;min.', Math.floor (seconds / 3600), (Math.floor (seconds / 60) % 60));
            else
            if (seconds > 3600 * 24 && seconds <= 3600 * 48)
                result = _('yesterday');
            else
            if (seconds > 3600*48) {
                result = _('for&nbsp;%s&nbsp;hours', Math.floor (seconds / 3600));
            }

            return result;
        },
        logout: function (el, data) {
            if (vis.editMode) return;
            var $el = $(el);
            $el.data('redirect', data.redirect_url);
            $el.data('app', data.in_app_close);

            $el.click(function () {
                if ($(this).data('app')) {
                    if (typeof logout === 'function') {
                        logout();
                    } else {
                        vis.showMessage(_('This option works only in APP'));
                    }
                } else if ($(this).data('redirect')) {
                    var redirect = $(this).data('redirect');
                    vis.conn.logout(function() {
                        window.location = redirect;
                    });
                } else {
                    vis.conn.logout(function(){
                        window.location.reload();
                    });
                }
            });
        },
        toggleFullScreen: function (wid, view, data, style) {
            var $div = $('#' + wid);

            var id = $div.attr('id');
            if (id && id.match(/_removed$/)) return;

            // if nothing found => wait
            if (!$div.length) {
                setTimeout(function () {
                    vis.binds.basic.toggleFullScreen(wid, view, data, style);
                }, 100);
                return;
            }

            var svgOn  = '<svg viewBox="0 0 24 24" style="display: inline-block; color: rgba(0, 0, 0, 0.87); fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>';
            var svgOff = '<svg viewBox="0 0 24 24" style="display: inline-block; color: rgba(0, 0, 0, 0.87); fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg>';

            if (!vis.editMode) {
                $div.unbind('click').click(function () {
                    if (vis.binds.basic.isFullScreen) {
                        vis.binds.basic.isFullScreen = false;
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.mozCancelFullScreen) {
                            document.mozCancelFullScreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        }
                        $('#' + wid).find('.vis-fullscreen-icon').html(svgOn);
                    } else {
                        vis.binds.basic.isFullScreen = true;
                        var element = $('#vis_container')[0];
                        if (element.requestFullscreen) {
                            element.requestFullscreen();
                        } else if (element.mozRequestFullScreen) {
                            element.mozRequestFullScreen();
                        } else if (element.webkitRequestFullscreen) {
                            element.webkitRequestFullscreen();
                        } else if (element.msRequestFullscreen) {
                            element.msRequestFullscreen();
                        }
                        $('#' + wid).find('.vis-fullscreen-icon').html(svgOff);
                    }
                });
            }

            $div.find('.vis-fullscreen-icon').html(svgOn);
        }
    };

    $(document).mouseup(function () {
        if (vis.binds.basic.pressed) {
            clearInterval(vis.binds.basic.pressed);
            vis.binds.basic.pressed = null;
        }
    });

    if (vis.editMode) {
        vis.binds.basic.onOrientation = function (widgetID, view, newId, attr, isCss) {
            var data  = vis.views[view].widgets[widgetID].data;
            var style = vis.views[view].widgets[widgetID].style;
            var h = parseInt(style.height, 10);
            var w = parseInt(style.width, 10);

            if (data[attr] === 'vertical') {
                if (h < w) {
                    var t = style.height;
                    style.height = style.width;
                    style.width = t;
                    setTimeout(function () {
                        vis.showWidgetHelper(widgetID, true);
                    }, 0);
                    return ['width', 'height'];
                }
            } else {
                if (w < h) {
                    var t = style.height;
                    style.height = style.width;
                    style.width = t;
                    setTimeout(function () {
                        vis.showWidgetHelper(widgetID, true);
                    }, 0);
                    return ['width', 'height'];
                }
            }
        };
        vis.binds.basic.onAttrChanged = function (widgetID, view, newId, attr, isCss) {
            if (vis.binds.basic.groupTimer) clearTimeout(vis.binds.basic.groupTimer);
            vis.binds.basic.groupTimer = setTimeout(function () {
                vis.inspectWidgets(vis.activeViewDiv, vis.activeView, this.activeWidgets);
            }, 2000);
        };
    }
</script>

<!-- Basic Widgets -->


<script id="tplHtml"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-prev='<img src="widgets/basic/img/Prev_HTML.png"></img>'
        data-vis-prev1='<div id="prev_tplFrame" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev vis-widget-lock" style="width: 80px; height: 80px; border: 3px solid rgb(73, 185, 255); border-radius: 20px;"><div style="top: 30px; color: rgb(73, 185, 255); font-size: 20px; text-align: center; padding-top: 32px;">HTML</div></div>'
        data-vis-name="HTML"
        data-vis-attrs="html/text;refreshInterval[0]/slider,0,180000,100">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" <%= (el) -> vis.binds.basic.htmlRefresh(el, this.data.attr('html'), data.attr("refreshInterval")) %>>
            <%== this.data.attr('html') %>
        </div>
    </div>
</script>

<script id="tplShapes"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-name="Svg shape"
        data-vis-prev='<div id="prev_tplShapes" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev " style="width: 90px; height: 90px; left: 502px; top: 174px; position: absolute;"> <div class="vis-widget-prev-body"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" style="display: block;width: 100%;height: 100%;fill: rgb(255, 255, 255);stroke: rgb(60, 152, 211); stroke-width: 4px;"> <circle cx="50" cy="50" r="47"></circle></svg></div> </div></div>'
        data-vis-attrs="svgType[circle]/select,line,triangle,square,pentagone,hexagone,octagone,circle,star,arrow;strokeColor[#009cb3]/color;fill[#00b3ac]/color;strokeWidth[5]/slider,0,100,1;rotate/slider,0,360,1;scaleWidth[1]/slider,0,1,0.1;scaleHeight[1]/slider,0,1,0.1">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 100px; height: 100px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewbox="-50 -50 100 100" style="display: block;width:100%; height:100%;fill:<%== this.data.attr('fill') %>;stroke:<%== this.data.attr('strokeColor')%>;stroke-width: <%== this.data.attr('strokeWidth') %>">
                <%
                var svg = '';
                var rotate      = parseFloat(this.data.attr('rotate')) || 0;
                var scaleWidth  = parseFloat(this.data.attr('scaleWidth')) || 1;
                var scaleHeight = parseFloat(this.data.attr('scaleHeight')) || 1;
                var strokeWidth = parseInt(this.data.attr('strokeWidth'), 10) || 0;

                if (this.data.svgType === 'triangle') {
                    svg = '<polygon transform="rotate(' + rotate + ')  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="' + vis.binds.basic.circlePoints(50 - strokeWidth, 3) + '"/>';
                } else if (this.data.svgType === 'line') {
                    svg = '<line  vector-effect="non-scaling-stroke"  transform="rotate(' + rotate + ')" x1="-50" y1="0" x2="50" y2="0"/>';
                } else if (this.data.svgType === 'circle') {
                    svg = '<circle transform="scale(' + scaleWidth + ', ' + scaleHeight + ') rotate(' + rotate + ')" cx="0" cy="0" r="' + (50 - parseInt(strokeWidth, 10) / 2) + '" />';
                } else if (this.data.svgType === 'pentagone') {
                    svg = '<polygon transform="rotate(' + rotate + ')  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="' + vis.binds.basic.circlePoints(50 - strokeWidth, 5) + '"/>';
                } else if (this.data.svgType === 'square') {
                    svg = '<polygon transform="rotate(' + rotate + ')  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="' + vis.binds.basic.circlePoints(50 - strokeWidth, 4) + '"/>';
                } else if (this.data.svgType === 'hexagone') {
                    svg = '<polygon transform="rotate(' + rotate + ')  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="' + vis.binds.basic.circlePoints(50 - strokeWidth, 6) + '"/>';
                } else if (this.data.svgType === 'octagone') {
                    svg = '<polygon transform="rotate(' + rotate + ')  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="' + vis.binds.basic.circlePoints(50 - strokeWidth, 8) + '"/>';
                } else if (this.data.svgType === 'star') {
                    svg = '<polygon transform="rotate(' + rotate + ')  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="' + vis.binds.basic.circlePoints(50 - strokeWidth, 5, 144) + '"/>';
                } else if (this.data.svgType === 'arrow') {
                    var points = vis.binds.basic.circlePoints(50 - strokeWidth * 4, 3, true);
                    var text = '';
                    for (var p = 0; p < points.length; p++) {
                        text += points.x + ',' + points.y;
                        if (points.length === p - 2) {
                            text += '0,0';
                        }
                    }
                    svg = '<polygon transform="rotate(' + rotate + ') translate(0,10)  scale(' + scaleWidth + ', ' + scaleHeight + ') " ' +
                        'points="0, -50 -43.3, 25 0,0 43.3, 25"/>';
                }
                %>
                <%== svg %>
                </g>
            </svg>
        </div>
    </div>
</script>

<script id="tplIFrame"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-prev='<img src="widgets/basic/img/Prev_iFrame.png"></img>'
        data-vis-name="iFrame"
        data-vis-attrs="src;refreshInterval[0]/slider,0,180000,100;noSandbox/checkbox;refreshOnWakeUp/checkbox;refreshOnViewChange/checkbox;refreshWithNoQuery/checkbox;scrollX/checkbox;scrollY/checkbox;seamless[true]/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top: 0px; left: 0px; width: 600px; height: 320px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
            <div class="editmode-helper" />
            <% } %>
            <iframe src="<%= this.data.attr('src') %>" <%= this.data.attr('noSandbox') ? '' : 'sandbox="allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"' %> style="position: absolute; border: 0; padding: 0; margin: 0; width: 100%; height: 100%;<%= this.data.attr('scrollX') == true ? 'overflow-x: scroll;' : 'overflow-x: hidden;' %><%= this.data.attr('scrollY') == true ? 'overflow-y: scroll;' : 'overflow-y: hidden;' %>" <%= this.data.attr('seamless') == true ? 'seamless' : '' %>></iframe>
            <div <%= (el) -> vis.binds.basic.iframeRefresh(el, data, this.view) %>></div>
        </div>
    </div>
</script>

<script id="tplImage"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-prev='<img src="widgets/basic/img/Prev_Image.png"></img>'
        data-vis-name="Image"
        data-vis-attrs="src/image;stretch/checkbox;refreshInterval[0]/slider,0,180000,100;"
        data-vis-attrs0="refreshOnWakeUp/checkbox;refreshOnViewChange/checkbox;refreshWithNoQuery/checkbox;allowUserInteractions/checkbox;">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <img class="<%= this.data.attr('stretch') ? 'vis-image' : '' %> <%= this.data.attr('allowUserInteractions') ? '' : 'vis-no-user-select vis-no-pointer-events' %>" style="top:0; left: 0; position: absolute; width: 100%; <%= this.data.attr('stretch') ? 'height: 100%;' : '' %>" <%= this.data.attr('src') ? 'src="' + this.data.attr('src') + '"' : '' %> />
            <div <%= (el) -> vis.binds.basic.imgRefresh(el, data, this.view) %> />
        </div>
    </div>
</script>

<script id="tplLink"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_tplLink.png"></img>'
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-name="link"
        data-vis-attrs="html;href;target/auto,,_blank,_self,_parent,_top;alt">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; " id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <a href="<%== this.data.attr('href') %>" target="<%== this.data.attr("target") %>" alt="<%== this.data.attr("alt") %>" style="text-decoration:none;width:100%;height:100%"><div style="width:100%;height:100%"><%== this.data.attr("html") %></div></a>
        </div>
    </div>
</script>

<script id="tplFrame"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplFrame" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev vis-widget-lock" style="width: 80px; height: 80px; border: 3px dashed rgb(60, 152, 211); border-radius: 20px;"><div style="top: 30px; color: rgb(60, 152, 211); font-size: 16px; text-align: center; padding-top: 31px;">BORDER</div></div>'
        data-vis-set="basic"
        data-vis-type="static"
        data-vis-name="Border"
        data-vis-attrs="title['Title'];title_font;title_color[black]/color;title_back/color;title_top[-10]/slider,-20,20,1;title_left[15]/slider,-20,30,1;header_height[0]/slider,0,100,1;header_color[black]/color">
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible;width:50px;height:50px;border:1px solid #888" id="<%= this.data.attr('wid') %>" >
        <% if (this.data.attr('header_height')) { %>
	    <div style="width:100%;height:<%= this.data.attr('header_height') %>px;background-color:<%= this.data.attr('header_color') %>">
		<% } %>
        <div style="position: absolute;top:<%= this.data.attr('title_top') %>px;left:<%= this.data.attr('title_left') %>px;color:<%== this.data.attr('title_color') %>;background:<%== this.data.attr('title_back') %>;font:<%== this.data.attr('title_font') %>"><%== this.data.attr('title') %></div>
        <% if (this.data.attr('header_height')) { %>
        </div>
		<% } %>
    </div>
</script>

<script id="tplStatefulIFrame8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_StatefulIFrame8.png"></img>'
        data-vis-type="stateful"
        data-vis-name="iFrame 8"
        data-vis-attrs="oid;refreshInterval[0]/slider,0,180000,100;count[1]/number;group.frames;src_(0-count);noSandbox/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 600px; height: 320px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper"/>
        <% } %>
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper"/>
            <% } %>
            <%
                var srcArr = [];
                var i = 0;
                while(data.attr('src_' + i) !== undefined) {
                    srcArr.push(data.attr('src_' + i));
                    i++;
                }
            %>
            <iframe class="vis-widget-element" <%= this.data.attr('noSandbox') ? '' : 'sandbox="allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"' %> data-oid="<%= this.data.attr('oid') %>" src="<%== vis.binds.stateful.value(srcArr, data.attr('oid')) %>" style="position: absolute; border: 0; padding: 0; margin: 0; width: 100%; height: 100%;"></iframe>
            <div <%= (el) -> vis.binds.stateful.iframe(el, srcArr, data.attr('refreshInterval')) %> />
        </div>
    </div>
</script>

<!-- basic Container -->
<script id="tplContainerView"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ContainerView.png"></img>'
        data-vis-type="container"
        data-vis-name="view in widget"
        data-vis-attrs="contains_view/views">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:400px; height: 270px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper"></div>
        <% } %>
        <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container">
        </div>
    </div>
</script>

<!-- Stateful Widgets -->
<script id="tplStatefulContainerView8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_StatefulContainerView8.png"></img>'
        data-vis-type="stateful,container"
        data-vis-name="view in widget 8"
        data-vis-attrs="oid;persistent/checkbox;notIfInvisible/checkbox;count[1]/number;group.views;contains_view_(0-count)/views">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:400px; height: 270px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper" />
        <% } %>
        <%
            var viewArr = [];
            var i = 0;
            while (data.attr('contains_view_' + i) !== undefined) {
                viewArr.push(data.attr('contains_view_' + i));
                i++;
            }
        %>
        <div class="vis-widget-body">
            <div class="vis-view-container" data-oid="<%= data.attr('oid') %>" data-vis-contains="<%= vis.binds.stateful.value(viewArr, data.attr('oid')) %>" <%= (el) -> vis.binds.stateful.view(el, viewArr, data.attr('persistent'), data.attr('notIfInvisible')) %> />
        </div>
    </div>
</script>

<!-- TODO
<script type="text/ejs" id="tplStatefulIFrame8Persistent" class="vis-tpl" data-vis-set="basic" data-vis-name="stateful - iFrame 8 (persistent)" data-vis-attrs="oid;refreshInterval;src_(0-1)">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 600px; height: 320px;" id="<%= this.data.attr('wid') %>">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
          <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_0') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_1') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_2') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_3') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_4') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_5') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_6') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <iframe class="vis-widget-element" src="<%= this.data.attr('src_7') %>" style="position: absolute; border:0; padding:0; margin:0; width: 100%; height:100%;"></iframe>
            <div <%= (el) -> vis.binds.stateful.iframe(el, [data.attr("src_0"), data.attr("src_1"), data.attr("src_2"), data.attr("src_3"), data.attr("src_4"), data.attr("src_5"), data.attr("src_6"), data.attr("src_7"]), data.attr("refreshInterval")) %> />
        </div>
    </div>
</script>
-->

<script id="tplStatefulImage8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_StatefulImage.png"></img>'
        data-vis-type="stateful"
        data-vis-name="Image 8"
        data-vis-attrs="oid;refreshInterval[0]/slider,0,180000,100;count[1]/number;group.images;src_(0-count)/image">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
            <div class="editmode-helper" />
        <% } %>
        <div class="vis-widget-body">
            <% if (vis.editMode) { %>
                <div class="editmode-helper" />
            <% } %>
            <%
                var srcArr = [];
                var i = 0;
                while(data.attr("src_" + i) !== undefined) {
                    srcArr.push(this.data.attr("src_" + i));
                    i++;
                }
            %>
            <img class="vis-widget-element" data-oid="<%= this.data.attr('oid') %>" style="position:absolute; width:100%;" src="<%== vis.binds.stateful.value(srcArr, this.data.attr('oid')) %>" />
            <div <%= (el) -> vis.binds.stateful.image(el, srcArr, data.attr('refreshInterval')) %> />
        </div>
    </div>
</script>

<script id="tplHtmlNav"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="static,navigation"
        data-vis-prev='<img src="widgets/basic/img/Prev_HTMLnavigation.png"></img>'
        data-vis-name="HTML navigation"
        data-vis-attrs="html;nav_view;sync/checkbox;body-background/color;group.effects;hide_effect/effect;hide_duration/slider,0,10000,100;hide_options/effect-options;show_effect/effect;show_duration/slider,0,10000,100;show_options/effect-options">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; " id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.basic.navigation(el, {nav_view: data.attr('nav_view'), hideOptions: {effect: data.attr('hide_effect'), options: (data.attr('hide_options') ? data.attr('hide_options') : {}),duration:data.attr('hide_duration')}, showOptions: {effect:data.attr('show_effect'), options: (data.attr('show_options') ? data.attr('show_options') : {}), duration: data.attr('show_duration')}, sync: data.attr('sync'), background: data.attr('body-background')}) %>>
        <div class="vis-widget-body">
            <%== this.data.attr('html') %>
        </div>
    </div>
</script>

<script id="tplFilterDropdown"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_FilterDropdown.png"></img>'
        data-vis-set="basic"
        data-vis-type="filter"
        data-vis-name="filter - dropdown"
        data-vis-attrs="filters;group.effects;hide_effect/effect;hide_duration/slider,0,10000,100;show_effect/effect;show_duration/slider,0,10000,100;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left:0px; width: 200px; height: 40px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.basic.filterDropdown(el, data.attr('filters'), data.attr('hide_effect'), data.attr('hide_duration'), data.attr('show_effect'), data.attr('show_duration')) %>>
        <div class="vis-widget-body">
            <select id="" name="" <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus' : '' %> >
                <option value=""><%= _('all') %></option>
            </select>
        </div>
    </div>
</script>

<script id="tplValueFloat"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueFloat.png"></img>'
        data-vis-name="Number"
        data-vis-attrs="oid;html_prepend;html_append_singular;html_append_plural;group.extended;digits;is_comma[true]/checkbox;is_tdp/checkbox;factor[1];oid-quality;class_true;class_false;test_html">
    <div class="vis-widget <%== (vis.states.attr(this.data['oid-quality'] + '.val') === 'true' ||  vis.states.attr(this.data['oid-quality'] + '.val') === true) ? this.data.attr('class_true') : this.data.attr('class_false') %> <%== this.data.attr('class') %>" style="top: 0; left: 0; width: 60px; height: 18px" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%= vis.binds.basic.formatFloat(this.data) %><%== (parseFloat(vis.binds.basic.formatFloat(this.data)) === 1 ? this.data.attr('html_append_singular') : this.data.attr('html_append_plural')) %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueString"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="String"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueString.png"></img>'
        data-vis-attrs="oid;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') ? ((this.data.attr('oid').indexOf('"') !== -1) ? '' : this.data.attr('oid')) : this.data.attr('oid') %>">
                <%== this.data.attr("html_prepend") %><%= (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : this.data.attr('oid') ? ((this.data.attr('oid').indexOf('"') !== -1) ? this.data.oid.substring(1, this.data.oid.length - 1) : (vis.states.attr(this.data.oid + '.val'))) : (vis.states.attr(this.data.oid + '.val')) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueStringRaw"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueStringRaw.png"></img>'
        data-vis-name="String (unescaped)"
        data-vis-attrs="oid;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : (typeof app !== 'undefined' ? app.replaceFilePathSrc(vis.states.attr(this.data.oid + '.val')) : vis.states.attr(this.data.oid + '.val')) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueStringImg"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueStringImg.png"></img>'
        data-vis-type="val"
        data-vis-name="String img src"
        data-vis-attrs="oid;html_prepend;html_append;refreshInterval[0]/slider,0,180000,100">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left:0px; width:60px; height: 40px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %>
                <img src="<%= (typeof app !== 'undefined' ? app.replaceFilePathImg(vis.states.attr(this.data.oid + '.val')) : vis.states.attr(this.data.oid + '.val')) || '' %>" width="100%" />
                 <div <%= (el) -> vis.binds.basic.imgRefresh(el, vis.states.attr(data.oid + '.val' ), data, this.view) %> />
                <%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplTimeValue"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,timestamp"
        data-vis-name="TimesValue"
        data-vis-prev='<img src="widgets/basic/img/Prev_TimeValue.png"></img>'
        data-vis-attrs="oid;show_interval/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY.MM.DD,DD.MM.YYYY,YYYY/MM/DD hh:mm:ss,YYYY/MM/DD,hh:mm:ss;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top: 0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.binds.basic.formatDate(vis.states.attr(this.data.oid + '.val'), this.data.attr('format_date'), this.data.attr('show_interval')) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueTimestampValue"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,timestamp"
        data-vis-name="Timestamp Value"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueTimestamp.png"></img>'
        data-vis-attrs="oid;show_interval/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY.MM.DD,DD.MM.YYYY,YYYY/MM/DD hh:mm:ss,YYYY/MM/DD,hh:mm:ss;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top: 0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.binds.basic.formatDate(vis.states.attr(this.data.oid + '.val'), this.data.attr('format_date'), this.data.attr('show_interval')) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueTimestamp"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,timestamp"
        data-vis-name="Timestamp"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueTimestamp.png"></img>'
        data-vis-attrs="oid;show_interval/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY.MM.DD,DD.MM.YYYY,YYYY/MM/DD hh:mm:ss,YYYY/MM/DD,hh:mm:ss;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top: 0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.binds.basic.formatDate(vis.states.attr(this.data.oid + '.ts'), this.data.attr('format_date'), this.data.attr('show_interval')) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueLastchange"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,timestamp"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueLastchange.png"></img>'
        data-vis-name="Last change Timestamp"
        data-vis-attrs="oid;show_interval/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY.MM.DD,DD.MM.YYYY,YYYY/MM/DD hh:mm:ss,YYYY/MM/DD,hh:mm:ss;html_prepend;html_append;test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 50px; height: 20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%== (vis.editMode && this.data.attr('test_html')) ? this.data.attr('test_html') : vis.binds.basic.formatDate(vis.states.attr(this.data.oid + '.lc'), this.data.attr('format_date'), this.data.attr('show_interval')) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueList"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueList.png"></img>'
        data-vis-type="val"
        data-vis-name="ValueList Text"
        data-vis-attrs="oid;html_prepend;html_append;valuelist/text;test_list/nselect,,0,1,2,3,4,5,6,7,8,9,10,11,12">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:60px;height:20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%= (function (that){var list = (that.data.valuelist ? that.data.valuelist.split(';') : []); var val = list[(vis.editMode && (that.data.attr('test_list') || that.data.attr('test_list') == '0')) ? parseInt(that.data.attr('test_list')) : parseInt(vis.states.attr(that.data.oid + '.val'), 10)]; if (val) val = val.replace('§§', ';'); return val;})(this) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueListHtml"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueListHtml.png"></img>'
        data-vis-type="val"
        data-vis-name="ValueList HTML"
        data-vis-attrs="oid;html_prepend;html_append;valuelist/text;test_list/nselect,,0,1,2,3,4,5,6,7,8,9,10,11,12">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px;left:0px;width:60px;height:20px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== this.data.attr('html_prepend') %><%== (function (that){var list = (that.data.valuelist ? that.data.valuelist.split(';') : []); var val = list[(vis.editMode && (that.data.attr('test_list') || that.data.attr('test_list') == '0')) ? parseInt(that.data.attr('test_list')) : parseInt(vis.states.attr(that.data.oid + '.val'), 10)]; if (val) val = val.replace('§§', ';'); return val;})(this) %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueListHtml8"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueListHtml8.png"></img>'
        data-vis-type="val"
        data-vis-name="ValueList HTML Style"
        data-vis-attrs="oid;html_prepend;html_append;count[2]/number,0,10,1;value(0-count);style(0-count);test_list/nselect,,0,1,2,3,4,5,6,7,8,9,10,11,12">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 100px; height: 30px;" id="<%= this.data.attr('wid') %>">
        <%
            var slist = [];
            var i = 0;
            while (data['style' + i] !== undefined) {
                slist[i] = data['style' + i]; i++;
            }
        %>
        <div class="vis-widget-body" style="<%== slist[(vis.editMode && (this.data.attr('test_list') || this.data.attr('test_list') == '0')) ? parseInt(this.data.attr('test_list')) : (parseInt((vis.states.attr(this.data.oid + '.val') == true ? 1 : (vis.states.attr(this.data.oid + '.val') == false ? 0 : vis.states.attr(this.data.oid + '.val'))), 10))] %>">
            <div data-oid="<%= this.data.attr('oid') %>">
               <%== this.data.attr('html_prepend') %><%
                   var list = [];
                   var j = 0;
                   while (data['value' + j] !== undefined) {
                        list[j] = data['value' + j];
                        if (list[j]) list[j] = list[j].replace('§§', ';');
                        j++;
                   }
                   %><%== list[(vis.editMode && (this.data.attr('test_list') || this.data.attr('test_list') == '0')) ? parseInt(this.data.attr('test_list')) : (parseInt((vis.states.attr(this.data.oid + '.val') == true ? 1 : (vis.states.attr(this.data.oid + '.val') == false ? 0 : vis.states.attr(this.data.oid + '.val'))), 10))] %><%== this.data.attr('html_append') %>
            </div>
        </div>
    </div>
</script>

<script id="tplValueBool"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueBool.png"></img>'
        data-vis-type="val"
        data-vis-name="Bool HTML"
        data-vis-attrs="oid;html_prepend;html_append;html_false;html_true">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>"  data-oid="<%= this.data.attr('oid') %>" >
        <div class="vis-widget-body">
            <%== this.data.attr('html_prepend') %>
            <% if (vis.binds.basic.isFalse(vis.states.attr(this.data.oid + '.val'), this.data.attr('min'), this.data.attr('max'))) { %>
                <%== this.data.attr("html_false") %>
            <% } else { %>
                <%== this.data.attr('html_true') %>
            <% } %>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplAckBool"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_AckBool.png"></img>'
        data-vis-type="val"
        data-vis-name="AckFlag HTML"
        data-vis-attrs="oid;html_prepend;html_append;html_false;html_true">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>"  data-oid="<%= this.data.attr('oid') %>" >
        <div class="vis-widget-body">
            <%== this.data.attr('html_prepend') %>
            <%
            var str = vis.states.attr(this.data.oid + ".ack");
            var val = parseFloat(str);
            var state;
            if (str === false || str === "false" || val == 0) {
            %>
            <%== this.data.attr('html_false') %>
            <% } else { %>
            <%== this.data.attr('html_true') %>
            <% } %>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplValueBoolCheckbox"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueBoolCheckbox.png"></img>'
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="Bool Checkbox"
        data-vis-attrs="oid;html_prepend;html_append;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body">
			<%== this.data.attr('html_prepend') %>
			<input
			    type="checkbox"
			    name="<%= this.data.attr('wid') %>_checkbox"
			    <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus' : '' %>
			    id="<%= this.data.attr('wid') %>_checkbox"
			    data-oid="<%= this.data.attr('oid') %>"
			    <%= (el) -> vis.binds.basic.checkbox(el) %>
            />
			<%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplValueInput"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueInput.png"></img>'
        data-vis-type="ctrl"
        data-vis-update-style="true"
        data-vis-name="Input val"
        data-vis-attrs="oid;html_prepend;html_append;numeric/checkbox;min;max;autoSet/checkbox;readOnly/checkbox;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="background: white; color: black; border: 2px inset" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body">
			<%== this.data.attr('html_prepend') %>
			<input type="text"
			    <%= (this.data.attr('readOnly') === true || this.data.attr('readOnly') === 'true') ? 'readonly ' : '' %>
			    <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus ' : '' %>
			    data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.input(el, this.data) %> style="width: calc(100% - 5px);"
            />
			<%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplValueBoolSelect"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueBoolSelect.png"></img>'
        data-vis-type="ctrl"
        data-vis-name="Bool Select"
        data-vis-attrs="oid;html_prepend;html_append;text_true;text_false;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:false" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body"  style="overflow:false">
			<%== this.data.attr('html_prepend') %>
			<select id="<%= this.data.attr('wid') %>_select" data-oid="<%= this.data.attr('oid') %>" <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus' : '' %> >
				<option value="0" selected='selected'><%= this.data.attr('text_false') %></option>
				<option value="1"><%= this.data.attr('text_true') %></option>
			</select>
			<div <%= (el) -> vis.binds.basic.select(el) %>></div>
			<%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplValueBoolCtrl"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueBoolCtrl.png"></img>'
        data-vis-type="ctrl"
        data-vis-name="Bool HTML"
        data-vis-attrs="oid;min;max;html_prepend;html_append;html_false;html_true;"
        data-vis-attrs1="group.ccontrol;urlTrue;urlFalse;oidTrue/id;oidFalse/id;">
    <div
        class="vis-widget <%== this.data.attr('class') %>"
        style="width:76px; height:76px;"
        id="<%= this.data.attr('wid') %>"
        data-oid="<%= this.data.attr('oid') %>"
        data-min="<%= this.data.attr('min') %>"
        data-max="<%= this.data.attr('max') %>"
        data-as-button="<%= this.data.attr('asButton') %>"
        data-url-true="<%=  this.data.attr('urlTrue') %>"
        data-url-false="<%= this.data.attr('urlFalse') %>"
        data-oid-true="<%=  this.data.attr('oidTrue') %>"
        data-oid-false="<%= this.data.attr('oidFalse') %>"
        <%= (el) -> vis.binds.basic.toggle(el) %>>
        <div class="vis-widget-body">
			<%== this.data.attr('html_prepend') %>
			<% if (vis.binds.basic.isFalse(vis.states.attr(this.data.oid + '.val'), this.data.attr('min'), this.data.attr('max'))) { %>
			    <%== this.data.attr('html_false') %>
			<% } else { %>
			    <%== this.data.attr('html_true') %>
			<% } %>
			<%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplValueBoolCtrlSvg"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueBoolCtrlSvg.png"></img>'
        data-vis-type="ctrl,state"
        data-vis-name="Bool SVG"
        data-vis-attrs="oid;no_control/checkbox;"
        data-vis-attrs0="svg_false[<polygon points='100,10 40,198 190,78 10,78 160,198' style='fill:lime§ stroke:purple§ stroke-width:5§ fill-rule:nonzero' transform='scale(0.4)'/>]/text;"
        data-vis-attrs1="svg_true[<polygon points='100,10 40,198 190,78 10,78 160,198' style='fill:yellow§ stroke:red§ stroke-width:5§ fill-rule:nonzero' transform='scale(0.4)'/>]/text;"
        data-vis-attrs2="svg_opacity/slider,0,1,0.05">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>">
        <div class="vis-widget-body">
            <% vis.binds.basic.showSvg(this.data.attr('class'), this.view, this.data.attr('wid'), this.data.attr('oid'), this.data.attr('svg_opacity'), this.data.attr('svg_false'), this.data.attr('svg_true'), null, this.data.attr('no_control')) %>
        </div>
    </div>
</script>

<script id="tplBasicState"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_BasicState.png"></img>'
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="HTML State"
        data-vis-attrs="oid;html;value;urlValue">
    <div
        class="vis-widget <%== this.data.attr('class') %>"
        style="width:76px; height:76px;"
        id="<%= this.data.attr('wid') %>"
        data-oid="<%= this.data.attr('oid') %>"
        data-url-value="<%= this.data.attr('urlValue') %>"
        data-val="<%= this.data.attr('value') %>"
        <%= (el) -> vis.binds.basic.state(el) %>
        >
        <div class="vis-widget-body">
			<%== this.data.attr("html") %>
        </div>
    </div>
</script>

<script id="tplRedNumber"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Red Number"
        data-vis-prev='<img src="widgets/basic/img/Prev_RedNumber.png"></img>'
        data-vis-attrs="oid;type[circle]/select,circle,pin;html_prepend;html_append_singular;html_append_plural">
    <% if (this.data.attr('type') === 'pin') { %>
        <div class="vis-widget <%== this.data.attr('class') %>" style="width: 33px; height: 61px; padding-left: 4px" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.hideOnFalse(el) %>>
            <div class="vis-widget-body" >
                <img src="widgets/basic/img/pin_red5.svg" style="width: 100%; height: 100%">
                <div style="position:absolute; top: 22%; width: 95%; text-align: center">
                    <%== this.data.attr('html_prepend') %><%= parseInt(vis.states.attr(this.data.oid + '.val'), 10) %><%== (parseInt(vis.states.attr(this.data.oid + '.val'), 10) === 1 ? this.data.attr("html_append_singular") : this.data.attr("html_append_plural")) %>
                </div>
            </div>
        </div>
    <% } else { %>
        <div class="vis-widget <%== this.data.attr('class') %>" style="padding: 3px; width: auto; min-width: 21px; height: 21px; border-radius:16px; border: 3px solid white; background-color: rgb(214, 69, 69); color:white; font:normal normal normal 20px/normal Helvetica; text-align: center;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.hideOnFalse(el) %>>
            <div class="vis-widget-body" >
                <%== this.data.attr('html_prepend') %><%= parseInt(vis.states.attr(this.data.oid + '.val'), 10) %><%== (parseInt(vis.states.attr(this.data.oid + '.val'), 10) === 1 ? this.data.attr("html_append_singular") : this.data.attr("html_append_plural")) %>
            </div>
        </div>
    <% } %>
</script>

<script id="tplBulbOnOffCtrl"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_BulbOnOffCtrl.png"></img>'
        data-vis-set="basic"
        data-vis-type="ctrl"
        data-vis-name="Bulb on/off"
        data-vis-attrs="oid;min;max;icon_off[img~bulb_off.png]/image;icon_on[img~bulb_on.png]/image;readOnly/checkbox;"
        data-vis-attrs0="group.ccontrol;urlTrue;urlFalse;oidTrue/id;oidFalse/id;oidTrueValue;oidFalseValue;"
>
    <div
        data-oid="<%= this.data.attr('oid') %>"
        class="vis-widget <%== this.data.attr('class') %>"
        id="<%= this.data.attr('wid') %>"
        style="width: 44px; height: 59px"
        data-read-only="<%=  this.data.attr('readOnly') %>"
        data-min="<%= this.data.attr('min') %>"
        data-max="<%= this.data.attr('max') %>"
        data-url-true="<%=  this.data.attr('urlTrue') %>"
        data-url-false="<%= this.data.attr('urlFalse') %>"
        data-oid-true="<%=  this.data.attr('oidTrue') %>"
        data-oid-false="<%= this.data.attr('oidFalse') %>"
        data-oid-true-value="<%=  this.data.attr('oidTrueValue') %>"
        data-oid-false-value="<%= this.data.attr('oidFalseValue') %>"
        <%= (el) -> vis.binds.basic.toggle(el) %>
        >
        <div class="vis-widget-body">
            <% if (vis.binds.basic.isFalse(vis.states.attr(this.data.oid + '.val'), this.data.attr('min'), this.data.attr('max'))) { %>
                <img src="<%== this.data.attr('icon_off') ? this.data.attr('icon_off') : 'img/bulb_off.png' %>" width="100%"/>
            <% } else { %>
                <img src="<%== this.data.attr('icon_on') ? this.data.attr('icon_on') : 'img/icon_on.png' %>" width="100%"/>
            <% } %>
        </div>
    </div>
</script>

<script id="tplValueFloatBar"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,bar"
        data-vis-name="Bar"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueFloatBar.png"></img>'
        data-vis-attrs="oid;min[0];max[100];orientation[horizontal]/select,horizontal,vertical/onOrientation;color[blue]/color;border;shadow;reverse/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 240px; height: 20px; border: 1px solid #888" id="<%= this.data.attr('wid') %>">
        <div data-oid="<%= this.data.attr('oid') %>" class="vis-widget-body"
        style="<%= (this.data.attr('orientation') === 'vertical') ? ('height: ' + vis.binds.basic.getCalc(this.data) + ';' + ((this.data.border) ? ' width:  calc(100% - ' + vis.binds.basic.extractWidth(this.data.border, 2) + ');' : '') + (this.data.reverse === 'true' || this.data.reverse === true ? 'left: 0px; position: absolute; bottom: 0%;' : '')) : (((this.data.border) ? " height: calc(100% - " + vis.binds.basic.extractWidth(this.data.border, 2) + ');' : '') + 'width: ' + vis.binds.basic.getCalc(this.data) + ';' + (this.data.reverse === 'true' || this.data.reverse === true ? 'float: right; ' : '')) %>background-color:<%= this.data.color %>; border: <%= this.data.border %>; box-shadow: <%= this.data.shadow %>"></div>
    </div>
</script>

<script id="tplNote"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-name="Note"
        data-vis-prev='<img src="widgets/basic/img/Prev_Note.png"></img>'
        data-vis-attrs="oid;max_width[300];html_prepend;html_append;test_text">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:50px; height:50px; border:1px solid #888; background: rgba(255,255,105,0.8)" id="<%= this.data.attr('wid') %>" onclick="vis.binds.basic.editNote('<%= this.data.attr('wid') %>', '<%= this.data.attr('max_width') %>', '<%= this.data.attr('min_width') %>', '<%= this.data.attr('min_height') %>', '<%= this.data.attr('oid') %>')">
		<div data-oid="<%= this.data.attr('oid') %>" id="div_<%= this.data.attr('wid') %>" style="padding: 10px">
			<%== this.data.attr('html_prepend') %><%= (this.data.test_text && vis.editMode) ? this.data.test_text : (vis.states.attr(this.data.oid + '.val') == null ? "" : vis.states.attr(this.data.oid + '.val')) %><%== this.data.attr('html_append') %>
		</div>
    </div>
</script>

<script id="tplTableBody"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="json,table"
        data-vis-name="Table"
        data-vis-prev='<img src="widgets/basic/img/Prev_TableBody.png"></img>'
        data-vis-attrs="table_oid/id;"
        data-vis-attrs0="static_value[[{^Title^: ^first^, ^Value^: 1, ^_Description^: ^Value1^}, {^Title^: ^second^, ^Value^: 2, ^_Description^: ^Value2^}]]/text;"
        data-vis-attrs1="event_oid/id;new_on_top/checkbox;ack_oid/id;selected_oid/id;hide_header/checkbox;show_scroll/checkbox;detailed_wid/widget;max_rows/number;"
        data-vis-attrs2="colCount/number;group.header/byindex;colName(1-colCount);colWidth(1-colCount);colAttr(1-colCount);"
        data-vis-attrs-not-used="btn_print;view_for_print/views"
>
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" style="width: 300px; height: 150px; background: #d3d3d3">
       <% vis.binds.table.showTable(this.view, this.data.attr('wid'), this.data); %>
    </div>
</script>

<script id="tplHtmlLogout"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="tools"
        data-vis-prev='<img src="widgets/basic/img/Prev_HtmlLogout.png"></img>'
        data-vis-name="HTML logout"
        data-vis-attrs="html[<button style=^cursor: pointer^>Logout</button>]/text;redirect_url;in_app_close/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 70px; height: 30px; cursor: pointer" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.basic.logout(el, this.data) %> >
        <div class="vis-widget-body">
            <%== this.data.attr('html') %>
        </div>
    </div>
</script>

<!--script id="tplDialog"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="table"
        data-vis-name="Dialog"
        data-vis-attrs="show/checkbox;trigger_id/id;button(1-3);title;text;image/image;width[400]/slider,50,1000,10;height[200]/slider,50,1000,10;modal/checkbox;_no_style[true]/hidden;_no_move[true]/hidden;_no_resize[true]/hidden;margin_left[0]/slider,0,200,1;margin_top[0]/slider,0,200,1"
        >
    <%
        var options =  {
            trigger_id:  this.data.attr('trigger_id'),
            buttons:     [this.data.attr('button1'), this.data.attr('button2'), this.data.attr('button3')],
            image:       this.data.attr('image'),
            title:       this.data.attr('title'),
            text:        this.data.attr('text'),
            width:       this.data.attr('width'),
            height:      this.data.attr('height'),
            show:        this.data.attr('show'),
            modal:       this.data.attr('modal'),
            margin_left: this.data.attr('margin_left'),
            margin_top:  this.data.attr('margin_top')
        };
        vis.binds.table.showDialog(this.view, this.data.attr('wid'), options);
    %>
</script-->

<script id="tplValueGesture"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val,tools"
        data-vis-prev='<img src="widgets/basic/img/Prev_ValueGesture.png"></img>'
        data-vis-name="Gesture indicator"
        data-vis-no-gestures="true"
        data-vis-attrs="html_prepend;html_append_singular;html_append_plural;group.extended;digits[0];is_comma[true]/checkbox;is_tdp/checkbox;factor[1];test_html">
    <div class="vis-widget <%== this.data.attr('class') %>" style="height: 21px; border: 1px solid #c7c7c7; border-radius: 5px; text-align: center; padding-top: 6px; box-shadow: 2px 2px 5px 1px gray; padding-left: 2px; padding-right: 2px; background: lightgray;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <% vis.binds.basic.createValueGesture(this.data.wid, this.view, this.data, this.style); %>
        </div>
    </div>
</script>

<script id="tplSpeech2Text"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-type="val"
        data-vis-prev='<img src="widgets/basic/img/Prev_Speech2Text.png"></img>'
        data-vis-name="Speech to text"
        data-vis-no-gestures="true"
        data-vis-attrs="oid;speechMode[single]/select,single,startstop,continuous;language/select,,en-US,de,ru-RU;keywords;"
        data-vis-attrs0="group.image;noImage/checkbox;imageInactive[widgets~basic~img~micInactive.svg]/image;imageActive[widgets~basic~img~micActive.svg]/image;imageStarted[widgets~basic~img~micStarted.svg]/image;imageDetected[widgets~basic~img~micDetected.svg]/image;imageSent[widgets~basic~img~micSent.svg]/image;imageHeightPx[70]/slider,0,200,1;imageWidthPx[70]/slider,0,200,1;"
        data-vis-attrs1="group.text;noText/checkbox;noResults/checkbox;keyWordColor[#FFB051]/color;textSentColor[#7E88D3]/color;">
    <div class="vis-widget <%== this.data.attr('class') %>" style="height: 77px; width: 500px" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <table style="height: 100%; width: 100%"><tr>
                <td style="<%= this.data.attr('noImage') ? 'display: none' : '' %>"><img class="mic-image" style="height: <%= this.data.attr('imageHeightPx') %>px; width: <%= this.data.attr('imageWidthPx') %>px" src="<%= this.data.attr('imageInactive') %>" /></td>
                <td class="mic-text" style="width: 100%">
                    <div class="mic-info-text" style="<%= this.data.attr('noText')    ? 'display: none' : '' %>"></div>
                    <div class="mic-results"   style="<%= this.data.attr('noResults') ? 'display: none' : '' %>"></div>
                </td>
            </tr></table>
        </div>
    </div>
    <% vis.binds.basic.speech2text(this.data.wid, this.view, this.data, this.style); %>
</script>

<script id="tplFullScreen"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_FullScreen.png"></img>'
        data-vis-set="basic"
        data-vis-type="tools"
        data-vis-name="Full Screen"
        data-vis-attrs="">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:43px; height:43px; background: #AAAAAA; cursor: pointer; opacity: 0.9" id="<%= this.data.attr('wid') %>">
		<div class='vis-fullscreen-icon' style="padding: 10px"></div>
		<%= vis.binds.basic.toggleFullScreen(this.data.wid, this.view, this.data, this.style); %>
    </div>
</script>

<script id="tplScreenResolution"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/basic/img/Prev_ScreenResolution.png"></img>'
        data-vis-set="basic"
        data-vis-type="tools"
        data-vis-name="Screen Resolution"
        data-vis-attrs="">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:170px; height:75px; border: 1px solid #888; font-size: 12px; opacity: 0.8" id="<%= this.data.attr('wid') %>">
		<div id="div_<%= this.data.attr('wid') %>" style="padding: 10px">
			Default view: <span class='vis-resolution-default-view'></span><br>
			Width: <span class='vis-resolution-width'></span><br>
			Height: <span class='vis-resolution-height'></span><br>
			Instance: <span><%== vis.instance ? vis.instance : vis.binds.basic.createScreenText() %></span>
		</div>
		<%= vis.binds.basic.detectScreen(this.data.attr('wid')) %>
    </div>
</script>


<script id="_tplGroup"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="basic"
        data-vis-attrs="group.objects;attrCount[1]/slider,0,20,1;attrName(1-attrCount)//onAttrChanged;attrType(1-attrCount)/select,,id,checkbox,image,color,views,html,widget,history/onAttrChanged;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow: visible" id="<%= this.data.attr('wid') %>"></div>
</script>

<!-- --------------basic.html--- END -->
<!-- --------------colorpicker.html--- START -->
<!--
    ioBroker.vis colorpicker Widget-Set

    version: "1.2.0"

    Copyright 2013-2020 hobbyquaker https://github.com/hobbyquaker, bluefox https://github.com/GermanBluefox
-->

<link rel="stylesheet" type="text/css" href="widgets/colorpicker/css/farbtastic.css" />
<link rel="stylesheet" type="text/css" href="widgets/colorpicker/css/spectrum.css" />

<script type="text/javascript" src="widgets/colorpicker/js/jscolor.js"></script>
<script type="text/javascript" src="widgets/colorpicker/js/farbtastic.js"></script>
<script type="text/javascript" src="widgets/colorpicker/js/spectrum.js"></script>
<script type="text/javascript" src="widgets/colorpicker/js/huepiHelper.js"></script>

<script type="text/javascript">
    
    if (vis.language === 'de'){
        var localization = $.spectrum.localization.de = {
            cancelText: 			'Abbrechen',
            chooseText: 			'Wählen',
            clearText: 				'Farbauswahl zurücksetzen',
            noColorSelectedText: 	'Keine Farbe ausgewählt',
            togglePaletteMoreText: 	'Mehr',
            togglePaletteLessText: 	'Weniger'
        };
        $.extend($.fn.spectrum.defaults, localization);
    } else if (vis.language === 'ru'){
        var localization = $.spectrum.localization.ru = {
            cancelText: 			'отмена',
            chooseText: 			'выбрать',
            clearText: 				'сбросить',
            noColorSelectedText: 	'никакой цвет не выбран',
            togglePaletteMoreText: 	'больше',
            togglePaletteLessText: 	'меньше'
        };
        $.extend($.fn.spectrum.defaults, localization);
    }

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "red-oid":              {"en": "Red ID",            "de": "Rot ID",             "ru": "Красный ID"},
            "green-oid":            {"en": "Green ID",          "de": "Grün ID",            "ru": "Зелёный ID"},
            "blue-oid":             {"en": "Blue ID",           "de": "Blau ID",            "ru": "Синий ID"},
            "divisor":              {"en": "divisor",           "de": "Divisor",            "ru": "Делитель"},
			"decimal": 		        {"en": "Precision",         "de": "Nach Komma",         "ru": "Чисел посля запятой"},
            "command-oid":          {"en": "Command ID",        "de": "Command ID",         "ru": "Command ID"},
            "xy-oid":               {"en": "XY ID",             "de": "XY ID",              "ru": "XY ID"},
            "level-oid":            {"en": "Level ID",          "de": "Level ID",           "ru": "Level ID"},
            "gamut":                {"en": "Gamut/Model",       "de": "Gamut/Model",        "ru": "Gamut/Model"},
            "gamut_tooltip": {
                "en": "Gamut ID (A,B,C) or Model ID (LCT001 etc.)",
                "de": "Gamut ID (A,B,C) oder Model ID (LCT001 usw.)",
                "ru": "Gamut ID (A,B,C) or Model ID (LCT001 etc.)"
            },
            "transitionTime":       {"en": "Transition Time",   "de": "Übergangszeit",      "ru": "Transition Time"},
            "transitionTime_tooltip": {
                "en": "Transition time in 1/10s",
                "de": "Übergangszeit in 1/10s",
                "ru": "Transition time in 1/10s"
            },
            "pickerBackground":     {"en": "Background Color",  "de": "Hintergrundfarbe",   "ru": "Background Color"},
            "pickerWidth":          {"en": "Picker Width",      "de": "Farbwahl Breite",    "ru": "Picker Width"},
            "pickerHeight":         {"en": "Picker Height",     "de": "Farbwahl Höhe",      "ru": "Picker Height"},
            "buttonName":           {"en": "Button Text",       "de": "Buttontext",         "ru": "Button Text"},
            "closeButton":          {"en": "Close button",      "de": "Schließen Button",   "ru": "Close button"},
            "group_rgb":            {"en": "R.G.B.",            "de": "R.G.B.",             "ru": "R.G.B."},
            "rgb-oid":              {"en": "RGB ID",            "de": "RGB ID",             "ru": "RGB ID"},
            "group_hue":            {"en": "H.S.L.",            "de": "H.S.L.",             "ru": "H.S.L."},
            "hue-oid":              {"en": "HUE ID",            "de": "HUE ID",             "ru": "HUE ID"},
            "sat-oid":              {"en": "Saturation ID",     "de": "Sättigung ID",       "ru": "ID Насыщенность"},
            "bri-oid":              {"en": "Brightness ID",     "de": "Helligkeit ID",      "ru": "ID Яркость"}
        });
    }

    vis.binds.colorpicker = {
		version: "1.2.0",
		showVersion: function () {
			if (vis.binds.colorpicker.version) {
				console.log('Version vis-colorpicker: ' + vis.binds.colorpicker.version);
				vis.binds.colorpicker.version = null;
			}
		},
        jscolor: function (el, data) {
            data = data._data || data;
            var $this = $(el);
            var handler = [];
            var factor  = parseFloat(data.factor) || 1;
            var decimal = parseInt(data.decimal || 0, 10) || 0;

            var picker = new jscolor($this[0], {
                valueElement:   data.showValue || false,
                onFineChange:   function () {
                    for (var h = 0; h < handler.length; h++) {
                        handler[h]();
                    }
                },
                closable:       !!data.closeText,
                closeText:      data.closeText
            });

            $this.click(function () {
                picker.show();
            });

            if (data['hue-oid'] && data['hue-oid'] !== 'nothing_selected' &&
                data['sat-oid'] && data['sat-oid'] !== 'nothing_selected' &&
                data['bri-oid'] && data['bri-oid'] !== 'nothing_selected') {
                var hue = data['hue-oid'];
                var sat = data['sat-oid'];
                var bri = data['bri-oid'];

                handler.push(function () {
                    vis.setValue(hue, parseFloat(picker.hsv[0]).toFixed(decimal));
                    vis.setValue(sat, parseFloat((picker.hsv[1] / factor).toFixed(decimal)));
                    vis.setValue(bri, parseFloat((picker.hsv[2] / factor).toFixed(decimal)));
                });

                var htimer = null;
                var hueChanged = function () {
                    if (htimer) clearTimeout(htimer);
                    htimer = setTimeout(function () {
                        htimer = null;
                        picker.fromHSV(
                                Math.round(parseFloat(vis.states[hue + '.val'] || 0)),
                                Math.round(parseFloat(vis.states[sat + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[bri + '.val'] || 0) * factor)
                        );
                    }, 10);
                };

                vis.states.bind(hue + '.val', hueChanged);
                vis.states.bind(sat + '.val', hueChanged);
                vis.states.bind(bri + '.val', hueChanged);

                hueChanged();
            }
            if (data['red-oid'] && data['red-oid']  !== 'nothing_selected' &&
                    data['green-oid'] && data['green-oid'] !== 'nothing_selected' &&
                    data['blue-oid']  && data['blue-oid']  !== 'nothing_selected') {
                var r = data['red-oid'];
                var g = data['green-oid'];
                var b = data['blue-oid'];

                handler.push(function () {
                    vis.setValue(r, parseFloat((picker.rgb[0] / factor).toFixed(decimal)));
                    vis.setValue(g, parseFloat((picker.rgb[1] / factor).toFixed(decimal)));
                    vis.setValue(b, parseFloat((picker.rgb[2] / factor).toFixed(decimal)));
                });

                var timer = null;
                var rgbChanged = function () {
                    if (timer) clearTimeout(timer);
                    timer = setTimeout(function () {
                        timer = null;
                        picker.fromRGB(
                                Math.round(parseFloat(vis.states[r + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[g + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[b + '.val'] || 0) * factor)
                        );
                    }, 10);
                };

                vis.states.bind(r + '.val', rgbChanged);
                vis.states.bind(g + '.val', rgbChanged);
                vis.states.bind(b + '.val', rgbChanged);

                rgbChanged();
            }
            if (data['rgb-oid'] && data['rgb-oid'] !== 'nothing_selected') {
                var rgb = data['rgb-oid'];

                handler.push(function () {
                    vis.setValue(rgb, picker.toHEXString());
                });

                var _rgbChanged = function () {
                    picker.fromString(vis.states[rgb + '.val'] || '');
                };

                vis.states.bind(rgb + '.val', _rgbChanged);

                _rgbChanged();
            }
        },
        rgb2hex: function (r,g,b) {
            return '#' + ('0' + r.toString(16)).slice(-2) + ('0' + g.toString(16)).slice(-2) + ('0' + b.toString(16)).slice(-2);
        },
        hex2rgb: function (hex) {
            var r = parseInt(hex.substr(1, 2), 16);
            var g = parseInt(hex.substr(3, 2), 16);
            var b = parseInt(hex.substr(5, 2), 16);
            return {r: r, g: g, b: b};
        },
        farbtastic: function (el, data) {
            var $this = $(el);
            $this.hide();

            data = data._data || data;
            var handler = [];
            var factor  = parseFloat(data.factor) || 1;
            var decimal = parseInt(data.decimal || 0, 10) || 0;

            var ft = $.farbtastic($this.prev(), function () {
                for (var h = 0; h < handler.length; h++) {
                    handler[h](this.color);
                }
            });

            if (data['hue-oid'] && data['hue-oid'] !== 'nothing_selected' &&
                data['sat-oid'] && data['sat-oid'] !== 'nothing_selected' &&
                data['bri-oid'] && data['bri-oid'] !== 'nothing_selected') {
                var hue = data['hue-oid'];
                var sat = data['sat-oid'];
                var bri = data['bri-oid'];

                handler.push(function (hex) {
                    var color = vis.binds.colorpicker.hex2rgb(hex);
                    vis.setValue(hue, parseFloat(picker.hsv[0]).toFixed(decimal));
                    vis.setValue(sat, parseFloat((picker.hsv[1] / factor).toFixed(decimal)));
                    vis.setValue(bri, parseFloat((picker.hsv[2] / factor).toFixed(decimal)));
                });

                var htimer = null;
                var hueChanged = function () {
                    if (htimer) clearTimeout(htimer);
                    htimer = setTimeout(function () {
                        htimer = null;
                        ft.setColor(vis.binds.colorpicker.rgb2hex(
                                Math.round(parseFloat(vis.states[hue + '.val'] || 0)),
                                Math.round(parseFloat(vis.states[sat + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[bri + '.val'] || 0) * factor)
                        ));
                    }, 10);
                };

                vis.states.bind(hue + '.val', hueChanged);
                vis.states.bind(sat + '.val', hueChanged);
                vis.states.bind(bri + '.val', hueChanged);

                hueChanged();
            }
            if (data['red-oid'] && data['red-oid']  !== 'nothing_selected' &&
                data['green-oid'] && data['green-oid'] !== 'nothing_selected' &&
                data['blue-oid']  && data['blue-oid']  !== 'nothing_selected') {
                var r = data['red-oid'];
                var g = data['green-oid'];
                var b = data['blue-oid'];

                handler.push(function (hex) {
                    var color = vis.binds.colorpicker.hex2rgb(hex);
                    vis.setValue(r, parseFloat((color.r / factor).toFixed(decimal)));
                    vis.setValue(g, parseFloat((color.g / factor).toFixed(decimal)));
                    vis.setValue(b, parseFloat((color.b / factor).toFixed(decimal)));
                });

                var timer = null;
                var rgbChanged = function () {
                    if (timer) clearTimeout(timer);
                    timer = setTimeout(function () {
                        timer = null;
                        ft.setColor(vis.binds.colorpicker.rgb2hex(
                                Math.round(parseFloat(vis.states[r + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[g + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[b + '.val'] || 0) * factor)
                        ));
                    }, 10);
                };

                vis.states.bind(r + '.val', rgbChanged);
                vis.states.bind(g + '.val', rgbChanged);
                vis.states.bind(b + '.val', rgbChanged);

                rgbChanged();
            }
            if (data['rgb-oid'] && data['rgb-oid'] !== 'nothing_selected') {
                var rgb = data['rgb-oid'];

                handler.push(function (hex) {
                    vis.setValue(rgb, hex);
                });

                var _rgbChanged = function () {
                    ft.setColor(vis.states[rgb + '.val'] || '');
                };

                vis.states.bind(rgb + '.val', _rgbChanged);

                _rgbChanged();
            }
        },
        spectrum: function (el, data) {
            data = data._data || data;
            var $this = $(el);
            var handler = [];
            var factor  = parseFloat(data.factor) || 1;
            var decimal = parseInt(data.decimal || 0, 10) || 0;

            $this.spectrum({
                preferredFormat: 'rgb'
            });

            $this.change(function() {
                for (var h = 0; h < handler.length; h++) {
                    handler[h]();
                }
            });
            if (data['hue-oid'] && data['hue-oid'] !== 'nothing_selected' &&
                data['sat-oid'] && data['sat-oid'] !== 'nothing_selected' &&
                data['bri-oid'] && data['bri-oid'] !== 'nothing_selected') {
                var hue = data['hue-oid'];
                var sat = data['sat-oid'];
                var bri = data['bri-oid'];


                handler.push(function () {
                    var hsl = $this.spectrum('get').toHsl();
                    vis.setValue(hue, parseFloat((hsl.h).toFixed(decimal)));
                    vis.setValue(sat, parseFloat((hsl.s * factor).toFixed(decimal)));
                    vis.setValue(bri, parseFloat((hsl.l * factor).toFixed(decimal)));
                });

                var htimer = null;
                var hueChanged = function () {
                    if (htimer) clearTimeout(htimer);
                    htimer = setTimeout(function () {
                        htimer = null;
                        $this.spectrum('set', {
                            h: Math.round(parseFloat(vis.states[hue + '.val'] || 0)),
                            s: Math.round(parseFloat(vis.states[sat + '.val'] || 0) / factor),
                            l: Math.round(parseFloat(vis.states[bri + '.val'] || 0) / factor)
                        });
                    }, 10);
                };

                vis.states.bind(hue + '.val', hueChanged);
                vis.states.bind(sat + '.val', hueChanged);
                vis.states.bind(bri + '.val', hueChanged);

                hueChanged();
            }
            if (data['red-oid']   && data['red-oid']   !== 'nothing_selected' &&
                data['green-oid'] && data['green-oid'] !== 'nothing_selected' &&
                data['blue-oid']  && data['blue-oid']  !== 'nothing_selected') {
                var r = data['red-oid'];
                var g = data['green-oid'];
                var b = data['blue-oid'];

                handler.push(function () {
                    var color = $this.spectrum('get').toRgb();
                    vis.setValue(r, parseFloat((color.r / factor).toFixed(decimal)));
                    vis.setValue(g, parseFloat((color.g / factor).toFixed(decimal)));
                    vis.setValue(b, parseFloat((color.b / factor).toFixed(decimal)));
                });

                var timer = null;
                var rgbChanged = function () {
                    if (timer) clearTimeout(timer);
                    timer = setTimeout(function () {
                        timer = null;
                        $this.spectrum('set', {
                            r: Math.round(parseFloat(vis.states[r + '.val'] || 0) * factor),
                            g: Math.round(parseFloat(vis.states[g + '.val'] || 0) * factor),
                            b: Math.round(parseFloat(vis.states[b + '.val'] || 0) * factor)
                        });
                    }, 10);
                };

                vis.states.bind(r + '.val', rgbChanged);
                vis.states.bind(g + '.val', rgbChanged);
                vis.states.bind(b + '.val', rgbChanged);

                rgbChanged();
            }
            if (data['rgb-oid'] && data['rgb-oid'] !== 'nothing_selected') {
                var rgb = data['rgb-oid'];

                handler.push(function () {
                    vis.setValue(rgb, $this.spectrum('get').toHexString());
                });

                var _rgbChanged = function () {
                    $this.spectrum('set', vis.states[rgb + '.val'] || '');
                };

                vis.states.bind(rgb + '.val', _rgbChanged);

                _rgbChanged();
            }
        },
        spectrumHomematic: function (el, data) {
            data = data._data || data;
            var $this = $(el);
            var handler = [];

            $this.spectrum({
                homematic: true,
                preferredFormat: "convert360To200",
                showInput: false,
                color: "hsv(360,0%,100%)",
                showPalette: true,
                palette: ["white"]
            });

            $this.change(function() {
                for (var h = 0; h < handler.length; h++) {
                    handler[h]();
                }
            });


            if (data['color-oid'] && data['color-oid'] !== 'nothing_selected') {
                var color = data['color-oid'];

                handler.push(function () {
                    vis.setValue(color, $this.spectrum('get').toHMString());
                });

                var _colorChanged = function () {
                    var currentColor = vis.states[color + '.val'] === 0 ? 0 : vis.states[color + '.val'] || 200;
                    var saturation = "100%";
                    if (currentColor >= 200) {
                        saturation = "0%";
                        currentColor = 200;
                    }
                    var hsvVal = Math.round(currentColor / 200 * 360);
                    $this.spectrum('set',"hsv(" + hsvVal + "," + saturation + ",100%)");
                };

                vis.states.bind(color + '.val', _colorChanged);

                _colorChanged();
            }
        },
        jscolorcie: function (el, data) {
            data = data._data ? JSON.parse(JSON.stringify(data._data)) : data;
            data.pickerWidth     = parseInt(data.pickerWidth)  || 100;
            data.pickerHeight    = parseInt(data.pickerHeight) || 100;
            data.gamut           = typeof data.gamut === 'string' ? data.gamut : 'default';
            var gamutZoom   = true;
            data.transitionTime  = parseInt(data.transitionTime) || 0;
            data.buttonName      = typeof data.buttonName  === 'string' ? data.buttonName  : '';
            data.closeButton     = typeof data.closeButton === 'string' ? data.closeButton : '';
            var factor  = parseFloat(data.factor) || 1;
            var decimal = parseInt(data.decimal || 0, 10) || 0;

            var $this = $(el);
            $this.html(data.buttonName);
            var handler = [];

            var picker = new jscolor($this[0], {
                valueElement:   false,
                onFineChange:   function () {
                    for (var h = 0; h < handler.length; h++) {
                        handler[h]();
                    }
                },
                mode:            'CIE',
                gamut:           data.gamut,
                gamutZoom:       gamutZoom,
                width:           data.pickerWidth,
                height:          data.pickerHeight,
                closable:        !!data.closeButton,
                closeText:       data.closeButton,
                padding:         0,
                shadow:          false,
                borderWidth:     0,
                backgroundColor: data.pickerBackground,
                insetColor:      '#000'
            });

            if (data['command-oid']  && data['command-oid'] !== 'nothing_selected' &&
                data['xy-oid']       && data['xy-oid']      !== 'nothing_selected' &&
                data['level-oid']    && data['level-oid']   !== 'nothing_selected') {
                var cmd_id   = data['command-oid'];
                var xy_id    = data['xy-oid'];
                var level_id = data['level-oid'];

                handler.push(function () {
                    if (cmd_id !== 'nothing_selected') {
                        var cmd = '{"transitiontime":' + data.transitionTime + ',"xy":"' + picker.xy[0] + ',' + picker.xy[1] + '",' + '"level":' + Math.round(picker.xy[2] * 100) + '}';
                        vis.setValue(cmd_id, cmd);
                    }
                });

                var onChange = function () {
                    var xy = vis.states[xy_id + '.val'] || '0.5,0.5';
                    if (typeof xy !== 'string') xy = '0.5,0.5';

                    var level = vis.states[level_id + '.val'] || 0;
                    xy = xy.split(',');
                    if (xy.length === 2) {
                        picker.fromXY(parseFloat(xy[0]), parseFloat(xy[1]), parseInt(level) / 100);
                    }
                };


                vis.states.bind(xy_id    + '.val', onChange);
                vis.states.bind(level_id + '.val', onChange);
                onChange();
            }
            if (data['hue-oid'] && data['hue-oid'] !== 'nothing_selected' &&
                    data['sat-oid'] && data['sat-oid'] !== 'nothing_selected' &&
                    data['bri-oid'] && data['bri-oid'] !== 'nothing_selected') {
                var hue = data['hue-oid'];
                var sat = data['sat-oid'];
                var bri = data['bri-oid'];

                handler.push(function () {
                    vis.setValue(hue, parseFloat(picker.hsv[0]).toFixed(decimal));
                    vis.setValue(sat, parseFloat((picker.hsv[1] / factor).toFixed(decimal)));
                    vis.setValue(bri, parseFloat((picker.hsv[2] / factor).toFixed(decimal)));
                });

                var htimer = null;
                var hueChanged = function () {
                    if (htimer) clearTimeout(htimer);
                    htimer = setTimeout(function () {
                        htimer = null;
                        picker.fromHSV(
                            Math.round(parseFloat(vis.states[hue + '.val'] || 0)),
                            Math.round(parseFloat(vis.states[sat + '.val'] || 0) * factor),
                            Math.round(parseFloat(vis.states[bri + '.val'] || 0) * factor)
                        );
                    }, 10);
                };

                vis.states.bind(hue + '.val', hueChanged);
                vis.states.bind(sat + '.val', hueChanged);
                vis.states.bind(bri + '.val', hueChanged);

                hueChanged();
            }
            if (data['red-oid'] && data['red-oid']  !== 'nothing_selected' &&
                    data['green-oid'] && data['green-oid'] !== 'nothing_selected' &&
                    data['blue-oid']  && data['blue-oid']  !== 'nothing_selected') {
                var r = data['red-oid'];
                var g = data['green-oid'];
                var b = data['blue-oid'];

                handler.push(function () {
                    vis.setValue(r, parseFloat((picker.rgb[0] / factor).toFixed(decimal)));
                    vis.setValue(g, parseFloat((picker.rgb[1] / factor).toFixed(decimal)));
                    vis.setValue(b, parseFloat((picker.rgb[2] / factor).toFixed(decimal)));
                });

                var timer = null;
                var rgbChanged = function () {
                    if (timer) clearTimeout(timer);
                    timer = setTimeout(function () {
                        timer = null;
                        picker.fromRGB(
                                Math.round(parseFloat(vis.states[r + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[g + '.val'] || 0) * factor),
                                Math.round(parseFloat(vis.states[b + '.val'] || 0) * factor)
                        );
                    }, 10);
                };

                vis.states.bind(r + '.val', rgbChanged);
                vis.states.bind(g + '.val', rgbChanged);
                vis.states.bind(b + '.val', rgbChanged);

                rgbChanged();
            }
            if (data['rgb-oid'] && data['rgb-oid'] !== 'nothing_selected') {
                var rgb = data['rgb-oid'];

                handler.push(function () {
                    vis.setValue(rgb, picker.toHEXString());
                });

                var _rgbChanged = function () {
                    picker.fromString(vis.states[rgb + '.val'] || '');
                };

                vis.states.bind(rgb + '.val', _rgbChanged);

                _rgbChanged();
            }
        },
        huepickerxy: function (el, data) {
            data = data._data ? JSON.parse(JSON.stringify(data._data)) : data;
            data.gamut = typeof data.gamut === 'string' ? data.gamut : 'default';
            data.transitionTime = parseInt(data.transitionTime) || 0;
            var gamutZoom = true;

            var $this = $(el);

            //build canvas
            var canvas = document.createElement('canvas');
            var img = document.createElement("img");
            canvas.appendChild(img);
            function redraw() {
                canvas.width = $this.width();
                canvas.height = $this.height();
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#FFFFFF";
                ctx.fillRect(0, 0, canvas.width, canvas.height); // Need to Fill Canvas otherwise its unable to be modified...
                var XYImagedata = ctx.getImageData(0, 0, canvas.width, canvas.height);
                for (var x = 0; x < canvas.width; x++) { // Every Pixel on ScanLine
                    for (var y = 0; y < canvas.height; y++) { // Every ScanLine
                        var Index = (x + y * canvas.width) * 4; // Index of Pixel
                        var xy;
                        if (gamutZoom){
                            xy = huepi.HelperZoomXYforModel(x / canvas.width, 1 - (y / canvas.height), data.gamut);
                        }else {
                            xy = [
                                x / canvas.width,
                                1 - (y / canvas.height)
                            ]
                        }
                        var XYColor = huepi.HelperXYtoRGBforModel(xy[0], xy[1], 1, data.gamut);
                        var TestColor = huepi.HelperXYtoRGB(xy[0], xy[1], 1);
                        if (TestColor.Red !== XYColor.Red || TestColor.Green !== XYColor.Green || TestColor.Blue !== XYColor.Blue){
                            XYImagedata.data[Index] = XYColor.Red * 240;
                            XYImagedata.data[Index + 1] = XYColor.Green * 240;
                            XYImagedata.data[Index + 2] = XYColor.Blue * 240;
                        }else {
                            XYImagedata.data[Index] = XYColor.Red * 255;
                            XYImagedata.data[Index + 1] = XYColor.Green * 255;
                            XYImagedata.data[Index + 2] = XYColor.Blue * 255;
                        }
                    }
                }
                ctx.putImageData(XYImagedata, 0, 0);
                img.src = canvas.toDataURL("image/png");

                var xyGet = vis.states[xy_id + '.val'] || '0.5,0.5';
                if (typeof xyGet !== 'string') xyGet = '0.5,0.5';
                xyGet = xyGet.split(',');
                xyGet = huepi.HelperUnzoomXYforModel(xyGet[0], xyGet[1], data.gamut);
                var centerX = xyGet[0] * canvas.width;
                var centerY = canvas.height - (xyGet[1] * canvas.height);
                var radius = 6;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#000000';
                ctx.stroke();
                $this.html(canvas);
            }
            $this.parent().parent().resize(function() {
				redraw();
			});
            $this.show(function() {
                redraw();
            });

			if (data['command-oid']  && data['command-oid'] !== 'nothing_selected' &&
                data['xy-oid']       && data['xy-oid']      !== 'nothing_selected') {
                var cmd_id   = data['command-oid'];
                var xy_id    = data['xy-oid'];

                $this.click(function (e) {
                    var xy = [e.offsetX / canvas.width, 1 - (e.offsetY / canvas.height)];
                    if (gamutZoom) {
                        xy = huepi.HelperZoomXYforModel(xy[0], xy[1], data.gamut);
					}
					var cmd = '{"transitiontime":' + data.transitionTime + ',"xy":"' + xy[0] + ',' + xy[1] + '"}';
					vis.setValue(cmd_id, cmd);
                });

                var onChange = function () {
                    redraw();
                };

                vis.states.bind(xy_id    + '.val', onChange);
            }
        },
        hueindicatorxy: function (el, data) {
            data = data._data ? JSON.parse(JSON.stringify(data._data)) : data;
            data.gamut = typeof data.gamut === 'string' ? data.gamut : 'default';
            var $this = $(el);

            if (data['xy-oid']       && data['xy-oid']      !== 'nothing_selected') {
                var xy_id    = data['xy-oid'];

                var onChange = function () {
                    var xyGet = vis.states[xy_id + '.val'] || '0.5,0.5';
                    if (typeof xyGet !== 'string') xyGet = '0.5,0.5';
                    xyGet = xyGet.split(',');
                    var rgb = huepi.HelperXYtoRGBforModel(xyGet[0], xyGet[1], 1, data.gamut);
                    $this.css("background-color", huepi.HelperRGBToHEX(rgb));
                };

                vis.states.bind(xy_id    + '.val', onChange);
                onChange();
            }
        },
        huepickerct: function (el, data) {
            data = data._data ? JSON.parse(JSON.stringify(data._data)) : data;
            data.transitionTime = parseInt(data.transitionTime) || 0;
            var ctMin = 2000;
            var ctMax = 6500;

            var $this = $(el);

            //build canvas
            var canvas = document.createElement('canvas');
            var img = document.createElement("img");
            canvas.appendChild(img);
            function redraw() {
                canvas.width = $this.width();
                canvas.height = $this.height();
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#FFFFFF";
                ctx.fillRect(0, 0, canvas.width, canvas.height); // Need to Fill Canvas otherwise its unable to be modified...
                var XYImagedata = ctx.getImageData(0, 0, canvas.width, canvas.height);
                for (var x = 0; x < canvas.width; x++) { // Every Pixel on ScanLine
                    var ctColor = huepi.HelperColortemperaturetoRGB(ctMin + (x / canvas.width * (ctMax - ctMin)));
                    for (var y = 0; y < canvas.height; y++) { // Every ScanLine
                        var Index = (x + y * canvas.width) * 4; // Index of Pixel
						XYImagedata.data[Index] = ctColor.Red * 255;
						XYImagedata.data[Index + 1] = ctColor.Green * 255;
						XYImagedata.data[Index + 2] = ctColor.Blue * 255;
                    }
                }
                ctx.putImageData(XYImagedata, 0, 0);
                img.src = canvas.toDataURL("image/png");
                var ctGet = parseInt(vis.states[ct_id + '.val']) || 153;
                ctGet = Math.max(2000, Math.min(6500, Math.round(Math.pow(10,6)/ctGet)));
                ctGet = canvas.width / ((ctMax-ctMin) / (ctGet-ctMin));
                ctx.beginPath();
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#000000';
                ctx.moveTo(ctGet, 0);
                ctx.lineTo(ctGet, canvas.height);
                ctx.stroke();
                $this.html(canvas);
            }
            $this.parent().parent().resize(function() {
                redraw();
            });
            $this.show(function() {
                redraw();
            });

            if (data['command-oid']  && data['command-oid'] !== 'nothing_selected' &&
                data['ct-oid']       && data['ct-oid']      !== 'nothing_selected') {
                var cmd_id   = data['command-oid'];
                var ct_id    = data['ct-oid'];

                $this.click(function (e) {
                    var ct = e.offsetX / canvas.width;
                    ct = Math.round(ctMin + (ctMax-ctMin) * ct);
                    ct = Math.max(153, Math.min(500, Math.round(Math.pow(10,6)/ct)));
                    var cmd = '{"transitiontime":' + data.transitionTime + ',"ct":"' + ct + '"}';
                    vis.setValue(cmd_id, cmd);
                });

                var onChange = function () {
                    redraw();
                };

                vis.states.bind(ct_id    + '.val', onChange);
            }
        },
        hueindicatorct: function (el, data) {
            data = data._data ? JSON.parse(JSON.stringify(data._data)) : data;
            var $this = $(el);

            if (data['ct-oid']       && data['ct-oid']      !== 'nothing_selected') {
                var ct_id    = data['ct-oid'];

                var onChange = function () {
                    var ctGet = parseInt(vis.states[ct_id + '.val']) || 153;
                    ctGet = Math.max(2000, Math.min(6500, Math.round(Math.pow(10,6)/ctGet)));
                    var rgb = huepi.HelperColortemperaturetoRGB(ctGet);
                    $this.css("background-color", huepi.HelperRGBToHEX(rgb));
                };

                vis.states.bind(ct_id    + '.val', onChange);
                onChange();
            }
        }
    };

    if (vis.editMode) {
        vis.binds.colorpicker.changedHUE = function (widgetID, view, newId, fields) {
            var cmd     = vis.objects[newId];
            var changed = [];

            // If it is real object and state
            if (cmd && cmd.common && cmd.type === 'state') {
                var light   = vis.objects[newId.split('.').slice(0,-1).join('.')];
                var xy      = vis.objects[newId.split('.').slice(0,-1).join('.') + '.xy'];
                var level   = vis.objects[newId.split('.').slice(0,-1).join('.') + '.level'];

                if (xy && xy.type === 'state' && !vis.views[view].widgets[widgetID].data['xy-oid']) {
                    changed.push('xy-oid');
                    vis.views[view].widgets[widgetID].data['xy-oid'] = newId.split('.').slice(0,-1).join('.') + '.xy';
                    vis.widgets[widgetID].data['xy-oid'] = newId.split('.').slice(0,-1).join('.') + '.xy';
                }
                if (level && level.type === 'state' && !vis.views[view].widgets[widgetID].data['level-oid']) {
                    changed.push('level-oid');
                    vis.views[view].widgets[widgetID].data['level-oid'] = newId.split('.').slice(0,-1).join('.') + '.level';
                    vis.widgets[widgetID].data['level-oid'] = newId.split('.').slice(0,-1).join('.') + '.level';
                }
                if (light.native.modelid !== undefined && !vis.views[view].widgets[widgetID].data.gamut) {
                    changed.push('gamut');
                    vis.views[view].widgets[widgetID].data.gamut = light.native.modelid;
                    vis.widgets[widgetID].data.gamut = light.native.modelid;
                }
            }
            return changed;
        };
        vis.binds.colorpicker.changedHUEPickerXY = function (widgetID, view, newId, fields) {
            var cmd     = vis.objects[newId];
            var changed = [];

            // If it is real object and state
            if (cmd && cmd.common && cmd.type === 'state') {
                var light   = vis.objects[newId.split('.').slice(0,-1).join('.')];
                var xy      = vis.objects[newId.split('.').slice(0,-1).join('.') + '.xy'];

                if (xy && xy.type === 'state' && !vis.views[view].widgets[widgetID].data['xy-oid']) {
                    changed.push('xy-oid');
                    vis.views[view].widgets[widgetID].data['xy-oid'] = newId.split('.').slice(0,-1).join('.') + '.xy';
                    vis.widgets[widgetID].data['xy-oid'] = newId.split('.').slice(0,-1).join('.') + '.xy';
                }
                if (light.native.modelid !== undefined && !vis.views[view].widgets[widgetID].data.gamut) {
                    changed.push('gamut');
                    vis.views[view].widgets[widgetID].data.gamut = light.native.modelid;
                    vis.widgets[widgetID].data.gamut = light.native.modelid;
                }
            }
            return changed;
        };
        vis.binds.colorpicker.changedHUEPickerCT = function (widgetID, view, newId, fields) {
            var cmd     = vis.objects[newId];
            var changed = [];

            // If it is real object and state
            if (cmd && cmd.common && cmd.type === 'state') {
                var light   = vis.objects[newId.split('.').slice(0,-1).join('.')];
                var ct      = vis.objects[newId.split('.').slice(0,-1).join('.') + '.ct'];

                if (ct && ct.type === 'state' && !vis.views[view].widgets[widgetID].data['ct-oid']) {
                    changed.push('ct-oid');
                    vis.views[view].widgets[widgetID].data['ct-oid'] = newId.split('.').slice(0,-1).join('.') + '.ct';
                    vis.widgets[widgetID].data['ct-oid'] = newId.split('.').slice(0,-1).join('.') + '.ct';
                }
            }
            return changed;
        };
        vis.binds.colorpicker.changedHUEIndicatorXY = function (widgetID, view, newId, fields) {
            var xy     = vis.objects[newId];
            var changed = [];

            // If it is real object and state
            if (xy && xy.common && xy.type === 'state') {
                var light   = vis.objects[newId.split('.').slice(0,-1).join('.')];

                if (xy && xy.type === 'state' && !vis.views[view].widgets[widgetID].data['xy-oid']) {
                    changed.push('xy-oid');
                    vis.views[view].widgets[widgetID].data['xy-oid'] = newId.split('.').slice(0,-1).join('.') + '.xy';
                    vis.widgets[widgetID].data['xy-oid'] = newId.split('.').slice(0,-1).join('.') + '.xy';
                }
                if (light.native.modelid !== undefined && !vis.views[view].widgets[widgetID].data.gamut) {
                    changed.push('gamut');
                    vis.views[view].widgets[widgetID].data.gamut = light.native.modelid;
                    vis.widgets[widgetID].data.gamut = light.native.modelid;
                }
            }
            return changed;
        };
    }

	vis.binds.colorpicker.showVersion();
</script>

<script id="tplRGBSpectrum"
                 type="text/ejs"
                 class="vis-tpl"
                 data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplRGBSpectrum.png"></img>'
                 data-vis-set="colorpicker"
                 data-vis-type="ctrl,color"
                 data-vis-name="RGB spectrum"
                 data-vis-attrs="rgb-oid/id;"
                 data-vis-attrs0="group.rgb;red-oid/id;green-oid/id;blue-oid/id;"
                 data-vis-attrs1="group.hue;hue-oid/id;sat-oid/id;bri-oid/id;"
                 data-vis-attrs2="group.extra;factor[1];decimal[0]/slider,0,5,1;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <input style="width: 100%; height: 100%" <%= (el) -> vis.binds.colorpicker.spectrum(el, data) %> />
        </div>
    </div>
</script>

<script id="tplSpectrumHomematic"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplRGBSpectrum.png"></img>'
        data-vis-set="colorpicker"
        data-vis-type="ctrl,color"
        data-vis-name="Homematic spectrum"
        data-vis-attrs="color-oid/id;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <input style="width: 100%; height: 100%" <%= (el) -> vis.binds.colorpicker.spectrumHomematic(el, data) %> />
        </div>
    </div>
</script>

<script id="tplRGBFarbtastic"
        class="vis-tpl" 
        type="text/ejs"
        data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplRGBFarbtastic.png"></img>'
        data-vis-set="colorpicker"
        data-vis-type="ctrl,color"
        data-vis-name="farbtastic"
        data-vis-attrs="rgb-oid/id;"
        data-vis-attrs0="group.rgb;red-oid/id;green-oid/id;blue-oid/id;"
        data-vis-attrs1="group.hue;hue-oid/id;sat-oid/id;bri-oid/id;"
        data-vis-attrs2="group.extra;factor[1];decimal[0]/slider,0,5,1;"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 196px; height: 196px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div></div>
            <input <%= (el) -> vis.binds.colorpicker.farbtastic(el, data) %> />
        </div>
    </div>
</script>

<script id="tplHUEjscolor"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplHUEjscolor.png"></img>'
        data-vis-set="colorpicker"
        data-vis-type="ctrl,color"
        data-vis-name="Philips HUE"
        data-vis-attrs="command-oid/id/changedHUE;xy-oid/id;level-oid/id;gamut;transitionTime[4]/number,0,30000,1;pickerWidth[100]/number,0,500,1;pickerHeight[100]/number,0,500,1;pickerBackground/color;buttonName[HUE]/html;closeButton[close];"
        data-vis-attrs0="group.rgb;red-oid/id;green-oid/id;blue-oid/id;divisor[1];decimal[0]/slider,0,5,1;rgb-oid/id;"
        data-vis-attrs1="group.hue;hue-oid/id;sat-oid/id;bri-oid/id;"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:100px;height:100px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="display:table;">
            <div class="ui-button ui-state-default ui-corner-all" style="width:100%;height:100%;display:table-cell;" <%= (el) -> vis.binds.colorpicker.jscolorcie(el, data) %> ></div>
        </div>
    </div>
</script>

<script id="tplHUEPickerXY"
		type="text/ejs"
		class="vis-tpl"
		data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplHUEPickerXY.png"></img>'
		data-vis-set="colorpicker"
		data-vis-type="ctrl,color"
		data-vis-name="Philips HUE XY-Picker"
		data-vis-attrs="command-oid/id/changedHUEPickerXY;xy-oid/id;gamut;transitionTime[4]/number,0,30000,1;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:100px;height:100px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div class="hue-canvas" style="width:100%;height:100%;cursor:crosshair;" <%= (el) -> vis.binds.colorpicker.huepickerxy(el, data) %> ></div>
        </div>
    </div>
</script>

<script id="tplHUEIndicatorXY"
		type="text/ejs"
		class="vis-tpl"
		data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplHUEIndicatorXY.png"></img>'
		data-vis-set="colorpicker"
		data-vis-type="value,color"
		data-vis-name="Philips HUE XY-Indicator"
		data-vis-attrs="xy-oid/id/changedHUEIndicatorXY;gamut;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:100px;height:100px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div class="hue-indicator-xy" style="width:100%;height:100%;" <%= (el) -> vis.binds.colorpicker.hueindicatorxy(el, data) %> ></div>
        </div>
    </div>
</script>

<script id="tplHUEPickerCT"
		type="text/ejs"
		class="vis-tpl"
		data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplHUEPickerCT.png"></img>'
		data-vis-set="colorpicker"
		data-vis-type="ctrl,color"
		data-vis-name="Philips HUE CT-Picker"
		data-vis-attrs="command-oid/id/changedHUEPickerCT;ct-oid/id;transitionTime[4]/number,0,30000,1;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:100px;height:100px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div class="hue-canvas-ct" style="width:100%;height:100%;cursor:crosshair;" <%= (el) -> vis.binds.colorpicker.huepickerct(el, data) %> ></div>
        </div>
    </div>
</script>

<script id="tplHUEIndicatorCT"
		type="text/ejs"
		class="vis-tpl"
		data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplHUEIndicatorCT.png"></img>'
		data-vis-set="colorpicker"
		data-vis-type="value,color"
		data-vis-name="Philips HUE CT-Indicator"
		data-vis-attrs="ct-oid/id;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:100px;height:100px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <div class="hue-indicator-xy" style="width:100%;height:100%;" <%= (el) -> vis.binds.colorpicker.hueindicatorct(el, data) %> ></div>
        </div>
    </div>
</script>

<script id="tplJscolor" 
		type="text/ejs" 
		class="vis-tpl"
        data-vis-prev='<img src="widgets/colorpicker/img/Prev_tplJscolor.png"></img>'
		data-vis-set="colorpicker"
        data-vis-type="ctrl,color"
		data-vis-name="RGBColor"
		data-vis-attrs="title[RGB:&nbsp];closeText[X];rgb-oid/id;"
        data-vis-attrs0="group.rgb;red-oid/id;green-oid/id;blue-oid/id;"
        data-vis-attrs1="group.hue;hue-oid/id;sat-oid/id;bri-oid/id;"
        data-vis-attrs2="group.extra;factor[1];decimal[0]/slider,0,5,1;"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 96px; height: 50px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="display: inline-block">
            <table style="border: 0; border-spacing: 0; width: 100%; height: 100%" class="vis-no-spaces">
            	<tr class="vis-no-spaces">
					<td class="vis-no-spaces"><%== this.data.attr('title') %></td>
					<td class="vis-no-spaces"><input style="width: calc(100% - 5px); height: 100%" readonly <%= (el) -> vis.binds.colorpicker.jscolor(el, this.data) %> /></td>
				</tr>
			</table>
        </div>
    </div>
</script>


<!-- --------------colorpicker.html--- END -->
<!-- --------------consumption.html--- START -->
<!--
    ioBroker.consumption

    version: "0.4.3"

    Copyright 2020 bluefox <dogafox@gmail.com>
-->
<link rel="stylesheet" type="text/css" href="widgets/consumption/css/styles.css" />

<script type="text/javascript">

    /*var vis = {
        editMode: false,
        binds: {},
        conn: {
            getStates: function () {}
        },
        unregisterOnChange: function () {}
    };
    function _(a) {return a; }
    function $(item) { return item; }*/

    $.extend(true, systemDictionary, {
        "%s overview": {
            "en": "%s overview",
            "de": "%s Übersicht",
            "ru": "%s обзор",
            "pt": "Visão geral do %s",
            "nl": "Overzicht van %s",
            "fr": "Présentation de %s",
            "it": "Panoramica di %s",
            "es": "Resumen de %s",
            "pl": "Przegląd %s",
            "zh-cn": "％s概述"
        },
        "Actual": {
            "en": "Actual",
            "de": "Tatsächlich",
            "ru": "Этот год",
            "pt": "Real",
            "nl": "Eigenlijk",
            "fr": "Réel",
            "it": "Effettivo",
            "es": "Real",
            "pl": "Rzeczywisty",
            "zh-cn": "实际"
        },
        "All": {
            "en": "All",
            "de": "Alle",
            "ru": "Все",
            "pt": "Tudo",
            "nl": "Allemaal",
            "fr": "Tout",
            "it": "Tutti",
            "es": "Todos",
            "pl": "Wszystko",
            "zh-cn": "所有"
        },
        "Costs for %s": {
            "en": "Costs for %s",
            "de": "Kosten für %s",
            "ru": "Затраты на %s",
            "pt": "Custos para %s",
            "nl": "Kosten voor %s",
            "fr": "Coûts pour %s",
            "it": "Costi per %s",
            "es": "Costos para %s",
            "pl": "Koszty dla %s",
            "zh-cn": "％s的费用"
        },
        "Forecast": {
            "en": "Forecast",
            "de": "Prognose",
            "ru": "Прогноз",
            "pt": "Previsão",
            "nl": "Voorspelling",
            "fr": "Prévoir",
            "it": "previsione",
            "es": "Pronóstico",
            "pl": "Prognoza",
            "zh-cn": "预测"
        },
        "Heat map": {
            "en": "Heat map",
            "de": "Wärmekarte",
            "ru": "Тепловая карта",
            "pt": "Mapa de calor",
            "nl": "Heat map",
            "fr": "Carte de chaleur",
            "it": "Mappa di calore",
            "es": "Mapa de calor",
            "pl": "Mapa ciepła",
            "zh-cn": "热图"
        },
        "Name": {
            "en": "Name",
            "de": "Name",
            "ru": "Имя",
            "pt": "Nome",
            "nl": "Naam",
            "fr": "Nom",
            "it": "Nome",
            "es": "Nombre",
            "pl": "Imię",
            "zh-cn": "名称"
        },
        "Now %s": {
            "en": "Now %s",
            "de": "Jetzt %s",
            "ru": "Сейчас %s",
            "pt": "Agora %s",
            "nl": "Nu %s",
            "fr": "Maintenant %s",
            "it": "Ora %s",
            "es": "Ahora %s",
            "pl": "Teraz %s",
            "zh-cn": "现在％s"
        },
        "Pie chart": {
            "en": "Pie chart",
            "de": "Kuchendiagramm",
            "ru": "Круговая диаграмма",
            "pt": "Gráfico de pizza",
            "nl": "Cirkeldiagram",
            "fr": "Diagramme circulaire",
            "it": "Grafico a torta",
            "es": "Gráfico circular",
            "pl": "Wykres kołowy",
            "zh-cn": "饼形图"
        },
        "Planned": {
            "en": "Planned",
            "de": "Geplant",
            "ru": "Запланированные",
            "pt": "Planejado",
            "nl": "Gepland",
            "fr": "Prévu",
            "it": "Planned",
            "es": "Planificado",
            "pl": "Zaplanowany",
            "zh-cn": "计划"
        },
        "Planning": {
            "en": "Planning",
            "de": "Planung",
            "ru": "Запланировано",
            "pt": "Planejamento",
            "nl": "Planning",
            "fr": "Planification",
            "it": "Pianificazione",
            "es": "Planificación",
            "pl": "Planowanie",
            "zh-cn": "规划"
        },
        "Reference": {
            "en": "Reference",
            "de": "Referenz",
            "ru": "Сравнение",
            "pt": "Referência",
            "nl": "Referentie",
            "fr": "Référence",
            "it": "Riferimento",
            "es": "Referencia",
            "pl": "Odniesienie",
            "zh-cn": "参考"
        },
        "Stack bar": {
            "en": "Stack bar",
            "de": "Stapelleiste",
            "ru": "Stack bar",
            "pt": "Barra de empilhamento",
            "nl": "Stapelbalk",
            "fr": "Barre de pile",
            "it": "Stack bar",
            "es": "Barra de pila",
            "pl": "Pasek stosu",
            "zh-cn": "堆叠栏"
        },
        "Table": {
            "en": "Table",
            "de": "Tabelle",
            "ru": "Таблица",
            "pt": "Tabela",
            "nl": "Tafel",
            "fr": "Table",
            "it": "tavolo",
            "es": "Mesa",
            "pl": "Stół",
            "zh-cn": "表"
        },
        "Total": {
            "en": "Total",
            "de": "Gesamt",
            "ru": "Итого",
            "pt": "Total",
            "nl": "Totaal",
            "fr": "Total",
            "it": "Totale",
            "es": "Total",
            "pl": "Całkowity",
            "zh-cn": "总"
        },
        "from": {
            "en": "from",
            "de": "von",
            "ru": "от",
            "pt": "de",
            "nl": "van",
            "fr": "de",
            "it": "a partire dal",
            "es": "desde",
            "pl": "od",
            "zh-cn": "从"
        },
        "rendering...": {
            "en": "rendering...",
            "de": "Rendern...",
            "ru": "рендеринг...",
            "pt": "Renderização...",
            "nl": "renderen...",
            "fr": "le rendu...",
            "it": "il rendering ...",
            "es": "representación...",
            "pl": "wykonanie...",
            "zh-cn": "渲染..."
        },
        "to": {
            "en": "to",
            "de": "bis",
            "ru": "до",
            "pt": "para",
            "nl": "naar",
            "fr": "à",
            "it": "per",
            "es": "a",
            "pl": "do",
            "zh-cn": "至"
        },
        "Total overview": {
            "en": "Total overview",
            "de": "Gesamtübersicht",
            "ru": "Общий обзор",
            "pt": "Visão geral total",
            "nl": "Totaal overzicht",
            "fr": "Vue d'ensemble",
            "it": "Panoramica totale",
            "es": "Resumen total",
            "pl": "Ogólny przegląd",
            "zh-cn": "总概述"
        }
    });

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "consInstance": {
                "en": "Instance",
                "de": "Instanz",
                "ru": "Инстанция",
                "pt": "Instância",
                "nl": "Voorbeeld",
                "fr": "Exemple",
                "it": "Esempio",
                "es": "Ejemplo",
                "pl": "Instancja",
                "zh-cn": "实例"
            },
            "colorTheme": {
                "en": "Theme",
                "de": "Thema",
                "ru": "Тема",
                "pt": "Tema",
                "nl": "Thema",
                "fr": "Thème",
                "it": "Tema",
                "es": "Tema",
                "pl": "Motyw",
                "zh-cn": "主题"
            },
            "startsFrom": {
                "en": "Data start from",
                "de": "Daten beginnen ab",
                "ru": "Данные начинаются с",
                "pt": "Os dados começam em",
                "nl": "Gegevens beginnen vanaf",
                "fr": "Les données commencent à partir de",
                "it": "I dati iniziano da",
                "es": "Los datos comienzan desde",
                "pl": "Dane zaczynają się od",
                "zh-cn": "数据从"
            },
            "startsFrom_tooltip": {
                "en": "In form 2020-01 or 2020-01-01",
                "de": "In Form 2020-01 oder 2020-01-01",
                "ru": "По форме 2020-01 или 2020-01-01",
                "pt": "No formulário 2020-01 ou 2020-01-01",
                "nl": "In vorm 2020-01 of 2020-01-01",
                "fr": "Sous forme 2020-01 ou 2020-01-01",
                "it": "Nel modulo 2020-01 o 2020-01-01",
                "es": "En forma 2020-01 o 2020-01-01",
                "pl": "W formie 2020-01 lub 2020-01-01",
                "zh-cn": "格式为2020-01或2020-01-01"
            },
            "consumption_station": {
                "en": "Consumption station",
                "de": "Verbrauchsstation",
                "ru": "Станция потребления",
                "pt": "Estação de consumo",
                "nl": "Verbruiksstation",
                "fr": "Station de consommation",
                "it": "Stazione di consumo",
                "es": "Estación de consumo",
                "pl": "Stacja zużycia",
                "zh-cn": "消费站"
            }
        });
    }

    vis.binds.consumption = {
        version: "0.4.3",
        showVersion: function () {
            if (vis.binds.consumption.version) {
                console.log('Version consumption: ' + vis.binds.consumption.version);
                vis.binds.consumption.version = null;
            }
        },
        months: {
            en: ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            de: ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
            ru: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек']
        },

        padZero: function (num) {
            if (num.length < 2) {
                return '0' + num;
            } else {
                return num;
            }
        },
        invertColor: function (hex, bw) {
            // taken from here: https://stackoverflow.com/questions/35969656/how-can-i-generate-the-opposite-color-according-to-current-color
            if (hex.indexOf('#') === 0) {
                hex = hex.slice(1);
            }
            // convert 3-digit hex to 6-digits.
            if (hex.length === 3) {
                hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
            }
            if (hex.length !== 6) {
                throw new Error('Invalid HEX color.');
            }
            var r = parseInt(hex.slice(0, 2), 16);
            var g = parseInt(hex.slice(2, 4), 16);
            var b = parseInt(hex.slice(4, 6), 16);

            if (bw) {
                // http://stackoverflow.com/a/3943023/112731
                return (r * 0.299 + g * 0.587 + b * 0.114) > 186
                    ? '#000000'
                    : '#FFFFFF';
            }
            // invert color components
            r = (255 - r).toString(16);
            g = (255 - g).toString(16);
            b = (255 - b).toString(16);
            // pad each with zeros and return
            return '#' + vis.binds.consumption.padZero(r) + vis.binds.consumption.padZero(g) + vis.binds.consumption.padZero(b);
        },
        getStations: function (instance, cb) {
            instance = instance || 0;
            vis.conn.getStates([
                'consumption.' + instance + '.instances.common.resources',
                'consumption.' + instance + '.instances.common.stations'
            ], function (err, data) {
                if (err) {
                    cb(err);
                } else {
                    try {
                        var stations  = JSON.parse(data['consumption.' + instance + '.instances.common.stations'].val  || '[]');
                        var resources = JSON.parse(data['consumption.' + instance + '.instances.common.resources'].val || '[]');
                        cb(null, {stations: stations, resources: resources});
                    } catch (e) {
                        cb('Cannot parse stations: ' + e);
                    }
                }
            });
        },
        renderStations: function ($div, $el, stations) {
            var text = '<table class="vis-cons-stations-table"><tr class="vis-cons-stations-tr>';
            text += '<td class="vis-cons-stations-td" data-name="">' + _('All') + '</td></tr>';
            for (var i = 0; i < stations.length; i++) {
                text += '<td class="vis-cons-stations-td" data-name="' + stations[i].name + '" data-color="' + stations[i].color + '">';
                text += stations[i].title;
                text += '</td>';
            }

            text += '</tr></table>';

            $el.html(text);

            var $items = $el.find('.vis-cons-stations-td');

            // install handlers
            $items.on('click', function () {
                $(this).parent().find('.vis-cons-stations-td').removeClass('vis-cons-stations-selected');
                $(this).addClass('vis-cons-stations-selected');
                vis.binds.consumption.setSettings($div, null, $(this).data('name'));
            });

            // select current resource
            var settings = $div.data('settings');

            $items.each(function () {
                if (settings.station === $(this).data('name')) {
                    $(this).addClass('vis-cons-resources-selected');
                }
            });
        },
        renderResources: function ($div, $el, resources) {
            var count = resources.length + 1; // + all
            var width = Math.round(10000 / count) / 100;

            var text = '<table class="vis-cons-resources-table"><tr class="vis-cons-resources-tr">';
            if (count > 2) {
                text += '<td class="vis-cons-resources-td vis-cons-resources-all" data-name="" style="width: ' + width + '%"><span class="vis-cons-types-icon">€</span><span class="vis-cons-types-title">' + _('all') + '</span></td>';
            }

            var ownClasses = $div.data('data').ownClasses || false;

            for (var r = 0; r < resources.length; r++) {
                var color = resources[r].color;
                var style = ownClasses ? '' : 'background: ' + color + '50; color: ' + vis.binds.consumption.invertColor(resources[r].color, true);

                text += '<td class="vis-cons-resources-td vis-cons-resources-td-' + resources[r].name + '" data-name="' + resources[r].name + '" style="width: ' + width + '%; ' + style + '">';
                if (resources[r].icon && resources[r].icon.length <= 2) {
                    text += '<span class="vis-cons-types-icon">' + resources[r].icon + '</span>';
                }
                text += '<span class="vis-cons-types-title">' + resources[r].title + '</span>';
                text += '</td>';
            }
            text += '</tr></table>';
            $el.html(text);

            // install handlers
            var $items = $el.find('.vis-cons-resources-td');
            $items.on('click', function () {
                $(this).parent().find('.vis-cons-resources-td').removeClass('vis-cons-resources-selected');
                $(this).addClass('vis-cons-resources-selected');
                vis.binds.consumption.setSettings($div, null, null, $(this).data('name'));
            });

            // select current resource
            var settings = $div.data('settings');

            if (count === 2 && !settings.resource) {
                vis.binds.consumption.setSettings($div, null, null, resources[0].name);
                $items.each(function () {
                    if ($(this).data('name')) {
                        $(this).addClass('vis-cons-resources-selected');
                    }
                });
            } else {
                $items.each(function () {
                    if (settings.resource === $(this).data('name')) {
                        $(this).addClass('vis-cons-resources-selected');
                    }
                });
            }
        },
        renderTypes: function ($div, $el) {
            var text = '<table class="vis-cons-types-table">';
            text += '<tr class="vis-cons-types-tr"><td class="vis-cons-types-td" data-name="plan" title="' + _('Planning') + '">' +
                '<img class="vis-cons-types-icon" src="widgets/consumption/img/market-research.svg" alt="analysis"/>' +
                '</td></tr>';
            text += '<tr class="vis-cons-types-tr"><td class="vis-cons-types-td" data-name="donut" title="' + _('Pie chart') + '">' +
                '<img class="vis-cons-types-icon" src="widgets/consumption/img/seo-and-web.svg" alt="donut"/>' +
                '</td></tr>';
            text += '<tr class="vis-cons-types-tr"><td class="vis-cons-types-td" data-name="stackbar" title="' + _('Stack bar') + '">' +
                '<img class="vis-cons-types-icon" src="widgets/consumption/img/stacked.svg" alt="stackbar"/>' +
                '</td></tr>';
            text += '<tr class="vis-cons-types-tr"><td class="vis-cons-types-td" data-name="heatmap" title="' + _('Heat map') + '">' +
                '<img class="vis-cons-types-icon" src="widgets/consumption/img/heatmap.svg" alt="heatmap"/>' +
                '</td></tr>';
            text += '<tr class="vis-cons-types-tr"><td class="vis-cons-types-td" data-name="table" title="' + _('Table') + '">' +
                '<img class="vis-cons-types-icon" src="widgets/consumption/img/spreadsheet.svg" alt="table"/>' +
                '</td></tr>';

            text += '</table>';
            $el.html(text);

            var $items = $el.find('.vis-cons-types-td');
            // install handlers
            $items.on('click', function () {
                $(this).parent().parent().find('.vis-cons-types-td').removeClass('vis-cons-types-selected');
                $(this).addClass('vis-cons-types-selected');
                vis.binds.consumption.setSettings($div, $(this).data('name'));
            });

            // select current resource
            var settings = $div.data('settings');

            $items.each(function () {
                if (settings.type === $(this).data('name')) {
                    $(this).addClass('vis-cons-types-selected');
                }
            });
        },
        loadCharts: function (cb) {
            if (!vis.binds.consumption.loaded) {
                vis.binds.consumption.loaded = true;
                $.ajax({
                    url: 'widgets/consumption/js/echarts.min.js',
                    dataType: 'script',
                    success: function () { cb && cb();}
                });
            } else {
                return cb && cb();
            }
        },
        setSettings: function ($div, type, station, resource, start, end, isEuro, force) {
            var settings = $div.data('settings');
            var changed = false;
            if (type && settings.type !== type) {
                settings.type = type;
                changed = true;
            }
            if (station !== null && station !== undefined && settings.station !== station) {
                settings.station = station;
                changed = true;
            }
            if (resource !== null && resource !== undefined && settings.resource !== resource) {
                settings.resource = resource;
                changed = true;
            }
            if (isEuro !== null && isEuro !== undefined && settings.isEuro !== isEuro) {
                settings.isEuro = isEuro;
                changed = true;
            }
            if (start && settings.start !== start) {
                var startsFrom = $div.data('data').startsFrom;
                if (startsFrom) {
                    var parts = startsFrom.split('-');
                    startsFrom = new Date(parseInt(parts[0], 10), parseInt(parts[1], 10) - 1, 1);
                    if (start < startsFrom.getTime()) {
                        start = startsFrom.getTime();
                    }
                }

                settings.start = start;
                changed = true;
            }
            if (end && settings.end !== end) {
                var startsFrom1 = $div.data('data').startsFrom;
                if (startsFrom1) {
                    var parts1 = startsFrom1.split('-');
                    startsFrom1 = new Date(parseInt(parts1[0], 10), parseInt(parts1[1], 10) - 1, 1);
                    if (start < startsFrom1.getTime()) {
                        end = startsFrom1.getTime();
                    }
                }
                settings.end = end;
                changed = true;
            }

            if (changed || force) {
                localStorage.setItem('vis-consumption', JSON.stringify(settings));
                $div.data('settings', settings);
                var instance = $div.data('instance');
                vis.conn.setState(instance + '.trigger', JSON.stringify(settings));
            }
        },
        initInstance: function (instId, instance, cb) {
            if (!vis.binds.consumption.instancePromise) {
                vis.binds.consumption.instancePromise = true;
                vis.conn.getStates([instId + '.lastTime'], function (err, data) {
                    if (!data[instId + '.lastTime'] || !data[instId + '.lastTime'].val) {
                        vis.conn.setState('consumption.' + instance + '.instances.common.addInstance', vis.instance.replace(/\./g, '_'), function () {
                            setTimeout(function () {
                                vis.conn.subscribe(instId + '.result', function () {
                                    cb && cb();
                                }, 200); // wait till
                            });
                        });
                    } else {
                        vis.conn.subscribe(instId + '.result', function () { cb && cb(); });
                    }
                });
            } else {
                cb && cb();
            }
        },
        init: function (el, wid, view, data, style) {
            var $div = $('#' + wid);
            if (!$div.length) {
                return setTimeout(function () {
                    vis.binds.consumption.init(el, wid, view, data, style);
                }, 100);
            }

            var _data = Object.assign({}, data);
            _data.consInstance = _data.consInstance || 0;
            _data.startsFrom = _data.startsFrom || '2020-01';
            var parts = _data.startsFrom.split('-');
            if ((parts[0] || '').length !== 4) {
                parts[0] = '2020';
            }
            if (!parts[1]) {
                parts[1] = '01';
            }
            _data.startsFrom = parts[0] + '-' + parts[1];

            // generate instance if not exists
            !vis.instance && vis.generateInstance();

            var inst = 'consumption.' + _data.consInstance + '.instances.' + vis.instance.replace(/\./g, '_');
            $div.data('instance', inst);
            $div.data('dateFormat', _data.dateFormat || 'yy-mm-dd');
            $div.data('data', Object.assign({}, _data));

            // load echarts
            vis.binds.consumption.loadCharts(function () {
                vis.binds.consumption.initInstance(inst, _data.consInstance, function () {
                    vis.binds.consumption.getStations(_data.consInstance, function (err, data) {
                        // init settings
                        var settings = localStorage.getItem('vis-consumption') || '{}';
                        try {
                            settings = JSON.parse(settings);
                        } catch (e) {

                        }
                        var now = new Date();
                        settings.end = settings.end || now.getTime();

                        if (!settings.start) {
                            now.setMonth(0);
                            now.setDate(1);
                            now.setHours(0);
                            now.setMinutes(0);
                            now.setSeconds(0);
                            now.setMilliseconds(0);
                            settings.start = now.getTime();
                        }

                        settings.type     = settings.type    || 'plan';
                        settings.station  = _data.consumption_station || settings.station || data.stations[0].name;
                        var s;
                        for (s = 0; s < data.stations.length; s++) {
                            if (settings.station === data.stations[s].name) {
                                break;
                            }
                        }
                        if (s === data.stations.length) {
                            settings.station  = data.stations[0].name;
                        }

                        settings.resource = settings.resource === null || settings.resource === undefined ? data.resources[0].name : settings.resource;
                        $div.data('settings', settings);

                        var text = '<table class="vis-cons-table"><tbody style="width:100%; height: 100%;">';

                        text += '<tr class="vis-cons-table-first-row">';
                        text += '<td class="vis-cons-table-empty-cell"></td>'; // empty
                        text += '<td class="vis-cons-resources"></td>';
                        text += '</tr>';

                        text += '<tr class="vis-cons-table-second-row">';
                        text += '<td class="vis-cons-types"></td>';
                        text += '<td class="vis-cons-toolbar-ans-results">';
                        text += '<div class="vis-cons-toolbar" style="color: ' + (_data.colorTheme === 'dark' ? 'white' : 'black') + '"><div class="vis-cons-toolbar-euro"></div><div class="vis-cons-toolbar-dates"></div></div><div class="vis-cons-results"></div></td>';
                        text += '</tr>';
                        text += '</tbody></table>';
                        $div.html(text);

                        var $types = $div.find('.vis-cons-types');
                        vis.binds.consumption.renderTypes($div, $types);

                        $div.data('resources', data.resources);
                        $div.data('stations', data.stations);

                        var $resources = $div.find('.vis-cons-resources');
                        vis.binds.consumption.renderResources($div, $resources, data.resources);

                        vis.binds.consumption.renderResults($div, settings);

                        function onChange(wid, id, newVal) {
                            if (id === inst + '.result') {
                                if (typeof newVal === 'string') {
                                    try {
                                        newVal = JSON.parse(newVal);
                                    } catch (e) {
                                        newVal = {};
                                    }
                                }
                                vis.binds.consumption.renderResults($div, settings, newVal);
                            }
                        }

                        vis.registerOnChange(onChange, wid);

                        /*vis.states.bind(inst + '.result.val', onChangeBindHandler);

                        // remember all ids, that bound
                        $div.data('bound', [inst + '.result.val']);

                        // remember bind handler
                        $div.data('bindHandler', onChangeBindHandler);*/

                        $div.data('destroy', function () {
                            vis.binds.consumption.instancePromise = null;
                            vis.conn.unsubscribe($(this).data('instance') + '.result');
                            vis.unregisterOnChange(onChange, wid);
                        });

                        // request data
                        vis.binds.consumption.setSettings($div, null, null, null, null, null, null, true);
                    });
                });
            });
        },
        destroyChart: function ($div, $report) {
            $report = $report || $div.find('.vis-cons-results');
            try {
                var chart = $report.data('chart');
                chart && echarts.dispose(chart);
                $report.data('chart', null);
            } catch (e) {

            }
        },
        renderEuroSwitch: function ($div, $results, $toolbar, settings, unit) {
            settings = settings || $div.data('settings');
            var $euro = $toolbar.find('.vis-cons-toolbar-euro');

            // install onclick handler once
            if (!$euro.data('installed')) {
                $euro.data('installed', true);

                $euro.on('click', function () {
                    $(this).find('.vis-cons-switch-input').prop('checked', !settings.isEuro);
                    vis.binds.consumption.setSettings($div, null, null, null, null, null, !settings.isEuro);
                });
            }


            var $input = $euro.find('.vis-cons-switch-input');
            if (unit) {
                $euro.css('padding-top', '15px');
                if (settings.resource) {
                    if ($input.length) {
                        $input.prop('checked', settings.isEuro);
                        $euro.find('.vis-cons-switch-unit').html(unit);
                    } else {
                        var text = '<span class="vis-cons-switch-label vis-cons-switch-unit">' + unit + '</span><input type="checkbox" class="vis-cons-switch-input" ' + (settings.isEuro ? 'checked' : '') + '/><label for="switch">Toggle</label><span class="vis-cons-switch-label vis-cons-switch-euro">€</span>';
                        $euro.html(text);
                    }
                } else {
                    $euro.css('padding-top', '0');
                    $input.length && $euro.html('');
                }
            } else {
                $input.length && $euro.html('');
                $euro.css('padding-top', '0');
            }
        },
        renderDatePicker: function ($div, $results, $toolbar, settings, visible) {
            settings = settings || $div.data('settings');
            var $dates = $toolbar.find('.vis-cons-toolbar-dates');
            var $inputs = $dates.find('select');
            var startsFrom = $div.data('data').startsFrom;
            if (visible) {
                var dateFormat = $div.data('dateFormat');
                if ($inputs.length) {
                    var $from = $dates.find('.vis-cons-toolbar-from');
                    var $to   = $dates.find('.vis-cons-toolbar-to');
                    $from.val(settings.start);
                    $to.val(settings.end);
                } else {
                    var theme = $div.data('data').colorTheme;
                    var textColor = theme === 'dark' ? 'white' : 'black';
                    var style = 'color: ' + textColor + '; background: #00000000; border: 1px solid lightgray; padding: 3px;';
                    var parts = startsFrom.split('-');

                    var _startsFrom = new Date(parseInt(parts[0], 10), parseInt(parts[1], 10) - 1, 1);
                    var now = new Date();
                    now.setMonth(now.getMonth() + 1);
                    var startOptions = [];
                    while (_startsFrom < now) {
                        startOptions.push('<option style="color: black" value="' + _startsFrom.getTime() + '">' + $.datepicker.formatDate(dateFormat, _startsFrom) + '</option>');
                        _startsFrom.setMonth(_startsFrom.getMonth() + 1);
                    }

                    var _endsTo = new Date(parseInt(parts[0], 10), parseInt(parts[1], 10) - 1, 1);
                    var endOptions = [];
                    while (_endsTo < now) {
                        var d = new Date(_endsTo);
                        d.setMonth(d.getMonth() + 1);
                        d.setMilliseconds(d.getMilliseconds() - 1);
                        endOptions.push('<option style="color: black" value="' + d.getTime() + '">' + $.datepicker.formatDate(dateFormat, d) + '</option>');
                        _endsTo.setMonth(_endsTo.getMonth() + 1);
                    }

                    var text = '<span class="vis-cons-toolbar-dates-label">' + _('from') + ':</span> ' +
                               '<select class="vis-cons-toolbar-from" style="' + style + '">' + startOptions.join('\n') + '</select> ' +
                               '<span class="vis-cons-toolbar-dates-label">' + _('to') + ':</span> ' +
                               '<select style="' + style + '" class="vis-cons-toolbar-to">' + endOptions.join('\n') + '</select>';
                    $dates.html(text);
                    var $from1 = $dates.find('.vis-cons-toolbar-from');
                    var $to1   = $dates.find('.vis-cons-toolbar-to');

                    $from1.on('change', function () {
                        var from = parseInt($(this).val(), 10);
                        var to = settings.end;
                        if (to <= from) {
                            var d = new Date(from);
                            d.setMonth(d.getMonth() + 1);
                            d.setMilliseconds(d.getMilliseconds() - 1);
                            to = d.getTime();
                        }
                        vis.binds.consumption.setSettings($div, null, null, null, from, to);
                    }).val(settings.start);
                    $to1.on('change', function () {
                        var to = parseInt($(this).val(), 10);
                        var from = settings.start;
                        if (to <= from) {
                            var d = new Date(to);
                            d.setMilliseconds(d.getMilliseconds() + 1);
                            d.setMonth(d.getMonth() - 1);
                            from = d.getTime();
                        }
                        vis.binds.consumption.setSettings($div, null, null, null, from, to);
                    }).val(settings.end);
                }
            } else {
                if ($inputs.length) {
                    $dates.html('');
                }
            }
        },
        renderToolbar: function ($div, $results, $toolbar, euroVisible, dateVisible) {
            if (euroVisible || dateVisible) {
                $results.css('height', 'calc(100% - 50px)');
                $toolbar.show();
            } else {
                $results.css('height', '100%');
                $toolbar.hide();
            }
        },
        renderResults: function ($div, settings, data) {
            settings = settings || $div.data('settings');
            var $toolbar = $div.find('.vis-cons-toolbar');
            var $report  = $div.find('.vis-cons-results');
            if (!data || !data.series) {
                return $report.html('<div class="vis-cons-rendering">' + _('rendering...') + '</div>');
            } else {
                var $render = $report.find('.vis-cons-rendering');
                $render && $render.length && $render.remove();
            }

            switch (settings.type) {
                case 'donut':
                    vis.binds.consumption.renderToolbar($div, $report, $toolbar, !!settings.resource, true);
                    vis.binds.consumption.renderEuroSwitch($div, $report, $toolbar, settings, !!settings.resource ? data.unitOriginal : '');
                    vis.binds.consumption.renderDatePicker($div, $report, $toolbar, settings, true);
                    vis.binds.consumption.renderDonut($div, $report, settings, data);
                    break;

                case 'stackbar':
                    vis.binds.consumption.renderToolbar($div, $report, $toolbar, !!settings.resource, false);
                    vis.binds.consumption.renderEuroSwitch($div, $report, $toolbar, settings, !!settings.resource ? data.unitOriginal : '');
                    vis.binds.consumption.renderDatePicker($div, $report, $toolbar, settings, false);
                    vis.binds.consumption.renderStackBar($div, $report, settings, data);
                    break;

                case 'heatmap':
                    vis.binds.consumption.renderToolbar($div, $report, $toolbar, !!settings.resource, false);
                    vis.binds.consumption.renderEuroSwitch($div, $report, $toolbar, settings, !!settings.resource ? data.unitOriginal : '');
                    vis.binds.consumption.renderDatePicker($div, $report, $toolbar, settings, false);
                    vis.binds.consumption.renderHeatMap($div, $report, settings, data);
                    break;

                case 'table':
                    vis.binds.consumption.destroyChart($div, $report);
                    vis.binds.consumption.renderToolbar($div, $report, $toolbar, !!settings.resource ? data.unitOriginal : '', false);
                    vis.binds.consumption.renderEuroSwitch($div, $report, $toolbar, settings, !!settings.resource ? data.unitOriginal : '');
                    vis.binds.consumption.renderDatePicker($div, $report, $toolbar, settings, false);
                    vis.binds.consumption.renderTable($div, $report, settings, data);
                    break;

                case 'plan':
                default:
                    vis.binds.consumption.destroyChart($div, $report);
                    vis.binds.consumption.renderToolbar($div, $report, $toolbar, !!settings.resource ? data.unitOriginal : '', false);
                    vis.binds.consumption.renderEuroSwitch($div, $report, $toolbar, settings, !!settings.resource ? data.unitOriginal : '');
                    vis.binds.consumption.renderDatePicker($div, $report, $toolbar, settings, false);
                    vis.binds.consumption.renderPlan($div, $report, settings, data);
                    break;
            }
        },
        renderDonut: function ($div, $report, settings, data) {
            var unit = data.unit;
            var option = {
                tooltip: {
                    show: true,
                    trigger: 'item',
                    formatter: '{b}<br/>{c} ' + unit + ' ({d}%)'
                },
                series: data.series
            };

            // var theme = $div.data('data').colorTheme;

            for (var i = 0; i < option.series.length; i++) {
                var serie = option.series[i];
                serie.type = 'pie';
                if (i === 0) {
                    if (option.series.length === 1) {
                        serie.radius = '65%';
                    } else {
                        serie.radius = ['40%', '65%'];
                    }
                    // only outer ring has labels
                    serie.label = {
                        formatter: ' {b|{b}}\n{hr|}\n  {c} ' + unit + ' {per|{d}%}  ',
                        backgroundColor: '#eee',
                        borderColor: '#aaa',
                        borderWidth: 1,
                        borderRadius: 2,
                        padding: [0, 7],
                        rich: {
                            b: {
                                color: '#999',
                                align: 'center',
                                fontSize: 14,
                                lineHeight: 20
                            },
                            hr: {
                                borderColor: '#aaa',
                                width: '100%',
                                borderWidth: 0.5,
                                height: 0
                            },
                            per: {
                                color: '#eee',
                                backgroundColor: '#334455',
                                padding: [2, 4],
                                borderRadius: 2,
                                lineHeight: 22
                            }
                        }
                    };
                } else {
                    // inner ring
                    serie.radius = [0, '35%'];
                    serie.label = {position: 'inner'};
                }
            }

            var chart = $report.data('chart');

            if (!chart || $report.data('type') !== 'donut' + data.series.length) {
                vis.binds.consumption.destroyChart($div, $report);
                $report.text(''); // remove old stuff
                chart = echarts.init($report[0]/*, null, {renderer: 'svg'}*/);
                $report.data('type', 'donut' + data.series.length);
                $report.data('chart', chart);
            }

            // console.log(JSON.stringify(option, null, 2));

            chart.setOption(option);
        },
        renderPlan: function ($div, $report, settings, data) {
            var theme = $div.data('data').colorTheme;
            var textColor = theme === 'dark' ? 'white' : 'black';

            var text = '<table class="vis-cons-plan-table" style="color: ' + textColor + '">';
            text += '<tr class="vis-cons-plan-tr-first"><td class="vis-cons-plan-td-main"></td><td class="vis-cons-plan-main-td-widget"><div class="vis-cons-plan-main-td-widget-div"></div></td></tr>';
            if (!settings.resource) {
                text += '<tr class="vis-cons-plan-tr-second"><td colspan="2" class="vis-cons-plan-td-additional"></td></tr>';
            }
            text += '</table>';
            $report.html(text);

            vis.binds.consumption.renderPlanMain($div, $report.find('.vis-cons-plan-td-main'), settings, data);
            var resources = $div.data('resources');

            var name = (settings.resource || 'all').toLowerCase();
            var resourceTitle = '';
            if (settings.resource) {
                for (var r = 0; r < resources.length; r++) {
                    if (resources[r].name === settings.resource) {
                        resourceTitle = resources[r].title;
                        break;
                    }
                }
            }

            var options = {
                reference: data.series[name].reference, // last year consumption
                actual:    data.series[name].actual,    // actual consumption
                planned:   data.series[name].planned,   // planned this year
                forecast:  data.series[name].forecast,  // forecast this year
                unit:      data.unit,
                height:    180,
                textColor: textColor,

                title: resourceTitle ? _('%s overview', resourceTitle) : _('Total overview')
            };

            vis.binds.consumption.forecastBar.init($report.find('.vis-cons-plan-main-td-widget-div'), options);

            if (!settings.resource) {
                var $additional = $report.find('.vis-cons-plan-td-additional');
                var divs = [];
                for (var rr = 0; rr < resources.length; rr++) {
                    divs.push('<div class="vis-cons-plan-div-additional-widget"><div class="vis-cons-plan-main-additional-widget-div" data-resource="' + resources[rr].name + '"></div></div>');
                }

                $additional.html(divs.join('\n'));

                for (var i = 0; i < resources.length; i++) {
                    var res = resources[i];
                    var $wDiv = $additional.find('.vis-cons-plan-main-additional-widget-div[data-resource="' + res.name + '"]');
                    var resourceTitle1 = resources[i].title;

                    var name1 = res.name.toLowerCase();

                    var options1 = {
                        reference: data.series[name1].reference, // last year consumption
                        actual:    data.series[name1].actual,    // actual consumption
                        planned:   data.series[name1].planned,   // planned this year
                        forecast:  data.series[name1].forecast,  // forecast this year
                        unit:      data.unit,
                        height:    100,
                        textColor: textColor,
                        onClick:   (function (n) { return function () {
                            vis.binds.consumption.setSettings($div, null, null, n);
                        }})(name1),

                        title: resourceTitle1
                    };

                    vis.binds.consumption.forecastBar.init($wDiv, options1);
                }
            }
        },
        renderStackBar: function ($div, $report, settings, data) {
            var unit = data.unit;
            var theme = $div.data('data').colorTheme;
            var color = theme === 'dark' ? '#CCC' : '#333';

            function formatter(year, month) {
                var sum = null;
                for (var s = 0; s < data.series.length; s++) {
                    if (data.series[s].stack === year && data.series[s].data[month] !== null && data.series[s].data[month] !== undefined) {
                        sum = sum || 0;
                        sum += data.series[s].data[month];
                    }
                }

                return vis.binds.consumption.format(sum, unit, true);
            }

            // find last items of every stack
            var last = {};
            for (var s = 0; s < data.series.length; s++) {
                last[data.series[s].stack] = data.series[s];
                data.series[s].type = 'bar';
            }

            // and place text on the top
            for (var stack in last) {
                last[stack].label = {
                    formatter: (function (stack) {
                        return function (opt) { return formatter(stack, opt.dataIndex); }
                    })(stack),
                    show: true,
                    color: color,
                    fontSize: 10,
                    rotate: 45,
                    offset: [5, -10],
                    position: 'top'
                }
            }

            // add year to name
            for (var ss = 0; ss < data.series.length; ss++) {
                data.series[ss].name = data.series[ss].year + ' ' + data.series[ss].name;
            }

            var option = {
                tooltip: {
                    show: true,
                    trigger: 'axis',
                    formatter: function (params) {
                        var len = params.length / 2;
                        var map = '';
                        for (var i = 0; i < params.length; i++) {
                            map += '<div style="opacity: ' + (i < len ? 0.5 : 1) + '"><span style="display: inline-block; margin-right: 5px;border-radius: 10px;width: 9px;height: 9px; background-color: ${params[i].color}; opacity: ' + params[i].opacity + '"></span>' + params[i].seriesName + ': ' + vis.binds.consumption.format(params[i].value, unit) + '</div>';
                        }

                        return '<div style="text-align: left"><strong style="padding-left: 15px">' + params[0].name + '</strong></br>' + map + '</div>';
                    },
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '0%',
                    right: '0%',
                    bottom: data.legend ? '50px' : '0%',
                    top: '30px',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: vis.binds.consumption.months[vis.language] || vis.binds.consumption.months.en,
                    axisLabel: {
                        color: color
                    },
                    axisTick: {
                        alignWithLabel: true,
                        lineStyle: {
                            color: color
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: color
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    name: data.unit,
                    axisLabel: {
                        color: color
                    },
                    axisTick: {
                        lineStyle: {
                            color: color
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: color
                        }
                    }
                },
                series: data.series
            };
            if (data.legend) {
                option.legend = {
                    data: data.legend,
                    //type: 'scroll',
                    bottom: 0,
                    selectedMode: false,
                    textStyle: {
                        color: color
                    }
                }
            }

            var chart;

            vis.binds.consumption.destroyChart($div, $report);
            $report.text(''); // remove old stuff
            chart = echarts.init($report[0], null, {renderer: 'svg'});
            $report.data('type', 'stackbar');
            $report.data('chart', chart);
            chart.setOption(option);
        },

        format: function (m, unit, noHtml) {
            if (m === undefined || m === null) {
                return '';
            }

            if (unit === '€' || unit === '$' || unit === '₽' || unit === '£' || unit === '元' || unit === 'CHF') {
                if (noHtml) {
                    if (m < 1000) {
                        return m.toFixed(1).toString().replace('.', ',') + ' ' + unit;
                    } else {
                        return Math.round(m) + ' ' + unit;
                    }
                } else {
                    return '<span class="vis-cons-table-value">' + m.toFixed(1).replace('.', ',') + '<span class="vis-cons-table-unit"> ' + unit + '</span>';
                }
            } else {
                var val = m < 1000 ? (Math.round(m * 10) / 10).toString().replace('.', ',') : Math.round(m);
                if (noHtml) {
                    return val + ' ' + (unit || '');
                } else {
                    return '<span class="vis-cons-table-value">' + val + '<span class="vis-cons-table-unit"> ' + (unit || '') + '</span>';
                }
            }
        },
        renderTable: function ($div, $report, settings, data) {
            // combine
            //          Jan Feb Mar                       Total
            // -----------------------
            // E1 2020
            // E1 2019
            // ----------------------
            // E2 2020
            // E2 2019
            // ----------------------
            // Total 2020                                  xxx
            // Total 2019                                  yyy
            var theme = $div.data('data').colorTheme;
            var textColor = theme === 'dark' ? 'white' : 'black';
            var lines = [];
            lines.push('<tr class="vis-cons-table-tr-header"><th>' + _('Name') + '</th><th></th><th>' + (vis.binds.consumption.months[vis.language] || vis.binds.consumption.months.en).join('</th><th>') + '</th><th>' + _('Total') + ' </th></tr>\n');
            var ids = {};

            var prevYear;
            var actualYear;
            for (var s = 0; s < data.series.length; s++) {
                ids[data.series[s]._id] = ids[data.series[s]._id] || {};

                if (data.series[s].stack === 'prev') {
                    prevYear = prevYear || data.series[s].year;
                    ids[data.series[s]._id].prev = data.series[s];
                } else {
                    actualYear = actualYear || data.series[s].year;
                    ids[data.series[s]._id].actual = data.series[s];
                }
            }
            actualYear = actualYear || new Date().getFullYear();
            prevYear   = prevYear || (actualYear - 1);

            var unit = data.unit;

            var items = Object.keys(ids).sort();
            var stats = {actual: [], prev:  []};

            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var line1 = '<tr class="vis-cons-table-tr-actual">';
                item = ids[item];
                if (!item.actual) {
                    line1 += '<td rowspan="2" class="vis-cons-table-td-name">' + (item.prev ? item.prev.name : '--') + '</td>';
                    line1 += '<td>' + actualYear + '</td>';
                    for (var m = 0; m < 12; m++) {
                        line1 += '<td>--</td>';
                    }
                    line1 += '<td>--</td>';
                } else {
                    line1 += '<td rowspan="2" class="vis-cons-table-td-name">' + item.actual.name + '</td>';
                    line1 += '<td>' + actualYear + '</td>';
                    item.actual.data = item.actual.data || [];
                    var sum1 = 0;
                    for (var mm = 0; mm < 12; mm++) {
                        line1 += '<td>' + (item.actual.data[mm] === null || item.actual.data[mm] === undefined ? '--' : vis.binds.consumption.format(item.actual.data[mm], unit)) + '</td>';
                        sum1 += parseFloat(item.actual.data[mm] || 0);

                        stats.actual[mm] = stats.actual[mm] || {c: 0, s: 0};

                        if (item.actual.data[mm] !== null || item.actual.data[mm] !== undefined) {
                            stats.actual[mm].c++;
                            stats.actual[mm].s += parseFloat(item.actual.data[mm] || 0);
                        }
                    }
                    line1 += '<td class="vis-cons-table-td-total">' + vis.binds.consumption.format(sum1, unit) + '</td>';
                }
                line1 += '</tr>';
                lines.push(line1);


                line1 = '<tr class="vis-cons-table-tr-prev">';
                if (!item.prev) {
                    //line += '<td>--</td>';
                    line1 += '<td>' + prevYear + '</td>';
                    for (var mmm = 0; mmm < 12; mmm++) {
                        line1 += '<td>--</td>';
                    }
                    line1 += '<td>--</td>';
                } else {
                    //line += '<td>' + item.prev.name + '</td>';
                    line1 += '<td>' + prevYear + '</td>';
                    item.prev.data = item.prev.data || [];
                    var sum = 0;
                    for (var m = 0; m < 12; m++) {
                        line1 += '<td>' + (item.prev.data[m] === null || item.prev.data[m] === undefined ? '--' : vis.binds.consumption.format(item.prev.data[m], unit)) + '</td>';
                        sum += parseFloat(item.prev.data[m] || 0);

                        stats.prev[m] = stats.prev[m] || {c: 0, s: 0};

                        if (item.prev.data[m] !== null || item.prev.data[m] !== undefined) {
                            stats.prev[m].c++;
                            stats.prev[m].s += parseFloat(item.prev.data[m] || 0);
                        }
                    }
                    line1 += '<td class="vis-cons-table-td-total">' + vis.binds.consumption.format(sum, unit) + '</td>';
                }
                line1 += '</tr>\n';
                lines.push(line1);
            }

            // total of all lines for actual
            var line = '<tr class="vis-cons-table-tr-actual vis-cons-table-tr-total">';
            if (!stats.actual.length) {
                line += '<td rowspan="2" class="vis-cons-table-td-name">' + _('All') + '</td>';
                line += '<td>' + actualYear + '</td>';
                for (var m = 0; m < 12; m++) {
                    line += '<td>--</td>';
                }
                line += '<td>--</td>';
            } else {
                line += '<td rowspan="2" class="vis-cons-table-td-name">' + _('All') + '</td>';
                line += '<td>' + actualYear + '</td>';
                var sum2 = 0;
                for (var m1 = 0; m1 < 12; m1++) {
                    line += '<td>' + (!stats.actual[m1].c ? '--' : vis.binds.consumption.format(stats.actual[m1].s, unit)) + '</td>';
                    sum2 += stats.actual[m1].s || 0;
                }
                line += '<td class="vis-cons-table-td-total">' + vis.binds.consumption.format(sum2, unit) + '</td>';
            }
            line += '</tr>\n';
            lines.push(line);

            // total of all lines for prev
            line = '<tr class="vis-cons-table-tr-prev vis-cons-table-tr-total">';
            if (!stats.prev.length) {
                //line += '<td>--</td>';
                line += '<td>' + prevYear + '</td>';
                for (var m4 = 0; m4 < 12; m4++) {
                    line += '<td>--</td>';
                }
                line += '<td>--</td>';
            } else {
                //line += '<td>' + _('Previous') + '</td>';
                line += '<td>' + prevYear + '</td>';
                var sum3 = 0;
                for (var m3 = 0; m3 < 12; m3++) {
                    line += '<td>' + (!stats.prev[m3].c ? '--' : vis.binds.consumption.format(stats.prev[m3].s, unit)) + '</td>';
                    sum3 += stats.prev[m3].s || 0;
                }
                line += '<td class="vis-cons-table-td-total">' + vis.binds.consumption.format(sum3, unit) + '</td>';
            }
            line += '</tr>\n';
            line += '<tr class="vis-cons-table-tr-spacer"><td colspan="15"></td></tr>';
            lines.push(line);

            $report.html('<table class="vis-cons-table" style="height: ' + (settings.resource ? 'calc(100% - 50px)' : '100%') + '; color: ' + textColor + '">' + lines.join('\n') + '</table>\n');
        },
        isLeapYear: function (date) {
            var year = typeof date !== 'object' ? date : date.getFullYear();
            if (year & 3) {
                return false;
            } else {
                return (year % 100 || !(year % 400));
            }
        },
        // Get Day of Year
        getMonth: function (day, year) {
            var dayCount = [31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            if (vis.binds.consumption.isLeapYear(year || new Date())) {
                dayCount = [31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335];
            }
            var month = 0;

            for (;month < dayCount.length; month++) {
                if (day < dayCount[month]) {
                    break;
                }
            }
            return {month: month, date: month ? day - dayCount[month - 1] : day};
        },
        renderHeatMap: function ($div, $report, settings, data) {
            var months = vis.binds.consumption.months[vis.language] || vis.binds.consumption.months.en;
            var theme = $div.data('data').colorTheme;

            var maxDays = vis.binds.consumption.isLeapYear(new Date()) ? 366 : 365;
            var xData = [];
            for (var dd = 0; dd < maxDays; dd++) {
                xData[dd] = dd;
            }

            var yData = [];
            for (var d = 0; d < 24; d++) {
                yData[d] = d;
            }

            var values = data.series;

            var allData = [];
            var min = null;
            var max = null;
            for (var day = 0; day < values.length; day++) {
                if (!values[day]) {
                    continue;
                }
                for (var hour = 0; hour < values[day].length; hour++) {
                    var val = values[day][hour];
                    if (val !== null && val !== undefined) {
                        if (max === null || val > max) {
                            max = val;
                        }
                        if (min === null || val < min) {
                            min = val;
                        }
                        allData.push([day, hour, val]);
                    }
                }
            }

            var stats = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

            // sort too less min and too less max values
            var _diff = max - min;
            var count = 0;
            for (var a = 0; a < allData.length; a++) {
                if (allData[a][2]) {
                    var ii = Math.round((allData[a][2] - min) / _diff * (stats.length - 1));
                    if (ii < 0) {
                        ii = 0;
                    } else if (ii > stats.length - 1) {
                        ii = stats.length - 1;
                    }
                    stats[ii]++;
                    count++;
                }
            }

            for (var i = 0; i < stats.length; i++) {
                stats[i] /= count;
            }
            var v = 0;
            while (stats[v] < 0.2 && v < stats.length - 2) {
                v++;
            }

            if (v) {
                min += _diff * v * (1 / (stats.length - 1));
            }

            var m = stats.length - 1;
            while (stats[m] < 0.2 && m > v) {
                m--;
            }
            if (m !== stats.length - 1) {
                if (m === v) {
                    m++;
                }
                max -= _diff * (stats.length - 1 - m) * (1 / (stats.length - 1));
            }

            var colors = ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026'];
            var size = colors.length;
            var diff = max - min;
            var width = $div.width();
            var unit = !settings.resource || settings.isEuro ? '€' : data.unit;
            var color = theme === 'dark' ? '#CCC' : '#333';

            var option = {
                tooltip: {
                    show: true,
                    formatter: function (data) {
                        var m = vis.binds.consumption.getMonth(data.data[0]);
                        return months[m.month] + '.' + (m.date + 1) + ' ' + data.data[1] + ':00 - ' + vis.binds.consumption.format(data.data[2], unit);
                    }
                },
                xAxis: {
                    type: 'category',
                    data: xData,
                    axisLabel: {
                        show: true,
                        color: color,
                        align: 'left',
                        interval: function (data, value) {
                            var m = vis.binds.consumption.getMonth(data);
                            if (m.date === 0) {
                                return m.month.toString();
                            } else {
                                return false;
                            }
                        },
                        formatter: function (data) {
                            var m = vis.binds.consumption.getMonth(parseInt(data, 10));
                            return months[m.month];
                        }
                    },
                    axisTick: {
                        lineStyle: {
                            color: color
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: color
                        }
                    }
                },
                grid: {
                    right: 0,
                    top: 0,
                    bottom: 65,
                    left: 25
                },
                yAxis: {
                    type: 'category',
                    data: yData,
                    axisLabel: {
                        alignWithLabel: true,
                        color: color
                    },
                    axisTick: {
                        lineStyle: {
                            color: color
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: color
                        }
                    }
                },
                visualMap: {
                    type: 'continuous',
                    min: min,
                    max: max,
                    calculable: true,
                    realtime: false,
                    orient: 'horizontal',
                    inRange: {color: colors},
                    precision: 1,
                    left: 50,
                    textStyle: {
                        color: color
                    },
                    itemHeight: Math.max(140, width - 280),
                    formatter: function (value) { return vis.binds.consumption.format(value, unit, true); }
                },
                series: [{
                    type: 'heatmap',
                    data: allData,
                    emphasis: {
                        itemStyle: {
                            borderColor: '#333',
                            borderWidth: 1
                        }
                    },
                    itemStyle1: {
                        color: function (data) {
                            var val = (data.data[2] - min) / diff;
                            var i = Math.round(val * 10);
                            if (i > size - 1) {
                                i = size - 1;
                            }
                            if (i < 0) {
                                i = 0;
                            }

                            return colors[i];
                        }
                    },
                    progressive: 1000,
                    animation: false
                }]
            };
            var chart = $report.data('chart');

            if (!chart || $report.data('type') !== 'heatmap_' + !!settings.resource) {
                vis.binds.consumption.destroyChart($div, $report);
                chart = echarts.init($report[0]);
                $report.data('type', 'heatmap_' + !!settings.resource);
                $report.data('chart', chart);
            }

            // console.log(JSON.stringify(option, null, 2));

            chart.setOption(option);
        },

        forecastBar: {
            getValue: function (oid) {
                var val = 0;
                if (oid || oid === '0') {
                    if (parseFloat(oid) !== oid) {
                        val = vis.states.attr(oid + '.val');
                    } else {
                        val = parseFloat(oid);
                    }
                    return val;
                } else {
                    return null;
                }
            },
            draw: function ($div, options) {
                var val1     = vis.binds.consumption.forecastBar.getValue(options.reference);
                var val2     = vis.binds.consumption.forecastBar.getValue(options.actual);
                var valLeft  = vis.binds.consumption.forecastBar.getValue(options.forecast);
                var valRight = vis.binds.consumption.forecastBar.getValue(options.planned);

                var max = val1 > val2 ? val1 : val2;
                max = max > valLeft  ? max : valLeft;
                max = max > valRight ? max : valRight;

                var val1Height     = Math.round(val1     / max * 100);
                var val2Height     = Math.round(val2     / max * 100);
                var valLeftHeight  = Math.round(valLeft  / max * 100);
                var valRightHeight = Math.round(valRight / max * 100);

                var color;
                if (val2 < valLeft && (!valRight || (val2 < valRight && valLeft < valRight))) {
                    color = options['color-border'];
                } else {
                    color = options['color-border-error'] || options['color-border'];
                }

                var backColor   = 'repeating-linear-gradient(135deg, ' + color + ', ' + color + ' 2px, rgba(0,0,0,0) 2px, rgba(0,0,0,0) 12px)';
                var $val1 = $div.find('.value-1').css({height: val1Height + '%', 'border-color': color}).attr('title', vis.binds.consumption.format(val1, options.unit, true));
                var $val2 = $div.find('.value-2').css({height: val2Height + '%', 'border-color': color}).attr('title', vis.binds.consumption.format(val2, options.unit, true));
                $div.find('.value-2-inner').css('background', backColor);
                $div.find('.label-value-1').css('top', 'calc(' + (100 - val1Height)  + '% - 5px)').attr('title', vis.binds.consumption.format(val1, options.unit, true));
                $div.find('.label-value-2').css('top', 'calc(' + (100 - val2Height)  + '% - 5px)').attr('title', vis.binds.consumption.format(val2, options.unit, true));

                                    $div.find('.line-left')    .css('top', (100 - valLeftHeight)  + '%');
                var $lineRight =  $div.find('.line-right')   .css('top', (100 - valRightHeight) + '%');

                                    $div.find('.label-left')   .css('top', 'calc(' + (100 - valLeftHeight)  + '% - 8px)').attr('title', vis.binds.consumption.format(valLeft, options.unit, true));
                var $labelRight = $div.find('.label-right')  .css('top', 'calc(' + (100 - valRightHeight) + '% - 8px)').attr('title', vis.binds.consumption.format(valRight, options.unit, true));

                                    $div.find('.arrow-left')   .css('top', 'calc(' + (100 - valLeftHeight)  + '% - 17px)');
                var $arrowRight = $div.find('.arrow-right')  .css('top', 'calc(' + (100 - valRightHeight) + '% - 17px)');

                if (!valRightHeight) {
                    $lineRight.hide();
                    $labelRight.hide();
                    $arrowRight.hide();
                } else {
                    $lineRight.show();
                    $labelRight.show();
                    $arrowRight.show();
                }

                if (val1 > val2) {
                    $val1.css({'z-index': 0, 'border-radius': '8px 8px 0 0'});
                    $val2.css({'z-index': 1, 'border-radius': ''});
                } else {
                    $val1.css({'z-index': 1, 'border-radius': ''});
                    $val2.css({'z-index': 0, 'border-radius': '8px 8px 0 0'});
                }
            },
            init: function ($div, options) {
                var year = new Date().getFullYear();

                var _options = Object.assign({
                    reference: 200, // last year consumption
                    actual:    100, // actual consumption
                    planned:   350, // planned this year
                    forecast:  400, // forecast this year
                    width:     100,
                    height:    200,
                    textColor: 'black',

                    'color-border': 'green',
                    'color-border-error': 'red',
                    title: '',
                    textForecast: _('Forecast'),
                    textPlanned: _('Planned'),
                    textActual: _('Now %s', year),
                    textPrev: year - 1,
                    unit: '€'
                }, options);

                var text = '<div style="overflow: visible; width: ' + _options.width + 'px; height: ' + _options.height + 'px; color: ' + _options.textColor + '">\n' +
                    '\t\t<div class="forecast-bar" style="max-width: 100px;" >\n' +
                    '\t\t\t<div   class="value-1" style=""><span>' + _options.textPrev + '</span></div>\n' +
                    '\t\t\t<div   class="value-2" style=""><div class="value-2-inner"><span>' + _options.textActual + '</span></div></div>\n' +
                    '\t\t\t<div   class="label-value-1 forecast-texts"></div>\n' +
                    '\t\t\t<div   class="label-value-2 forecast-texts"></div>\n' +
                    '\n' +
                    '\t\t\t<span  class="check-visibility arrow-left">\n' +
                    '\t\t\t    <svg viewBox="0 0 20 20" style="fill: #DDDDDD; width: 35px; height: auto"><path d="M15,10l-9,5V5L15,10z"/></svg>\n' +
                    '\t\t\t</span>\n' +
                    '\t\t\t<span  class="check-visibility arrow-right">\n' +
                    '\t\t\t    <svg viewBox="0 0 20 20" style="fill: #DDDDDD;width: 35px; height: auto"><path d="M14,5v10l-9-5L14,5z"/></svg>\n' +
                    '\t\t\t</span>\n' +
                    '\t\t\t<div   class="check-visibility line-left"></div>\n' +
                    '\t\t\t<div   class="check-visibility line-right"></div>\n' +
                    '\t\t\t<div   class="check-visibility label-left  forecast-texts">' + _options.textForecast + '</div>\n' +
                    '\t\t\t<div   class="check-visibility label-right forecast-texts">' + _options.textPlanned + '</div>\n' +
                    '\n' +
                    '\t\t\t<div   class="forecast-title forecast-texts"><div class="forecast-title-inner">' + _options.title + '</div></div>\n' +
                    '\t\t</div>\n' +
                    '\t</div>';
                $div.html(text);

                _options.onClick && $div.find('.forecast-texts').css('cursor', 'pointer').on('click', _options.onClick);

                vis.binds.consumption.forecastBar.draw($div, _options);
            }
        },

        renderPlanMain: function ($div, $td, settings, data) {
            var name = (settings.resource || 'all').toLowerCase();
            var stations = $div.data('stations');
            var theme = $div.data('data').colorTheme;
            var textColor = theme === 'dark' ? 'white' : 'black';

            var stationName;
            if (settings.station) {
                for (var i = 0; i < stations.length; i++) {
                    if (stations[i].name === settings.station) {
                        stationName = stations[i].title;
                        break;
                    }
                }
            }
            var isBad = data.series[name].planned && data.series[name].forecast > data.series[name].planned;
            var text = '<div class="vis-cons-plan-main-div-widget" style="color: ' + textColor + '">\n';
            text += '<div class="vis-cons-plan-main-div-widget-title">'     + _('Costs for %s', stationName) + '</div>\n';
            text += '<div class="vis-cons-plan-main-div-widget-actual">'    + _('Actual') + ': ' +  vis.binds.consumption.format(data.series[name].actual, data.unit) + '</div>\n';
            text += '<div class="vis-cons-plan-main-div-widget-reference">' + _('Reference') + ': ' + (data.series[name].reference ? vis.binds.consumption.format(data.series[name].reference, data.unit) : '--') + '</div>\n';
            text += '<img class="vis-cons-plan-main-div-widget-icon vis-cons-plan-main-div-widget-icon-' + (isBad ? 'bad' : 'good') + '" src="widgets/consumption/img/' + (isBad ? 'smileBad.svg' : 'smile.svg') + '"/>\n';
            text += '<div class="vis-cons-plan-main-div-widget-forecast">'  + _('Forecast') + ': ' +  vis.binds.consumption.format(data.series[name].forecast, data.unit) + '</div>\n';
            text += '<div class="vis-cons-plan-main-div-widget-planned">'   + _('Planned') + ': ' +  vis.binds.consumption.format(data.series[name].planned, data.unit) + '</div>\n';
            text += '</div>';

            $td.html(text);
        }
    };

    vis.binds.consumption.showVersion();

</script>

<script id="tplConsumption"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/consumption/img/Prev_tplConsumption.png"></img>'
        data-vis-set="consumption"
        data-vis-type="ctrl"
        data-vis-name="Charts"
        data-vis-attrs="consInstance[0]/number,0,5;colorTheme[light]/nselect,light,dark;ownClasses[false]/checkbox;"
        data-vis-attrs0="startsFrom[2020-01-01];dateFormat[yy-mm-dd];consumption_station;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 600px; height: 450px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="display: inline-block" <%= (el) -> vis.binds.consumption.init(el, this.data.wid, this.view, this.data, this.style) %> ></div>
    </div>
</script>

<!-- --------------consumption.html--- END -->
<!-- --------------coronavirus-statistics.html--- START -->
<!--
    ioBroker.vis coronavirus-statistics Widget-Set

    version: "0.1.0"
-->
<style>
    .covid-div {
        display: inline-block;
        height: calc(100% - 20px);
        text-align: center;
    }
    .covid-div-title {
        font-weight: bold;
	    white-space: nowrap;
        text-align: center;
        width: 100%;
    }
    .covid-div-img {
        width: 100%;
        height: calc(100% - 40px);
    }
    .covid-div-number {
        font-size: smaller;
        text-align: center;
        width: 100%;
    }
    .covid-title {
        font-weight: bold;
        font-size: larger;
    }
</style>
<script type="text/javascript">

    $.extend(true, systemDictionary, {
        "cases": {
            "en": "Confirmed",
            "de": "Bestätigt",
            "ru": "Всего",
            "pt": "Confirmado",
            "nl": "Bevestigd",
            "fr": "Confirmé",
            "it": "Confermato",
            "es": "Confirmado",
            "pl": "Potwierdzony",
            "zh-cn": "已确认"
        },
        "deaths": {
            "en": "Deaths",
            "de": "Todesfälle",
            "ru": "Смертей",
            "pt": "Mortes",
            "nl": "Sterfgevallen",
            "fr": "Des morts",
            "it": "morti",
            "es": "Muertes",
            "pl": "Zgony",
            "zh-cn": "死亡人数"
        },
        "recovered": {
            "en": "Recovered",
            "de": "wieder gesund",
            "ru": "Здоровы",
            "pt": "Recuperado",
            "nl": "Hersteld",
            "fr": "Rétabli",
            "it": "recuperato",
            "es": "Recuperado",
            "pl": "Odzyskany",
            "zh-cn": "已恢复"
        },
        "active": {
            "en": "Current",
            "de": "infiziert",
            "ru": "Больны",
            "pt": "Atual",
            "nl": "Huidige",
            "fr": "Courant",
            "it": "attuale",
            "es": "Actual",
            "pl": "obecny",
            "zh-cn": "当前"
        },
        "critical": {
            "en": "Critical",
            "de": "Kritisch",
            "ru": "Критическое",
            "pt": "Crítico",
            "nl": "Kritiek",
            "fr": "Critique",
            "it": "critico",
            "es": "Crítico",
            "pl": "Krytyczny",
            "zh-cn": "危急"
        },
        "todayCases": {
            "en": "Today cases",
            "de": "Heute infiziert",
            "ru": "Сегодня",
            "pt": "Casos de hoje",
            "nl": "Gevallen van vandaag",
            "fr": "Cas d'aujourd'hui",
            "it": "Casi oggi",
            "es": "Hoy casos",
            "pl": "Dzisiaj przypadki",
            "zh-cn": "今天的情况"
        },
        "todayDeaths": {
            "en": "Today death",
            "de": "Heute verstorben",
            "ru": "Сегодня",
            "pt": "Hoje a morte",
            "nl": "Vandaag dood",
            "fr": "Aujourd'hui la mort",
            "it": "Oggi morte",
            "es": "Hoy muerte",
            "pl": "Dziś śmierć",
            "zh-cn": "今天死亡"
        },
        "Worldwide": {
            "en": "Worldwide",
            "de": "Weltweit",
            "ru": "По всему миру",
            "pt": "No mundo todo",
            "nl": "Wereldwijd",
            "fr": "À l'échelle mondiale",
            "it": "In tutto il mondo",
            "es": "En todo el mundo",
            "pl": "Na całym świecie",
            "zh-cn": "全世界"
        }
    });

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "country": {
                "en": "Country",
                "de": "Land",
                "ru": "Страна",
                "pt": "País",
                "nl": "Land",
                "fr": "Pays",
                "it": "Nazione",
                "es": "País",
                "pl": "Kraj",
                "zh-cn": "国家"
            },
            "showCountry": {
                "en": "Show country",
                "de": "Land anzeigen",
                "ru": "Показать страну",
                "pt": "Mostrar país",
                "nl": "Land weergeven",
                "fr": "Afficher le pays",
                "it": "Mostra paese",
                "es": "Mostrar país",
                "pl": "Pokaż kraj",
                "zh-cn": "显示国家"
            },
            "countryFontSize": {
                "en": "Country",
                "de": "Land",
                "ru": "Страна",
                "pt": "País",
                "nl": "Land",
                "fr": "Pays",
                "it": "Nazione",
                "es": "País",
                "pl": "Kraj",
                "zh-cn": "国家"
            },
            "typeFontSize": {
                "en": "Type",
                "de": "Bezeichnungen",
                "ru": "Тип",
                "pt": "Tipo",
                "nl": "Type",
                "fr": "Type",
                "it": "genere",
                "es": "Tipo",
                "pl": "Rodzaj",
                "zh-cn": "类型"
            },
            "numberFontSize": {
                "en": "Numbers",
                "de": "Zahlen",
                "ru": "чисел",
                "pt": "Números",
                "nl": "Nummers",
                "fr": "Nombres",
                "it": "Numeri",
                "es": "Números",
                "pl": "Liczby",
                "zh-cn": "号码"
            },
            "group_fonts": {
                "en": "Font size",
                "de": "Schriftgröße",
                "ru": "Размер шрифта",
                "pt": "Tamanho da fonte",
                "nl": "Lettertypegrootte",
                "fr": "Taille de police",
                "it": "Dimensione del font",
                "es": "Tamaño de fuente",
                "pl": "Rozmiar czcionki",
                "zh-cn": "字体大小"
            }
        });
    }

    vis.binds['coronavirus-statistics'] = {
		version: "0.1.0",
		showVersion: function () {
			if (vis.binds['coronavirus-statistics'].version) {
				console.log('Version coronavirus-statistics: ' + vis.binds['coronavirus-statistics'].version);
				vis.binds['coronavirus-statistics'].version = null;
			}
		},
        one: function (data, type, count, fontTitleSize, fontNumberSize) {
		    return '<div class="covid-div" style="width: ' + ((100 / count) - 0.5).toFixed(2) +'%">\n' +
                '                    <div class="covid-div-title" style="' + (fontTitleSize ? 'font-size: ' + fontTitleSize : '') + '">' + _(type) + '</div>\n' +
                '                    <img class="covid-div-img" src="widgets/coronavirus-statistics/img/' + type + '.svg" alt="' + type + '"/>\n' +
                '                    <div class="covid-div-number" style="' + (fontNumberSize ? 'font-size: ' + fontNumberSize : '') + '">' + data[type].toLocaleString() + '</div>\n' +
                '                </div>';
        },
        init: function (wid, view, data, style) {
            var $div = $('#' + wid);
            if (!$div.length) {
                setTimeout(function () {
                    vis.binds['coronavirus-statistics'].init(wid, view, data, style);
                }, 100);
                return;
            }
            var text = '<div class="vis-widget-body">';
            if (data.showCountry !== 'false' && data.showCountry !== false) {
                var countryFontSize = data.countryFontSize;
                if (countryFontSize && countryFontSize.match(/\d$/)) {
                    countryFontSize += 'px';
                }
                text += '<div class="covid-title" style="' + (countryFontSize ? 'font-size: ' + countryFontSize : '') + '">' + _(!data.country || data.country === 'all' ? 'Worldwide' : data.country) + '</div>';
            }

            var fontTitleSize = data.typeFontSize;
            if (fontTitleSize && fontTitleSize.match(/\d$/)) {
                fontTitleSize += 'px';
            }
            var fontNumberSize = data.numberFontSize;
            if (fontNumberSize && fontNumberSize.match(/\d$/)) {
                fontNumberSize += 'px';
            }
            if (!data.country || data.country === 'all') {
                // https://coronavirus-19-api.herokuapp.com/all
                fetch('https://coronavirus-19-api.herokuapp.com/all')
                    .then((response) => {
                        return response.json();
                    })
                    .then((info) => {
                        var count = 0;
                        count += data.cases     === true || data.cases     === 'true' ? 1 : 0;
                        count += data.deaths    === true || data.deaths    === 'true' ? 1 : 0;
                        count += data.recovered === true || data.recovered === 'true' ? 1 : 0;

                        text += data.cases      === true || data.cases     === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'cases',     count, fontTitleSize, fontNumberSize) : '';
                        text += data.recovered  === true || data.recovered === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'recovered', count, fontTitleSize, fontNumberSize) : '';
                        text += data.deaths     === true || data.deaths    === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'deaths',    count, fontTitleSize, fontNumberSize) : '';
                        $div.html(text + '</div>');
                    });
            } else {
                // https://coronavirus-19-api.herokuapp.com/countries
                fetch('https://coronavirus-19-api.herokuapp.com/countries')
                    .then((response) => {
                        return response.json();
                    })
                    .then((datas) => {
                        var count = 0;
                        count += data.cases       === true || data.cases       === 'true' ? 1 : 0;
                        count += data.todayCases  === true || data.todayCases  === 'true' ? 1 : 0;
                        count += data.recovered   === true || data.recovered   === 'true' ? 1 : 0;
                        count += data.deaths      === true || data.deaths      === 'true' ? 1 : 0;
                        count += data.todayDeaths === true || data.todayDeaths === 'true' ? 1 : 0;
                        count += data.active      === true || data.active      === 'true' ? 1 : 0;
                        count += data.critical    === true || data.critical    === 'true' ? 1 : 0;

                        var info = datas.find(it => it.country === data.country);
                        text += data.cases       === true || data.cases       === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'cases',       count, fontTitleSize, fontNumberSize) : '';
                        text += data.todayCases  === true || data.todayCases  === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'todayCases',  count, fontTitleSize, fontNumberSize) : '';
                        text += data.recovered   === true || data.recovered   === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'recovered',   count, fontTitleSize, fontNumberSize) : '';
                        text += data.active      === true || data.active      === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'active',      count, fontTitleSize, fontNumberSize) : '';
                        text += data.critical    === true || data.critical    === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'critical',    count, fontTitleSize, fontNumberSize) : '';
                        text += data.deaths      === true || data.deaths      === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'deaths',      count, fontTitleSize, fontNumberSize) : '';
                        text += data.todayDeaths === true || data.todayDeaths === 'true' ? vis.binds['coronavirus-statistics'].one(info, 'todayDeaths', count, fontTitleSize, fontNumberSize) : '';
                        $div.html(text + '</div>');
                    });
            }
            $div.data('destroy', function () {
                var interval = $div.data('interval');
                interval && clearInterval(interval);
            });
            // every 3 hours
            $div.data('interval', setInterval(function () {
                vis.binds['coronavirus-statistics'].init(wid, view, data, style);
            }, 3 * 3600000));
        },
    };

	vis.binds['coronavirus-statistics'].showVersion();
</script>

<script id="tplCovidInfo"
     type="text/ejs"
     class="vis-tpl"
     data-vis-prev='<img src="widgets/coronavirus-statistics/img/Prev_tplCovidInfo.png"></img>'
     data-vis-set="coronavirus-statistics"
     data-vis-type="ctrl,color"
     data-vis-name="Covid-19 info"
     data-vis-attrs="country/select,all,Germany,Austria,Switzerland,Russia,China,Italy,Iran,S. Korea,Spain,France,USA,UK,Norway,Netherlands,Sweden,Belgium,Denmark,Japan,Diamond Princess,Malaysia,Qatar,Greece,Canada,Australia,Portugal,Finland,Czechia,Singapore,Slovenia,Bahrain,Israel,Estonia,Iceland,Hong Kong,Philippines,Romania,Ireland,Brazil,Poland,Indonesia,Thailand,Kuwait,Iraq,India,Egypt,Saudi Arabia,San Marino,Lebanon,UAE,Chile,Luxembourg,Taiwan,Vietnam,Slovakia,Pakistan,Bulgaria,South Africa,Brunei,Croatia,Algeria,Serbia,Argentina,Panama,Peru,Albania,Mexico,Palestine,Colombia,Georgia,Hungary,Latvia,Ecuador,Morocco,Belarus,Costa Rica,Armenia,Cyprus,Senegal,Bosnia and Herzegovina,Azerbaijan,Moldova,Oman,Malta,North Macedonia,Sri Lanka,Tunisia,Afghanistan,Maldives,Cambodia,Lithuania,Dominican Republic,Faeroe Islands,Macao,Bolivia,Martinique,Venezuela,Kazakhstan,Jordan,New Zealand,Jamaica,French Guiana,Liechtenstein,Paraguay,Reunion,Ghana,Turkey,Uruguay,Andorra,Bangladesh,Guyana,Ivory Coast,Cuba,Ethiopia,Puerto Rico,Ukraine,Burkina Faso,Channel Islands,French Polynesia,Guadeloupe,Guam,Honduras,Kenya,Monaco,Nigeria,Aruba,Cameroon,Curacao,DRC,Namibia,Saint Lucia,Saint Martin,Seychelles,Trinidad and Tobago,Sudan,Nepal,Antigua and Barbuda,Bhutan,Cayman Islands,CAR,Congo,Equatorial Guinea,Gabon,Gibraltar,Guatemala,Guinea,Vatican City,Mauritania,Mayotte,Mongolia,Rwanda,St. Barth,St. Vincent Grenadines,Suriname,Eswatini,Togo,U.S. Virgin Islands,Uzbekistan;"
     data-vis-attrs0="showCountry[true]/checkbox;todayCases[true]/checkbox;recovered[true]/checkbox;active[true]/checkbox;critical[true]/checkbox;deaths[true]/checkbox;todayDeaths[true]/checkbox;"
     data-vis-attrs1="group.fonts;countryFontSize[16]/slider,6,32,1;typeFontSize[14]/slider,6,32,1;numberFontSize[12]/slider,6,32,1;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 400px; height: 110px; font-size: 14px" id="<%= this.data.attr('wid') %>">
        <%= (el) -> vis.binds['coronavirus-statistics'].init(this.data.wid, this.view, this.data, this.style) %>
    </div>
</script>


<!-- --------------coronavirus-statistics.html--- END -->
<!-- --------------dwd.html--- START -->
<!--
    ioBroker.vis dwd Widget-Set

    version: "2.4.5"

    Copyright 2013-2020 bluefox<dogafox@gmail.com>
-->

<script type="text/javascript">
    if (vis.editMode) {
        // Add words for widgets
        $.extend(true, systemDictionary, {
            "oid-begin":    {"en": "oid-begin",    "de": "oid-begin",    "ru": "oid-begin"},
            "oid-end":      {"en": "oid-end",      "de": "oid-end",      "ru": "oid-end"},
            "oid-headline": {"en": "oid-headline", "de": "oid-headline", "ru": "oid-headline"},
            "oid-severity": {"en": "oid-severity", "de": "oid-severity", "ru": "oid-severity"},
            "dwd-format": {
                "en": "Time format",
                "de": "Zeitformat",
                "ru": "Формат времени",
                "pt": "Formato da hora",
                "nl": "Tijd formaat",
                "fr": "Format de l'heure",
                "it": "Formato orario",
                "es": "Formato de tiempo",
                "pl": "Format czasu",
                "zh-cn": "时间格式"
            }
        });
    }
</script>

<script id="tplDwdAdapterSmall"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="dwd"
        data-vis-prev='<img src="widgets/dwd/img/Prev_DwdAdapterSmall.png"></img>'
        data-vis-name="DWD Wetterwarnungen klein"
        data-vis-attrs="oid[dwd.0.warning.text];oid-severity[dwd.0.warning.severity]">
    <%
    var dwdBackground = [
        "",        // 0
        "#ffeb3b", // 1 - Wetterwarnungen (Stufe 1)
        "#fb8c00", // 2 - Warnungen vor markantem Wetter (Stufe 2)
        "#e53935", // 3 - Unwetterwarnungen (Stufe 3)
        "#880e4f", // 4 - Warnungen vor extremem Unwetter (Stufe 4)
        "",        // 5 -
        "",        // 6 -
        "",        // 7 -
        "",        // 8 -
        "#c99afe", // 9 - Hitzewarnung
        "",        // 10
        "#c9f",    // 11 - Keine Warnungen
        "",        // 12 -
        "",        // 13 -
        "",        // 14 -
        "",        // 15 -
        "",        // 16 -
        "",        // 17 -
        "",        // 18 -
        "#fe68fe", // 19 - UV-Warnung
        "",        // 6 -
    ];
    %>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 160px; height: 21px; font-family: Arial" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="padding: 3px; background-color: <%= dwdBackground[parseInt(vis.states.attr(this.data['oid-severity'] + '.val'), 10)] %>;">
            <div data-oid="<%= this.data.attr('oid') %>">
                <%== vis.states.attr(this.data.oid + '.val') %>
            </div>
        </div>
    </div>
</script>

<script id="tplDwdAdapter"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/dwd/img/Prev_DwdAdapter.png"></img>'
        data-vis-set="dwd"
        data-vis-name="DWD Wetterwarnungen"
        data-vis-attrs="oid-begin[dwd.0.warning.begin];oid-end[dwd.0.warning.end];oid-headline[dwd.0.warning.headline];oid[dwd.0.warning.description];oid-severity[dwd.0.warning.severity];dwd-format[DD.MM hh:mm]">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 585px; height: 85px; font-family: Arial" id="<%= this.data.attr('wid') %>">
        <%
		var dwdBackground = [
			"",        // 0
			"#ffeb3b", // 1 - Wetterwarnungen (Stufe 1)
			"#fb8c00", // 2 - Warnungen vor markantem Wetter (Stufe 2)
			"#e53935", // 3 - Unwetterwarnungen (Stufe 3)
			"#880e4f", // 4 - Warnungen vor extremem Unwetter (Stufe 4)
			"",        // 5 -
			"",        // 6 -
			"",        // 7 -
			"",        // 8 -
			"#c99afe", // 9 - Hitzewarnung
			"",        // 10
			"#c9f",    // 11 - Keine Warnungen
			"",        // 12 -
			"",        // 13 -
			"",        // 14 -
			"",        // 15 -
			"",        // 16 -
			"",        // 17 -
			"",        // 18 -
			"#fe68fe", // 19 - UV-Warnung
			"",        // 6 -
		];
        %>
        <div class="vis-widget-body" style="padding: 3px; background-color: <%= dwdBackground[parseInt(vis.states.attr(this.data['oid-severity'] + '.val'), 10)] %>;">
            <div style="font-size: 1.5em; font-weight: bold;" data-oid="<%= this.data.attr('oid-headline') %>">
                <%== vis.states.attr(this.data['oid-headline'] + '.val') %>
            </div>
            <p><%== vis.states.attr(this.data['oid'] + '.val') %><br/>
            <%== vis.states.attr(this.data['oid-begin'] + '.val') ? vis.binds.basic.formatDate(vis.states.attr(this.data['oid-begin'] + '.val'), this.data['dwd-format']) + ' - ' : '' %><%== vis.states.attr(this.data['oid-end'] + '.val') ? vis.binds.basic.formatDate(vis.states.attr(this.data['oid-end'] + '.val'), this.data['dwd-format']) : '' %></p>
        </div>
    </div>
</script>
<!-- --------------dwd.html--- END -->
<!-- --------------echarts.html--- START -->
<!--
    ioBroker.echarts high quality Widget-Set

    version: "0.0.1"

    Copyright 2019-2020 bluefox <dogafox@gmail.com>

-->
<script type="text/javascript" >
    if (vis.editMode) {
        $.extend(true, systemDictionary, {
            "echart_oid": {
                "en": "EChart ID",
                "de": "EChart ID",
                "ru": "EChart ID",
                "pt": "EChart ID",
                "nl": "EChart ID",
                "fr": "ID de graphique",
                "it": "ID EChart",
                "es": "EChart ID",
                "pl": "Identyfikator EChart",
                "zh-cn": "图表ID"
            },
            "noChartBackground": {
                "en": "No background",
                "de": "Kein Hintergrund",
                "ru": "Без фона",
                "pt": "Sem fundo",
                "nl": "Geen achtergrond",
                "fr": "Pas de fond",
                "it": "Nessuno sfondo",
                "es": "Sin antecedentes",
                "pl": "Bez tła",
                "zh-cn": "没有背景"
            },
        });
    }
</script>

<script id="tplEchartsChart"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="echarts"
        data-vis-name="Chart"
        data-vis-type="chart"
        data-vis-prev='<img src="widgets/echarts/img/Prev_tplEchartsChart.png"/>'
        data-vis-attrs="echart_oid[nothing_selected]/id/filterTypeChart;noChartBackground/checkbox;"
        data-vis-filter="chart">
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px; border-radius: 64px" id="<%= this.data.attr('wid') %>">
         <iframe style="width: 100%; height: 100%; border: 0" src="../echarts/index.html?preset=<%== this.data.attr('echart_oid') %>&noBG=<%== this.data.attr('noChartBackground') %>"></iframe>
    </div>
</script>
<!-- --------------echarts.html--- END -->
<!-- --------------eventlist.html--- START -->
<!--
    ioBroker.vis eventlist Widget-Set

    version: "0.2.0"

    Copyright 2020 ioBroker dogafox@gmail.com
-->

<link rel="stylesheet" href="widgets/eventlist/css/style.css" />

<script type="text/javascript">
    'use strict';

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            // Bars
            "eventlistInstance":              {
                "en": "Instance",
                "de": "Instanz",
                "ru": "Инстанция",
                "pt": "Instância",
                "nl": "Instance",
                "fr": "Instance",
                "it": "Instance",
                "es": "Instance",
                "pl": "Instancja",
                "zh-cn": "实例"
            },
            "showEventTime": {
                "en": "Time",
                "de": "Zeit",
                "ru": "Время",
                "pt": "Tempo",
                "nl": "Tijd",
                "fr": "Temps",
                "it": "Tempo",
                "es": "Hora",
                "pl": "Czas",
                "zh-cn": "时间"
            },
            "showEventValue": {
                "en": "Value",
                "de": "Wert",
                "ru": "Значение",
                "pt": "Valor",
                "nl": "Waarde",
                "fr": "Valeur",
                "it": "Valore",
                "es": "Valor",
                "pl": "Wartość",
                "zh-cn": "值"
            },
            "showEventDuration": {
                "en": "Duration",
                "de": "Dauer",
                "ru": "Продолжительность",
                "pt": "Duração",
                "nl": "Looptijd",
                "fr": "Durée",
                "it": "Durata",
                "es": "Duración",
                "pl": "Trwanie",
                "zh-cn": "持续时间"
            },
            "textEventEvent": {
                "en": "Event",
                "de": "Ereignis",
                "ru": "Мероприятие",
                "pt": "Evento",
                "nl": "Evenement",
                "fr": "un événement",
                "it": "Evento",
                "es": "Evento",
                "pl": "Zdarzenie",
                "zh-cn": "事件"
            },
            "textEventTime": {
                "en": "Time",
                "de": "Zeit",
                "ru": "Время",
                "pt": "Tempo",
                "nl": "Tijd",
                "fr": "Temps",
                "it": "Tempo",
                "es": "Hora",
                "pl": "Czas",
                "zh-cn": "时间"
            },
            "textEventValue": {
                "en": "Value",
                "de": "Wert",
                "ru": "Значение",
                "pt": "Valor",
                "nl": "Waarde",
                "fr": "Valeur",
                "it": "Valore",
                "es": "Valor",
                "pl": "Wartość",
                "zh-cn": "值"
            },
            "textEventDuration": {
                "en": "Duration",
                "de": "Dauer",
                "ru": "Продолжительность",
                "pt": "Duração",
                "nl": "Looptijd",
                "fr": "Durée",
                "it": "Durata",
                "es": "Duración",
                "pl": "Trwanie",
                "zh-cn": "持续时间"
            },
            'group_headerTitle': {
                "en": "Header texts",
                "de": "Kopfzeilentexte",
                "ru": "Тексты заголовков",
                "pt": "Textos de cabeçalho",
                "nl": "Kopteksten",
                "fr": "Textes d'en-tête",
                "it": "Testi di intestazione",
                "es": "Textos de encabezado",
                "pl": "Teksty nagłówka",
                "zh-cn": "标题文字"
            },
            "widthEventEvent": {
                "en": "Event",
                "de": "Ereignis",
                "ru": "Мероприятие",
                "pt": "Evento",
                "nl": "Evenement",
                "fr": "un événement",
                "it": "Evento",
                "es": "Evento",
                "pl": "Zdarzenie",
                "zh-cn": "事件"
            },
            "widthEventTime": {
                "en": "Time",
                "de": "Zeit",
                "ru": "Время",
                "pt": "Tempo",
                "nl": "Tijd",
                "fr": "Temps",
                "it": "Tempo",
                "es": "Hora",
                "pl": "Czas",
                "zh-cn": "时间"
            },
            "widthEventValue": {
                "en": "Value",
                "de": "Wert",
                "ru": "Значение",
                "pt": "Valor",
                "nl": "Waarde",
                "fr": "Valeur",
                "it": "Valore",
                "es": "Valor",
                "pl": "Wartość",
                "zh-cn": "值"
            },
            "widthEventDuration": {
                "en": "Duration",
                "de": "Dauer",
                "ru": "Продолжительность",
                "pt": "Duração",
                "nl": "Looptijd",
                "fr": "Durée",
                "it": "Durata",
                "es": "Duración",
                "pl": "Trwanie",
                "zh-cn": "持续时间"
            },
            "group_headerWidths": {
                "en": "Columns widths",
                "de": "Spaltenbreiten",
                "ru": "Ширина столбцов",
                "pt": "Larguras das colunas",
                "nl": "Kolombreedtes",
                "fr": "Largeurs de colonnes",
                "it": "Larghezze delle colonne",
                "es": "Anchos de columnas",
                "pl": "Szerokość kolumn",
                "zh-cn": "列宽"
            },
            "eventListSampleEvent": {
                "en": "Temperature outside changed to",
                "de": "Außentemperatur auf geändert",
                "ru": "Температура снаружи изменилась на",
                "pt": "A temperatura externa mudou para",
                "nl": "Temperatuur buiten veranderd naar",
                "fr": "Température extérieure modifiée à",
                "it": "La temperatura esterna è cambiata a",
                "es": "La temperatura exterior cambió a",
                "pl": "Temperatura na zewnątrz zmieniona na",
                "zh-cn": "外界温度更改为"
            },
            "alignEventEvent": {
                "en": "Event",
                "de": "Ereignis",
                "ru": "Мероприятие",
                "pt": "Evento",
                "nl": "Evenement",
                "fr": "un événement",
                "it": "Evento",
                "es": "Evento",
                "pl": "Zdarzenie",
                "zh-cn": "事件"
            },
            "alignEventTime": {
                "en": "Time",
                "de": "Zeit",
                "ru": "Время",
                "pt": "Tempo",
                "nl": "Tijd",
                "fr": "Temps",
                "it": "Tempo",
                "es": "Hora",
                "pl": "Czas",
                "zh-cn": "时间"
            },
            "alignEventValue": {
                "en": "Value",
                "de": "Wert",
                "ru": "Значение",
                "pt": "Valor",
                "nl": "Waarde",
                "fr": "Valeur",
                "it": "Valore",
                "es": "Valor",
                "pl": "Wartość",
                "zh-cn": "值"
            },
            "alignEventDuration": {
                "en": "Duration",
                "de": "Dauer",
                "ru": "Продолжительность",
                "pt": "Duração",
                "nl": "Looptijd",
                "fr": "Durée",
                "it": "Durata",
                "es": "Duración",
                "pl": "Trwanie",
                "zh-cn": "持续时间"
            },
            "group_headerAligns": {
                "en": "Align columns",
                "de": "Spalten ausrichten",
                "ru": "Выровнять столбцы",
                "pt": "Alinhar colunas",
                "nl": "Lijn kolommen uit",
                "fr": "Aligner les colonnes",
                "it": "Allinea le colonne",
                "es": "Alinear columnas",
                "pl": "Wyrównaj kolumny",
                "zh-cn": "对齐列"
            },
            "showScroll": {
                "en": "Show scroll",
                "de": "Schriftrolle anzeigen",
                "ru": "Показать прокрутку",
                "pt": "Mostrar pergaminho",
                "nl": "Toon scroll",
                "fr": "Afficher le défilement",
                "it": "Mostra scorrimento",
                "es": "Mostrar desplazamiento",
                "pl": "Pokaż przewijanie",
                "zh-cn": "显示滚动"
            },
            "defaultStyle": {
                "en": "Default style",
                "de": "Standardstil",
                "ru": "Стиль по умолчанию",
                "pt": "Estilo padrão",
                "nl": "Standaard stijl",
                "fr": "Style par défaut",
                "it": "Stile predefinito",
                "es": "Estilo por Defecto",
                "pl": "Domyślny styl",
                "zh-cn": "默认样式"
            },
            "center": {
                "en": "center",
                "de": "Center",
                "ru": "по центру",
                "pt": "сentro",
                "nl": "centrum",
                "fr": "centre",
                "it": "centro",
                "es": "centrar",
                "pl": "środek",
                "zh-cn": "中央"
            },
            tooltip_defaultStyle: {
                "en": "You can overload following classes: event-table for table, event-table-header for header",
                "de": "Sie können folgende Klassen überladen: event-table für table, event-table-header für header",
                "ru": "Вы можете перегрузить следующие классы: event-table для таблицы, event-table-header для заголовка.",
                "pt": "Você pode sobrecarregar as seguintes classes: event-table para a tabela, event-table-header` para o cabeçalho",
                "nl": "U kunt de volgende klassen overbelasten: event-table voor tabel, event-table-header` voor header",
                "fr": "Vous pouvez surcharger les classes suivantes: event-table pour la table, event-table-header` pour l'en-tête",
                "it": "Puoi sovraccaricare le seguenti classi: event-table per table, event-table-header` per header",
                "es": "Puede sobrecargar las siguientes clases: event-table para la tabla, event-table-header` para el encabezado",
                "pl": "Możesz przeciążać następujące klasy: event-table dla tabeli, event-table-header` dla nagłówka",
                "zh-cn": "您可以重载以下类：表的“事件表”，标头的“事件表头”"
            }
        });
    }

    $.extend(true, systemDictionary, {
        "eventtableTime": {
            "en": "Time",
            "de": "Zeit",
            "ru": "Время",
            "pt": "Tempo",
            "nl": "Tijd",
            "fr": "Temps",
            "it": "Tempo",
            "es": "Hora",
            "pl": "Czas",
            "zh-cn": "时间"
        },
        "eventtableValue": {
            "en": "Value",
            "de": "Wert",
            "ru": "Значение",
            "pt": "Valor",
            "nl": "Waarde",
            "fr": "Valeur",
            "it": "Valore",
            "es": "Valor",
            "pl": "Wartość",
            "zh-cn": "值"
        },
        "eventtableEvent": {
            "en": "Event",
            "de": "Ereignis",
            "ru": "Мероприятие",
            "pt": "Evento",
            "nl": "Evenement",
            "fr": "un événement",
            "it": "Evento",
            "es": "Evento",
            "pl": "Zdarzenie",
            "zh-cn": "事件"
        },
        "eventtableDuration": {
            "en": "Duration",
            "de": "Dauer",
            "ru": "Продолжительность",
            "pt": "Duração",
            "nl": "Looptijd",
            "fr": "Durée",
            "it": "Durata",
            "es": "Duración",
            "pl": "Trwanie",
            "zh-cn": "持续时间"
        }
    });

    vis.binds.eventlist = {
        version: "0.2.0",
        showVersion: function () {
            if (vis.binds.eventlist.version) {
                console.log('Version eventlist: ' + vis.binds.eventlist.version);
                vis.binds.eventlist.version = null;
            }
        },
        renderHeader(el, wid, view, data) {
            var text = '<tr class="' + (data.defaultStyle ? 'event-table-header' : '') + '">';
            if (data.showEventTime || data.showEventTime === undefined) {
                text += '<th width="' + data.widthEventTime + '" style="text-align: ' + data.alignEventTime + '">' + (data.textEventTime === '_' || data.textEventTime === undefined ? _('eventtableTime') : data.textEventTime) + '</th>';
            }
            text += '<th width="' + data.widthEventEvent + '" style="text-align: ' + data.alignEventEvent + '">' + (data.textEventEvent === '_' || data.textEventEvent === undefined ? _('eventtableEvent') : data.textEventEvent) + '</th>';
            if (data.showEventValue || data.showEventValue === undefined) {
                text += '<th width="' + data.widthEventValue + '" style="text-align: ' + data.alignEventValue + '">' + (data.textEventValue === '_' || data.textEventValue === undefined ? _('eventtableValue') : data.textEventValue) + '</th>';
            }
            if (data.showEventDuration || data.showEventDuration === undefined) {
                text += '<th width="' + data.widthEventDuration + '" style="text-align: ' + data.alignEventDuration + '">' + (data.textEventDuration === '_' || data.textEventDuration === undefined ? _('eventtableDuration') : data.textEventDuration) + '</th>';
            }
            text += '</tr>\n';
            return text;
        },
        renderRow(el, wid, view, data, json, i) {
            var item = json[i];
            var style = [];
            if (item._style) {
                var attrs = Object.keys(item._style);
                for (var t = 0; t < attrs.length; t++) {
                    style.push(attrs[t] + ': ' + item._style[attrs[t]]);
                }
            }
            var line = '<tr style="' + style.join('; ') + '">';
            if (data.showEventTime) {
                line += '<td style="text-align: ' + data.alignEventTime + '">' + item.ts + '</td>';
            }
            line += '<td style="text-align: ' + data.alignEventEvent + '">' + item.event + '</td>';
            if (data.showEventValue) {
                line += '<td style="text-align: ' + data.alignEventValue + '">' + (item.val === undefined || item.val === null ? '' : item.val) + '</td>';
            }
            if (data.showEventDuration) {
                line += '<td style="text-align: ' + data.alignEventDuration + '">' + (item.duration === undefined || item.duration === null ? '' : item.duration) + '</td>';
            }
            line += '</tr>\n';
            return line;
        },
        state2json(state) {
            state = state || {};
            let table = state.val || [];

            if (typeof table !== 'object') {
                try {
                    table = JSON.parse(table);
                } catch (e) {
                    console.warn('Cannot parse event list: "' + table + '"');
                    table = [];
                }
            }

            table = table || [];

            return table;
        },
        renderTable(el, wid, view, data, style, json) {
            var table = '<table style="width: 100%;" class="' + (data.defaultStyle || data.defaultStyle === undefined ? 'event-table' : '') + '"><tbody style="width: 100%;">'
            table += vis.binds.eventlist.renderHeader(el, wid, view, data);
            for (var i = 0; i < json.length; i++) {
                if (!data.max_rows || i < data.max_rows) {
                    table += vis.binds.eventlist.renderRow(el, wid, view, data, json, i);
                } else {
                    break;
                }
            }

            table += '</tbody></table>\n';
            return table;
        },
        subscribes: [],
        init: function (el, wid, view, data, style) {
            var $div = $('#' + wid);
            if (!$div.length) {
                return setTimeout(function () {
                    vis.binds.eventlist.init(el, wid, view, data, style);
                }, 100);
            }
            data.max_rows = parseInt(data.max_rows, 10) || 0;
            data.widthEventTime     = data.widthEventTime     === parseFloat(data.widthEventTime).toString()     ? data.widthEventTime     + 'px' : data.widthEventTime || '';
            data.widthEventEvent    = data.widthEventEvent    === parseFloat(data.widthEventEvent).toString()    ? data.widthEventEvent    + 'px' : data.widthEventEvent || '';
            data.widthEventValue    = data.widthEventValue    === parseFloat(data.widthEventValue).toString()    ? data.widthEventValue    + 'px' : data.widthEventValue || '';
            data.widthEventDuration = data.widthEventDuration === parseFloat(data.widthEventDuration).toString() ? data.widthEventDuration + 'px' : data.widthEventDuration || '';
            data.showEventTime      = data.showEventTime      === undefined ? true : data.showEventTime;
            data.showEventValue     = data.showEventValue     === undefined ? true : data.showEventValue;
            data.showEventDuration  = data.showEventDuration  === undefined ? true : data.showEventDuration;

            if (data.showScroll) {
                $div.css('overflow-y', 'auto');
            }

            var jsonID = 'eventlist.' + (parseInt(data.eventlistInstance, 10) || 0) + '.eventJSONList';

            vis.conn.getStates(jsonID, (err, state) => {
                var json = vis.binds.eventlist.state2json(state[jsonID]);

                if (vis.editMode && !json.length) {
                    json.push({
                        ts: new Date().toLocaleTimeString(),
                        val: '5°C',
                        event: _('eventListSampleEvent'),
                        duration: '1h 2s'
                    });
                }

                var text = vis.binds.eventlist.renderTable(el, wid, view, data, style, json);
                $div.html(text);

                function onChange(wid, id, newVal) {
                    if (id === jsonID) {
                        var json = vis.binds.eventlist.state2json({val: newVal});
                        var text = vis.binds.eventlist.renderTable(el, wid, view, data, style, json);
                        $div.html(text);
                    }
                }

                if (vis.binds.eventlist.subscribes[jsonID]) {
                    vis.binds.eventlist.subscribes[jsonID]++;
                } else {
                    vis.binds.eventlist.subscribes[jsonID] = 1;
                    vis.conn.subscribe(jsonID);
                    console.log('Subscribe on ' + jsonID);
                }

                vis.registerOnChange(onChange, jsonID);

                $div.data('destroy', function () {
                    if (vis.binds.eventlist.subscribes[jsonID]) {
                        vis.binds.eventlist.subscribes[jsonID]--;
                        if (!vis.binds.eventlist.subscribes[jsonID]) {
                            console.log('Unsubscribe on ' + jsonID);
                            vis.conn.unsubscribe(jsonID);
                            delete vis.binds.eventlist.subscribes[jsonID];
                        }
                        vis.unregisterOnChange(onChange, jsonID);
                    }
                });
            });
        },
        button: function (el, wid, view, data, style) {
            var $div = $('#' + wid);
            if (!$div.length) {
                return setTimeout(function () {
                    vis.binds.eventlist.button(el, wid, view, data, style);
                }, 100);
            }

            var jsonID = 'eventlist.' + (parseInt(data.eventlistInstance, 10) || 0) + '.triggerPDF';

            if (!data.no_style) {
                $div.addClass('ui-state-default').button();
                $div.find('.ui-button-text').css({width: '100%', height: '100%'});
            }
            if (!vis.editMode) {
                $div.off('click').on('click', function () {
                    vis.setValue(jsonID, true);
                    setTimeout(function () {
                        vis.conn.getStates([jsonID], function (error, data) {
                            if (error) {
                                vis.showError(error);
                            } else if (data[jsonID] && data[jsonID].ack && !data[jsonID].val) {
                                window.open('../eventlist/report.pdf?q=' + Date.now(), 'PDF');
                            } else {
                                setTimeout(function () {
                                    window.open('../eventlist/report.pdf?q=' + Date.now(), 'PDF');
                                }, 500);
                            }
                        });
                    }, 100);
                });
            }
        }
    };

    vis.binds.eventlist.showVersion();
</script>

<script id="tplEventlist"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="eventlist"
        data-vis-type="json,table"
        data-vis-name="Events"
        data-vis-prev='<img src="widgets/eventlist/img/Prev_Eventlist.png"></img>'
        data-vis-attrs="eventlistInstance[0]/instance,eventlist;"
        data-vis-attrs0="max_rows/number;defaultStyle[true]/checkbox;defaultStyle[true]/checkbox;"
        data-vis-attrs1="group.header;showEventTime[true]/checkbox;showEventValue[true]/checkbox;showEventDuration[false]/checkbox;"
        data-vis-attrs2="group.headerTitle;textEventTime[_];textEventEvent[_];textEventValue[_];textEventDuration[_];"
        data-vis-attrs3="group.headerWidths;widthEventTime;widthEventEvent;widthEventValue;widthEventDuration;"
        data-vis-attrs4="group.headerAligns;alignEventTime[right]/select,left,right,center;alignEventEvent[right]/select,left,right,center;alignEventValue[right]/select,left,right,center;alignEventDuration[right]/select,left,right,center;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" style="width: 300px; height: 150px; overflow-x: hidden; overflow-y: auto">
        <div class="vis-widget-body" style="display: inline-block" <%= (el) -> vis.binds.eventlist.init(el, this.data.wid, this.view, this.data, this.style) %> ></div>
    </div>
</script>

<script id="tplEventlistButton"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="eventlist"
        data-vis-type="button"
        data-vis-name="PDF"
        data-vis-prev='<img src="widgets/eventlist/img/Prev_EventlistButton.png"></img>'
        data-vis-attrs="eventlistInstance[0]/instance,eventlist;src/image;imageHeight/slider,0,200,1;alt;text[PDF];no_style/checkbox">
    <div
        class="vis-widget ui-widget ui-button ui-corner-all <%== this.data.attr('class') %>"
        style="width: 100px; height: 37px; z-index: 1;"
        id="<%= this.data.attr('wid') %>"
        <%= (el) -> vis.binds.eventlist.button(el, this.data.wid, this.view, this.data, this.style) %>
    >
        <div class="vis-widget-body"><img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %></div>
    </div>
</script>
<!-- --------------eventlist.html--- END -->
<!-- --------------hqwidgets.html--- START -->
<!--
    ioBroker.vis high quality Widget-Set

    version: "1.1.4"

    Copyright 6'2014-2020 bluefox <dogafox@gmail.com>

-->
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/hqwidgets.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/hqwidgetsButtons.css"/>
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/checkbox.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/glossy.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-car.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-default.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-digital.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-minimal.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-plaza.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-slot-machine.css" />
<link rel="stylesheet" type="text/css" href="widgets/hqwidgets/css/odometer-theme-train-station.css" />

<script type="text/javascript" src="widgets/hqwidgets/js/jquery.knob.js"></script>
<script type="text/javascript" src="widgets/hqwidgets/js/odometer.min.js"></script>
<script type="text/javascript" src="widgets/hqwidgets/js/hqwidgets.js"></script>

<style>
        .odometer-leading .odometer-inside .odometer-digit:first-child,
        /*, .odometer-leading .odometer-inside .odometer-formatting-mark:nth-child(2),*/
        .odometer-leading .odometer-inside .odometer-digit:last-child {
            display: none
        }
</style>

<script id="tplHqButton"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="On/Off"
        data-vis-update-style="true"
        data-vis-type="ctrl,bool,button,state"
        data-vis-prev='<div id="prev_tplHqButton" style="position: relative; text-align: initial;padding: 10px !important"><div class="vis-widget_prev vis-hq-button-base" style="overflow: visible; width: 64px; height: 64px; border-radius: 64px; left: 543px; top: 37px; position: absolute;"><div class="vis-hq-main vis-hq-button-base-on" style="z-index: 1; border-radius: 64px;"><div class="vis-hq-middle"><table class="vis-hq-table hq-no-space" style="position: absolute; left: 4px; top: 2px;"><tbody><tr class="hq-no-space"><td class="hq-no-space"><div class="vis-hq-icon" style="text-align: center;"><img class="vis-hq-icon-img" style="height: 56px; width: auto;" src="img/bulb_off.png"></div></td></tr></tbody></table></div></div></div></div>'
        data-vis-attrs="oid[nothing_selected]/id/changedButtonId;oid-working;oid-battery;oid-signal;readOnly/checkbox;"
        data-vis-attrs0="group.value;min[false];max[true];pushButton/checkbox;"
        data-vis-attrs1="group.center;caption;captionOn;iconName[img~bulb_off.png]/image;iconOn/image;btIconWidth[56]/slider,0,400,1;offsetAuto[true]/checkbox;leftOffset[15]/slider,0,100,1;topOffset[55]/slider,0,100,1;"
        data-vis-attrs2="group.leftRight;hoursLastAction/nselect,,1,2,3,6,12,24,1024;timeAsInterval[true]/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY/MM/DD hh:mm:ss,hh:mm:ss,hh:mm;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;infoRight;infoFontRightSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;infoRightPaddingLeft/slider,0,100,1;infoRightPaddingRight[15]/slider,0,100,1;"
        data-vis-attrs3="group.styles;styleNormal/style,hqwidgetsButtons glossy,-button,background;styleActive/style,hqwidgetsButtons glossy,-button,background;usejQueryStyle/checkbox;changeEffect/nselect,,waves,wobble,tada,swing,shake,rubberBand,pulse,flash,bounce;waveColor/color;testActive/checkbox;"
        data-vis-attrs4="group.ccontrol;urlTrue;urlFalse;oidTrue/id;oidFalse/id;oidTrueValue;oidFalseValue;"
        data-vis-filter="HM-LC-Sw1-Pl,HM-LC-Sw1-FM,HM-Dis-TD-T,HM-LC-Sw2-FM,HM-LC-Sw1PBU-FM,HM-LC-Sw1-SM,HM-LC-Sw1-FM,HM-LC-Sw2-FM,HM-LC-Sw4-PCB,HM-LC-Sw4-SM,HM-LC-Sw4-DR,HM-LC-Sw4-WM,HM-Sec-SFA-SM,HM-OU-CF-Pl,HM-OU-CFM-Pl,HMW-LC-Sw2-DR,HM-LC-Sw1-PB-FM,HM-LC-Sw2-PB-FM,HMW-IO-12-Sw14-DR,HMW-IO-12-Sw7-DR,HM-ES-PMSw1-Pl">
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px; border-radius: 64px" id="<%= this.data.attr('wid') %>"><%
         vis.binds.hqwidgets.button.init(this.data.wid, this.view, this.data, this.style);
    %></div>
</script>

<script id="tplHqDimmer"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="Dimmer"
        data-vis-type="ctrl,dimmer,button"
        data-vis-prev='<img src="widgets/hqwidgets/img/prev/Prev_hqwidgetsDimmer.png"></img>'
        data-vis-update-style="true"
        data-vis-attrs="oid[nothing_selected]/id/changedButtonId;oid-working;oid-battery;oid-signal;"
        data-vis-attrs0="group.value;unit[%];min[0];max[100];digits[0]/number;step[1];is_comma[true]/checkbox;"
        data-vis-attrs1="group.center;caption;iconName[img~bulb_off.png]/image;iconOn/image;btIconWidth[56]/slider,0,400,1;offsetAuto[true]/checkbox;leftOffset[15]/slider,0,100,1;topOffset[55]/slider,0,100,1;circleWidth[50]/slider,1,200,1;showValue[true]/checkbox;alwaysShow/checkbox;"
        data-vis-attrs2="group.leftRight;hoursLastAction/nselect,,1,2,3,6,12,24,1024;timeAsInterval[true]/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY/MM/DD hh:mm:ss,hh:mm:ss,hh:mm;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;infoFontRightSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;infoRightPaddingLeft/slider,0,100,1;infoRightPaddingRight[15]/slider,0,100,1;"
        data-vis-attrs3="group.styles;styleNormal/style,hqwidgetsButtons glossy,-button,background;styleActive/style,hqwidgetsButtons glossy,-button,background;usejQueryStyle/checkbox;changeEffect/nselect,,waves,wobble,tada,swing,shake,rubberBand,pulse,flash,bounce;waveColor/color;testActive/checkbox"
        data-vis-filter="light.dimmer">
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px; border-radius: 64px" id="<%= this.data.attr('wid') %>"><%
        vis.binds.hqwidgets.button.init(this.data.wid, this.view, this.data, this.style, 'number');
    %></div>
</script>

<script id="tplHqInTemp"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="Inner temperature"
        data-vis-type="ctrl,temperature"
        data-vis-prev='<img src="widgets/hqwidgets/img/prev/Prev_hqwidgetsInTemp.png"></img>'
        data-vis-update-style="true"
        data-vis-attrs="oid[nothing_selected]/id,level.temperature/changedTempId;oid-humidity/id,value.humidity;oid-actual/id,value.temperature/changedTemperatureId;oid-drive/id,value.valve;valveBinary/checkbox;oid-battery/id,indicator.battery;"
        data-vis-attrs0="group.value;unit[°C];min[6];max[30];digits[0]/number;step[1];is_comma[true]/checkbox;"
        data-vis-attrs1="group.center;caption;iconName[img~Heating.png]/image;btIconWidth[45]/slider,0,400,1;offsetAuto[true]/checkbox;leftOffset[25]/slider,0,100,1;topOffset[55]/slider,0,100,1;circleWidth[50]/slider,1,100,1;showValue[true]/checkbox;alwaysShow/checkbox;midTextColor/color;"
        data-vis-attrs2="group.leftRight;hoursLastAction/nselect,,1,2,3,6,12,24,1024;timeAsInterval[true]/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY/MM/DD hh:mm:ss,hh:mm:ss,hh:mm;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;infoFontRightSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;infoRightPaddingLeft/slider,0,100,1;infoRightPaddingRight[15]/slider,0,100,1;"
        data-vis-attrs3="group.styles;styleNormal[hq-button-base-intemp]/style,hqwidgetsButtons,-button,background;usejQueryStyle/checkbox;changeEffect/nselect,,waves,wobble,tada,swing,shake,rubberBand,pulse,flash,bounce;waveColor/color;testActive/checkbox;"
        data-vis-attrs4="group.chart;url;dialog_title;dialog_width;dialog_height;dialog_effect/effect;dialog_timeout/number,0,3600000,100;dialog_modal/checkbox;dialog_open/checkbox"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px; border-radius: 64px" id="<%= this.data.attr('wid') %>"><%
        this.data.temperature = true;
        vis.binds.hqwidgets.button.init(this.data.wid, this.view, this.data, this.style, 'number');
    %></div>
</script>

<script id="tplHqOutTemp"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="Outdoor temperature"
        data-vis-type="value,temperature"
        data-vis-prev='<img src="widgets/hqwidgets/img/prev/Prev_hqwidgetsOutTemp.png"></img>'
        data-vis-update-style="true"
        data-vis-attrs="oid-actual/id,value.temperature/changedTempId;oid-humidity/id,value.humidity;oid-battery/id,indicator.battery;"
        data-vis-attrs0="group.value;unit[°C];min[6];max[30];digits[0]/number;step[1];is_comma[true]/checkbox;"
        data-vis-attrs1="group.center;caption;iconName[img~Heating.png]/image;btIconWidth[45]/slider,0,400,1;offsetAuto[true]/checkbox;leftOffset[25]/slider,0,100,1;topOffset[55]/slider,0,100,1;circleWidth[50]/slider,1,100,1;showValue[true]/checkbox;alwaysShow/checkbox;midTextColor/color;"
        data-vis-attrs2="group.leftRight;hoursLastAction/nselect,,1,2,3,6,12,24,1024;timeAsInterval[true]/checkbox;format_date/auto,YYYY.MM.DD hh:mm:ss,DD.MM.YYYY hh:mm:ss,YYYY/MM/DD hh:mm:ss,hh:mm:ss,hh:mm;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;infoFontRightSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;infoRightPaddingLeft/slider,0,100,1;infoRightPaddingRight[15]/slider,0,100,1;"
        data-vis-attrs3="group.styles;styleNormal[hq-button-base-outtemp]/style,hqwidgetsButtons,-button,background;usejQueryStyle/checkbox;changeEffect/nselect,,waves,wobble,tada,swing,shake,rubberBand,pulse,flash,bounce;waveColor/color;testActive/checkbox;"
        data-vis-attrs4="group.chart;url;dialog_title;dialog_width;dialog_height;dialog_effect/effect;dialog_timeout/number,0,3600000,100;dialog_modal/checkbox;dialog_open/checkbox"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px; border-radius: 64px" id="<%= this.data.attr('wid') %>"><%
        this.data.temperature = true;
        vis.binds.hqwidgets.button.init(this.data.wid, this.view, this.data, this.style, 'number');
    %></div>
</script>

<script id="tplHqShutter"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-type="ctrl;window;shutter"
        data-vis-name="Window and Shutter"
        data-vis-prev='<div id="prev_tplHqShutter" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev hq-blind-base vis-hq-button-base" style="overflow: visible; width: 110px; height: 90px; left: 109px; top: 74px; position: absolute; padding: 3px 4px 2px;"><table class="hq-blind hq-no-space" style="width: 100%; height: 100%"><tbody><tr><td><div class="hq-blind-blind1" style="border-width: 3px;border-color: #a9a7a8;"><div class="hq-blind-blind2" style="border-width: 3px; "><div class="hq-blind-blind3"><table class="hq-no-space" style="width: 100%; height: 100%; position: absolute"><tbody><tr class="hq-no-space hq-blind-position" style="height: 20%"><td class="hq-no-space hq-blind-blind"></td></tr><tr class="hq-no-space"><td class="hq-no-space"></td></tr></tbody></table><div class="hq-blind-blind4" style="border-width: 3px;border-color: #a5aaad;"><div class="hq-blind-handle hq-blind-handle-bg" style="border-width: 1px;top: 50%; width: 3px; height: 15%;left: calc(100% - 5px);"></div></div></div></div></div></td><td><div class="hq-blind-blind1" style="border-width: 3px;border-color: #a9a7a8;"><div class="hq-blind-blind2" style="border-width: 3px; "><div class="hq-blind-blind3"><table class="hq-no-space" style="width: 100%; height: 100%; position: absolute"><tbody><tr class="hq-no-space hq-blind-position" style="height: 20%"><td class="hq-no-space hq-blind-blind"></td></tr><tr class="hq-no-space"><td class="hq-no-space"></td></tr></tbody></table><div class="hq-blind-blind4 hq-blind-blind4-opened-left" style="border-width: 3px;border-color: #a5aaad;"><div class="hq-blind-handle hq-blind-handle-bg" style="border-width: 1px;top: 50%; width: 3px; height: 15%;-moz-transform-origin: 3px 3px;-ms-transform-origin: 3px 3px;-o-transform-origin: 3px 3px;-webkit-transform-origin: 3px 3px;transform-origin: 3px 3px;-moz-transform: rotate(-90deg);-ms-transform: rotate(-90deg);-o-transform: rotate(-90deg);-webkit-transform: rotate(-90deg);transform: rotate(-90deg);"></div></div></div></div></div></td></tr></tbody></table></div></div>'
        data-vis-attrs="oid/id,level.blind/changedWindowId;oid-working/id,indicator.working;min[0];max[100];border_width/slider,0,10,1;slide_count[1]/nselect,1,2,3,4,5,6;invert/checkbox;hide_timeout[2000];noAnimate/checkbox;popupHorizontalPos[center]/select,top,center,bottom;popupVerticalPos[center]/select,left,center,right;"
        data-vis-attrs0="group.leftRight;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;show_value/checkbox;infoFontRightSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;infoRightPaddingLeft/slider,0,100,1;infoRightPaddingRight[15]/slider,0,100,1;"
        data-vis-attrs1="group.slides/byindex;slide_type(1-slide_count)/select,,left,right,top,bottom;oid-slide-sensor(1-slide_count)/id/changedSensorId;oid-slide-sensor-lowbat(1-slide_count)/id,indicator.battery;oid-slide-handle(1-slide_count)/id/changedSensorId;oid-slide-handle-lowbat(1-slide_count)/id,indicator.battery;"
        >
    <div class="vis-widget hq-blind-base <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px" id="<%= this.data.attr('wid') %>"><%
        vis.binds.hqwidgets.window.init(this.data.wid, this.view, this.data, this.style);
    %></div>
</script>

<script id="tplHqDoor"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-type="state;door"
        data-vis-name="Door"
        data-vis-prev='<div id="prev_tplHqDoor" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev hq-blind-base vis-hq-button-base" style="overflow: visible; width: 47px; height: 93px; padding: 3px 4px 2px;"><table class="vis-hq-main vis-hq-door vis-hq-no-space" style="border: 2px #8E8D8D solid;"><tbody><tr class="vis-hq-no-space"><td class="vis-hq-no-space vis-hq-door-empty-right"></td><td class="vis-hq-no-space vis-hq-door-sheet" style="width: 100%;"><div class="vis-hq-door-handle" style="left: 75%;"></div></td><td class="vis-hq-no-space vis-hq-door-empty-left" style="width: 0px; background: rgb(81, 81, 81);"></td></tr></tbody></table></div></div></div>'
        data-vis-attrs="oid/id,state/changedButtonId;oid-battery/id,indicator.battery;border_width/slider,0,10,1;invert/checkbox;door_type/select,,left,right;noAnimate/checkbox;"
        data-vis-attrs0="group.leftRight;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;"
        >
    <div class="vis-widget hq-blind-base <%== this.data.attr('class') %>" style="overflow:visible; width: 50px; height: 100px" id="<%= this.data.attr('wid') %>"><%
        vis.binds.hqwidgets.door.init(this.data.wid, this.view, this.data, this.style);
    %></div>
</script>

<script id="tplHqLock"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplHqLock" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev vis-hq-lock-base vis-hq-button-base hq-button-no-background" style="overflow: visible; width: 30px; height: 30px;" ><img src="widgets/hqwidgets/img/lockUnlocked.png" class="vis-hq-lock1" style="width: 100%; height:100%;"></div></div>'
        data-vis-set="hqwidgets"
        data-vis-type="control;lock"
        data-vis-name="Lock"
        data-vis-attrs="oid/id,state/changedLockId;oid-open/id;oid-battery/id,indicator.battery;noAnimate/checkbox;"
        data-vis-attrs0="group.image;closedIcon[widgets~hqwidgets~img~lockLocked.png]/image;openedIcon[widgets~hqwidgets~img~lockUnlocked.png]/image;"
        data-vis-attrs1="group.popup;popupRadius[75]/slider,50,150,1;buttonRadius[50]/slider,0,150,1;closeIcon[widgets~hqwidgets~img~lockLocked.png]/image;closeValue;closeStyle/style,hqwidgetsButtons glossy,-button,background;"
        data-vis-attrs2="openIcon[widgets~hqwidgets~img~lockUnlocked.png]/image;openValue;openStyle/style,hqwidgetsButtons glossy,-button,background;"
        data-vis-attrs3="openDoorIcon[widgets~hqwidgets~img~openDoor.png]/image;openDoorValue;openDoorStyle/style,hqwidgetsButtons glossy,-button,background;showTimeout[5000]/slider,0,30000,100;"
        data-vis-attrs4="group.leftRight;descriptionLeftDisabled/checkbox;descriptionLeft;infoLeftFontSize[12]/slider,6,50,1;infoFontRightSize[12]/slider,6,50,1;infoColor/color;infoBackground/color;infoLeftPaddingLeft[15]/slider,0,100,1;infoLeftPaddingRight[50]/slider,0,100,1;infoRightPaddingLeft/slider,0,100,1;infoRightPaddingRight[15]/slider,0,100,1;"
        data-vis-attrs5="group.styles;styleNormal[hq-button-no-background]/style,hqwidgetsButtons glossy,-button,background;styleActive[hq-button-no-background]/style,hqwidgetsButtons glossy,-button,background;usejQueryStyle/checkbox;changeEffect/nselect,,waves,wobble,tada,swing,shake,rubberBand,pulse,flash,bounce;waveColor/color;testActive/checkbox;"
        >
    <div class="vis-widget vis-hq-lock-base <%== this.data.attr('class') %>" style="overflow:visible; width: 30px; height: 30px" id="<%= this.data.attr('wid') %>"><%
        vis.binds.hqwidgets.lock.init(this.data.wid, this.view, this.data, this.style);
    %></div>
</script>


<!--script type="text/ejs" id="tplHqText" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Text" data-vis-render-visible="true" data-vis-attrs="hqoptions">
    <%
    if (this && this.data && this.data.attr) {
        if (this.data.attr('hqoptions')){
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
        }
        else {
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqText", this.view);
        }
    }
    %>
</script>
<script type="text/ejs" id="tplHqInfo" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Info" data-vis-render-visible="true" data-vis-attrs="hm_id;hqoptions">
    <%
    if (this && this.data && this.data.attr) {
        if (this.data.attr('hqoptions')){
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
        }
        else {
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqInfo", this.view);
        }
    }
    %>
</script>
<script type="text/ejs" id="tplHqImage" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Image" data-vis-render-visible="true" data-vis-attrs="hqoptions">
    <%
    if (this && this.data && this.data.attr) {
        if (this.data.attr('hqoptions')){
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
        }
        else {
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqImage", this.view);
        }
    }
    %>
</script>
<script type="text/ejs" id="tplHqCam" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="IpCamera" data-vis-render-visible="true" data-vis-attrs="hm_id;hqoptions" data-hqwidgets-filter="HM-OU-CFM-Pl,HM-Sec-SFA-SM,HM-OU-CF-Pl,HM-Sec-SC,HM-SCI-3-FM,HMW-Sen-SC-12-DR,HMW-IO-12-Sw14-DR;.STATE,.OPEN,HM-Sec-Key-S,HM-LC-Sw4-WM,HM-LC-Sw1-Pl,HM-LC-SW1-FM,HM-LC-Sw2-FM,HM-LC-Sw1-SM,HM-LC-Sw4-PCB,HM-LC-Sw4-PCB,HM-LC-Sw4-SM,HM-LC-Sw1-BA-PCB">
    <%
    if (this && this.data && this.data.attr) {
        if (this.data.attr('hqoptions')){
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
        }
        else {
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqCam", this.view);
        }
    }
    %>
</script>
<script type="text/ejs" id="tplHqGong" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Gong" data-vis-render-visible="true" data-vis-attrs="hm_id;hqoptions" data-hqwidgets-filter="HM-OU-CFM-Pl,HM-Sec-SFA-SM,HM-OU-CF-Pl,HM-Sec-SC,HM-SCI-3-FM,HMW-Sen-SC-12-DR,HMW-IO-12-Sw14-DR;.STATE,.OPEN,HM-Sec-Key-S,HM-LC-Sw4-WM,HM-LC-Sw1-Pl,HM-LC-SW1-FM,HM-LC-Sw2-FM,HM-LC-Sw1-SM,HM-LC-Sw4-PCB,HM-LC-Sw4-SM,HM-LC-Sw1-BA-PCB">
    <%
    if (this && this.data && this.data.attr) {
        if (this.data.attr('hqoptions')){
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
        }
        else {
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqGong", this.view);
        }
    }
    %>
</script>
<script type="text/ejs" id="tplHqGauge" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Gauge" data-vis-render-visible="true" data-vis-attrs="hm_id;hqoptions">
    <%
    if (this && this.data && this.data.attr) {
		if (this.data.attr('hqoptions')){
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
		}
		else {
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqGauge", this.view);
		}
    }
    %>
</script>
<script type="text/ejs" id="tplHqMotion" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Motion Detector" data-vis-render-visible="true" data-vis-attrs="hm_id;hqoptions" data-hqwidgets-filter=".STATE,.MOTION;">
    <%
    if (this && this.data && this.data.attr) {
		if (this.data.attr('hqoptions')){
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
		}
		else {
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqMotion", this.view);
		}
    }
    %>
</script>
<script type="text/ejs" id="tplHqLowbat" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Battery Indicator" data-vis-render-visible="true" data-vis-attrs="hqoptions" data-hqwidgets-filter=".LOWBAT">
    <%
    if (this && this.data && this.data.attr) {
        if (this.data.attr('hqoptions')){
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
        }
        else {
            vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqLowbat", this.view);
        }
    }
    %>
</script>
<script type="text/ejs" id="tplHqIp" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Ping device" data-vis-render-visible="true" data-vis-attrs="hqoptions" data-hqwidgets-filter="PING">
    <%
    if (this && this.data && this.data.attr) {
		if (this.data.attr('hqoptions')){
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
		} else {
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqIp", this.view);
		}
    }
    %>
</script>
<script type="text/ejs" id="tplHqCharts" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Charts" data-vis-render-visible="true" data-vis-attrs="hqoptions">
    <%
    if (this && this.data && this.data.attr) {
		if (this.data.attr('hqoptions')){
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
		} else {
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqCharts", this.view);
		}
    }
    %>
</script>
<script type="text/ejs" id="tplHqEventlist" class="vis-tpl" data-vis-set="hqwidgets" data-vis-name="Eventlist" data-vis-render-visible="true" data-vis-attrs="hqoptions">
    <%
    if (this && this.data && this.data.attr) {
		if (this.data.attr('hqoptions')){
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, this.data.attr('hqoptions'), undefined, this.view);
		} else {
			vis.binds.hqWidgetsExt.hqButtonExt (this.data.wid, undefined, "tplHqEventlist", this.view);
		}
    }
    %>
</script-->

<script id="tplHqCheckbox"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="Checkbox"
        data-vis-type="ctrl,checkbox"
        data-vis-prev='<div id="prev_tplHqCheckbox" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev " style="overflow: visible; width: 108px; height: 35px"><div class="checkbox-small-orange-wrap"><div class="checkbox-small-orange-button"><input type="checkbox" style="display: none;"></div></div></div></div>'
        data-vis-update-style="true"
        data-vis-attrs="oid[nothing_selected]/id;val_false[false];val_true[true];staticValue;"
        data-vis-attrs0="checkboxSize[big]/select,big,small;checkboxColor[grey]/select,orange,blue,green,grey;checkboxColorOn[orange]/select,orange,blue,green,grey;readOnly/checkbox"
    >
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 216px; height: 68px" id="<%= this.data.attr('wid') %>"  data-vis-resizable='{"disabled":true, "handles":"e"}'><%
            vis.binds.hqwidgets.checkbox.init(this.data.wid, this.view, this.data, this.style);
    %></div>
</script>

<script id="tplHqCircle"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="CircleKnob"
        data-vis-update-style="true"
        data-vis-type="ctrl,number,dimmer,knob"
        data-vis-prev='<img src="widgets/hqwidgets/img/prev/Prev_hqwidgetsCircleKnob.png"></img>'
        data-vis-attrs="oid[nothing_selected]/id/changedButtonId;oid-working;oid-battery;oid-signal;"
        data-vis-attrs0="group.value;unit;min[0];max[100];digits[0]/number;step[1];is_comma[true]/checkbox;readOnly/checkbox;"
        data-vis-attrs1="group.center;caption;hideNumber/checkbox;"
        data-vis-attrs2="group.arc;angleOffset/slider,0,360,1;angleArc/slider,0,360,1;displayPrevious[true]/checkbox;"
        data-vis-attrs3="group.style;cursor/slider,1,350,1;thickness/slider,0.05,1,0.05;color/color;bgcolor/color;linecap/checkbox;anticlockwise/checkbox"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 64px; height: 64px" id="<%= this.data.attr('wid') %>"><%
        vis.binds.hqwidgets.circle.init(this.data.wid, this.view, this.data);
        %><input type="text" style="display: none"/></div>
</script>
<script id="tplHqOdometer"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="hqwidgets"
        data-vis-name="Odometer"
        data-vis-beta="true"
        data-vis-update-style="true"
        data-vis-type="val,number"
        data-vis-prev='<img src="widgets/hqwidgets/img/prev/Prev_hqOdometer.png"></img>'
        data-vis-attrs="oid;style[car]/nselect,car,default,digital,minimal,plaza,slot-machine,train-station;group.extended;format[(ddd),dd];factor[1];leadingZeros[true]/checkbox"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 125px; height: 42px; font-size: 24px" id="<%= this.data.attr('wid') %>"></div>
    <% vis.binds.hqwidgets.odometer(this.view, this.data) %>
</script>

<!-- --------------hqwidgets.html--- END -->
<!-- --------------info.html--- START -->
<link rel="stylesheet" href="widgets/info/css/style.css" />

<script type="text/javascript" src="../socket.io/socket.io.js"></script>
<script type="text/javascript" src="../adapter/info/lib/js/commons.js"></script>
<script type="text/javascript" src="../adapter/info/lib/js/popupnews.js"></script>
<script type="text/javascript" src="widgets/info/js/info.js"></script>

<script id="tplInfoMessages"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/info/img/messages.png" style="width: 115px;"></img>'
        data-vis-attrs="oid[info.0.newsfeed]/id"
        data-vis-set="info"
        data-vis-type="data"
        data-vis-name="Messages">
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 530px; height: 210px" id="<%= this.data.attr('wid') %>">
    <% vis.binds.info.createMessage(this.data.wid, this.view, this.data, this.style); %>
    </div>
</script>

<script id="tplInfoCalendar"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/info/img/calendar.png" style="width: 115px;"></img>'
        data-vis-attrs="width[400]/number;height[400]/number;bgcolor[ffffff]/text;mode[AGENDA]/select,AGENDA,MONTH,WEEK"
        data-vis-set="info"
        data-vis-type="data"
        data-vis-name="Event calendar">  
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow:visible; width: 400px; height: 400px" id="<%= this.data.attr('wid') %>">
    <% vis.binds.info.createCalendar(this.data.wid, this.view, this.data, this.style); %>
    </div>
</script>

<!-- Popup News -->
<div id="popupNewsTemplate" style="display: none;">
    <div class="info-adapter-class">
        <div class="alert alert-info alert-dismissible row" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <div class="col-xs-2"><i class="fa fa-exclamation-triangle fa-5x"></i></div>
            <div class="col-xs-9">
                <h2 class="popupnews_title"></h2>
                <p class="popupnews_content"></p>
            </div>
        </div>
    </div>
</div>
<!-- / Popup News -->
<!-- --------------info.html--- END -->
<!-- --------------jqplot.html--- START -->
<link rel="stylesheet" type="text/css" href="widgets/jqplot/css/jquery.jqplot.min.css" />

<script type="text/javascript" src="widgets/jqplot/js/jquery.jqplot.min.js"></script>

<script type="text/javascript">

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "background":           {"en": "Background",            "de": "Hintergrund",                    "ru": "Фон"},
            "group_ticks":          {"en": "Ticks",                 "de": "Tick",                           "ru": "Штрихи"},
            "ticks":                {"en": "Ticks-Namen",           "de": "Tick-Beschriftungen",            "ru": "Подписи штрихов"},
            "ticks_tooltip":        {"en": "Divide with semicolon, e.g '10;50;70'", "de": "Mit Semikolon trennen, z.B. '10;50;70'", "ru": "Разделять точкой запятой, например '10;50;70'"},
            "showTickLabels":       {"en": "Show tick labels",      "de": "Zeige Tick-Beschriftungen",      "ru": "Показать подписи"},
            "tickPadding":          {"en": "Tick padding",          "de": "Tick-Abstand",                   "ru": "Отступ штрихов"},
            "group_intervals":      {"en": "Intervals",             "de": "Intervalle",                     "ru": "Интервалы"},
            "intervals":            {"en": "Intervals",             "de": "Intervalle",                     "ru": "Отрезки"},
            "intervals_tooltip":    {"en": "Divide with semicolon, e.g '10;50;70'", "de": "Mit Semikolon trennen, z.B. ''10;50;70'", "ru": "Разделять точкой запятой, например '10;50;70'"},
            "intervalColors":       {"en": "Interval colors",       "de": "Intervallfarben",                "ru": "Цвета интервалов"},
            "intervalColors_tooltip": {"en": "Divide with semicolon, e.g 'green;#0000FF;red'", "de": "Mit Semikolon trennen, z.B. 'green;#0000FF;red'", "ru": "Разделять точкой запятой, например 'green;#0000FF;red'"},
            "intervalInnerRadius":  {"en": "Inner interval raduis", "de": "Intervall-Radius innen",         "ru": "Внутренний радиус интервалов"},
            "intervalOuterRadius":  {"en": "Outer interval radius", "de": "Intervall-Radius außen",         "ru": "Внешний радиус интервалов"},
            "diameter":             {"en": "Diameter",              "de": "Durchmesser",                    "ru": "Диаметер"},
            "padding":              {"en": "Padding",               "de": "Abstand",                        "ru": "Отступ"},
            "group_shadow":         {"en": "Shadow",                "de": "Schatten",                       "ru": "Тень"},
            "shadowOffset":         {"en": "shadowOffset",          "de": "Schatten offset",                "ru": "Сдвиг тени"},
            "shadowAlpha":          {"en": "Shadow transparence",   "de": "Schatten Alpha",                 "ru": "Прозрачость тени"},
            "shadowDepth":          {"en": "Shadow depth",          "de": "Schattentiefe",                  "ru": "Глубина тени"},
            "group_ring":           {"en": "Ring",                  "de": "Rand",                           "ru": "Кайма"},
            "ringColor":            {"en": "Ring color",            "de": "Randfarbe",                      "ru": "Цвет окантовки"},
            "ringWidth":            {"en": "Ring width",            "de": "Randbreite",                     "ru": "Ширина окантовки"},
            "group_needle":         {"en": "Needle",                "de": "Zeiger",                         "ru": "Стрелка"},
            "needleThickness":      {"en": "Needle thickness",      "de": "Zeigerdicke",                    "ru": "Ширина стрелки"},
            "needlePad":            {"en": "Needle pad",            "de": "Zeigeroffset",                   "ru": "Радиус основания"},
            "hubRadius":            {"en": "Hub radius",            "de": "Zeigerbasis-Radius",             "ru": "Основание стрелки"}
        });
    }

    vis.binds.jqplot = {
        gauge: function (el, data) {
            var $this = $(el).find('.jqplot-gauge');

            var id = $(el).attr('id');
            if (id && id.match(/_removed$/)) {
                return;
            }

            if (!$this.length || !$this.is(':visible')) {
                setTimeout(function () {
                    vis.binds.jqplot.gauge(el, data);
                }, 100);
                return;
            }

            if (!data) return;

            var options = {
                title: data.title,
                seriesDefaults: {
                    rendererOptions: {
                        min:            (data.min ? parseFloat(data.min) : undefined),
                        max:            (data.max ? parseFloat(data.max) : undefined),
                        ticks:          (data.ticks ? jQuery.map(data.ticks.split(';'), Number) : undefined),
                        intervals:      (data.intervals ? jQuery.map(data.intervals.split(';'), Number) : undefined),
                        intervalColors: (data.intervalColors ? data.intervalColors.split(';') : undefined),
                        label:          data.label,
                        showTickLabels: ((data.showTickLabels === 'false' || data.showTickLabels === false) ? false : undefined),
                        intervalInnerRadius: (!data.intervalInnerRadius ? undefined : parseInt(data.intervalInnerRadius, 10)),
                        intervalOuterRadius: (!data.intervalOuterRadius ? undefined : parseInt(data.intervalOuterRadius, 10)),
                        diameter:       (!data.diameter ? undefined : parseInt(data.diameter, 10)),
                        padding:        (!data.padding ? undefined : parseInt(data.padding, 10)),
                        shadowOffset:   (!data.shadowOffset ? undefined : parseInt(data.shadowOffset, 10)),
                        shadowAlpha:    (!data.shadowAlpha ? undefined : parseInt(data.shadowAlpha, 10)),
                        shadowDepth:    (!data.shadowDepth ? undefined : parseInt(data.shadowDepth, 10)),
                        background:     data.background, ringColor: data.ringColor,
                        tickColor:      data.tickColor,
                        ringWidth:      (!data.ringWidth ? undefined : parseInt(data.ringWidth, 10)),
                        hubRadius:      (!data.hubRadius ? undefined : parseInt(data.hubRadius, 10)),
                        tickPadding:    (!data.tickPadding ? undefined : parseInt(data.tickPadding, 10)),
                        needleThickness: (!data.needleThickness ? undefined : parseInt(data.needleThickness, 10)),
                        needlePad:      (!data.needlePad ? undefined : parseInt(data.needlePad, 10))
                    }
                }
            };
            if (options.seriesDefaults.rendererOptions.ticks && options.seriesDefaults.rendererOptions.ticks.length === 1) {
                options.seriesDefaults.rendererOptions.ticks[1] = options.seriesDefaults.rendererOptions.ticks[0];
            }

            $(el).data('options', data);
            $this.html('');

            try {
                var jqplotOptions = $.extend(true, {
                    title: {show: false},
                    grid: {
                        background: 'transparent'
                    },
                    seriesDefaults: {
                        renderer: $.jqplot.MeterGaugeRenderer,
                        rendererOptions: {
                            min: 0,
                            max: 100
                        }
                    }
                }, options);

                var oid = $this.attr('data-oid');
                var series;
                if (oid !== 'nothing_selected' && vis.states[oid + '.val'] !== undefined) {
                    series = [[vis.states[oid + '.val']]];
                } else {
                    series = [[1, 0]];
                }

                function onChange(e, newVal/* , oldVal */) {
                    plot.series[0].data = [[1, newVal]];
                    plot.redraw();
                }

                var bound = [];

                if (oid) {
                    vis.states.bind(oid + '.val', onChange);
                    bound.push(oid + '.val');
                }
                var plot = $.jqplot($this.attr('id'), series, jqplotOptions);

                if (bound.length) {
                    // remember all ids, that bound
                    $(el).data('bound', bound);
                    // remember bind handler
                    $(el).data('bindHandler', onChange);
                }
            } catch(e) {
                servConn.logError('Cannot render widget jqplot: ' + e);
            }

            if (vis.editMode) {
                $(el).resize(function () {
                    var timer = $(this).data('timer');
                    if (timer) {
                        clearTimeout(timer);
                    }
                    var that = this;
                    $(this).data('timer', setTimeout(function () {
                        $(that).data('timer', null);
                        $('#' + $(that).attr('id') + '_gauge').html('');
                        vis.binds.jqplot.gauge(that, $(that).data('options'));
                    }, 300));
                });

                $(el).data('destroy', function (id, $widget) {
                    $widget.off('resize');
                });
            }
        }
    };
</script>

<script type="text/ejs"
        id="tplJqplotGauge"
        class="vis-tpl"
        data-vis-prev='<img src="widgets/jqplot/img/Prev_MeterGauge.png"></img>'
        data-vis-set="jqplot"
        data-vis-type="number"
        data-vis-name="MeterGauge"
        data-vis-attrs="oid;title;min/number;max/number;label;background/color;padding/slider,0,50,1;group.ticks;ticks;showTickLabels[true]/checkbox;tickPadding/slider,0,50,1;group.intervals;intervals;intervalColors;intervalInnerRadius/slider,0,550,1;intervalOuterRadius/slider,0,550,1;group.shadow;shadowOffset/slider,0,50,1;shadowAlpha/slider,0,1,0.05;shadowDepth/slider,0,50,1;group.ring;ringColor/color;ringWidth/slider,0,150,1;group.needle;needleThickness/slider,0,50,1;needlePad/slider,0,150,1;hubRadius/slider,0,150,1"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:460px; height:280px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqplot.gauge(el, data) %>>
        <div class="vis-widget-body" style="width: 100%; height: 100%">
            <div class="jqplot-gauge" id="_<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" style="width: 100%; height: 100%"/>
        </div>
    </div>
</script>

<!-- --------------jqplot.html--- END -->
<!-- --------------jqui.html--- START -->
<link rel="stylesheet" href="lib/css/jquery-ui-timepicker-addon-1.6.3.css" />
<script type="text/javascript" src="lib/js/jquery-ui-timepicker-addon-1.6.3.js"></script>
<style>
    #ui-datepicker-div {
        z-index: 999 !important;
    }
</style>
<script type="text/javascript">
    'use strict';

    if (vis.editMode) {
        $.extend(systemDictionary, {
            "group_dialog":     {"en": 'Dialog',            "de": "Dialog",                 "ru": "Диалог"},
            "buttontext":       {"en": "Button text",       "de": "Knopftext",              "ru": "Надпись на кнопке"},
            "href":             {"en": "Link",              "de": "Link",                   "ru": "Ссылка"},
            "href_tooltip":     {"en": "Like 'http://google.com'", "de": "Wie 'http://google.com'", "ru": "Например 'http://google.com'"},
            "target":           {"en": "target",            "de": "target",                 "ru": "target"},
            "dialog_height":    {"en": "Dialog height",     "de": "Dialoghöhe",             "ru": "Высота окна"},
            "dialog_width":     {"en": "Dialog width",      "de": "Dialogbreite",           "ru": "Ширина окна"},
            "alt":              {"en": "Tooltip (alt)",     "de": "Tooltip (alt)",          "ru": "Всплывающая подсказка (alt)"},
            "text":             {"en": "Text",              "de": "Text",                   "ru": "Текст"},
            "invert_icon":      {"en": "Invert image",      "de": "Invertiere das Bild",    "ru": "Инвертировать картинку"},
            "html_dialog":      {"en": "HTML in dialog",    "de": "HTML im Dialog",         "ru": "HTML в диалоговом окне"},
            "preload":          {"en": "Prerender dialog",  "de": "Prerender Dialog",       "ru": "Рендер содержания в начале"},
            "closeOnClick":     {"en": "Close by click on dialog",  "de": "Anklicken zum Schliessen",       "ru": "Закрыть по нажатию в любом месте"},
            "preload_tooltip":  {
                "en": "If true, the content of dialog will be created at start of view.\x0AIf false, the content will be created during opening of dialog.\x0AWebcams or dynamic content require 'prerender'=false",
                "de": "Falls true, wird Inhalt vom Dialog sofort am Anfang gerendert.\x0AFalls false, erst beim Anzeigen vom Dialog.\x0AWebcams oder dynamischer Inhalt müssen prerender auf false haben",
                "ru": "Если да, то рендер содержания будет в самом начале.\x0AЕсли нет, то при показе диалога.\x0AWebCams или динамическое содержание требуют значение false."
            },
            "persistent":       {"en": "Persistent",        "de": "Dauernd",                "ru": "Существует постоянно"},
            "persistent_tooltip":  {
                "en": "If true, the dialog will be created at start and can\x0Abe shown by external command 'dialogOpen'.",
                "de": "Falls true, wird der Dialog sofort am Anfang erzeugtx0Aund kann mit dem Befehl 'dialogOpen' angezeigt werden.",
                "ru": "Если да, то диалог будет создан в самом начале и\x0Aможет быть вызван внешней командой 'dialogOpen'."
            },
            "src_true":         {"en": "Icon by ON",         "de": "Icon bei AN",           "ru": "Иконка при ВКЛ"},
            "alt_true":         {"en": "Tooltip by ON",      "de": "Tooltip bei AN",        "ru": "Подсказка при ВКЛ"},
            "src_false":        {"en": "Icon by OFF",        "de": "Icon bei AUS",          "ru": "Иконка при ВЫКЛ"},
            "alt_false":        {"en": "Tooltip by OFF",     "de": "Tooltip bei AUS",       "ru": "Подсказка при ВЫКЛ"},
            "timeOnly":         {"en": "Time only",          "de": "Nur Zeit",              "ru": "Только время"},
            "hideSeconds":      {"en": "Hide seconds",       "de": "Keine Sekunden",        "ru": "спрятать секунды"},
            "stepMinute":       {"en": "Step size minutes",  "de": "Schrittweite Minuten",  "ru": "размер шага минуты"},
            "showGrid":         {"en": "Show grid",          "de": "Zeige Raster",          "ru": "показать сетку"},
            "inverted":         {"en": "Inverted value",     "de": "Wert invertiert",       "ru": "Иневртировать значение"},
            "submitmethod":     {"en": "Submit method",      "de": "Sendemethode",          "ru": "Метод"},
            "click_id":         {"en": "Control ID",         "de": "Steuer-ID",             "ru": "Контроль-ID"},
            "click_value":      {"en": "Control value",      "de": "Steuerwert",            "ru": "Контроль-значение"},
            "false_text":       {"en": "Text inactive",      "de": "Inaktiv-Text",          "ru": "Неактивный текст"},
            "true_text":        {"en": "Text active",        "de": "Aktiv-Text",            "ru": "Активный текст"},
            "false_src":        {"en": "Icon inactive",      "de": "Inaktiv-Bild",          "ru": "Неактивная картинка"},
            "true_src":         {"en": "Icon active",        "de": "Aktiv-Bild",            "ru": "Активная картинка"},
            "false_alt":        {"en": "Tooltip inactive",   "de": "Inaktiv-Tooltip",       "ru": "Неактивная подсказка"},
            "true_alt":         {"en": "Tooltip active",     "de": "Aktiv-Tooltip",         "ru": "Активная подсказка"},
            "dialog_top":       {"en": "Top",                "de": "Position oben",         "ru": "Позиция сверху"},
            "dialog_left":      {"en": "Left",               "de": "Position links",        "ru": "Позиция слева"},
            "overflowX":        {"en": "Overflow X",         "de": "Overflow X",            "ru": "Overflow X"},
            "overflowY":        {"en": "Overflow Y",         "de": "Overflow Y",            "ru": "Overflow Y"},
            "noHeader":         {"en": "Hide header",        "de": "Kopfzeile verbergen",   "ru": "Скрыть заголовок"},
            "setId":            {"en": "Set Object ID",      "de": "Setze Objekt-ID",       "ru": "Записать в Объект с ID"},
            "setId_tooltip":    {
                "en": "By opening of dialog the Object ID\x0Awill be set with given value.",
                "de": "Beim Öffnen des Dialogs wird die Object ID\x0Amit dem eingegebenen Wert gesetzt.",
                "ru": "При открытии диалога в объект с этим ID будет записано значение"
            },
            "setValue":         {"en": "Set value",          "de": "Setze Wert",            "ru": "Записываемое значение"},
            "oid-2":            {"en": "OID Range max.",     "de": "OID Bereich max.",      "ru": "ID Объекта макс"},
            "oid-2-working":    {"en": "OID Working max.",   "de": "OID Working max.",      "ru": "ID working макс"},
            "asString":         {"en": "As string",          "de": "Als String",            "ru": "Строковое значение"},
            "values":           {"en": "Values",             "de": "Werte",                 "ru": "Значения"},
            "values_tooltip":   {
                "en": "Values divided by semicolon:\x0A0;1;2",
                "de": "Werte sind mit Semikolon getrennt:\x0A0;1;2",
                "ru": "Значения разделены точкой с запятой:\x0A0;1;2"
            },
            "texts":            {"en": "Texts",             "de": "Texte",                  "ru": "Тексты"},
            "height":           {"en": "Height",            "de": "Höhe",                   "ru": "Высота"},
            "no_style":         {"en": "No jQuery style",   "de": "Ohne jQuery Stil",       "ru": "Без стиля jQuery"},
            "Password":         {"en": "Password",          "de": "Kennwort",               "ru": "Пароль"},
            "imageHeight":      {"en": "Image height %",    "de": "Bildhöhe in %",          "ru": "Высота иконки в %"},
            "autoclose":        {"en": "Auto close (ms)",   "de": "Auto-Zu (ms)",           "ru": "Автозакрытие (мс)"},
            "modal":            {"en": "Modal",             "de": "Modal",                  "ru": "Модальное"},
            "texts_tooltip":   {
                "en": "Texts divided by semicolon:\x0AOn;Off;Auto",
                "de": "Texte sind mit Semikolon getrennt:\x0AAn;Aus;Auto",
                "ru": "Тексты разделены точкой с запятой:\x0AВкл;Выкл;Авто"
            }
        });
    }
    $.extend(systemDictionary, {
        "Password": {"en": "Password", "de": "Kennwort", "ru": "Пароль"}
    });

    vis.navChangeCallbacks.push(function (view) {
        $('.jqui-nav-state').each(function () {
            var $this = $(this);
            if ($this.attr('data-vis-nav') === view) {
                $this.removeClass('ui-state-default');
                $this.addClass('ui-state-active');
            } else {
                $this.addClass('ui-state-default');
                $this.removeClass('ui-state-active');
            }
        });
    });

    vis.binds.jqueryui = {
        navigationActive: function (el, nav_view) {
            var $this = $(el);
            if (window.location.hash.slice(1) === nav_view) {
                $this.removeClass('ui-state-default').addClass('ui-state-active');
            }
        },
        months: {
            "en": ['January', 'February', 'March', 'April',  'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
            "de": ['Januar',  'Februar',  'März',  'April',  'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
            "ru": ['Январь',  'Февраль',  'Март',  'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь',  'Октябрь', 'Ноябрь',   'Декабрь']
        },
        shortMonths: {
            "en": ['Jan', 'Feb', 'Mar',  'Apr', 'May', 'Jun',  'Jul',  'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            "de": ['Jan', 'Feb', 'Mär',  'Apr', 'Mai', 'Jun',  'Jul',  'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
            "ru": ['Янв', 'Фев', 'Март', 'Апр', 'Май', 'Июня', 'Июля', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек']
        },
        weekDays: {
            "en": ['Sunday',      'Monday',      'Tuesday',  'Wednesday', 'Thursday',   'Friday',  'Saturday'],
            "de": ['Sonntag',     'Montag',      'Dienstag', 'Mittwoch',  'Donnerstag', 'Freitag', 'Samstag'],
            "ru": ['Воскресение', 'Понедельник', 'Вторник',  'Среда',     'Четверг',    'Пятница', 'Суббота']
        },
        shortWeekDays: {
            "en": ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
            "de": ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"],
            "ru": ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб']
        },
        currentText: {
            "en": 'Now',
            "de": 'Jetzt',
            "ru": 'Сейчас'
        },
        closeText: {
            "en": 'Close',
            "de": 'Schließen',
            "ru": 'Закрыть'
        },
        timeText: {
            "en": 'Time',
            "de": 'Zeit',
            "ru": 'Время'
        },
        hourText: {
            "en": 'Hour',
            "de": 'Std',
            "ru": 'Час'
        },
        minuteText: {
            "en": 'Min',
            "de": 'Min',
            "ru": 'Мин'
        },
        secondText: {
            "en": 'Sec',
            "de": 'Sek',
            "ru": 'Сек'
        },
        timeOnlyTitle: {
            "en": 'Choose Time',
            "de": 'Zeit auswählen',
            "ru": 'Установите время'
        },
        activeHelper: function ($this, val, min, max, value, reverse) {
            if (val === true  || val === 'true')  val = max;
            if (val === false || val === 'false') val = min;

            if (max === undefined || max === '' || max === null) {
                max = 1;
                min = 0;
                val = (val === 'false' || val === false || val === 0 || val === '0' || val === '' || val === null || val === undefined) ? min : max;
            }

            if (reverse) {
                if (val == max) {
                    val = min;
                } else {
                    val = max;
                }
            }

            if (value === undefined && val > min && val !== true) {
                val = parseFloat(val) || 0;
            }

            if ((value === undefined && val > min) || (value !== undefined && val == value)) {
                $this.addClass('ui-state-active');
            } else {
                $this.removeClass('ui-state-active');
            }
        },
        active: function (el, reverse, _value) {
            var $this = $(el);
            var oid = $this.data('oid');
            var max = $this.data('max') || 1;
            var min = $this.data('min') || 0;

            function onChange(e, newVal) {
                vis.binds.jqueryui.activeHelper($this, newVal, min, max, _value, reverse);
            }

            if (oid) {
                // remember all ids, that bound
                $this.parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                vis.states.bind(oid + '.val', onChange);
                vis.binds.jqueryui.activeHelper($this, vis.states.attr(oid + '.val'), min, max, _value, reverse);
            }
        },
        classes: function (el, reverse, _value) {
            var $this = $(el);
            if (!$this.data('no-style')) {
                $this.hover(function () {
                    $this.addClass('ui-state-hover');
                }, function () {
                    $this.removeClass('ui-state-hover');
                });
            } else {
                $this.removeClass('ui-widget ui-corner-all ui-state-default');
            }

            $this.css({position: 'absolute'});
            vis.binds.jqueryui.active(el, reverse, _value);
        },
        dialog: function (el, options, persistent, preload, html, closeOnClick) {
            var $dlg = $(el).parent().find('div.vis-widget-dialog');
            $dlg.data('preload', (!preload || preload === 'false') && !$dlg.html().replace(/\s/g, ''));
            $('[aria-describedby="' + $dlg.attr('id') + '"]').remove();

            options.width     = options.width  || options.dialog_width;
            options.height    = options.height || options.dialog_height;
            options.top       = options.top    || options.dialog_top;
            options.left      = options.left   || options.dialog_left;
            options.minHeight = options.height;
            options.minWidth  = options.width;

            // Show dialog in edit mode too
            if (1 || !vis.editMode) {
                $(el).parent().find('div.vis-widget-body').on('click touchend', function (event) {
                    event.stopPropagation();
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    if ($dlg.data('preload')) $dlg.html(html);

                    if (persistent) {
                        if (options.setId) {
                            vis.setValue(options.setId, options.setValue);
                        }
                        $dlg.dialog('open');
                        $dlg.parent().css('z-index', 998);
                        $dlg.parent().find('.ui-widget-header button .ui-button-text').html('');
                        if (options.minHeight)   $dlg.css('min-height', options.minHeight);
                        if (options.minWidth)    $dlg.css('min-width', options.minWidth);
                        if (options.top  || options.top  === 0 || options.top  === '0') $dlg.parent().css('top',  options.top);
                        if (options.left || options.left === 0 || options.left === '0') $dlg.parent().css('left', options.left);
                        if (options.overflowX) $dlg.css('overflow-x', options.overflowX);
                        if (options.overflowY) $dlg.css('overflow-y', options.overflowY);
                        if (options.noHeader) {
                            $dlg.parent().find('.ui-dialog-titlebar').css({background: 'rgba(0,0,0,0)', border: 0, color: 'rgba(0,0,0,0)'});
                            $dlg.parent().find('.ui-dialog-title').html('&nbsp;');
                        }
                        $dlg.parent().find('.ui-state-focus').blur();
                    } else {
                        $dlg.dialog($.extend({
                            autoOpen: true,
                            open: function () {
                                $(this).parent().find('.ui-widget-header button .ui-button-text').html('');
                                if (options.setId) vis.setValue(options.setId, options.setValue);
                                $(this).parent().css('z-index', 998);
                                if (options.minHeight)   $(this).css('min-height', options.minHeight);
                                if (options.minWidth)    $(this).css('min-width', options.minWidth);
                                if (options.top  || options.top  === 0 || options.top  === '0') $(this).parent().css('top',  options.top);
                                if (options.left || options.left === 0 || options.left === '0') $(this).parent().css('left', options.left);
                                if (options.overflowX) $(this).css('overflow-x', options.overflowX);
                                if (options.overflowY) $(this).css('overflow-y', options.overflowY);
                                if (options.noHeader) {
                                    $dlg.parent().find('.ui-dialog-titlebar').css({background: 'rgba(0,0,0,0)', border: 0, color: 'rgba(0,0,0,0)'});
                                    $dlg.parent().find('.ui-dialog-title').html('&nbsp;');
                                }
                                $(this).parent().find('.ui-state-focus').blur();
                                //touchscreen fix
                                var $closeButton = $(this).parent().find('button.ui-dialog-titlebar-close');
                                $closeButton.off('touchend').on('touchend', function (event) {
                                    event.stopPropagation();
                                    $dlg.dialog('close');
                                    return false;
                                });
                            },
                            close: function () {
                                if ($dlg.data('timer')) { clearTimeout($dlg.data('timer')); $dlg.data('timer', null)};
                                $dlg.dialog('destroy');
                                // Destroy content if not preloaded
                                if ($dlg.data('preload')) $dlg.html('');
                            }
                        }, options));

                        $dlg.data('inited', true);

                        if (closeOnClick) {
                            $dlg.off('click touchstart touchend').on('click touchend', function (event) {
                                event.stopPropagation();
                                $dlg.dialog('close');
                                return false;
                            });
                        }
                    }
                    return false;
                });
            }
            if (persistent) {
                $dlg.dialog($.extend({
                    autoOpen: false,
                    open: function () {
                        $dlg.parent().css({'z-index': 1000});
                        if ($dlg.data('preload')) $dlg.html(html);
                        //touchscreen fix
                        var $closeButton = $(this).parent().find('button.ui-dialog-titlebar-close');
                        $closeButton.off('touchend').on('touchend', function (event) {
                            event.stopPropagation();
                            $dlg.dialog('close');
                            return false;
                        });
                    },
                    close: function () {
                        if ($dlg.data('timer')) {
                            clearTimeout($dlg.data('timer'));
                            $dlg.data('timer', null);
                        }
                        // Destroy content if not preloaded
                        if ($dlg.data('preload')) $dlg.html('');
                    }
                }, options));

                $dlg.data('inited', true);

                if (closeOnClick) {
                    $dlg.off('click touchstart touchend').on('click touchend', function (event) {
                        event.stopPropagation();
                        $dlg.dialog('close');
                        return false;
                    });
                }
            }
        },
        dialogContainer: function (el, options, persistent, preload) {
            var $dlg = $(el).parent().find('div.vis-widget-dialog');

            var id = $(el).parent().attr('id');
            if (id && id.match(/_removed$/)) {
                return;
            }

            if (!$dlg.length) {
                setTimeout(function () {
                    vis.binds.jqueryui.dialogContainer(el, options, persistent, preload);
                }, 200);
                return;
            }

            options.width     = options.dialog_width;
            options.height    = options.dialog_height;
            options.top       = options.dialog_top;
            options.left      = options.dialog_left;
            options.minHeight = options.height;
            options.minWidth  = options.width;

            $dlg.dialog($.extend({
                autoOpen: false,
                open: function () {
                    $(this).parent().find('.ui-widget-header button .ui-button-text').html('');
                    $(this).parent().css('z-index', 998);
                    //touchscreen fix
                    $dlg.find('.vis-view-container').each(function () {
                        var cview = $(this).attr('data-vis-contains');
                        if (!vis.views[cview]) {
                            $(this).append('error: view not found.');
                            return false;
                        } else if (cview === vis.activeView) {
                            $(this).append('error: view container recursion.');
                            return false;
                        }
                        var $this = this;
                        vis.renderView(cview, cview, false, function (_view) {
                            $('#visview_' + _view)
                                    .appendTo($this)
                                    .show();
                        });
                    });

                    if (options.setId) vis.setValue(options.setId, options.setValue);
                    var $id =  $(this);
                    if (options.minHeight)   $id.css('min-height', options.minHeight);
                    if (options.minWidth)    $id.css('min-width',  options.minWidth);
                    if (options.top  || options.top  === 0 || options.top  === '0') $id.parent().css('top',  options.top);
                    if (options.left || options.left === 0 || options.left === '0') $id.parent().css('left', options.left);
                    if (options.overflowX) $id.css('overflow-x', options.overflowX);
                    if (options.overflowY) $id.css('overflow-y', options.overflowY);
                    if (options.noHeader) {
                        $id.parent().find('.ui-dialog-titlebar').css({background: 'rgba(0,0,0,0)', border: 0, color: 'rgba(0,0,0,0)'});
                        $id.parent().find('.ui-dialog-title').html('&nbsp;');
                    }
                    $id.parent().find('.ui-state-focus').blur();

                    var $closeButton = $(this).parent().find('button.ui-dialog-titlebar-close');
                    $closeButton.off('touchend').on('touchend', function (event) {
                        event.stopPropagation();
                        $dlg.dialog('close');
                        var $view = $dlg.find('.vis-view');
                        if (!$view.data('persistent')) {
                            vis.destroyView($view.data('view'), $view.data('view'));
                        }
                        return false;
                    });
                },
                close: function () {
                    if ($dlg.data('timer')) {
                        clearTimeout($dlg.data('timer'));
                        $dlg.data('timer', null);
                    }
                    vis.destroyUnusedViews();
                }
            }, options));

            if (persistent) $dlg.find('.vis-view-container').data('persistent', persistent);

            if (!vis.editMode) {
                $(el).parent().find('div.vis-widget-body').on('click touchend', function (event) {
                    event.stopPropagation();
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    var $id =  $('#' + $(this).parent().attr('id') + '_dialog');
                    $id.dialog('open');
                    return false;
                });
            } else {
                $(el).parent().find('div.vis-widget-body').show();
            }
        },
        dialogAutoClose: function (el, timeout) {
            if (timeout === true || timeout === 'true') timeout = 10000;
            if (timeout === null || timeout === undefined || timeout === '') return;
            timeout = parseInt(timeout, 10);
            if (timeout < 60) {
                // may be this is seconds
                timeout *= 1000;
            }
            if (!timeout) timeout = 1000;

            var $dialog = $('#' + $(el).parent().attr('id') + '_dialog');

            var id = $(el).parent().attr('id');
            if (id && id.match(/_removed$/)) {
                return;
            }

            if (!$dialog.length) {
                setTimeout(function () {
                    vis.binds.jqueryui.dialogAutoClose(el, timeout);
                }, 200);
                return;
            }

            $dialog.on('dialogopen', function () {
                $dialog.find('input').on('click', function () {
                    var timer = $dialog.data('timer');
                    if (timer) clearTimeout(timer);
                    $dialog.data('timer', setTimeout(function () {
                        $dialog.data('timer', null);
                        $dialog.dialog('close');
                    }, timeout));
                });
                $dialog.data('timer', setTimeout(function () {
                    $dialog.data('timer', null);
                    $dialog.dialog('close');
                }, timeout));
            });
        },
        dialogClose: function (el, options) {
            if (!$(el).data('no-style')) {
                setTimeout(function () {
                    $(el).button({
                        icons: {
                            primary: options.iconClass ? 'ui-icon-' + options.iconClass : null
                        }
                    });
                }, 0);
            }
            $(el).click(function () {
                if (options.dlgName) {
                    $('#' + options.dlgName + '_dialog').dialog('close');
                } else {
                    var $parent = $(this).parent().parent().parent();
                    var $dlg = $parent.find('.vis-widget-dialog');
                    if ($dlg.length) {
                        $dlg.dialog('close');
                        return;
                    }
                    $parent = $parent.parent();
                    $dlg = $parent.find('.vis-widget-dialog');
                    if ($dlg.length) {
                        $dlg.dialog('close');
                        return;
                    }
                    $parent = $parent.parent();
                    $dlg = $parent.find('.vis-widget-dialog');
                    if ($dlg.length) {
                        $dlg.dialog('close');
                        return;
                    }
                    $parent = $parent.parent();
                    $dlg = $parent.find('.vis-widget-dialog');
                    if ($dlg.length) {
                        $dlg.dialog('close');
                        return;
                    }
                }
            });
        },
        input: function (el, options, asString) {
            var $this  = $(el);
            var oid    = $this.attr('data-oid');
            var digits = options;
            asString = asString === 'true' || asString === true;
            if (!$this.data('no-style')) {
                $this.button().addClass('ui-state-default');
            } else {
                $this.removeClass('ui-widget ui-corner-all ui-state-default');
            }
            $this.css({
                'font':       'inherit',
                //'color' :   'inherit',
                'text-align': 'left',
                'outline':    'none',
                'cursor':     'text',
                height:       '50%'
            }).change(function () {
                vis.setValue(oid, $(this).val());
            });

            function onChange(e, newVal) {
                if (!asString && digits && digits !== '') {
                    newVal = parseFloat(newVal).toFixed(digits);
                }

                $this.val(newVal);
            }
            var val = '';
            if (oid) {
                vis.states.bind(oid + '.val', onChange);
                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                val = vis.states[oid + '.val'];
                if (!asString && digits && digits !== '') {
                    val = parseFloat(vis.states[oid + '.val']).toFixed(digits);
                }
            }
            $this.val(val);
        },
        inputDate: function (el, options) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            var datepickerOptions = $.extend(true, {
                dateFormat:      'yy-mm-dd',
                monthNamesShort: vis.binds.jqueryui.shortMonths[vis.language],
                monthNames:      vis.binds.jqueryui.months[vis.language],
                dayNamesMin:     vis.binds.jqueryui.shortWeekDays[vis.language],
                showAnim:        'fadeIn',
                firstDay: 1,
                currentText:     vis.binds.jqueryui.currentText[vis.language],
                closeText:       vis.binds.jqueryui.closeText[vis.language]

            }, options);

            $this.addClass('ui-widget ui-button ui-corner-all ui-state-default')
                    .css({
                        font:       'inherit',
                        //'color' :   'inherit',
                        'text-align': 'left',
                        outline:    'none',
                        cursor:     'text',
                        height:     '95%'
                    });

            if (!vis.editMode) $this.datepicker(datepickerOptions);

            function onChange(e, newVal) {
                $this.val(newVal);
            }

            if (oid) {
                $this.change(function () {
                    vis.setValue(oid, $(this).val());
                });

                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                $this.val(vis.states.attr(oid + '.val'));
            }
        },
        inputDatetime: function (el, options) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            var timeFormat = options.showSecond ? 'HH:mm:ss' : 'HH:mm';
            var hourGrid = options.showGrid ? 6 : 0;
            var minuteGrid = options.showGrid ? options.stepMinute : 0;
            if (minuteGrid < 10) {minuteGrid = 10;}
            var secondGrid = options.showGrid ? 15 : 0;
            var timepickerOptions = $.extend(true, {
                dateFormat:      'yy-mm-dd',
                monthNamesShort: vis.binds.jqueryui.shortMonths[vis.language],
                monthNames:      vis.binds.jqueryui.months[vis.language],
                dayNamesMin:     vis.binds.jqueryui.shortWeekDays[vis.language],
                showAnim:        'fadeIn',
                firstDay:        1,
                timeText:        vis.binds.jqueryui.timeText[vis.language],
                hourText:        vis.binds.jqueryui.hourText[vis.language],
                minuteText:      vis.binds.jqueryui.minuteText[vis.language],
                secondText:      vis.binds.jqueryui.secondText[vis.language],
                currentText:     vis.binds.jqueryui.currentText[vis.language],
                closeText:       vis.binds.jqueryui.closeText[vis.language],
                timeOnlyTitle:   vis.binds.jqueryui.timeOnlyTitle[vis.language],
                minuteGrid:      minuteGrid,
                hourGrid:        hourGrid,
                secondGrid:      secondGrid,
                timeOnly:        false,
                showSecond:      true,
                timeFormat:      timeFormat,
                pickerTimeFormat: timeFormat
            }, options);
            $this.addClass('ui-state-default')
                    .css({
                        font:       'inherit',
                        //color:    'inherit',
                        'text-align': 'left',
                        outline:    'none',
                        cursor:     'text',
                        height:     '95%'
                    });
            // Store options
            $this[0].__options = options;

            if (!vis.editMode) {
                $this.datetimepicker(timepickerOptions).button();
            } else {
                $this.addClass('ui-widget ui-button ui-corner-all');
            }


            function onChange(e, newVal) {
                $this.val(newVal);
            }

            if (oid) {
                $this.change(function () {
                    var $this = $(this);
                    var val = $this.val();
                    /*if ($this[0].__options && !$this[0].__options.showSecond) {
                     var vals = val.split(':');
                     if (vals.length === 3) {
                     val = vals[0] + ":" + vals[1];
                     }
                     }*/
                    vis.setValue(oid, val);
                });
                vis.states.bind(oid + '.val', onChange);
                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                $this.val(vis.states.attr(oid + '.val'));
            }
        },
        inputset: function (el, options, asString) {
            var digits    = options;
            var $this     = $(el);
            var input     = '#' + $this.attr('id').slice(0, -3) + 'input';
            var noJsStyle = $(el).data('no-style');
            var oid = $this.attr('data-oid');
            asString = asString === 'true' || asString === true;
            if (!noJsStyle) $this.button();

            $this.css({'padding-left': 5, 'padding-right': 5});

            if (!vis.editMode) {
                $this.on('click touchstart', function () {
                    // Protect against two events
                    if (vis.detectBounce(this)) return;

                    vis.setValue(oid, $(input).val());
                });

                // send text on enter
                setTimeout(function () {
                    $(input).keydown(function (e) {
                        if (e.keyCode === 13) vis.setValue(oid, $(this).val());
                    });
                }, 100);
            }

            if (!noJsStyle) $this.prev().button();

            $this.prev().addClass('ui-state-default')
                    .css({
                        font:            'inherit',
                        'padding-left':  5,
                        'padding-right': 5,
                        //'color' :   'inherit',
                        'text-align':   'left',
                        outline:        'none',
                        cursor:         'text',
                        height:         '95%'
                    });

            function onChange(e, newVal) {
                if (!asString && digits && digits !== '') {
                    newVal = parseFloat(newVal).toFixed(digits);
                }
                $(input).val(newVal);
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);
                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                var newVal = vis.states[oid + '.val'];
                if (!asString && digits && digits !== '') newVal = parseFloat(newVal).toFixed(digits);
                $(input).val(newVal);
            }
        },
        multiselect: function (el, options, isOpen) {
            var $this = $(el);
            var oid = $this.attr('data-oid');
            var noJsStyle = $this.attr('data-no-style');
            if (oid) $this.val(vis.states[oid + '.val']);

            if (noJsStyle !== true && noJsStyle !== 'true') {
                $this.multiselect($.extend({
                    minWidth:         $this.parent().parent().width() - 7,
                    multiple:         false,
                    header:           false,
                    noneSelectedText: false,
                    selectedList:     1
                }, options)).change(function () {
                    var val = $this.val();
                    if (parseFloat(val).toString() == val) val = parseFloat(val);
                    if (val === 'true')  val = true;
                    if (val === 'false') val = false;
                    if (!vis.editMode) vis.setValue(oid, val);
                });
            } else {
                $this.change(function () {
                    var val = $this.val();
                    if (parseFloat(val).toString() == val) val = parseFloat(val);
                    if (val === 'true') val = true;
                    if (val === 'false') val = false;
                    if (!vis.editMode) vis.setValue(oid, val);
                });
            }

            $this.val(vis.states[oid + '.val']);
            $this.prop('disabled', vis.editMode);
            if (noJsStyle !== true && noJsStyle !== 'true') {
                $this.multiselect('refresh');
            }
            var id =  $this.attr('id');

            function onChange(e, newVal) {
                var $select = $('#' + id);
                $select.val(newVal);
                if (noJsStyle !== true && noJsStyle !== 'true') {
                    $select.multiselect('refresh');
                }
            }

            if (oid) {
                vis.states.bind(oid + '.val', onChange);
                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);
            }

            if (vis.editMode) {
                if (noJsStyle !== true && noJsStyle !== 'true' && isOpen) {
                    $this.multiselect('open');
                }

                vis.bindWidgetClick($this.attr('data-view'), $this.attr('id').replace('_multiselect', ''));
                $this.parent().parent().resize(function () {
                    if (noJsStyle !== true && noJsStyle !== 'true') {
                        $('#' + id).multiselect('option', 'minWidth', $(this).width() - 7);
                    }
                }).data('destroy', function (id, $widget) {
                    $widget.off('resize');
                });
            }
        },
        slider: function (el, options) {
            var $this       = $(el);
            var oid         = $this.attr('data-oid');
            var oid2        = $this.attr('data-oid2');
            var oid_val     = 0;
            var oid2_val    = 0;
            var wid         = $this.attr('data-oid-working');
            var wid2        = $this.attr('data-oid2-working');

            var settings    = $.extend({
                range:  !!oid2,
                min:    0,
                max:    100,
                step:   1,
                value:  parseFloat(vis.states.attr(oid + '.val')),
                slide:  function (e, ui) {
                    if (options.submitmethod !== 'stop') {
                      // Slider -> Observable
                      if (oid2) {
                        if (options.inverted) {
                          ui.values[0] = (settings.max - ui.values[0]) + settings.min;
                          ui.values[1] = (settings.max - ui.values[1]) + settings.min;
                        }

                        oid && vis.setValue(oid, ui.values[0]); //.toFixed(6));
                        vis.setValue(oid2, ui.values[1]); //.toFixed(6));
                      } else if (oid) {
                        if (options.inverted) ui.value = (settings.max - ui.value) + settings.min;
                        vis.setValue(oid, ui.value); //.toFixed(6));
                      }
                    }

                },
                stop: function (e, ui) {
                  if (options.submitmethod === 'stop') {
                    if (oid2) {
                      if (options.inverted) {
                        ui.values[0] = (settings.max - ui.values[0]) + settings.min;
                        ui.values[1] = (settings.max - ui.values[1]) + settings.min;
                      }

                      oid && vis.setValue(oid, ui.values[0]); //.toFixed(6));
                      vis.setValue(oid2, ui.values[1]); //.toFixed(6));
                    } else if (oid) {
                      if (options.inverted) ui.value = (settings.max - ui.value) + settings.min;
                      vis.setValue(oid, ui.value); //.toFixed(6));
                    }
                  }
                }
            }, options);

            settings.inverted = (settings.inverted === 'true' || settings.inverted === true);

            if (isNaN(settings.value)) settings.value = 0;
            if (isNaN(settings.min))   settings.min = 0;
            if (isNaN(settings.max))   settings.max = 100;
            if (isNaN(settings.step))  settings.step = (settings.max - settings.min) / 100;

            settings.min = parseFloat(settings.min);
            settings.max = parseFloat(settings.max);
            settings.value = parseFloat(settings.value);

            if (settings.inverted) settings.value = (settings.max - settings.value) + settings.min;

            $this.slider(settings);

            function onChange(e, newVal) {
                // console.log('slider newVal=' + JSON.stringify(newVal));
                // If device not in working state
                if (e.type === oid + '.val') {
                    if (!vis.states.attr(wid + '.val')) {
                        if (settings.inverted) {
                            oid_val = (settings.max - parseFloat(newVal)) + settings.min;
                        } else {
                            oid_val = parseFloat(newVal);
                        }
                        if ($this.slider('instance')) {
                            if (oid2) {
                                $this.slider('values', [oid_val, oid2_val]);
                            } else {
                                $this.slider('value', oid_val);
                            }
                        }
                    }
                } else if (e.type === oid2 + '.val'){
                    // console.log('slider newVal=' + JSON.stringify(newVal));
                    // If device not in working state
                    if (!vis.states.attr(wid2 + '.val')) {
                        oid2_val = parseFloat(newVal);
                        if (settings.inverted) {
                            oid2_val = (settings.max - parseFloat(newVal)) + settings.min;
                        } else {
                            oid2_val = parseFloat(newVal);
                        }
                        if ($this.slider('instance')) {
                            $this.slider('values', [oid_val, oid2_val]);
                        }
                    }
                }
            }
            var bound = [];
            if (oid) {
                vis.states.bind(oid + '.val', onChange);
                bound.push(oid + '.val');
            }

            if (oid2) {
                vis.states.bind(oid2 + '.val', onChange);
                bound.push(oid2 + '.val');

                oid_val  = vis.states.attr(oid + '.val');
                oid2_val = vis.states.attr(oid2 + '.val');

                if (settings.inverted) {
                    oid_val  = (settings.max - oid_val)  + settings.min;
                    oid2_val = (settings.max - oid2_val) + settings.min;
                }
                $this.slider('values', [oid_val, oid2_val]);
            }

            if (bound.length) {
                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', bound)
                    // remember bind handler
                    .data('bindHandler', onChange);
            }
        },
        button: function (el, value) {
            if ($(el).data('no-style')) return;

            setTimeout(function () {
                $(el).button();
            }, 0);
        },
        buttonDialog: function (el) {
            if ($(el).data('no-style')) return;
            setTimeout(function () {
                $(el).button();
            }, 0);
        },
        buttonLink: function (el, href) {
            if (!$(el).data('no-style')) {
                setTimeout(function () {
                    $(el).button();
                }, 0);
            }
            $(el).click(function () {
                if (!vis.editMode && href) window.location.href = href;
            });
        },
        buttonLinkBlank: function (el, href) {
            if (!$(el).data('no-style')) {
                setTimeout(function () {
                    $(el).button();
                }, 0);
            }
            $(el).click(function () {
                if (!vis.editMode && href) window.open(href);
            });
        },
        radio: function (el, options, process) {
            var $this    = $(el);
            var id = $this.parent().parent().attr('id');
            if (id && id.match(/_removed$/)) {
                return;
            }

            if (!process) {
                setTimeout(function () {
                    vis.binds.jqueryui.radio(el, process, true);
                }, 50);
                return;
            }
            var settings = $.extend({}, options);
            var oid      = $this.attr('data-oid');

            function onChange(e, newVal) {
                $this.find('input').removeAttr('checked');
                if (newVal === true || newVal === 'true') {
                    newVal = 1;
                } else
                if (newVal === false || newVal === 'false') {
                    newVal = 0;
                }
                $this.find('input').prop('checked', false);
                $this.find('input[value="' + newVal + '"]').prop('checked', true);
                $this.find('input').each(function () {
                    if ($(this).button('instance')) $(this).button('refresh');
                });
            }

            // Observable -> Buttonset
            if (oid) {
                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $this.parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);

                var val = vis.states.attr(oid + '.val');

                if (val === true  || val === 'true')  {
                    val = 1;
                }
                if (val === false || val === 'false') {
                    val = 0;
                }

                setTimeout(function () {
                    //console.log(val + ' ' + $this.find('input[value="' + val + '"]').length);
                    $this.find('input').prop('checked', false);
                    $this.find('input[value="' + val + '"]').prop('checked', true);
                    $this.buttonset(settings);

                    $this.find('input').each(function () {
                        if ($this.button('instance')) {
                            $(this).button('refresh');
                        }
                    });

                    if (!vis.editMode) {
                        // Buttonset -> Observable
                        $this.find('input').on('click touchstart', function () {
                            // Protect against two events
                            if (vis.detectBounce(this)) return;

                            var val = $(this).val();
                            var f = parseFloat(val);
                            if (f.toString() === val.toString()) {
                                vis.setValue(oid, f);
                            } else {
                                vis.setValue(oid, val);
                            }
                        });
                    }
                }, 50);
            }

        },
        iconHttpGet: function (el, url) {
            if (vis.editMode) return;

            var $this = $(el).parent();
            $this.on('click touchstart', function (e) {
                // Protect against two events
                if (vis.detectBounce(this)) return;

                vis.conn.httpGet(url);
                e.preventDefault();
            });
        },
        hueColormode: function (el, oid) {
            var $hue = $(el).parent().find('.hue-mode-hue');
            var $ct  = $(el).parent().find('.hue-mode-ct');

            function onChange(e, newVal) {
                if (newVal === 'ct') {
                    $hue.hide();
                    $ct.show();
                } else {
                    $ct.hide();
                    $hue.show();
                }
            }

            if (oid) {
                if (vis.states.attr(oid + '.val') === 'ct') {
                    $hue.hide();
                    $ct.show();
                } else {
                    $ct.hide();
                    $hue.show();
                }
                vis.states.bind(oid + '.val', onChange);

                // remember all ids, that bound
                $(el).parent().parent()
                    .data('bound', [oid + '.val'])
                    // remember bind handler
                    .data('bindHandler', onChange);
            } else {
                $ct.hide();
                $hue.show();
            }
        },
        _disable: function () {
            $('.vis-view-container').find('.ui-slider').each(function () {
                if ($(this).slider('instance')) {
                    $(this).slider('disable').removeClass('ui-state-disabled');
                }
            });

            setTimeout(function () {
                $('.vis-view-container').find('select[id$="_multiselect"]').each(function () {
                    if ($(this).css('display') === 'none') {
                        $(this).multiselect('disable').next().removeClass('ui-state-disabled').unbind('click touchstart', false);
                    }
                });
            }, 200);

            setTimeout(function () {
                $('.vis-view-container').find('a[href]').each(function () {
                    $(this).on('click touchstart', function (e) {});
                });
            }, 200);
        },
        itoggle: function (el) {
            var $this = $(el).parent();
            var oid = $this.parent().attr('data-oid');
            if (oid) {
                oid += '.val';
            }
            var val = vis.states.attr(oid);
            var activeVal = $this.parent().data('val');
            if (activeVal === '' || activeVal === undefined) activeVal = null;

            if (activeVal !== null) {
                if (val === null || val === undefined) val = '';
                if (activeVal.toString() === val.toString()) {
                    $this.find('.imgToggleFalse').hide();
                    $this.find('.imgToggleTrue').show();
                }
            } else {
                if (val === 'false') val = false;
                if (val === 'true')  val = true;

                if (typeof val === 'string') {
                    var f = parseFloat(val);
                    if (f == val) {
                        val = f;
                    } else {
                        val = val !== '';
                    }
                }
                if (val > 0) {
                    $this.find('.imgToggleFalse').hide();
                    $this.find('.imgToggleTrue').show();
                }
            }

            function onChange (e, val) {
                if (activeVal !== null) {
                    if (activeVal.toString() === val.toString()) {
                        $this.find('.imgToggleFalse').hide();
                        $this.find('.imgToggleTrue').show();
                    } else {
                        $this.find('.imgToggleTrue').hide();
                        $this.find('.imgToggleFalse').show();
                    }
                } else {
                    if (val === true || val === 'true' || parseFloat(val) > 0) {
                        $this.find('.imgToggleFalse').hide();
                        $this.find('.imgToggleTrue').show();
                    } else {
                        $this.find('.imgToggleTrue').hide();
                        $this.find('.imgToggleFalse').show();
                    }
                }
            }
            if (oid) {
                vis.states.bind(oid, onChange);
                    // remember all ids, that bound
                $this.parent()
                    .data('bound', [oid])
                    // remember bind handler
                    .data('bindHandler', onChange);
            }
        },
        calcValue: function (value, min, max) {
            if (!min) min = 0;
            if (max === null || max === undefined || max === '') max = 100;
            min   = parseFloat(min);
            max   = parseFloat(max);
            value = parseFloat(value);
            return min + value * (max - min);
        },
        calcImage: function (val, min, max, invert) {
            max = (max !== undefined) ? max : 100;
            min = (min !== undefined) ? min : 0;

            val = parseFloat(val);
            if (invert) val = max - val + min;
            var image = '';
            if (val >= max) {
                image = 10;
            } else if (val >= min + (max - min) * 0.9) {
                image = 9;
            } else if (val >= min + (max - min) * 0.8) {
                image = 8;
            } else if (val >= min + (max - min) * 0.7) {
                image = 7;
            } else if (val >= min + (max - min) * 0.6) {
                image = 6;
            } else if (val >= min + (max - min) * 0.5) {
                image = 5;
            } else if (val >= min + (max - min) * 0.4) {
                image = 4;
            } else if (val >= min + (max - min) * 0.3) {
                image = 3;
            } else if (val >= min + (max - min) * 0.2) {
                image = 2;
            } else if (val >= min + (max - min) * 0.1) {
                image = 1;
            } else {
                image = 0;
            }
            return image;
        },
        setSvgColor: function (el, color) {
            setTimeout(function () {
                el.parent().find('svg').remove();
                var $that = el;
                var imgURL = $that.attr('src');
                $.get(imgURL, function (data) {
                    // Get the SVG tag, ignore the rest
                    var $svg = $(data).find('svg');

                    // Remove any invalid XML tags as per http://validator.w3.org
                    $svg = $svg.removeAttr('xmlns:a');
                    $svg = $svg.attr('width',  '100%');
                    $svg = $svg.attr('height', '100%');
                    $svg.find('*').each(function () {
                        var style = $(this).attr('style');
                        if (style) {
                            style = style.replace(/#FFFFFF/g, color);
                            $(this).attr('style', style);
                        }
                    });

                    // Replace image with new SVG
                    $that.replaceWith($svg);
                }, 'xml');
            }, 0);
        },
        navigationPw: function (el, data) {
            var $this = $(el);
            if (!$this.data('no-style')) {
                setTimeout(function () {
                    $($this).button();
                }, 100);
            }

            $($this).click(function () {
                $('body').append('<div id="NavPwDialog" style="text-align: center"><input  type="password"  id="inp_NavPw"><input style="width: 100px; margin-top: 20px" id="btn_navPwOk" value="' + _('Ok') + '"><input id="btn_navPwcancel" value="' + _('Cancel') + '" style="width: 100px; margin-top: 20px"></div>');

                $('#inp_NavPw').change(function () {
                    check_pw();
                });
                $('#btn_navPwOk').button().click(function () {
                    check_pw();
                });

                function check_pw() {
                    var $inputPass = $('#inp_NavPw');
                    if (data._data.Password === $inputPass.val()) {
                        $('#NavPwDialog').remove();
                        vis.changeView(data.attr('nav_view'), data.attr('nav_view'), {
                                    effect: data.attr('hide_effect'),
                                    options: {},
                                    duration: data.attr('hide_duration')
                                }, {
                                    effect: data.attr('show_effect'),
                                    options: {},
                                    duration: data.attr('show_duration')
                                },
                                data.attr('sync'));
                    } else {
                        $inputPass.val('');
                        var bg = $inputPass.data('bg');
                        if (!bg) {
                            bg = $inputPass.css('background-color');
                            $inputPass.data('bg', bg);
                        }
                        $inputPass.css('background-color', '#FF0000').animate({'background-color': bg}, 500);
                    }
                }

                $('#btn_navPwcancel').button().click(function () {
                    $('#NavPwDialog').remove();
                });

                $('#NavPwDialog').dialog({
                    title: _('Password'),
                    modal: true
                });
            })
        }
    };
</script>

<script id="tplJquiButtonLink"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonLink" style=" position: relative; text-align: initial;"><div class="vis-widget_prev ui-selectee ui-selected" style="height: 30px"> <div class="vis-widget-prev-body"> <input type="button" value=" Button " class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="static"
        data-vis-name="Button Link"
        data-vis-attrs="buttontext[Text];href;html_prepend/html;html_append/html;padding[5]/slider,0,100,1;no_style/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" >
            <%== this.data.attr('html_prepend') %>
            <button style="width: 100%; height: 100%" data-no-style="<%= this.data.attr('no_style') %>" data-vis-link="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.buttonLink(el, data.attr('href')); %> style="padding: <%= this.data.attr('padding') %>px"><%== this.data.attr('buttontext') %></button>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplJquiButtonLinkBlank"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonLinkBlank" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div  style="height: 30px" class="vis-widget_prev ui-selectee ui-selected ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":"e"}"> <div class="vis-widget-prev-body"> <input type="button" value=" Link " data-vis-link="" class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="static"
        data-vis-name="Button Link _blank"
        data-vis-attrs="buttontext[Text];href;html_prepend/html;html_append/html;padding[5]/slider,0,100,1;no_style/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body" >
            <%== this.data.attr('html_prepend') %>
            <button style="width: 100%; height: 100%" data-no-style="<%= this.data.attr('no_style') %>" data-vis-link="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.buttonLinkBlank(el, data.attr('href')); %> style="padding: <%= this.data.attr('padding') %>px"><%== this.data.attr('buttontext') %></button>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplIconLink"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplIconLink" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default " style="width: 119px; height: 30px;"> <div class="vis-widget-prev-body"> <a class="widget-link" href="" target="" style="white-space:no-wrap; text-decoration: none; text-align: left; width:100%;height:100%;"> <img src="widgets/jqui/img/internet-web-browser-2.png" style=" vertical-align: middle; height: 100%;" alt=""> Icon link </a> </div> </div></div>'
        data-vis-type="static"
        data-vis-name="Icon link"
        data-vis-attrs="src/image;imageHeight/slider,0,200,1;href;target/auto,,_blank,_self,_parent,_top;alt;text;invert_icon/checkbox">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 32px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div class="vis-widget-body">
            <a class="widget-link" href="<%== this.data.attr('href') %>" target="<%== this.data.attr('target') %>" style="white-space:no-wrap; text-decoration: none; text-align: left; width:100%; height:100%;">
                <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" />
                <%== this.data.attr('text') %>
            </a>
        </div>
    </div>
</script>

<script id="tplIconHttpGet"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplIconHttpGet" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default " style="width: 97px; height: 38px; " > <div class="vis-widget-prev-body"> <a class="widget-link" style="white-space:no-wrap; text-decoration:none;text-align:left;width:100%;height:100%;"><img style="vertical-align:middle;height:100%;">URL GET</a></div></div></div>'
        data-vis-type="static"
        data-vis-name="Icon HTTP GET"
        data-vis-attrs="url;src/image;imageHeight/slider,0,200,1;alt;text">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
    styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %>
            <div <%= (el) -> vis.binds.jqueryui.iconHttpGet(el, data.attr('url')) %> />
        </div>
    </div>
</script>

<script id="tplJquiDialog"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-type="static,dialog"
        data-vis-prev='<img src="widgets/jqui/img/Prev_JquiDialog.png"></img>'
        data-vis-name="HTML - Dialog"
        data-vis-attrs="html/text;setId/id;setValue;"
        data-vis-attrs0="group.dialog;html_dialog/text;title;noHeader/checkbox;autoclose/slider,0,30000,100;modal/checkbox;dialog_width;dialog_height;persistent/checkbox;preload/checkbox;closeOnClick/checkbox;dialog_top;dialog_left;overflowX/nselect,,visible,hidden,scroll,auto,initial,inherit;overflowY/nselect,,visible,hidden,scroll,auto,initial,inherit">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; border: 1px solid #000; background: #fff; cursor: pointer" id="<%= this.data.attr('wid') %>" data-no-style="<%= this.data.attr('no_style') %>" >
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <%== this.data.attr('html') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <%== this.data.attr('preload') ? this.data.attr('html_dialog') : '' %>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialog(el, data, data.attr('persistent'), data.attr('preload'), data.attr('html_dialog'), data.attr('closeOnClick')) %> />
    </div>
</script>

<script id="tplJquiIconDialog"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<img src="widgets/jqui/img/Prev_JquiIconDialog.png"></img>'
        data-vis-type="static,dialog"
        data-vis-name="Icon - Dialog"
        data-vis-attrs="src/image;imageHeight/slider,0,200,1;alt;text;invert_icon/checkbox;setId/id;setValue;"
        data-vis-attrs0="group.dialog;html_dialog/text;title;noHeader/checkbox;autoclose/slider,0,30000,100;modal/checkbox;dialog_width;dialog_height;persistent/checkbox;preload/checkbox;closeOnClick/checkbox;dialog_top;dialog_left;overflowX/nselect,,visible,hidden,scroll,auto,initial,inherit;overflowY/nselect,,visible,hidden,scroll,auto,initial,inherit">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px; cursor: pointer" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <%== this.data.attr('preload') ? this.data.attr('html_dialog') : '' %>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialog(el, data, data.attr('persistent'), data.attr('preload'), data.attr('html_dialog'), data.attr('closeOnClick')) %> />
    </div>
</script>

<script id="tplContainerDialog"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<img src="widgets/jqui/img/Prev_ContainerDialog.png"></img>'
        data-vis-type="container,dialog"
        data-vis-name="container - HTML - view in jqui Dialog"
        data-vis-attrs="html/text;contains_view/views;setId/id;setValue;"
        data-vis-attrs0="group.dialog;title;noHeader/checkbox;autoclose/slider,0,30000,100;modal/checkbox;dialog_width;dialog_height;dialog_top;dialog_left;overflowX/nselect,,visible,hidden,scroll,auto,initial,inherit;overflowY/nselect,,visible,hidden,scroll,auto,initial,inherit">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 200px; height: 130px; border: 1px solid #000; background: #fff; cursor: pointer" id="<%= this.data.attr('wid') %>">
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <%== this.data.attr('html') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display: none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container"></div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, data) %> />
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogAutoClose(el, data.attr('autoclose')) %> />
    </div>
</script>

<script id="tplContainerDialogExternal"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-type="container,dialog"
        data-vis-prev='<img src="widgets/jqui/img/Prev_ContainerDialogExternal.png"></img>'
        data-vis-name="container - ext cmd - view in jqui Dialog"
        data-vis-attrs="html/text;contains_view/views;setId/id;setValue;"
        data-vis-attrs0="group.dialog;title;noHeader/checkbox;autoclose/slider,0,30000,100;modal/checkbox;dialog_width;dialog_height;dialog_top;dialog_left;overflowX/nselect,,visible,hidden,scroll,auto,initial,inherit;overflowY/nselect,,visible,hidden,scroll,auto,initial,inherit">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 194px; height: 68px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="display:none; width: 190px; height: 64px; background-color: #333; color: #eee; cursor: pointer; border: 2px dashed red; opacity:0.8;">
            <b>External Container Dialog</b><br/>
            view: <%= this.data.attr('contains_view') %><br/>
            id: <%= this.data.attr('wid') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container">
            </div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, data) %> />
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogAutoClose(el, data.attr('autoclose')) %> />
    </div>
</script>

<script id="tplContainerIconDialog"
        type="text/ejs"
        class="vis-tpl"
        data-vis-type="container,dialog"
        data-vis-set="jqui"
        data-vis-prev='<img src="widgets/jqui/img/Prev_ContainerIconDialog.png"></img>'
        data-vis-name="container - Icon - view in jqui Dialog"
        data-vis-attrs="src/image;imageHeight/slider,0,200,1;alt;text;setId/id;setValue;"
        data-vis-attrs0="group.dialog;contains_view/views;title;noHeader/checkbox;autoclose/slider,0,30000,100;modal/checkbox;dialog_width;dialog_height;invert_icon/checkbox;dialog_top;dialog_left;overflowX/nselect,,visible,hidden,scroll,auto,initial,inherit;overflowY/nselect,,visible,hidden,scroll,auto,initial,inherit">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>

    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 76px; height: 76px; cursor: pointer" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.jqueryui.classes(el) %>>
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container"></div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, data) %> />
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogAutoClose(el, data.attr('autoclose')) %> />
    </div>
</script>

<script id="tplContainerButtonDialog"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-type="container,dialog"
        data-vis-prev='<img src="widgets/jqui/img/Prev_ContainerButtonDialog.png"></img>'
        data-vis-name="container - Button - view in jqui Dialog"
        data-vis-attrs="html_prepend/text;html_append/text;buttontext[Text];setId/id;setValue;no_style/checkbox;"
        data-vis-attrs0="group.dialog;contains_view/views;title;noHeader/checkbox;autoclose/slider,0,30000,100;modal/checkbox;dialog_width;dialog_height;padding[5]/slider,0,100,1;dialog_top;dialog_left;overflowX/nselect,,visible,hidden,scroll,auto,initial,inherit;overflowY/nselect,,visible,hidden,scroll,auto,initial,inherit">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div id="<%= this.data.attr('wid') %>_body" class="vis-widget-body">
            <%== this.data.attr('html_prepend') %>
            <button id="<%= this.data.attr('wid') %>_button" name="<%= this.data.attr('wid') %>_button" data-no-style="<%= this.data.attr('no_style') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.buttonDialog(el); %> style="padding: <%= this.data.attr('padding') %>px"><%== this.data.attr('buttontext') %></button>
            <%== this.data.attr('html_append') %>
        </div>
        <div id="<%= this.data.attr('wid') %>_dialog" style="display:none" class="vis-widget-dialog" title="<%= this.data.attr('title') %>">
            <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container"></div>
        </div>
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogContainer(el, data) %> />
        <div class="popup-helper" <%= (el) -> vis.binds.jqueryui.dialogAutoClose(el, data.attr('autoclose')) %> />
    </div>
</script>

<script id="tplJquiButtonDialogClose"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonDialogClose" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div class="vis-widget_prev ui-selectee ui-draggable-handle "> <div class="vis-widget-prev-body"> <input type="button" value=" Dialog close " class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> '
        data-vis-set="jqui"
        data-vis-type="dialog"
        data-vis-name="Button dialog close"
        data-vis-attrs="html_prepend/text;html_append/text;buttontext[Close];iconClass[close];dlgName;hide_effect;hide_duration;show_effect;show_duration;no_style/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <%== this.data.attr('html_prepend') %>
            <button style="width:100%; height:100%" data-no-style="<%= this.data.attr('no_style') %>" <%= (el) -> vis.binds.jqueryui.dialogClose(el, {hideOptions: {effect: data.attr('hide_effect'), options:{}, duration: data.attr('hide_duration')}, iconClass: data.attr('iconClass'), dlgName: data.attr('dlgName')}) %>><%== this.data.attr('buttontext') %></button>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplJquiButtonNav"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonNav" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="left: 167px; top: 129px;" > <div class="vis-widget-prev-body"> <input type="button" value=" Nav Button " class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> '
        data-vis-set="jqui"
        data-vis-type="navigation"
        data-vis-name="Button"
        data-vis-attrs="html_prepend/text;html_append/text;buttontext[Text];nav_view;hide_effect;hide_duration;show_effect;show_duration;no_style/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <%== this.data.attr('html_prepend') %>
            <button style="width: 100%; height: 100%" data-no-style="<%= this.data.attr('no_style') %>" <%= (el) -> vis.binds.jqueryui.button(el); vis.binds.jqueryui.navigationActive(el, data.attr('nav_view')); vis.binds.basic.navigation(el, {nav_view:data.attr('nav_view'),hideOptions:{effect:data.attr('hide_effect'),options:{},duration:data.attr('hide_duration')},showOptions:{effect:data.attr('show_effect'),options:{},duration:data.attr('show_duration')}}) %> ><%== this.data.attr('buttontext') %></button>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplJquiIconNav"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplJquiIconNav" style="position: relative; text-align: initial;padding: 4px "><div data-vis-nav="" class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default jqui-nav-state " style="width: 100px; height: 28px;"> <div class="vis-widget-prev-body"> <img src="/vis/widgets/jqui/img/internet-web-browser-2.png" style="vertical-align:middle;height:100%;">&nbsp;Nav</div></div></div>'
        data-vis-name="navigation - Icon"
        data-vis-attrs="src/image;imageHeight/slider,0,200,1;alt;text;nav_view;hide_effect;hide_duration;show_effect;show_duration">
    <div
        data-vis-nav="<%= this.data.attr('nav_view') %>"
        class="vis-widget ui-widget ui-button ui-corner-all ui-state-default jqui-nav-state <%== this.data.attr('class') %>"
        style="width: 76px; height: 76px;"
        id="<%= this.data.attr('wid') %>"
        <%= (el) -> vis.binds.jqueryui.classes(el); vis.binds.jqueryui.navigationActive(el, data.attr('nav_view')); vis.binds.basic.navigation(el, {nav_view: data.attr('nav_view'), hideOptions: {effect: data.attr('hide_effect'), options: {}, duration: data.attr('hide_duration')}, showOptions: {effect: data.attr('show_effect'), options: {}, duration: data.attr('show_duration')}}) %>
    >
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %>
        </div>
    </div>
</script>

<script id="tplJquiNavPw"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplJquiNavPw" style=" position: relative; text-align: initial;padding: 4px " class="wid_prev_content"><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="top: 445px; left: 314px; width: 116px; height: 35px;"> <div class="vis-widget-prev-body" style="text-align: center"> <label style=" display: none;">Input</label><input type="text" value="Nav button Pw" size="10" data-o="" class="ui-button ui-widget ui-state-default ui-corner-all" role="button" style="height: 20px;font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; text-align: left; outline: none; cursor: text;"> </div> </div></div>'
        data-vis-name="navigation - Pw"
        data-vis-attrs="buttontext[Text];Password;nav_view;hide_effect;hide_duration;show_effect;show_duration;sync/checkbox;no_style/checkbox">
       <div class="vis-widget <%== this.data.attr('class') %>" style="width:76px;height:30px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <button style="width:100%; height:100%" data-no-style="<%= this.data.attr('no_style') %>" <%= (el) -> vis.binds.jqueryui.navigationPw(el, data)%> ><%== this.data.attr('buttontext') %></button>
        </div>
    </div>
</script>

<script id="tplJquiInput"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiInput" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle " style="top: 445px; left: 314px; width: 116px; height: 30px;" > <div class="vis-widget-prev-body" style="text-align: center"> <label style=" display: none;">Input</label><input type="text" value=" Input" size="10" data-o class="ui-button ui-widget ui-state-default ui-corner-all" role="button" style="font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; line-height: inherit; text-align: left; outline: none; cursor: text;"> </div> '
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Input"
        data-vis-attrs="label[Input];oid;asString/checkbox;digits[0]/slider,0,10,1;size[10]/slider,10,100,1;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:275px;height:44px;" id="<%= this.data.attr('wid') %>" data-no-style="<%= this.data.attr('no_style') %>" >
        <div class="vis-widget-body">
            <label for="<%= this.data.attr('wid') %>_input"><%= ((this.data.attr('label') === undefined || this.data.attr('label') === null) ? '' : this.data.attr('label')) %></label>
            <input
                type="text"
                name="<%= this.data.attr('wid') %>_input"
                id="<%= this.data.attr('wid') %>_input"
                value=""
                size="<%= this.data.attr('size') %>"
                data-oid="<%= this.data.attr('oid') %>"
                <%= (el) -> vis.binds.jqueryui.input(el, data.digits, data.asString); %>
			    <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? ' autofocus ' : '' %>
            />
        </div>
    </div>
</script>

<script id="tplJquiBool"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-prev='<div id="prev_tplJquiBool" style="position: relative; text-align: initial;padding: 4px "><div class="ui-widget ui-corner-all ui-state-default vis-widget_prev " style="width: 79px; height: 25px;"> <div class="vis-widget-prev-body" style="text-align: center;padding-top: 5px;"> true/false</div> </div></div>'
        data-vis-name="Html Bool"
        data-vis-attrs="oid;html_true;html_false">

    <div class="ui-widget ui-corner-all ui-state-default vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px" id="<%= this.data.attr('wid') %>"  data-no-style="<%= this.data.attr('no_style') %>"  data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.toggle(el); vis.binds.jqueryui.classes(el) %>>
        <div class="vis-widget-body">
            <div>
                <% if (vis.binds.basic.isFalse(vis.states.attr(this.data.oid + '.val'))) { %>
                    <%== this.data.attr('html_false') %>
                <% } else { %>
                    <%== this.data.attr('html_true') %>
                <% } %>
            </div>
        </div>
    </div>
</script>

<script id="tplJquiToogle"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiToogle" style="position: relative; text-align: initial;padding: 4px "><div class="ui-widget ui-corner-all ui-state-default vis-widget_prev" style="width: 90px; height: 19px; padding: 10px;"> <div class="vis-widget-prev-body"><label>&nbsp;Toggle&nbsp;</label><img class="imgToggleFalse" src="/vis/icon/add.png" style=" vertical-align:middle; height:100%"></div></div></div>'
        data-vis-set="jqui"
        data-vis-type="ctrl,state"
        data-vis-name="Icon Toggle"
        data-vis-attrs="label;oid;src_true/image;imageHeight/slider,0,200,1;alt_true;src_false/image;alt_false;invert_icon/checkbox">

    <div class="ui-widget ui-corner-all ui-state-default vis-widget <%== this.data.attr('class') %>" style="width:76px; height:76px" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.toggle(el); vis.binds.jqueryui.classes(el) %> >
        <div class="vis-widget-body">
            <%
            var styles = '';
            if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
                styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
            }
            %>
            <label style="margin: 0" for="<%= this.data.attr('wid') %>_input"><%== this.data.attr('label') %></label>
            <img class="imgToggleFalse" <%= this.data.attr('src_false') ? 'src="' +  this.data.attr('src_false') + '"' : '' %> style="<%= styles %> vertical-align: middle; height:<%= this.data.attr('imageHeight') || 100 %>%"               alt="<%== this.data.attr('alt_false') %>" />
            <img class="imgToggleTrue"  <%= this.data.attr('src_true')  ? 'src="' +  this.data.attr('src_true')  + '"' : '' %> style="<%= styles %> vertical-align: middle; height:<%= this.data.attr('imageHeight') || 100 %>%; display:none" alt="<%== this.data.attr('alt_true')  %>" />
            <div <%= (el) -> vis.binds.jqueryui.itoggle(el) %>></div>
        </div>
    </div>
</script>

<script id="tplJquiInputDate"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplJquiInputDate" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev " style="width: 110px; height: 25px; overflow: visible; "> <div class="vis-widget-prev-body"> <input type="text" value="2015-09-20" size="10" class="ui-widget ui-button ui-corner-all ui-state-default" style="font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; text-align: left; outline: none; cursor: text;text-align:center;"></div> </div></div>'
        data-vis-name="ctrl - Input Date"
        data-vis-attrs="oid/id;size[10]/slider,1,50,1;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:200px;height:40px;overflow: visible;text-align:center;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
			<div class="editmode-helper" />
		<% } %>
        <div class="vis-widget-body">
            <input
                type="text"
                style="text-align: center; padding-left: 5px"
                name="<%= this.data.attr('wid') %>_input"
                id="<%= this.data.attr('wid') %>_input"
                value=""
                size="<%= this.data.attr('size') %>"
                data-oid="<%= this.data.attr('oid') %>"
                <%= (el) -> vis.binds.jqueryui.inputDate(el); %>
			    <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus' : '' %>
            />
        </div>
    </div>
</script>

<script id="tplJquiInputDatetime"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplJquiInputDatetime" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev " style="width: 110px; height: 39px; overflow: visible; text-align: center;"> <div class="vis-widget-prev-body"> <input type="text" style="text-align: left; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; outline: none; cursor: text; " value="18:00:00" size="5" class="ui-state-default ui-widget ui-button ui-corner-all"> </div> </div></div>'
        data-vis-name="ctrl - Input Datetime"
        data-vis-attrs="oid;size/slider,1,50,1;timeOnly/checkbox;hideSeconds/checkbox;stepMinute/slider,1,30,1;showGrid/checkbox;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:200px;height:40px;overflow: visible;text-align:center;" id="<%= this.data.attr('wid') %>">
        <% if (vis.editMode) { %>
			<div class="editmode-helper" />
		<% } %>
        <div class="vis-widget-body">
            <input
                type="text"
                style="text-align: center; padding-left: 5px"
                name="<%= this.data.attr('wid') %>_input"
                id="<%= this.data.attr('wid') %>_input"
                value=""
                size="<%= this.data.attr('size') %>"
                data-oid="<%= this.data.attr('oid') %>"
                <%= (el) -> vis.binds.jqueryui.inputDatetime(el, {timeOnly: data.attr('timeOnly'), showSecond: !data.attr('hideSeconds'), stepMinute: data.attr('stepMinute'), showGrid: data.attr('showGrid')}); %>
			    <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus' : '' %>
            />
        </div>
    </div>
</script>

<script id="tplJquiInputSet"
        type="text/ejs" class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplJquiInputSet" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev " style="width: 90px; height: 32px; overflow: visible;"> <div class="vis-widget-prev-body"> <label></label> <input type="text" value="Input" size="2" style="font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; font-family: inherit; padding-left: 5px; padding-right: 5px; text-align: left; outline: none; cursor: text;height:14px" class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> <input type="button" style="padding-left: 5px; padding-right: 5px;" value="Set" class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div></div>'
        data-vis-name="ctrl - Input + Set-Button"
        data-vis-attrs="title;buttontext[Text];oid;unit;asString/checkbox;digits/slider,0,10,1;size/slider,1,50,1;"
        data-vis-attrs0="autoFocus/checkbox;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width:300px;height:44px;overflow:visible" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <label for="<%= this.data.attr('wid') %>_input"><%== this.data.attr('title') %></label>
            <input
                type="text"
                name="<%= this.data.attr('wid') %>_input"
                id="<%= this.data.attr('wid') %>_input"
                data-no-style="<%= this.data.attr('no_style') %>"
                size="<%= this.data.attr('size') %>"
                style="font-size: 1.1em !important; padding: 0 0"
                <%= this.data.attr('autoFocus') === true || this.data.attr('autoFocus') === 'true' ? 'autofocus' : '' %>
            />
            <%== this.data.attr('unit') %>
            <input type="button" style="height: 100%" data-oid="<%= this.data.attr('oid') %>" name="<%= this.data.attr('wid') %>_set" id="<%= this.data.attr('wid') %>_set" value="<%== this.data.attr('buttontext') %>"  data-no-style="<%= this.data.attr('no_style') %>" <%= (el) -> vis.binds.jqueryui.inputset(el, data.digits, data.asString); %>/>
        </div>
    </div>
</script>

<script id="tplJquiButtonState"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiButtonState" style=" position: relative; text-align: initial;padding: 4px; height: 30px "><div style="left: 384px; top: 470px;" class="vis-widget_prev ui-selectee ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":"e"}"> <div class="vis-widget-prev-body"> <input type="button" value=" Button " data-o data-val="" class="ui-button ui-widget ui-state-default ui-corner-all" role="button"> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Button State"
        data-vis-attrs="oid;html_prepend/html;html_append/html;buttontext[Text];value;no_style/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" >
            <%== this.data.attr('html_prepend') %>
            <button style="width:100%; height:100%" data-oid="<%= this.data.attr('oid') %>"  data-no-style="<%= this.data.attr('no_style') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.jqueryui.button(el, data.value); vis.binds.basic.state(el); %>><%== this.data.attr('buttontext') %></button>
            <%== this.data.attr('html_append') %>
        </div>
    </div>
</script>

<script id="tplJquiRadio"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiRadio" style=" position: relative; text-align: initial;padding: 4px;height: 30px"><div style="top: 243px; left: 348px; font-size: 9px;" class="vis-widget_prev ui-selectee ui-selected ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":""}"> <div class="vis-widget-prev-body"> <div data-o class="ui-buttonset"> <input type="radio" value="0" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-pressed="false"><span class="ui-button-text">OFF</span></label> <input type="radio" value="1" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right ui-state-active" role="button" aria-pressed="true"><span class="ui-button-text">ON</span></label> </div> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Radiobuttons on/off"
        data-vis-attrs="off_text[OFF];on_text[ON];oid;padding[5]/slider,0,100,1">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":""}' >
        <div class="vis-widget-body" >
            <div id="<%= this.data.attr('wid') %>_radio" data-oid="<%= this.data.attr('oid') %>" style="display: flex" <%= (el) -> vis.binds.jqueryui.radio(el); %> >
                <input type="radio" id="<%= this.data.attr('wid') %>_radio0" name="<%= this.data.attr('wid') %>_radio" value="0" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio0" style="padding: <%= this.data.attr('padding') %>px"><%= this.data.off_text %></label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio1" name="<%= this.data.attr('wid') %>_radio" value="1"/><label for="<%= this.data.attr('wid') %>_radio1" style="padding: <%= this.data.attr('padding') %>px"><%= this.data.on_text %></label>
            </div>
        </div>
    </div>
</script>

<script id="tplJquiRadioList"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiRadioList" style=" position: relative; text-align: initial;padding: 4px "><div style="font-size: 8px;overflow:visible;height:20px" class="vis-widget_prev ui-selectee ui-selected ui-draggable-handle"> <div class="vis-widget-prev-body"> <div data-o class="ui-buttonset"> <input type="radio" value="0" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-pressed="false"><span class="ui-button-text">OFF</span></label> <input type="radio" value="1" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right" role="button" aria-pressed="false"><span class="ui-button-text">AUTO</span></label> </div> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Radiobuttons ValueList"
        data-vis-attrs="oid;values[0§1§2];texts[OFF§ON§AUTO]">
    <div style=" width:250px; height:41px;overflow: visible" class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled":true, "handles":""}' >
        <div class="vis-widget-body" >
            <table id="<%= this.data.attr('wid') %>_radio" data-oid="<%= this.data.attr('oid') %>" style="display: flex" <%= (el) -> setTimeout(function () {vis.binds.jqueryui.radio(el)}, 100) %> class="vis-no-spaces"><tr class="vis-no-spaces">
                <%
                var values = (data.attr('values') ? data.attr('values').split(';') : []);
                var texts  = (data.attr('texts') ? data.attr('texts').split(';'): []);
                var wid = data.attr('wid');
                for (var val in values) {
                %>
                    <td class="vis-no-spaces"><input type="radio" id="<%= wid %>_radio<%= val %>" name="<%= wid %>_radio" value="<%== values[val] %>" /><label style="float: left" for="<%= wid %>_radio<%= val %>"><%= texts[val] %></label></td>
                <%
                }
                %>
            </tr></table>
        </div>
    </div>
</script>

<script id="tplJquiSelectList"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiSelectList" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":""}" style="left: 336px; top: 323px;"> <div class="vis-widget-prev-body"> <select data-o disabled="" style="display: none;"> <option value="0">OFF</option> <option value="1">ON</option> <option value="2">AUTO</option> </select><button type="button" class="ui-multiselect ui-widget ui-state-default ui-corner-all" aria-haspopup="true" style="width: 86px;"><span class="ui-icon ui-icon-triangle-2-n-s"></span><span>OFF</span></button> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Select ValueList"
        data-vis-attrs="oid;values[0§1§2]/text;texts[OFF§ON§AUTO]/text;height[100]/slider,15,500,1;open/checkbox;no_style/checkbox">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" >
        <div class="vis-widget-body" >
            <select id="<%= this.data.attr('wid') %>_multiselect" data-no-style="<%= this.data.attr('no_style') %>" data-oid="<%= this.data.attr('oid') %>" data-view="<%= this.view %>" <%= (el) -> setTimeout(function (el_) { vis.binds.jqueryui.multiselect(el_, {height: (data.height || 220)}, data.open)}, 250, el); %> >
            <%
				var values = (data.attr('values') ? data.attr('values').split(';') : []);
				var texts  = (data.attr('texts')  ? data.attr('texts').split(';')  : []);
				for (var val in values) {
					%>
					<option value="<%= values[val] %>"><%= texts[val] %></option>
					<%
				}
            %>
            </select >
        </div>
    </div>
</script>

<script id="tplJquiRadioSteps"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiRadioSteps" style="zoom: 0.99; position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee ui-draggable-handle" data-vis-resizable="{"disabled":true, "handles":"e"}" style="left: 85px; top: 258px; font-size: 5px;"> <div class="vis-widget-prev-body"> <div data-o class="ui-buttonset"> <input type="radio" value="0" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-pressed="false"><span class="ui-button-text">aus</span></label> <input type="radio" value="0.25" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only" role="button" aria-pressed="false"><span class="ui-button-text">25%</span></label> <input type="radio" value="0.5" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only" role="button" aria-pressed="false"><span class="ui-button-text">50%</span></label> <input type="radio" value="0.75" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-state-active" role="button" aria-pressed="true"><span class="ui-button-text">75%</span></label> <input type="radio" value="1" class="ui-helper-hidden-accessible"><label class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right" role="button" aria-pressed="false"><span class="ui-button-text">100%</span></label> </div> </div> </div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Radiobuttons 25%"
        data-vis-attrs="oid;min;max">
    <div class="vis-widget <%== this.data.attr('class') %>" id="<%= this.data.attr('wid') %>" data-vis-resizable='{"disabled": true, "handles": "e"}' >
        <div class="vis-widget-body" >
            <div id="<%= this.data.attr('wid') %>_radio"  data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.jqueryui.radio(el); %> >
                <input type="radio" id="<%= this.data.attr('wid') %>_radio0" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0,    this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio0">aus</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio1" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0.25, this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio1">25%</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio2" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0.5,  this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio2">50%</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio3" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(0.75, this.data.attr('min'), this.data.attr('max')) %>" checked='checked'/><label for="<%= this.data.attr('wid') %>_radio3">75%</label>
                <input type="radio" id="<%= this.data.attr('wid') %>_radio4" name="<%= this.data.attr('wid') %>_radio" value="<%= vis.binds.jqueryui.calcValue(1,    this.data.attr('min'), this.data.attr('max')) %>"/><label for="<%= this.data.attr('wid') %>_radio4">100%</label>
            </div>
        </div>
    </div>
</script>

<script id="tplJquiSliderVertical"
        type="text/ejs"
        data-vis-attrs="oid;oid-2;oid-working;oid-2-working;min;max;step;inverted/checkbox;submitmethod/nselect,scroll,stop"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiSliderVertical" style="position: relative; text-align: initial;padding: 4px;overflow:visible;height:50px"><div class="vis-widget_prev " style="width: 23px; height: 30px; overflow: visible !important;"> <div class="vis-widget-prev-body " style="width: 100%; padding: 4px; "> <div class="sliderJQUI ui-slider ui-slider-vertical ui-widget ui-widget-content ui-corner-all" id="19vlqqb6r_slider" data-oid="nothing_selected" data-oid-working="" style="height:100%"><span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0" style="bottom: 0%;"></span></div></div> </div></div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Slider vertical">
    <div id="<%= this.data.attr('wid') %>" data-vis-resizable='{"minWidth":23, "maxWidth":23}' class="vis-widget" style="width:23px; height:160px; overflow:visible !important;">
        <div class="vis-widget-body <%== this.data.attr('class') %>" style="width: 100%; padding: 4px; ">
            <div class="sliderJQUI" id="<%= this.data.attr('wid') %>_slider" data-oid="<%= this.data.attr('oid') %>" data-oid2="<%= this.data.attr('oid-2') %>" data-oid-working="<%= this.data.attr('oid-working') %>"  data-oid2-working="<%= this.data.attr('oid-2-working') %>"<%= (el) -> vis.binds.jqueryui.slider(el, {min: parseFloat(data.min), max: parseFloat(data.max), step: parseFloat(data.step), orientation:"vertical", inverted: data.inverted, submitmethod: data.submitmethod}) %> style="height:100%"/></div>
        </div>
    </div>
</script>

<script id="tplJquiSlider"
        type="text/ejs"
        data-vis-attrs="oid;oid-2;oid-working;oid-2-working;min;max;step;inverted/checkbox;submitmethod/nselect,scroll,stop"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplJquiSlider" style="position: relative; text-align: initial;padding: 4px;overflow:visible"><div class="vis-widget_prev " style="width: 80px; overflow: visible !important; left: 475px; top: 188px; position: absolute; height: 23px;"> <div class="vis-widget-prev-body " style="padding: 4px;"> <div class="sliderJQUI ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" id="19vlqppi9_slider" data-oid="nothing_selected" data-oid-working=""><span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0" style="left: 0%;"></span></div></div> </div></div>'
        data-vis-set="jqui"
        data-vis-type="ctrl"
        data-vis-name="Slider horizontal">
    <div id="<%= this.data.attr('wid') %>" data-vis-resizable='{"minHeight":23, "maxHeight":23}' class="vis-widget" style="height:23; width:160px; overflow:visible !important;">
        <div class="vis-widget-body <%== this.data.attr('class') %>" style="padding: 4px;">
            <div class="sliderJQUI" id="<%= this.data.attr('wid') %>_slider" data-oid="<%= this.data.attr('oid') %>" data-oid2="<%= this.data.attr('oid-2') %>" data-oid-working="<%= this.data.attr('oid-working') %>"  data-oid2-working="<%= this.data.attr('oid-2-working') %>"<%= (el) -> vis.binds.jqueryui.slider(el, {min:parseFloat(data.min),max:parseFloat(data.max),step:parseFloat(data.step), inverted: data.inverted, submitmethod: data.submitmethod}) %> /></div>
        </div>
    </div>
</script>

<script id="tplIconState"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplIconState" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default " style="width: 122.4px; height: 32.4px; position: absolute; left: 237px; top: 201px;" id="19vlr5eto" data-oid="dev1" data-val="value"> <div class="vis-widget-prev-body"> <img src="/vis/widgets/jqui/img/internet-web-browser-2.png" style=" vertical-align:middle;height:100%;" alt="">set value </div> </div></div>'
        data-vis-set="jqui"
        data-vis-name="ctrl - Icon State"
        data-vis-attrs="oid;value;text;src/image;imageHeight/slider,0,200,1;alt;invert_icon/checkbox">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 100px; height: 35px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('value') %>" <%= (el) -> vis.binds.basic.state(el); vis.binds.jqueryui.classes(el, null, data.value) %>>
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height:<%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %>
        </div>
    </div>
</script>

<script id="tplIconStateBool"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplIconStateBool" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default " style="width: 100px; height: 25px;" > <div class="vis-widget-prev-body"> <img class="tplImgFalse" src="/vis/img/bulb_on.png" style=" vertical-align:middle;height:100%;" alt="">set value </div> </div></div>'
        data-vis-name="ctrl - Icon State / val - Icon Bool"
        data-vis-attrs="oid;click_id/id;click_value;false_text;true_text;false_src/image;true_src/image;imageHeight/slider,0,200,1;false_alt;true_alt;invert_icon/checkbox">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 100px; height: 35px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-val="<%= this.data.attr('click_value') %>" <%= (el) -> vis.binds.basic.state(el, this.data.attr('click_id')); vis.binds.jqueryui.classes(el, null, data.click_value) %>>
        <div class="vis-widget-body">
            <img class="imgToggleFalse" <%= this.data.attr('false_src') ? 'src="' +  this.data.attr('false_src') + '"' : '' %> style="               <%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('false_alt') %>"/ ><span class="imgToggleFalse"><%= this.data.attr('false_text') %></span>
            <img class="imgToggleTrue"  <%= this.data.attr('true_src')  ? 'src="' +  this.data.attr('true_src')  + '"' : '' %> style="display: none; <%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('true_alt')  %>" /><span class="imgToggleTrue" style="display: none"><%= this.data.attr('true_text')  %></span>
            <div <%= (el) -> vis.binds.jqueryui.itoggle(el) %>></div>
        </div>
    </div>
</script>

<script id="tplIconStatePushButton"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="jqui"
        data-vis-prev='<div id="prev_tplIconStateBool" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default " style="width: 100px; height: 25px;" > <div class="vis-widget-prev-body"> <img class="tplImgFalse" src="/vis/img/bulb_on.png" style=" vertical-align:middle;height:100%;" alt="">set value </div> </div></div>'
        data-vis-name="ctrl - Icon PushButton / val - Icon Bool"
        data-vis-attrs="oid;click_id/id;false_text;true_text;false_src/image;true_src/image;imageHeight/slider,0,200,1;false_alt;true_alt;invert_icon/checkbox">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 100px; height: 35px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" <%= (el) -> vis.binds.basic.pushbutton(el, this.data.attr('click_id')); vis.binds.jqueryui.classes(el, null, data.click_value) %>>
        <div class="vis-widget-body">
            <img class="imgToggleFalse" <%= this.data.attr('false_src') ? 'src="' +  this.data.attr('false_src') + '"' : '' %> style="               <%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('false_alt') %>"/ ><span class="imgToggleFalse"><%= this.data.attr('false_text') %></span>
            <img class="imgToggleTrue"  <%= this.data.attr('true_src')  ? 'src="' +  this.data.attr('true_src')  + '"' : '' %> style="display: none; <%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('true_alt')  %>" /><span class="imgToggleTrue" style="display: none"><%= this.data.attr('true_text')  %></span>
            <div <%= (el) -> vis.binds.jqueryui.itoggle(el) %>></div>
        </div>
    </div>
</script>

<script id="tplIconInc"
        type="text/ejs"
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplIconInc" style="position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-widget ui-button ui-corner-all ui-state-default ui-state-active " style="width: 44px; height: 20px;" data-vis-step="1" data-val=""> <div class="vis-widget-prev-body"> <img style=" vertical-align:middle;height:100%;">+1 </div> </div></div>'
        data-vis-set="jqui"
        data-vis-name="ctrl - Icon Increment"
        data-vis-attrs="oid;step[1];minmax[100];text[+1];src/image;imageHeight/slider,0,200,1;alt;repeat_delay[800];repeat_interval[800];invert_icon/checkbox">
    <%
    var styles = '';
    if (this.data.invert_icon === 'true' || this.data.invert_icon === true) {
        styles = "filter: invert(1); -webkit-filter: invert(1); -moz-filter: invert(1); -o-filter: invert(1); -ms-filter: invert(1);";
    }
    %>
    <div class="vis-widget ui-widget ui-button ui-corner-all ui-state-default <%== this.data.attr('class') %>" style="width: 100px; height: 35px;" id="<%= this.data.attr('wid') %>" data-oid="<%= this.data.attr('oid') %>" data-vis-step="<%= this.data.attr('step') %>" data-val="<%= this.data.attr('active_value') %>" <%= (el) -> vis.binds.basic.increment(el,data.minmax,data.repeat_delay,data.repeat_interval); vis.binds.jqueryui.classes(el, null, data.minmax) %>>
        <div class="vis-widget-body">
            <img <%= this.data.attr('src') ? 'src="' +  this.data.attr('src') + '"' : '' %> style="<%= styles %> vertical-align: middle; height: <%= this.data.attr('imageHeight') || 100 %>%;" alt="<%== this.data.attr('alt') %>" /><%== this.data.attr('text') %>
        </div>
    </div>
</script>

<!-- --------------jqui.html--- END -->
<!-- --------------map.html--- START -->
<!--
    ioBroker.vis map widgets

    version: "1.0.3"

    Copyright 2016-2020 bluefox<dogafox@gmail.com>

-->
<script type="text/javascript">
    'use strict';
    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "Get the Google API Key": {                      "en": "Get the Google API Key",                          "de": "Google API Schlüssel Bekommen",                   "ru": "Получить Google API ключ",                        "pt": "Obter a chave da API do Google",                  "nl": "Download de Google API Key",                      "fr": "Obtenir la clé de l'API Google",                  "it": "Ottieni la chiave dell'API di Google",            "es": "Obtener la clave API de Google",                  "pl": "Uzyskaj klucz Google API"},
            "Google Map API key:": {                         "en": "Google Map API key:",                             "de": "Google Map API Schlüssel:",                       "ru": "Google Map API ключ",                             "pt": "Tecla Google Map API:",                           "nl": "Google Map API-sleutel:",                         "fr": "Clé de l'API Google Map:",                        "it": "Chiave API Mappa Google:",                        "es": "Clave de la API de Google Map:",                  "pl": "Klucz API Map Google:"},
            "HYBRID": {                                      "en": "Hybrid",                                          "de": "Hybrid",                                          "ru": "Гибридная",                                       "pt": "Híbrido",                                         "nl": "Hybride",                                         "fr": "Hybride",                                         "it": "Ibrido",                                          "es": "Híbrido",                                         "pl": "Hybrydowy"},
            "Maps Widgets settings": {                       "en": "High quality Widgets settings",                   "de": "High quality Widgets Einstellungen",              "ru": "Настройки High quality Widgets",                  "pt": "Configurações de Widgets de alta qualidade",      "nl": "Hoge kwaliteit Widgets-instellingen",             "fr": "Paramètres Widgets de haute qualité",             "it": "Impostazioni widget di alta qualità",             "es": "Ajustes de widgets de alta calidad",              "pl": "Wysokiej jakości ustawienia widgetów"},
            "No API key": {                                  "en": "No API key",                                      "de": "Kein API Schlüssel",                              "ru": "Нет API ключа",                                   "pt": "Nenhuma chave da API",                            "nl": "Geen API-sleutel",                                "fr": "Aucune clé API",                                  "it": "Nessuna chiave API",                              "es": "Sin clave de API",                                "pl": "Brak klucza API"},
            "ROADMAP": {                                     "en": "Roadmap",                                         "de": "Straßenkarte ",                                   "ru": "Дороги",                                          "pt": "Roteiro",                                         "nl": "roadmap",                                         "fr": "Feuille de route",                                "it": "Roadmap",                                         "es": "Mapa vial",                                       "pl": "Mapa drogowa"},
            "SATELLITE": {                                   "en": "Satellite",                                       "de": "Satellit",                                        "ru": "Спутник",                                         "pt": "Satélite",                                        "nl": "Satelliet",                                       "fr": "Satellite",                                       "it": "Satellitare",                                     "es": "Satélite",                                        "pl": "Satelita"},
            "TERRAIN": {                                     "en": "Terrain",                                         "de": "Gelände",                                         "ru": "Местность",                                       "pt": "Terreno",                                         "nl": "Terrein",                                         "fr": "Terrain",                                         "it": "Terreno",                                         "es": "Terreno",                                         "pl": "Teren"},
            "apiKey": {                                      "en": "Google API Key",                                  "de": "Google API Schlüssel",                            "ru": "Google API ключ",                                 "pt": "Chave da API do Google",                          "nl": "Google API Key",                                  "fr": "Clé de l'API Google",                             "it": "Chiave API di Google",                            "es": "Clave de API de Google",                          "pl": "Klucz Google API"},
            "apiKey_tooltip": {                              "en": "Just write one space to get API from settings",   "de": "Einfach Leerzeihen eingeben um die Einstellungen aus dem Adapter zu übernehmen", "ru": "Просто введите пробел, что бы перенять ключ из настроек драйвера", "pt": "Basta escrever um espaço para obter API das configurações", "nl": "Schrijf gewoon een spatie om API uit instellingen te halen", "fr": "Il suffit d'écrire un espace pour obtenir l'API des paramètres", "it": "Basta scrivere uno spazio per ottenere API dalle impostazioni", "es": "Solo escribe un espacio para obtener la API de la configuración", "pl": "Wystarczy napisać jedną spację, aby pobrać interfejs API z ustawień"},
            "group_markers": {                               "en": "Markers",                                         "de": "Markers",                                         "ru": "Маркеры",                                         "pt": "Marcadores",                                      "nl": "markers",                                         "fr": "Marqueurs",                                       "it": "marcatori",                                       "es": "Marcadores",                                      "pl": "Markery"},
            "hideControls": {                                "en": "Hide controls",                                   "de": "Keine Bedienelemente",                            "ru": "Скрыть управление",                               "pt": "Ocultar controles",                               "nl": "Verberg besturingselementen",                     "fr": "Masquer les contrôles",                           "it": "Nascondi i controlli",                            "es": "Ocultar controles",                               "pl": "Ukryj formanty"},
            "mCount": {                                      "en": "Number of markers",                               "de": "Anzahl Markers",                                  "ru": "Количество маркеров",                             "pt": "Número de marcadores",                            "nl": "Aantal markeringen",                              "fr": "Nombre de marqueurs",                             "it": "Numero di marcatori",                             "es": "Cantidad de marcadores",                          "pl": "Liczba markerów"},
            "map": {                                         "en": "map",                                             "de": "Karte",                                           "ru": "карта",                                           "pt": "mapa",                                            "nl": "kaart",                                           "fr": "carte",                                           "it": "carta geografica",                                "es": "mapa",                                            "pl": "mapa"},
            "mapTypeId": {                                   "en": "Map type",                                        "de": "Kertentyp",                                       "ru": "Тип карты",                                       "pt": "Tipo de mapa",                                    "nl": "Kaartsoort",                                      "fr": "Type de carte",                                   "it": "Tipo di mappa",                                   "es": "Tipo de mapa",                                    "pl": "Typ mapy"},
            "markersHeight": {                               "en": "Height",                                          "de": "Höche",                                           "ru": "Высота",                                          "pt": "Altura",                                          "nl": "Hoogte",                                          "fr": "la taille",                                       "it": "Altezza",                                         "es": "Altura",                                          "pl": "Wysokość"},
            "markersImage": {                                "en": "Icon URL",                                        "de": "Bild URL",                                        "ru": "URL картинки",                                    "pt": "URL do ícone",                                    "nl": "Pictogram URL",                                   "fr": "URL de l'icône",                                  "it": "Icona URL",                                       "es": "Ícono URL",                                       "pl": "URL ikony"},
            "markersLabel": {                                "en": "Letter",                                          "de": "Buchstabe",                                       "ru": "Буква или число",                                 "pt": "Carta",                                           "nl": "Brief",                                           "fr": "Lettre",                                          "it": "Lettera",                                         "es": "Carta",                                           "pl": "List"},
            "markersLabel_tooltip": {                        "en": "Only first letter or digit",                      "de": "Nur ein Symbol",                                  "ru": "Только один символ",                              "pt": "Apenas a primeira letra ou dígito",               "nl": "Alleen eerste letter of cijfer",                  "fr": "Seulement la première lettre ou le chiffre",      "it": "Solo prima lettera o cifra",                      "es": "Solo la primera letra o dígito",                  "pl": "Tylko pierwsza litera lub cyfra"},
            "markersLat-oid": {                              "en": "Latitude ID",                                     "de": "Breitengrad ID",                                  "ru": "ID широты",                                       "pt": "Identificação da Latitude",                       "nl": "Latitude ID",                                     "fr": "Latitude ID",                                     "it": "Latitude ID",                                     "es": "Latitud ID",                                      "pl": "Identyfikator Latitude"},
            "markersLon-oid": {                              "en": "Longitude ID",                                    "de": "Längengrad ID",                                   "ru": "ID долготы",                                      "pt": "ID de Longitude",                                 "nl": "Lengtegraad-ID",                                  "fr": "Longitude ID",                                    "it": "ID longitudine",                                  "es": "ID de longitud",                                  "pl": "ID długości"},
            "markersOffsetX": {                              "en": "Offset X",                                        "de": "Offset X",                                        "ru": "Сдвиг по X",                                      "pt": "Offset X",                                        "nl": "Offset X",                                        "fr": "Décalage X",                                      "it": "Offset X",                                        "es": "Desplazamiento X",                                "pl": "Przesunięcie X"},
            "markersOffsetY": {                              "en": "Offset Y",                                        "de": "Offset Y",                                        "ru": "Сдвиг по Y",                                      "pt": "Offset Y",                                        "nl": "Offset Y",                                        "fr": "Offset Y",                                        "it": "Offset Y",                                        "es": "Desplazamiento Y",                                "pl": "Przesunięcie Y"},
            "markersOpacity": {                              "en": "Opacity",                                         "de": "Durchsichtigkeit",                                "ru": "Прозрачность",                                    "pt": "Opacidade",                                       "nl": "ondoorzichtigheid",                               "fr": "Opacité",                                         "it": "Opacità",                                         "es": "Opacidad",                                        "pl": "Nieprzezroczystość"},
            "markersSwap": {                                 "en": "Swap Latitude and Longitude",                     "de": "Tausche Längengrad mit Breitengrad",              "ru": "Поменять местами широту и долготу",               "pt": "Trocar Latitude e Longitude",                     "nl": "Swap Latitude and Longitude",                     "fr": "Échanger la latitude et la longitude",            "it": "Scambia latitudine e longitudine",                "es": "Intercambiar latitud y longitud",                 "pl": "Zamień szerokość i długość geograficzną"},
            "markersText": {                                 "en": "Tooltip",                                         "de": "Tooltip",                                         "ru": "Подсказка",                                       "pt": "Tooltip",                                         "nl": "tooltip",                                         "fr": "Info-bulle",                                      "it": "tooltip",                                         "es": "Información sobre herramientas",                  "pl": "Etykietka"},
            "markersWidth": {                                "en": "Width",                                           "de": "Breite",                                          "ru": "Ширина",                                          "pt": "Largura",                                         "nl": "Breedte",                                         "fr": "Largeur",                                         "it": "Larghezza",                                       "es": "Anchura",                                         "pl": "Szerokość"},
            "markersView": {                                 "en": "View",                                            "de": "View",                                            "ru": "Страница",                                        "pt": "View",                                            "nl": "View",                                            "fr": "View",                                            "it": "View",                                            "es": "View",                                            "pl": "View"},
            "markersUrl": {                                  "en": "URL",                                             "de": "URL",                                             "ru": "URL",                                             "pt": "URL",                                             "nl": "URL",                                             "fr": "URL",                                             "it": "URL",                                             "es": "URL",                                             "pl": "URL"},
            "maxZoom": {                                     "en": "Max zoom level",                                  "de": "Max Zoom",                                        "ru": "Уровень зума",                                    "pt": "Nível de zoom máximo",                            "nl": "Max zoomniveau",                                  "fr": "Niveau de zoom maximum",                          "it": "Max livello di zoom",                             "es": "Nivel de zoom máximo",                            "pl": "Maksymalny poziom zbliżenia"},
            "noZoomAndPan": {                                "en": "No zoom",                                         "de": "Kein Zoom",                                       "ru": "Без зума",                                        "pt": "Sem zoom",                                        "nl": "Niet zoomen",                                     "fr": "Pas de zoom",                                     "it": "Nessun zoom",                                     "es": "Sin zoom",                                        "pl": "Bez powiększenia"},
            "showTraffic": {                                 "en": "Show traffic",                                    "de": "Verkehrsinformation",                             "ru": "Загруженность дорог",                             "pt": "Mostrar tráfego",                                 "nl": "Toon verkeer",                                    "fr": "Afficher le trafic",                              "it": "Mostra traffico",                                 "es": "Mostrar tráfico",                                 "pl": "Pokaż ruch"}
        });
    }

    vis.binds.map = {
        version: "1.0.3",
        showVersion: function () {
            if (vis.binds.map.version) {
                console.log('Version vis-map: ' + vis.binds.map.version);
                vis.binds.map.version = null;
            }
        },
        updateWidgets: [],
        updateIntervalTimer: null,
        isLonLatIsOID: function (value) {
            if (typeof value !== 'string') return false;
            if (!value) return false;
            if (value[0] === '-') return false;
            if (value[0] >= '0' && value[0] <= '9') return false;
            return true;
        },
        osm: {
            loaded: false,
            fromProjection: null,
            toProjection: null,
            getMarkers: function (markers) {
                var result = new OpenLayers.Layer.Markers('Markers');
                var list = [];

                for (var m = 0; m < markers.length; m++) {
                    var width  = parseFloat(markers[m].width  || 25);
                    var height = parseFloat(markers[m].height || 25);
                    var size   = new OpenLayers.Size(width, height);
                    var url    = markers[m].image || 'widgets/map/img/pin.png';
                    var opacity = (markers[m].opacity === '' || markers[m].opacity === null || markers[m].opacity === undefined) ? 1 : parseFloat(markers[m].opacity);
                    var offsetX = (markers[m].offsetX === '' || markers[m].offsetX === null || markers[m].offsetX === undefined) ? -(size.w/2) : (-1) * parseFloat(markers[m].offsetX);
                    var offsetY = (markers[m].offsetY === '' || markers[m].offsetY === null || markers[m].offsetY === undefined) ? -size.h : (-1) * parseFloat(markers[m].offsetY);
                    var offset = new OpenLayers.Pixel(offsetX, offsetY);

                    var icon   = new OpenLayers.Icon(url, size, offset);
                    var marker;
                    if (vis.binds.map.isLonLatIsOID(markers[m].lon) && vis.binds.map.isLonLatIsOID(markers[m].lat)) {
                        marker = new OpenLayers.Marker(vis.binds.map.osm.text2position(vis.states[markers[m].lon + '.val'] + ';' + vis.states[markers[m].lat + '.val'], markers[m].swap), icon);
                    } else if (vis.binds.map.isLonLatIsOID(markers[m].lon)) {
                        marker = new OpenLayers.Marker(vis.binds.map.osm.text2position(vis.states[markers[m].lon + '.val'], markers[m].swap), icon);
                    } else {
                        marker = new OpenLayers.Marker(vis.binds.map.osm.text2position(markers[m].lon.toString() + (markers[m].lat ? ';' + markers[m].lat : ''), markers[m].swap), icon);
                    }
                    opacity = parseFloat(opacity);

                    if (opacity === 0) marker.display(opacity !== 0);
                    if (opacity !== 1 && opacity !== 0) marker.setOpacity(opacity);

                    if (markers[m].url || markers[m].view) {
                        (function (mm) {
                            marker.events.register('mousedown', marker.feature, function() {
                                if (markers[mm].view) {
                                    vis.changeView(markers[mm].view, markers[mm].view);
                                } else {
                                    document.location = markers[mm].url;
                                }
                            });
                        })(m);
                    }


                    list.push(marker);
                    result.addMarker(marker);
                }

                return {layer: result, list: list};
            },
            setCenter: function (map, markers, maxZoom) {
                if (markers && markers.markers.length) {
                    var bound = markers.getDataExtent();
                    var zoom = Math.min(map.getZoomForExtent(bound), maxZoom === undefined ? 30 : parseFloat(maxZoom));
                    map.setCenter(bound.getCenterLonLat(), zoom);
                } else {
                    map.setCenter(vis.binds.map.osm.text2position('5.55;6.66'), parseFloat(maxZoom));
                }
            },
            text2position: function (text, isSwap) {
                var parts = (text ||'').toString().split(';');
                if (parts.length < 2) parts = (text ||'').split(',');
                if (parts.length < 2) return null;
                var lon = parseFloat(parts[0].replace(',', '.').trim());
                var lat = parseFloat(parts[1].replace(',', '.').trim());
                if (isSwap) {
                    return new OpenLayers.LonLat(lat, lon).transform(vis.binds.map.osm.fromProjection, vis.binds.map.osm.toProjection);
                } else {
                    return new OpenLayers.LonLat(lon, lat).transform(vis.binds.map.osm.fromProjection, vis.binds.map.osm.toProjection);
                }
            },
            showMap: function (divName, markerList, maxZoom) {
                var map = new OpenLayers.Map(divName);
                var mapnik = new OpenLayers.Layer.OSM();
                // Fix Cross Origin problem on safari
                mapnik.tileOptions.crossOriginKeyword = null;
                map.addLayer(mapnik);

                var oObj = vis.binds.map.osm.getMarkers(markerList);
                map.addLayer(oObj.layer);

                vis.binds.map.osm.setCenter(map, oObj.layer, maxZoom);
                $('.olControlAttribution').hide();
                var $div = $('#' + divName);
                $div.css('border-radius', $div.parent().css('border-radius')).css('overflow', 'hidden');

                return {map: map, markers: oObj.list, layer: oObj.layer};
            },
            update: function ($div) {
                var obj     = $div.data('object');
                var markers = $div.data('markers');
                var zoom    = $div.data('zoom');

                for (var m = 0; m < markers.length; m++) {
                    if (vis.binds.map.isLonLatIsOID(markers[m].lon) && vis.binds.map.isLonLatIsOID(markers[m].lat)) {
                        obj.markers[m].lonlat = vis.binds.map.osm.text2position(vis.states[markers[m].lon + '.val'] + ';' + vis.states[markers[m].lat + '.val'], markers[m].swap);
                        obj.layer.removeMarker(obj.markers[m]);
                        obj.layer.addMarker(obj.markers[m]);
                    } else if (vis.binds.map.isLonLatIsOID(markers[m].lon)) {
                        obj.markers[m].lonlat = vis.binds.map.osm.text2position(vis.states[markers[m].lon + '.val'], markers[m].swap);
                        obj.layer.removeMarker(obj.markers[m]);
                        obj.layer.addMarker(obj.markers[m]);
                    }
                }
                vis.binds.map.osm.setCenter(obj.map, obj.layer, zoom);
            },
            init: function (wid, view, data, style) {
                var $div = $('#' + wid);
                if (!$div.length) {
                    setTimeout(function () {
                        vis.binds.map.osm.init(wid, view, data, style);
                    }, 100);
                    return;
                }

                if (!$('#osm_map').length) {
                    var script = document.createElement('script');
                    if (window.location.protocol === 'file:') {
                        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js';
                    } else {
                        script.src = '//cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js';
                    }
                    script.id = 'osm_map';
                    document.head.appendChild(script);
                    $('#osm_map').load(function () {
                        vis.binds.map.osm.loaded = true;
                        vis.binds.map.osm.init(wid, view, data, style);
                    });
                    return;
                } else if (!vis.binds.map.osm.loaded) {
                    $('#osm_map').load(function () {
                        vis.binds.map.osm.init(wid, view, data, style);
                    });
                    return;
                }
                if (!vis.binds.map.osm.fromProjection) vis.binds.map.osm.fromProjection = new OpenLayers.Projection('EPSG:4326');   // Transform from WGS 1984
                if (!vis.binds.map.osm.toProjection)   vis.binds.map.osm.toProjection   = new OpenLayers.Projection('EPSG:900913'); // to Spherical Mercator Projection

                var $map = $div.find('.vis-widget-body');

                var markers = [];

                data.mCount = parseInt(data.mCount, 10) || 1;
                var u;
                for (u = 1; u <= data.mCount; u++) {
                    if (data['markersLon-oid' + u]) {
                        var marker = {
                            lon:        data['markersLon-oid'   + u] || '',
                            lat:        data['markersLat-oid'   + u] || '',
                            image:      data['markersImage'     + u],
                            width:      data['markersWidth'     + u],
                            height:     data['markersHeight'    + u],
                            offsetX:    data['markersOffsetY'   + u],
                            offsetY:    data['markersOffsetX'   + u],
                            opacity:    data['markersOpacity'   + u],
                            text:       data['markersText'      + u] || undefined,
                            label:      data['markersLabel'     + u] || undefined,
                            view:       data['markersView'      + u] || undefined,
                            url:        data['markersUrl'       + u] || undefined,
                            swap:       data['markersSwap'      + u] === true || data['markersSwap'      + u] === 'true'
                        };

                        markers.push(marker);
                    }
                }

                $map.data('object',  vis.binds.map.osm.showMap('map_' + data.wid, markers, parseInt(data.maxZoom, 10) || 20));
                $map.data('markers', markers);
                $map.data('zoom',    parseInt(data.maxZoom, 10) || 20);
                if (data.hideControls) $map.find('.olControlZoom').hide();

                function onChange() {
                    vis.binds.map.osm.update($map);
                }
                var bound = [];

                for (u = 1; u <= data.mCount; u++) {
                    if (vis.binds.map.isLonLatIsOID(data['markersLon-oid' + u])) {
                        vis.states.bind(data['markersLon-oid' + u] + '.val', onChange);
                        bound.push(data['markersLon-oid' + u] + '.val');
                    }
                    if (vis.binds.map.isLonLatIsOID(data['markersLat-oid' + u])) {
                        vis.states.bind(data['markersLat-oid' + u] + '.val', onChange);
                        bound.push(data['markersLat-oid' + u] + '.val');
                    }
                }

                if (bound.length) {
                    // remember all ids, that bound
                    $div.data('bound', bound);
                    // remember bind handler
                    $div.data('bindHandler', onChange);
                }
            }
        },
        googleMap: {
            loaded: false,
            text2position: function (text, isSwap) {
                var parts = (text || '').toString().split(';');
                if (parts.length < 2) parts = (text || '').split(',');
                if (parts.length < 2) return null;
                var lon = parseFloat(parts[0].replace(',', '.').trim());
                var lat = parseFloat(parts[1].replace(',', '.').trim());
                if (isSwap) {
                    return new google.maps.LatLng(lon, lat);
                } else {
                    return new google.maps.LatLng(lat, lon);
                }
            },
            setCenter: function (map, oMarkers, maxZoom) {
                var bounds = new google.maps.LatLngBounds();
                for (var m = 0; m < oMarkers.length; m++) {
                    bounds.extend(oMarkers[m].getPosition());
                }
                if (oMarkers.length > 1) {
                    map.fitBounds(bounds);
                } else if (oMarkers.length) {
                    map.panTo(oMarkers[0].getPosition());
                }

                var listener = google.maps.event.addListener(map, 'idle', function() {
                    if (map.getZoom() > maxZoom) map.setZoom(maxZoom);
                    google.maps.event.removeListener(listener);
                });
            },
            setMarkers: function (map, markers) {
                var result = [];
                for (var m = 0; m < markers.length; m++) {
                    var width  = parseFloat(markers[m].width  || 100);
                    var height = parseFloat(markers[m].height || 25);
                    var opacity = (markers[m].opacity === '' || markers[m].opacity === null || markers[m].opacity === undefined) ? 1 : parseFloat(markers[m].opacity);
                    var offsetX = (markers[m].offsetX === '' || markers[m].offsetX === null || markers[m].offsetX === undefined) ? null : parseFloat(markers[m].offsetX);
                    var offsetY = (markers[m].offsetY === '' || markers[m].offsetY === null || markers[m].offsetY === undefined) ? null : parseFloat(markers[m].offsetY);

                    var image = markers[m].image ? {
                        url: 		markers[m].image.indexOf('/') === -1 ? '//maps.gstatic.com/mapfiles/markers2/' + markers[m].image : markers[m].image,
                        origin:     new google.maps.Point(0, 0),
                        scaledSize: new google.maps.Size(width, height) // scaled size

                    } : undefined;

                    if (image && offsetX !== null && offsetY !== null) image.anchor = new google.maps.Point(offsetY, offsetX);

                    var position;

                    if (vis.binds.map.isLonLatIsOID(markers[m].lon) && vis.binds.map.isLonLatIsOID(markers[m].lat)) {
                        position = vis.binds.map.googleMap.text2position(vis.states[markers[m].lon + '.val'] + ';' + vis.states[markers[m].lat + '.val'], markers[m].swap);
                    } else if (vis.binds.map.isLonLatIsOID(markers[m].lon)) {
                        position = vis.binds.map.googleMap.text2position(vis.states[markers[m].lon + '.val'], markers[m].swap);
                    } else {
                        position = vis.binds.map.googleMap.text2position(markers[m].lon.toString() + (markers[m].lat ? ';' + markers[m].lat : ''), markers[m].swap);
                    }
                    var marker = new google.maps.Marker({
                        position:   position,
                        icon: 		image,
                        label: 		markers[m].label || undefined,
                        map:        map,
                        title:      markers[m].text || undefined
                    });
                    if (opacity !== 1) {
                        marker.setOpacity(opacity);
                    }

                    if (markers[m].url || markers[m].view) {
                        (function (mm) {
                            marker.addListener('click', function() {
                                if (markers[mm].view) {
                                    vis.changeView(markers[mm].view, markers[mm].view);
                                } else {
                                    document.location = markers[mm].url;
                                }
                            });
                        })(m);
                    }
                    result.push(marker);
                }
                return result;
            },
            showMap: function (divElem, markerList, maxZoom, options) {
                options = options || {};
                options.mapTypeId = options.mapTypeId || google.maps.MapTypeId.ROADMAP;

                var map = new google.maps.Map(divElem, {
                    zoom: 			        maxZoom,
                    center: 		        new google.maps.LatLng(52.52, 13.41),
                    mapTypeId: 	            options.mapTypeId,
                    disableDefaultUI:       !!options.hideControls,
                    scrollwheel:            !options.noZoomAndPan,
                    disableDoubleClickZoom: !!options.noZoomAndPan,
                    panControl:             !options.noZoomAndPan
                });

                var $div = $(divElem);
                $div.css('border-radius', $div.parent().css('border-radius'));


                var markers = vis.binds.map.googleMap.setMarkers(map, markerList);
                vis.binds.map.googleMap.setCenter(map, markers, maxZoom);

                if (options.showTraffic) {
                    var trafficLayer = new google.maps.TrafficLayer();
                    trafficLayer.setMap(map);
                }
                return {map: map, markers: markers};
            },
            update: function ($div) {
                var obj     = $div.data('object');
                var markers = $div.data('markers');
                var maxZoom = $div.data('zoom');

                for (var m = 0; m < markers.length; m++) {
                    if (vis.binds.map.isLonLatIsOID(markers[m].lon) && vis.binds.map.isLonLatIsOID(markers[m].lat)) {
                        obj.markers[m].setPosition(vis.binds.map.googleMap.text2position(vis.states[markers[m].lon + '.val'] + ';' + vis.states[markers[m].lat + '.val'], markers[m].swap));
                    } else if (vis.binds.map.isLonLatIsOID(markers[m].lon)) {
                        obj.markers[m].setPosition(vis.binds.map.googleMap.text2position(vis.states[markers[m].lon + '.val'], markers[m].swap));
                    }
                }

                vis.binds.map.googleMap.setCenter(obj.map, obj.markers, maxZoom);
            },
            init: function (wid, view, data, style) {
                var $div = $('#' + wid);
                if (!$div.length) {
                    setTimeout(function () {
                        vis.binds.map.googleMap.init(wid, view, data, style);
                    }, 100);
                    return;
                }
                var $map = $div.find('.vis-widget-body');
                if (!data.apiKey) {
                    $map.append(_('No API key'));
                    return;
                }

                if (!$('#google_map').length) {
                    var script = document.createElement('script');
                    script.src = 'https://maps.googleapis.com/maps/api/js?key=' + data.apiKey + '&signed_in=false';
                    script.id = 'google_map';
                    document.head.appendChild(script);
                    $('#google_map').load(function () {
                        vis.binds.map.googleMap.loaded = true;
                        vis.binds.map.googleMap.init(wid, view, data, style);
                    });
                    return;
                } else if (!vis.binds.map.googleMap.loaded) {
                    $('#google_map').load(function () {
                        vis.binds.map.googleMap.init(wid, view, data, style);
                    });
                    return;
                }

                var options = {
                    mapTypeId:      google.maps.MapTypeId[data.mapTypeId || 'ROADMAP'],
                    hideControls:   data.hideControls || false,
                    noZoomAndPan:   data.noZoomAndPan || false,
                    showTraffic:    data.showTraffic === 'true' || data.showTraffic === true
                };
                var markers = [];

                for (var u = 1; u <= data.mCount; u++) {
                    if (data['markersLon-oid' + u]) {
                        var marker = {
                            lon:        data['markersLon-oid'   + u] || '',
                            lat:        data['markersLat-oid'   + u] || '',
                            image:      data['markersImage'     + u],
                            width:      data['markersWidth'     + u],
                            height:     data['markersHeight'    + u],
                            offsetX:    data['markersOffsetY'   + u],
                            offsetY:    data['markersOffsetX'   + u],
                            opacity:    data['markersOpacity'   + u],
                            text:       data['markersText'      + u] || undefined,
                            label:      data['markersLabel'     + u] || undefined,
                            view:       data['markersView'      + u] || undefined,
                            url:        data['markersUrl'       + u] || undefined,
                            swap:       data['markersSwap'      + u] === true || data['markersSwap'      + u] === 'true'
                        };
                        markers.push(marker);
                    }
                }

                $map.data('markers', markers);
                $map.data('zoom',    parseInt(data.maxZoom, 10) || 20);
                $map.data('object', vis.binds.map.googleMap.showMap($map[0], markers, parseInt(data.maxZoom, 10) || 20, options));

                function onChange() {
                    vis.binds.map.googleMap.update($map);
                }
                var bound = [];
                for (u = 1; u <= data.mCount; u++) {
                    if (vis.binds.map.isLonLatIsOID(data['markersLon-oid' + u])) {
                        vis.states.bind(data['markersLon-oid' + u] + '.val', onChange);
                        bound.push(data['markersLon-oid' + u] + '.val');
                    }
                    if (vis.binds.map.isLonLatIsOID(data['markersLat-oid' + u])) {
                        vis.states.bind(data['markersLat-oid' + u] + '.val', onChange);
                        bound.push(data['markersLat-oid' + u] + '.val');
                    }
                }
                if (bound.length) {
                    // remember all ids, that bound
                    $div.data('bound', bound);
                    // remember bind handler
                    $div.data('bindHandler', onChange);
                }
            }
        }
    };

    if (vis.editMode) {
        // find automatically google map api key
        vis.binds.map.onIdChanged = function (widgetID, view, newId, fields) {
            var changed = [];
            var key = vis.views[view].widgets[widgetID].data.apiKey;
            if (!key.trim()) {
                var obj = vis.objects['system.adapter.vis-map.0'];
                if (obj && obj.native && obj.native.googleApiKey) {
                    vis.views[view].widgets[widgetID].data.apiKey = obj.native.googleApiKey;
                    changed.push('apiKey');
                }
            }
            return changed.length ? changed : null;
        };
    }

    vis.binds.map.showVersion();
</script>
<style>
    a[href^="http://maps.google.com/maps"]{display: none !important}
    a[href^="https://maps.google.com/maps"]{display: none !important}

    .gmnoprint a, .gmnoprint span, .gm-style-cc {
        display: none;
    }
    .gmnoprint div {
        background: none !important;
    }
</style>

<script id="tplOsm"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="map"
        data-vis-name="Open Street Map"
        data-vis-type="map"
        data-vis-update-style="true"
        data-vis-prev='<img src="widgets/map/img/Prev_tplOsm.png"></img>'
        data-vis-attrs="mCount[1]/number,1,20,1;maxZoom[14]/slider,0,18,1;hideControls/checkbox;"
        data-vis-attrs0="group.markers/byindex;markersLon-oid(1-mCount)/id,gps;markersLat-oid(1-mCount)/id,gps;markersSwap(1-mCount)/checkbox;markersImage(1-mCount)/image;markersWidth(1-mCount)/slider,1,100,1;markersHeight(1-mCount)/slider,1,100,1;markersOffsetX(1-mCount)/slider,1,100,1;markersOffsetY(1-mCount)/slider,1,100,1;markersOpacity(1-mCount)/slider,0,1,0.05;markersView(1-mCount)/views;markersUrl(1-mCount)/text;"
        >
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow: hidden; width: 200px; height: 200px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" id="map_<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.map.osm.init(this.data.wid, this.view, this.data, this.style) %> style="position: relative;"></div>
    </div>
</script>

<script id="tplGoogleMap"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="map"
        data-vis-name="Google Map"
        data-vis-type="map"
        data-vis-update-style="true"
        data-vis-prev='<img src="widgets/map/img/Prev_tplGoogleMap.png"></img>'
        data-vis-attrs="mCount[1]/number,1,20,1;maxZoom[14]/slider,0,30,1;mapTypeId/select,ROADMAP,SATELLITE,HYBRID,TERRAIN;hideControls/checkbox;noZoomAndPan/checkbox;apiKey//onIdChanged;showTraffic/checkbox;"
        data-vis-attrs0="group.markers/byindex;markersLon-oid(1-mCount)/id,gps;markersLat-oid(1-mCount)/id,gps;markersSwap(1-mCount)/checkbox;markersImage(1-mCount)/image;markersWidth(1-mCount)/slider,1,100,1;markersHeight(1-mCount)/slider,1,100,1;markersOffsetX(1-mCount)/slider,1,100,1;markersOffsetY(1-mCount)/slider,1,100,1;markersText(1-mCount);markersLabel(1-mCount);markersOpacity(1-mCount)/slider,0,1,0.05;markersView(1-mCount)/views;markersUrl(1-mCount)/text;"
>
    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow: hidden; width: 200px; height: 200px; background-color: none !important" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" <%= (el) -> vis.binds.map.googleMap.init(this.data.wid, this.view, this.data, this.style) %>></div>
    </div>
</script>

<!-- --------------map.html--- END -->
<!-- --------------mihome-vacuum.html--- START -->
<script type="text/javascript">
    'use strict';

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            // Bars
            "picVisible":       {"en": "Background",        "de": "Hintergrund",        "ru": "Фон"},
            "oid-state":        {"en": "ID state",          "de": "Zustands ID",        "ru": "ID старт/стоп"},
            "oid-start":        {"en": "ID to start",       "de": "ID für Start",       "ru": "ID to start"},
            "oid-pause":        {"en": "ID to pause",       "de": "ID für Pause",       "ru": "ID to pause"},
            "oid-find":         {"en": "ID for search",     "de": "ID für Suche",       "ru": "ID для поиска"},
            "oid-home":         {"en": "ID go home",        "de": "ID zu Homebase",     "ru": "ID идти к базе"},
            "oid-power-level":  {"en": "ID for power level","de": "ID für Saugstufe",   "ru": "ID для мощности"},
            "oid-power-level-1":  {"en": "Value for power level 1","de": "Wert für Saugstufe 1",   "ru": "Value для мощности 1"},
            "oid-power-level-2":  {"en": "Value for power level 2","de": "Wert für Saugstufe 2",   "ru": "Value для мощности 2"},
            "oid-power-level-3":  {"en": "Value for power level 3","de": "Wert für Saugstufe 3",   "ru": "Value для мощности 3"},
            "oid-connected":    {"en": "ID is connected",   "de": "ID ist verbunden",   "ru": "ID online"}
        });
    }
    vis.binds['mihome-vacuum'] = {
        onclick: function (el, isRunning) {
            var oid = $(el).data('oid');
            if (oid) {
                var val = $(el).data('value');
                if (val) {
                    vis.setValue(oid, parseInt(val));
                } else {
                    if ($(el).data('type') === 'state') {
                        if (isRunning) {
                            vis.setValue($(el).data('pause'), true);
                        } else {
                            vis.setValue($(el).data('start'), true);
                        }
                    } else {
                        if ($(el).data('type') === 'home' && isRunning) {
                            // pause first to send back to the dock;
                            vis.setValue($(el).data('pause'), true);
                        }
                        vis.setValue(oid, true);
                    }
                }
            }
        }
    };

    if (vis.editMode) {
        vis.binds['mihome-vacuum'].changedId = function (widgetID, view, newId, attr, isCss, oldValue) {
            var obj = vis.objects[newId];
            var changed = [];

            if (oldValue) return false;

            if (obj) {
                var ids = newId.split('.');
                ids.pop();
                ids.pop();
                var id = ids.join('.');
                if (!vis.views[view].widgets[widgetID].data['oid-home'] && vis.objects[id + '.control.home']) {
                    vis.views[view].widgets[widgetID].data['oid-home'] = id + '.control.home';
                    vis.widgets[widgetID].data['oid-home'] = id + '.control.home';
                    changed.push('oid-home');
                }
                if (!vis.views[view].widgets[widgetID].data['oid-start'] && vis.objects[id + '.control.start']) {
                    vis.views[view].widgets[widgetID].data['oid-start'] = id + '.control.start';
                    vis.widgets[widgetID].data['oid-start'] = id + '.control.start';
                    changed.push('oid-start');
                }
                if (!vis.views[view].widgets[widgetID].data['oid-pause'] && vis.objects[id + '.control.pause']) {
                    vis.views[view].widgets[widgetID].data['oid-pause'] = id + '.control.pause';
                    vis.widgets[widgetID].data['oid-pause'] = id + '.control.pause';
                    changed.push('oid-pause');
                }
                if (!vis.views[view].widgets[widgetID].data['oid-connected'] && vis.objects[id + '.info.connection']) {
                    vis.views[view].widgets[widgetID].data['oid-connected'] = id + '.info.connection';
                    vis.widgets[widgetID].data['oid-connected'] = id + '.info.connection';
                    changed.push('oid-connected');
                }
                if (!vis.views[view].widgets[widgetID].data['oid-find'] && vis.objects[id + '.control.find']) {
                    vis.views[view].widgets[widgetID].data['oid-find'] = id + '.control.find';
                    vis.widgets[widgetID].data['oid-find'] = id + '.control.find';
                    changed.push('oid-find');
                }
                if (!vis.views[view].widgets[widgetID].data['oid-power-level'] && vis.objects[id + '.control.fan_power']) {
                    vis.views[view].widgets[widgetID].data['oid-power-level'] = id + '.control.fan_power';
                    vis.widgets[widgetID].data['oid-power-level'] = id + '.control.fan_power';
                    changed.push('oid-power-level');
                }
            }
            return changed.length ? changed : null;
        };
    }

</script>
<script id="tplXiaomiVacuum"
        type="text/ejs"
        class="vis-tpl"
        data-vis-type="ctrl"
        data-vis-set="mihome-vacuum"
        data-vis-name="Control"
        data-vis-prev='<img src="widgets/mihome-vacuum/img/previewControl.png"></img>'
        data-vis-attrs="oid-state/id/changedId;oid-home;oid-start;oid-pause;oid-connected;oid-find;oid-power-level;oid-power-level-1[101]/number;oid-power-level-2[102]/number;oid-power-level-3[104]/number;picVisible[true]/checkbox;"
>
<%
    function isRunning(data) {
        var val= vis.states.attr(data['oid-state'] + '.val');
        // 5 = Cleaning, 6 = Returning home, 11 = Spot cleaning, 17 = Zone cleaning
        return (val == 5 || val == 6 || val == 11 || val == 17);
    }
%>
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 130px; height: 130px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body" style="overflow: visible">
        <img src="widgets/mihome-vacuum/img/vacuum.png" style="width: 100%; height: 100%; <%= this.data.picVisible === true || this.data.picVisible === 'true' ? '' : 'display: none' %>"/>
        <div style="position: absolute;width: 33%;top: 0;left: 31%;border: 4px solid black; height: calc(100% - 8px);border-radius: 100px;">
            <div style="width: calc(100% - 8px); border: 4px solid <%= vis.states.attr(this.data['oid-connected'] + '.val') ? '#C6D4FF' : 'gray' %>; height: calc(100% - 8px); border-radius: 100px;
            /* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#9e9e9e+0,4c4c4c+100,4c4c4c+100 */
        background: rgb(158,158,158); /* Old browsers */
        background: -moz-linear-gradient(left,  rgba(158,158,158,1) 0%, rgba(76,76,76,1) 100%, rgba(76,76,76,1) 100%); /* FF3.6-15 */
        background: -webkit-linear-gradient(left,  rgba(158,158,158,1) 0%,rgba(76,76,76,1) 100%,rgba(76,76,76,1) 100%); /* Chrome10-25,Safari5.1-6 */
        background: linear-gradient(to right,  rgba(158,158,158,1) 0%,rgba(76,76,76,1) 100%,rgba(76,76,76,1) 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#9e9e9e', endColorstr='#4c4c4c',GradientType=1 ); /* IE6-9 */
        ">
            </div>
            <img onclick="vis.binds['mihome-vacuum'].onclick(this, <%= isRunning(this.data) %>)" data-pause="<%= this.data['oid-pause'] %>" data-start="<%= this.data['oid-start'] %>" data-type="state" data-oid="<%= this.data['oid-state'] %>" style="position: absolute; width: 60%; left: 20%; top: 15%;cursor: pointer;<%= this.data['oid-state'] ? '' : 'display: none;' %>" src="widgets/mihome-vacuum/img/<%= isRunning(this.data) ? 'on' : 'off' %>.png"  />
            <img onclick="vis.binds['mihome-vacuum'].onclick(this, <%= isRunning(this.data) %>)" data-type="home" data-pause="<%= this.data['oid-pause'] %>" data-oid="<%= this.data['oid-home'] %>" style="position: absolute;width: 60%;left: 20%;bottom: 15%;cursor: pointer;<%= this.data['oid-home'] ? '' : 'display: none;' %>" src="widgets/mihome-vacuum/img/home.png" />
        </div>
        </div>
        <img onclick="vis.binds['mihome-vacuum'].onclick(this)" data-oid="<%= this.data['oid-find'] %>" style="position: absolute; width: 20%; left: 8%; top: 39%;<%= this.data['oid-find'] ? 'cursor: pointer;' : 'display: none;' %>" src="widgets/mihome-vacuum/img/search.png"  />
        <div onclick="vis.binds['mihome-vacuum'].onclick(this)" data-value="<%= this.data['oid-power-level-1'] %>" data-oid="<%= this.data['oid-power-level'] %>" style="position: absolute;top: calc(27% - 8px); left: 72%; border: 1px gray solid; border-radius: 25px; width: 16px; height: 16px; text-align: center;cursor: pointer;<%= this.data['oid-power-level'] ? '' : 'display: none;' %>">1</div>
        <div onclick="vis.binds['mihome-vacuum'].onclick(this)" data-value="<%= this.data['oid-power-level-2'] %>" data-oid="<%= this.data['oid-power-level'] %>" style="position: absolute;top: calc(47% - 8px); left: 77%; border: 1px gray solid; border-radius: 25px; width: 16px; height: 16px; text-align: center;cursor: pointer;<%= this.data['oid-power-level'] ? '' : 'display: none;' %>">2</div>
        <div onclick="vis.binds['mihome-vacuum'].onclick(this)" data-value="<%= this.data['oid-power-level-3'] %>" data-oid="<%= this.data['oid-power-level'] %>" style="position: absolute;top: calc(66% - 8px); left: 72%; border: 1px gray solid; border-radius: 25px; width: 16px; height: 16px; text-align: center;cursor: pointer;<%= this.data['oid-power-level'] ? '' : 'display: none;' %>">3</div>
    </div>
</script>

<!-- --------------mihome-vacuum.html--- END -->
<!-- --------------swipe.html--- START -->
<style>
    .roundabout-holder {
        list-style: none;
        position: absolute;
        left:100px;
        top:10px;
        right: 0;
        margin: 0;
        overflow: visible;
        height: calc(100% - 20px);
        width: calc(100% - 200px);
    }

    .roundabout-moveable-item {
        text-align: center;
    }

    .li_carousel {
        background-color: rgba(0, 0, 0, 0);
        text-align: center;
        position: relative;
    }

    .carousel_blocking {
        position: relative;
        z-index: 149;
        width: 100%;
        height: 100%;
    }

    .roundabout-in-focus{
        z-index: 1000;
    }
</style>

<script type="text/javascript">
    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            "group_left":           {"en": "Swipe to left",     "de": "Swipe nach links",   "ru": "Сдвиг влево"},
            "left_nav_view":        {"en": "View name",         "de": "Viewname",           "ru": "Имя страницы"},
            "left_in_effect":       {"en": "In effect",         "de": "In-Effekt",          "ru": "In эффект"},
            "left_in_eff_opt":      {"en": "In options",        "de": "In-Optionen",        "ru": "In опции"},
            "left_out_effect":      {"en": "Out effect",        "de": "Out-Effekt",         "ru": "Out эффект"},
            "left_out_eff_opt":     {"en": "Out options",       "de": "Out-Optionen",       "ru": "Out опции"},
            "group_right":          {"en": "Swipe to right",    "de": "Swipe nach rechts",  "ru": "Сдвиг вправо"},
            "right_nav_view":       {"en": "View name",         "de": "Viewname",           "ru": "Имя страницы"},
            "right_in_effect":      {"en": "In effect",         "de": "In-Effekt",          "ru": "In эффект"},
            "right_in_eff_opt":     {"en": "In options",        "de": "In-Optionen",        "ru": "In опции"},
            "right_out_effect":     {"en": "Out effect",        "de": "Out-Effekt",         "ru": "Out эффект"},
            "right_out_eff_opt":    {"en": "Out options",       "de": "Out-Optionen",       "ru": "Out опции"},
            "Swipe Navigation":     {"en": "Swipe Navigation",  "de": "Swipe Navigation",   "ru": "Swipe навигация"}
        });
    }
    
    vis.binds.swipe = {
        loadedSwipe: false,
        loadedRound: false,
        loadSwipeScripts: function (cb) {
            if (vis.binds.swipe.loadedSwipe) {
                cb && cb();
            } else {
                vis.binds.swipe.loadedSwipe = true;
                $.ajax({
                    url: 'widgets/swipe/js/jquery.touchSwipe.min.js',
                    dataType: 'script',
                    success: function () {
                        cb && cb();
                    },
                    async: false
                });
            }
        },
        loadRoundScripts: function (cb) {
            if (vis.binds.swipe.loadedRound) {
                cb && cb();
            } else {
                vis.binds.swipe.loadedRound = true;
                $.ajax({
                    url: 'widgets/swipe/js/jquery.roundabout.min.js',
                    dataType: 'script',
                    success: function () {
                        jQuery.ajax({
                            url: 'widgets/swipe/js/jquery.roundabout-shapes.js',
                            dataType: 'script',
                            success: function () {
                                cb && cb();
                            },
                            async: false
                        });
                    },
                    async: false
                });
            }
        },
        swipeNav: function (wid, view, data, style) {
            var $div = $('#' + wid);
            // if nothing found => wait
            if (!$div.length) {
                setTimeout(function () {
                    vis.binds.swipe.swipeNav(wid, view, data, style);
                }, 100);
                return;
            }
            
            if (vis.editMode) {
                $div.show()
                    .find('.translate-it')
                        .each(function () {
                            $(this).html(_($(this).text()));
                        });
            }

            var $view = $('#visview_' + view);

            if (!vis.editMode) {
                vis.binds.swipe.loadSwipeScripts(function () {
                    $view.swipe({
                        swipeLeft: function () {
                            vis.changeView(data['left_nav_view'], data['left_nav_view'], {
                                effect: data['left_out_effect'],
                                options: {
                                    direction: data['left_out_eff_opt'],
                                    queue: false
                                }, duration: $div.attr('duration')
                            }, {
                                effect: data['left_in_effect'],
                                options: {direction: data['left_in_eff_opt'], queue: false},
                                duration: $div.attr('duration')
                            }, true)
                        },
                        swipeRight: function () {
                            vis.changeView(data['right_nav_view'], data['right_nav_view'], {
                                effect: data['right_out_effect'],
                                options: {direction: data['right_out_eff_opt'], queue: false},
                                duration: $div.attr('duration')
                            }, {
                                effect: data['right_in_effect'],
                                options: {direction: data['right_in_eff_opt'], queue: false},
                                duration: $div.attr('duration')
                            }, true)
                        }
                    });
                });
            }
        },
        applyCarousel: function ($div, childView) {
            var $childView = $div.find('#visview_' + childView);
            var count = $div.data('count');
            count = count || 0;

            if (!$childView.length) {
                count++;
                if (count > 20) {
                    return;
                }
                $div.data('count', count);
                setTimeout(function () {
                    vis.binds.swipe.applyCarousel($div, childView);
                }, 100);
                return;
            }
            var $all = $div.find('.vis-widget');
            $all.each(function () {
                var $id = $(this);
                var id = $id.attr('id');
                var idOldPos = $id.position();

                var $idAndChilds = $childView.children('[id^=' + id + ']');

                if ($idAndChilds.length === 1) {
                    $id.css({top: 0, left: 0});

                    $idAndChilds.wrapAll('<li id="li_' + id + '" class="li_carousel" ></li>');
                    $('#li_' + id).css({height: $id.css('height'), width: $id.css('width')});
                } else {
                    $idAndChilds.wrapAll('<div id="wrap_' + id + '" style="position: absolute; height: 50px; width: 50px; left: ' + (idOldPos.left * -1) + 'px; top:' + (idOldPos.top * -1) + 'px"></div>');
                    $('#wrap_' + id).wrap('<li id="li_' + id + '" class="li_carousel"></li>');
                    $('#li_' + id).css({height: $id.css('height'), width: $id.css('width')});
                }
            });

            $childView.children('.li_carousel').append('<div class="carousel_blocking"></div>');
            $childView.children('.li_carousel').wrapAll('<ul class="parent_carousel"></ul>');

            $childView.find('.parent_carousel')
                .bind('ready', function () {
                    var child = $('.roundabout-in-focus').children();
                    $(child[1]).removeClass('carousel_blocking');
                })
                .roundabout({
                    clickToFocus: true,
                    enableDrag: true,
                    dragFactor: 2,
                    minZ: 1,
                    maxZ: 100,
                    tilt: -4,
                    minOpacity: 0.2,
                    minScale: 1,
                    childSelector: '.li_carousel',
                    triggerFocusEvents: true,
                    triggerBlurEvents: true
                });

            $childView.find('.li_carousel')
                .bind('focus', function () {
                    var child = $(this).children();
                    $(child[1]).removeClass('carousel_blocking');
                    $(this).removeClass('roundabout-moveable-item')
                })
                .bind('blur', function () {
                    var child = $(this).children();
                    $(child[1]).addClass('carousel_blocking');
                    $(this).addClass('roundabout-moveable-item')
                });
        },
        carousel: function (wid, view, data, style) {
            var $div = $('#' + wid);
            var childView = data.contains_view;
            
            // if nothing found => wait
            if (!$div.length) {
                setTimeout(function () {
                    vis.binds.swipe.carousel(wid, view, data, style);
                }, 100);
                return;
            }

            if (view === data.contains_view) {
                $div.find('.vis-widget-body').attr('data-vis-contains', '');
                $div.html('<div style="color: red">' + _('Cannot show itself') + '</div>');
                return;
            }

            if (vis.editMode) return;

            vis.binds.swipe.loadRoundScripts(function () {
                vis.binds.swipe.applyCarousel($div, childView);
            });
        }
    };
</script>

<script id="tplSwipe"
        type="text/ejs"
        class="vis-tpl" 
        data-vis-set="swipe"
        data-vis-prev='<img src="widgets/swipe/img/Prev_Swipe.png"></img>'
        data-vis-name="swipe Navigation"
        data-vis-attrs="duration;"
        data-vis-attrs0="group.left;left_nav_view;left_in_effect[slide];left_in_eff_opt[right];left_out_effect[slide];left_out_eff_opt[left];"
        data-vis-attrs1="group.right;right_nav_view;right_in_effect[slide];right_in_eff_opt[left];right_out_effect[slide];right_out_eff_opt[right];">
    <div class="vis-widget <%== this.data.attr('class') %>" style="display: none; width: 160px; height: 64px; background-color: #333; color: #eee; border: 2px dashed red; opacity:0.8;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.swipe.swipeNav(this.data.wid, this.view, this.data, this.style) %>>
        <div class="vis-widget-body">
            <div style="font-weight: bold" class="translate-it">Swipe Navigation</div>
            <table>
                <tr><td style="width: 40px" class="translate-it">left</td><td style="width: 20px">&gt;</td><td><%= this.data.attr('left_nav_view') %></td></tr>
                <tr><td style="width: 40px" class="translate-it">right</td><td style="width: 20px">&lt;</td><td><%= this.data.attr('right_nav_view') %></td></tr>
            </table>
        </div>
    </div>
</script>


<script id="tplCarousel" 
        type="text/ejs"
        class="vis-tpl" 
        data-vis-set="swipe"
        data-vis-prev='<img src="widgets/swipe/img/Prev_Carousel.png"></img>'
        data-vis-name="Carousel"
        data-vis-attrs="contains_view/views">
    <div class="vis-widget <%== this.data.attr('class') %>" style="width: 300px; height: 100px;" id="<%= this.data.attr('wid') %>" <%= (el) -> vis.binds.swipe.carousel(this.data.wid, this.view, this.data, this.style) %>>
        <% if (vis.editMode) { %>
            <div class="editmode-helper" />
        <% } %>
        <div data-vis-contains="<%= this.data.attr('contains_view') %>" class="vis-widget-body vis-view-container"></div>
    </div>
</script>
<!-- --------------swipe.html--- END -->
<!-- --------------tabs.html--- START -->
<link rel="stylesheet" href="widgets/tabs/styles/jquery.sliderTabs.css">
<script src="widgets/tabs/jquery.sliderTabs.js"></script>
<script type="text/javascript">
    if (vis.editMode) {
        // Add words for widgets
        $.extend(true, systemDictionary, {
            "show_tabs":        {"en": "Tabs count",    "de": "Tabs-Anzahl",    "ru": "Количество закладок"},
            "title_tab_":       {"en": "Tab title",     "de": "Tab-Titel",      "ru": "Заголовок закладки"},
            "contains_view_":   {"en": "Contains view", "de": "View für Tab",   "ru": "Имя страницы"}
        });
    }

    vis.binds.tabs = {
        stabs: function (view, wid, data) {
            var $wid = $('#' + wid);
            var id = $wid.attr('id');
            if (id && id.match(/_removed$/)) {
                return;
            }

            if (!$wid.length) {
                return setTimeout(function () {
                    vis.binds.tabs.stabs(view, wid, data);
                }, 100);
            }
            // wait till widget will be visible
            if (!$wid.is(':visible')) {
                return setTimeout(function () {
                    vis.binds.tabs.stabs(view, wid, data);
                }, 1000);
            }

            $wid.find('.tabs-container').remove();
            var i;
            var text = '<span style="width: 100%; height: 100%" class="tabs-container">\n';
            text += '<ul>\n';

            data.show_tabs = parseInt(data.show_tabs, 10) || 1;

            for (i = 1; i <= data.show_tabs; i++) {
                text += '<li><a href="#' + wid + '_st' + i + '">' + (data['title_tab_' + i] || '') + '</a></li>';
            }
            text += '</ul>';

            for (i = 1; i <= data.show_tabs; i++) {
                text += '<div id="' + wid + '_st' + i + '" style="padding-left:0; height:100%">\n';
                if (vis.editMode) text += '    <div class="editmode-helper" />\n';
                text += '    <div data-vis-contains="' + (data['contains_view_' + i] || '') + '" class="vis-widget-body vis-view-container"></div>\n';
                text += '</div>\n';
            }
            text += '</span>';
            $wid.html(text);
            $wid.find('.tabs-container').sliderTabs({
                height: $wid.height() - 5
            });

            vis.updateContainers(view, view);

            if (vis.editMode && vis.activeWidgets.indexOf(wid) !== -1) {
                $wid.resizable('destroy');
                vis.resizable(vis.activeViewDiv, vis.activeView, $wid);
            }

            $wid.data('destroy', function (id, $widget) {
                try {
                    $widget.resizable('destroy');
                } catch (e) {

                }
            });
        }
    };
</script>

<script type="text/ejs" 
        id="tplSTab" 
        class="vis-tpl"
        data-vis-prev='<div id="prev_tplSTab" style=" position: relative; text-align: initial;padding: 4px "><div class="vis-widget_prev ui-selectee" style="top: 76px; left: 23px; width: 138px; height: 121px; position: absolute;" > <div class="vis-widget-prev-body"> <span style="width:100%;height:100%" class="ui-slider-tabs"> <!-- Unordered list representing the tabs --> <div class="ui-slider-tabs-list-wrapper"><div class="ui-slider-tabs-list-container" style="margin: 0px 35px;"><ul class="ui-slider-tabs-list" style="margin-left: 0px; width: 166px;"> <li class="selected" style="height: 32px;"><a href="#w00016_st1" style="height: 32px;">Tab</a></li><li style="height: 32px;"><a href="#w00016_st2" style="height: 32px;">Tab</a></li><li style="height: 32px;"><a href="#w00016_st3" style="height: 32px;">Tab</a></li></ul><a href="#" class="ui-slider-left-arrow edge" style="width: 35px; height: 32px;"><div></div></a><a href="#" class="ui-slider-right-arrow" style="width: 35px; height: 32px;"><div></div></a></div></div><div class="ui-slider-tabs-content-container" style="height: 86px;"><div style="padding-left: 0px; height: 100%; display: block; left: 0px; width: 126px;" class="ui-slider-tab-content selected"> <div class="editmode-helper"></div> <div data-vis-contains="hallo" class="vis-widget-body vis-view-container"></div> </div><div style="padding-left: 0px; height: 100%; left: 138px; width: 126px;" class="ui-slider-tab-content"> <div class="editmode-helper"></div> <div data-vis-contains="" class="vis-widget-body vis-view-container"></div> </div><div style="padding-left: 0px; height: 100%; left: 138px; width: 126px;" class="ui-slider-tab-content"> <div class="editmode-helper"></div> <div data-vis-contains="" class="vis-widget-body vis-view-container"></div> </div></div></span> </div> </div>'
        data-vis-set="tabs"
        data-vis-update-style="true"
        data-vis-name="SliderTabs" 
        data-vis-attrs="height[100]/slider,20,1000,1;show_tabs[1]/slider,1,8,1;title_tab_(1-show_tabs)[Tab];contains_view_(1-show_tabs)/views">
    <div class="vis-widget <%== this.data.attr('class') %>" style="top:0px; left: 0px; width: 250px; height: 250px;" id="<%= this.data.attr('wid') %>">
        <div class="vis-widget-body">
            <% vis.binds.tabs.stabs(this.view, this.data.attr('wid'), data) %>
        </div>
    </div>
</script>

<!-- --------------tabs.html--- END -->

<!-- ---------------------------------------  DO NOT EDIT INSIDE THIS LINE - END   ------------------------------------------- -->

<div id='waitScreen' class='vis-wait-screen'>
    <div id='waitDialog' class='waitDialog'>
        <div class='vis-progressbar '></div>
        <div class='vis-wait-text' id='waitText'></div>
    </div>
</div>

<div style="display: none;text-align: center" id="dialog_delete">
    <table style="height: 100%;width: 100%">
        <tr>
            <td><span class="ui-icon ui-icon-alert" style="display:inline-block"></span><span id="dialog_delete_content"
                                                                                              style="display:inline-block;padding-left:10px"></span>
            </td>
        </tr>
        <tr>
            <td style="text-align: left; vertical-align: bottom">
                <input type="checkbox" id="dialog_delete_is_show" style="display: inline-block; padding-left: 10px" />
                <label for="dialog_delete_is_show" class="translate" style="font-size: small">Do not ask again</label>
            </td>
        </tr>
    </table>
</div>
<div style="display: none;text-align: center" id="dialog_about" title="About" class="translateT"></div>
<div style="display: none;" id="dialog_export_view" title="export view" class="translateT">
    <textarea rows="60" cols="160" style="width: calc(100% - 5px); height: calc(100% - 5px); font-size: 11px;"
              id="textarea_export_view"></textarea>
</div>
<div style="display: none;" id="dialog_import_view" title="import view" class="translateT">
    <textarea rows="50" cols="160" style="width: 99%; height: calc(98% - 45px); font-size: 11px;"
              id="textarea_import_view"></textarea>
    <table class="table-no-space">
        <tr class="table-no-space">
            <td class="translate table-no-space">View name: </td>
            <td class="table-no-space"><input id="name_import_view"></td>
            <td class="table-no-space"><button id="start_import_view" class="translateB">import view</button></td>
        </tr>
    </table>
</div>
<div style="display: none; overflow: hidden" id="dialog_import_project" title="import project" class="translateT">
    <div class="vis-drop-zone" style="display: none">
        <div style="padding-top: 20%" class="translate vis-drop-text"></div>
        <input type="file" class="vis-drop-file" style="display: none">
    </div>
    <div class="vis-import-text-drop">
        <span class="vis-file-name translate">Drop files here or click to select one</span>
        <span class="vis-import-text-drop-plus">+</span>
    </div>
    <table style="padding: 15px; width: calc(100% - 30px);">
        <tr class="table-no-space">
            <td class="translate table-no-space" style="width: 20%">Project&nbsp;name:</td>
            <td class="table-no-space" style="width: 40%"><input id="name_import_project" style="width: 150px;"></td>
            <td class="table-no-space" style="width: 50%"><button id="start_import_project" class="translateB">import&nbsp;project</button></td>
        </tr>
    </table>
</div>

<div style="display: none;" id="dialog_export_widgets" title="export widgets title" class="translateT">
    <div><span class="translate">Export as zip:</span><input id="dialog_export_widgets_as_zip" type="checkbox"/></div>
    <textarea rows="60" cols="160" style="width: calc(100% - 15px); height: calc(100% - 45px); font-size: 11px;"
              id="textarea_export_widgets"></textarea>
</div>
<div style="display: none;" id="dialog_import_widgets" title="import widgets" class="translateT">
    <textarea rows="50" cols="160" style="width: 99%; height: calc(98% - 40px); font-size: 11px;"
              id="textarea_import_widgets"></textarea>
    <button id="start_import_widgets" class="translateB">import widgets</button>
</div>
<div style="display: none ;text-align: center" id="dialog_shortcuts" title="Shortcuts" class="translateT">
    <table style="height: 100%;width: 100%">
        <colgroup>
            <col style="text-align: left">
            <col style="text-align: center">
            <col style="text-align: center">
        </colgroup>
        <tr>
            <td class="translate">Full screen</td>
            <td></td>
            <td>F3</td>
        </tr>
        <tr>
            <td class="translate">Next View</td>
            <td></td>
            <td class="translate">PgUp</td>
        </tr>
        <tr>
            <td class="translate">Prev. View</td>
            <td></td>
            <td class="translate">PgDown</td>
        </tr>
        <tr>
            <td class="translate">Move Widget 1px</td>
            <td>
            </td>
            <td class="translate">Arrow Keys</td>
        </tr>
        <tr>
            <td class="translate">Move Widget 10px</td>
            <td class="translate">Ctrl / CMD</td>
            <td class="translate">Arrow Keys</td>
        </tr>
        <tr>
            <td class="translate" style="color:rgba(1,1,1,0.05)">Show develop ribbon</td>
            <td></td>
            <td style="color:rgba(1,1,1,0.05)">F2</td>
        </tr>
    </table>
</div>


<div style="height: 34px; width: 100%; position: absolute; top: 0;left:0" class="ui-widget-header ">

</div>
<div id="menu_body" style="display: none; padding: 0;border: none; background: transparent;z-index: 999 ">
    <div style="margin-left: 5px; display: inline-block; position: relative;top:-4px"><span class="ui-widget-header"  style="border: 0">vis </span><span id="vis-version" class="ui-widget-header" style="border: 0"></span></div>
    <div class="vis-menu-line" style="position: absolute; top: 37px; left: 0; height: 5px; width: 100%; background: #3C98D3; z-index: 1000;"></div>
    <ul style="border-radius: 0;display: inline-block; background: transparent; border: none;margin-bottom: -4px;position: relative; z-index: 2">
        <li id="ribbon_tab_datei" style="display: none">
            <a href="#ribbon_file" style="padding: 2px 4px 2px 4px" class="translate">File</a>
        </li>
        <li>
            <a href="#ribbon_view" style="padding: 2px 4px 2px 4px" class=" translate">Views</a>
        </li>
        <li>
            <a href="#ribbon_widget" style="padding: 2px 4px 2px 4px" class="translate">Widgets</a>
        </li>
        <li id="ribbon_tab_dev" style="display: none">
            <a href="#ribbon_dev" style="padding: 2px 4px 2px 4px" class="translate">Dev</a>
        </li>
        <li>
            <a href="#ribbon_tools" style="padding: 2px 4px 2px 4px" class="translate">Tools</a>
        </li>
    </ul>
    <div id="menu_sf" style="display: inline-block; margin-bottom: -4px; margin-left: -14px;">
        <ul id="menu" style="margin: 0; height: auto;" class="ui-tabs-nav sf-menu" >
            <li class="ui-state-default ui-corner-top menu-tab" role="tab" style="padding: 1px 4px 1px 4px"><a class="menu-tab-text translate">Setup</a>
                <ul style="display: none;" class="ui-widget-content">
                    <li class="ui-state-default menu-item" role="tab">
                        <a class="menu-tab-text"><span class="translate">Theme</span><span style="float: right;margin-top:4px" class="ui-icon ui-icon-carat-1-e"></span></a>
                        <ul id="ul_theme" class="ui-widget-content">
                            <li class="ui-state-default menu-item" data-theme="custom-light">
                                <a data-info="custom-light">Light</a>
                            </li>
                            <li class="ui-state-default menu-item" data-theme="custom-dark">
                                <a data-info="custom-dark">Dark</a>
                            </li>
                            <li class="ui-state-default menu-item" data-theme="dark-hive">
                                <a data-info="dark-hive">Dark-Hive</a>
                            </li>
                            <li class="ui-state-default menu-item" data-theme="redmond">
                                <a data-info="redmond">redmond</a>
                            </li>
                        </ul>
                    </li>
                    <li class="ui-state-default menu-item" role="tab">
                        <a class="menu-tab-text"><span class="translate">Language</span><span style="float: right;margin-top:4px" class="ui-icon ui-icon-carat-1-e"></span></a>
                        <ul class="ui-widget-content">
                            <li class="ui-state-default language-select menu-item" data-language="de">
                                <a>Deutsch</a>
                            </li>
                            <li class="ui-state-default language-select menu-item" data-language="en">
                                <a>English</a>
                            </li>
                            <li class="ui-state-default language-select menu-item" data-language="ru">
                                <a>русский</a>
                            </li>
                        </ul>
                    </li>
                    <li id="li_menu_projects" class="ui-state-default menu-item" role="tab">
                        <a class="menu-tab-text"><span class="translate">Projects</span><span style="float: right; margin-top:4px" class="ui-icon ui-icon-carat-1-e"></span></a>
                        <ul id="menu_projects" class="ui-widget-content">
                            <li class="ui-state-default project-select menu-item" data-language="de"><a>Main</a></li>
                        </ul>
                    </li>
                    <li id="li_menu_export" class="ui-state-default menu-item" role="tab">
                        <a class="menu-tab-text"><span class="translate">Project export/import</span><span style="float: right; margin-top:4px" class="ui-icon ui-icon-carat-1-e"></span></a>
                        <ul class="ui-widget-content">
                            <li class="ui-state-default menu-item translate export-normal">Export normal</li>
                            <li class="ui-state-default menu-item translate export-anonymized">Export anonymized</li>
                            <li class="ui-state-default menu-item translate import-normal">Import</li>
                        </ul>
                    </li>
                    <li id="li_menu_new_project" class="ui-state-default menu-item project-new" role="tab">
                        <a class="menu-tab-text"><span class="translate">New project...</span></a>
                    </li>
                    <li id="li_menu_file_manager" class="ui-state-default menu-item" role="tab" >
                        <a class="menu-tab-text"><span class="translate">File manager...</span></a>
                    </li>
                    <li id="li_menu_setup_settings" class="ui-state-default menu-item setup-settings" role="tab">
                        <a class="menu-tab-text"><span class="translate">Settings...</span></a>
                    </li>
                    <li id="li_menu_object_browser" class="ui-state-default menu-item" role="tab" >
                        <a class="menu-tab-text"><span class="translate">Object browser...</span></a>
                    </li>
                </ul>
            </li>
            <li class="ui-state-default ui-corner-top menu-tab" role="tab" style="padding: 1px 4px 1px 4px"><a class="menu-tab-text translate">Help</a>
                <ul style="display: none;" class="ui-widget-content">
                    <li class="ui-state-default menu-item" style="width: 252px ; background-image: none"><a id="m_shortcuts" class="translate">Shortcuts</a></li>
                    <li class="ui-state-default menu-item" style="width: 252px ; background-image: none"><a id="m_about" class="translate">About</a></li>
                </ul>
            </li>
        </ul>
    </div>
    <button id="button_undo"></button>
    <table style="display: inline-block; float: right">
        <tr>
            <td>
                <div class="ui-widget-header" style="border: 0; padding-right: 10px; height: 16px">
                    <span  style="display: inline-block;" id="current-project"></span> [<span  style="display: inline-block;" class="ui-icon ui-icon-person"></span>
                    <span style="display: inline-block;" id="current-user"></span>]
                </div>
            </td>
            <td style="width:30px"><button id="saving_progress"></button></td>
            <td><button id="logout_button" class="ui-state-default ui-corner-top translateT" style="display: none;" title="Logout"></button></td>
            <td><div><button id="exit_button"></button>
                <button id="exit_button_select"></button></div>
                <ul style="display: none; position: absolute; z-index: 1000; width: 400px" id="exit_button_select_menu">
                    <li data-value="close"><span class="ui-icon ui-icon-close"></span><span class="translate">Switch to runtime in this window</span></li>
                    <li data-value="play"><span class="ui-icon ui-icon-play"></span><span class="translate">Switch to runtime in new window</span></li>
                    <li data-value="refresh"><span class="ui-icon ui-icon-refresh"></span><span class="translate">Reload all runtimes</span></li>
                </ul>
            </td>
        </tr>
    </table>

    <div class="ribbon_tab" id="ribbon_file">
        <div class="ribbon_tab_content ui-widget-content"></div>
    </div>
    <div class="ribbon_tab" id="ribbon_view">
        <div class="ribbon_tab_content ui-widget-content">
            <div class="ribbon_field ui-widget-content ui-corner-all" style="width: 500px;">
                <table style="border-spacing: 0; width: 100%">
                    <colgroup>
                        <col width="80px" style="text-align:left"/>
                        <col width="100%"/>
                        <col span="10" width="26px"/>
                    </colgroup>
                    <tr id="rib_view_add_tr" style="display:none">
                        <td style=" height: 22px; padding-right:3px" class="translate">New Name:</td>
                        <td>
                            <input id="rib_view_addname" >
                        </td>
                        <td>
                            <div id="rib_view_add_ok" class="btn-iconbar ui-corner-all"></div>
                        </td>
                        <td>
                            <div id="rib_view_add_cancel" class="btn-iconbar ui-corner-all"></div>
                        </td>
                    </tr>
                    <tr id="rib_view_rename_tr" style="display:none">
                        <td style=" height: 22px; padding-right:3px" class="translate">New Name:</td>
                        <td>
                            <input id="rib_view_newname" >
                        </td>
                        <td>
                            <div id="rib_view_rename_ok" class="btn-iconbar ui-corner-all"><img class="icon-on-iconbar" src="icon/ok.png"></div>
                        </td>
                        <td>
                            <div id="rib_view_rename_cancel" class="btn-iconbar ui-corner-all"><img class="icon-on-iconbar" src="icon/cancel.png"></div>
                        </td>
                    </tr>
                    <tr id="rib_view_copy_tr" style="display:none">
                        <td style=" height: 22px; padding-right:3px" class="translate">New Name:</td>
                        <td>
                            <input id="rib_view_copyname" >
                        </td>
                        <td>
                            <div id="rib_view_copy_ok" class="btn-iconbar ui-corner-all"><img class="icon-on-iconbar" src="icon/ok.png"></div>
                        </td>
                        <td>
                            <div id="rib_view_copy_cancel" class="btn-iconbar ui-corner-all"><img class="icon-on-iconbar" src="icon/cancel.png"></div>
                        </td>
                    </tr>
                    <tr id="rib_view">
                        <td style=" height: 22px; padding-right:3px" class="translate">Active View:</td>
                        <td>
                            <select id="select_view" style="width: 310px"></select>
                        </td>
                        <td>
                            <div id="rib_view_add" class="btn-iconbar ui-corner-all translateT" title="Add new view"><img class="icon-on-iconbar" src="icon/add.png" style="width: 16px;height: 16px;margin: 3px;"></div>
                        </td>
                        <td>
                            <div id="rib_view_del" class="btn-iconbar ui-corner-all translateT" title="Delete actual view"><img class="icon-on-iconbar" src="icon/delete.png"></div>
                        </td>
                        <td>
                            <div id="rib_view_rename" class="btn-iconbar ui-corner-all translateT" title="Rename view"><img class="icon-on-iconbar" src="icon/rename.png"></div>
                        </td>
                        <td>
                            <div id="rib_view_copy" class="btn-iconbar ui-corner-all translateT" title="Copy view"><img class="icon-on-iconbar" src="icon/copy.png"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <button class="vis-editor translateB" id="export_view">export view</button>
                        </td>
                        <td>
                            <button class="vis-editor translateB" id="import_view">import view</button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="ribbon_tab" id="ribbon_widget">
        <div class="ribbon_tab_content ui-widget-content">
            <div class="ribbon_field ui-widget-content ui-corner-all" style="width: 461px;">
                <table style="border-spacing: 0; width: 100%; text-align: left">
                    <colgroup>
                        <col width="80px" style="text-align: left"/>
                        <col width="100%"/>
                        <col span="10" width="26px"/>
                        <col span="10" width="26px"/>
                        <col span="10" width="26px"/>
                    </colgroup>
                    <tr id="rib_wid_copy_tr" style="display:none">
                        <td style="height: 22px; padding-right: 3px" class="translate">To View:</td>
                        <td><select id="rib_wid_copy_view" style="width: 310px"></select></td>
                        <td><div id="rib_wid_copy_ok"     class="btn-iconbar ui-corner-all"></div></td>
                        <td colspan="2"><div id="rib_wid_copy_cancel" class="btn-iconbar ui-corner-all"></div></td>
                    </tr>
                    <tr id="rib_wid">
                        <td style=" height: 22px; padding-right:3px" class="translate">Active Widget:</td>
                        <td><select id="select_active_widget" multiple="multiple" data-multiselect-width="400" data-multiselect-height="250"></select></td>
                        <td><div id="rib_wid_del"  class="btn-iconbar ui-corner-all translateT" title="Delete widget"></div></td>
                        <td><div id="rib_wid_copy" class="btn-iconbar ui-corner-all translateT" title="Copy widget"></div></td>
                        <td><div id="rib_wid_doc"  class="btn-iconbar ui-corner-all translateT" title="Help about widget"></div></td>
                    </tr>
                </table>
            </div>
            <!--<div class="ribbon_field ui-widget-content ui-corner-all"style="display:none">-->
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td class="translate" style="text-align: center; height: 22px; padding-right: 3px">Align widgets:</td>
                        <td>
                            <div id="wid_align_left" class="btn-iconbar ui-corner-all translateT" title="Align horizontal/left"><img class="icon-on-iconbar" src="icon/align-horizontal-left.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_right" class="btn-iconbar ui-corner-all translateT" title="Align horizontal/right"><img class="icon-on-iconbar" src="icon/align-horizontal-right-2.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_top" class="btn-iconbar ui-corner-all translateT" title="Align vertical/top"><img class="icon-on-iconbar" src="icon/align-vertical-top-2.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_bottom" class="btn-iconbar ui-corner-all translateT" title="Align vertical/bottom"><img class="icon-on-iconbar" src="icon/align-vertical-bottom-2.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_hc" class="btn-iconbar ui-corner-all translateT" title="Align horizontal/center"><img class="icon-on-iconbar" src="icon/align-horizontal-center-2.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_vc" class="btn-iconbar ui-corner-all translateT" title="Align vertical/center"><img class="icon-on-iconbar" src="icon/align-vertical-center-2.png"></div>
                        </td>
                        <td>
                            <div id="wid_dis_h" class="btn-iconbar ui-corner-all translateT" title="Align horizontal/equal"><img class="icon-on-iconbar" src="icon/distribute-horizontal-equal.png"></div>
                        </td>
                        <td>
                            <div id="wid_dis_v" class="btn-iconbar ui-corner-all translateT" title="Align vertical/equal"><img class="icon-on-iconbar" src="icon/distribute-vertical-equal.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_width" class="btn-iconbar ui-corner-all translateT" title="Align width"><img class="icon-on-iconbar" src="icon/align-width.png"></div>
                        </td>
                        <td>
                            <div id="wid_align_height" class="btn-iconbar ui-corner-all translateT" title="Align height"><img class="icon-on-iconbar" src="icon/align-height.png"></div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all" style="">
                <table style="border-spacing: 0">
                    <tr>
                        <td class="translate" style="text-align: center; height: 22px; padding-right: 3px">All widgets:</td>
                        <td>
                            <input id="wid_all_lock_function" type="checkbox" /><label style="width: 23px; height: 23px" id="wid_all_lock_f" for="wid_all_lock_function" class="translateT ttt" title="Lock Widget function"></label>
                        </td>
                        <td>
                            <input id="wid_all_lock_drag" type="checkbox" /><label style="width: 23px;height: 23px" id="wid_all_lock_d" for="wid_all_lock_drag"  class="translateT" title="Lock Widget dragging"></label>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <button class="vis-editor translateB" id="export_widgets">export widgets</button>
                        </td>
                        <td>
                            <button class="vis-editor translateB" id="import_widgets">import widgets</button>
                        </td>
                    </tr>
                </table>
            </div>

        </div>
    </div>
    <div class="ribbon_tab" id="ribbon_tools" >
        <div class="ribbon_tab_content ui-widget-content" >
            <div class="ribbon_field ui-widget-content ui-corner-all" style="width: 550px">
                <table style="border-spacing: 0; width: 100%">
                    <colgroup>
                        <col width="80px" style="text-align:left"/>
                        <col width="100%"/>
                        <col span="10" width="26px"/>
                    </colgroup>
                    <tr id="rib_tools_resolution_manuel" style="display:none">
                        <td class="translate">Resolution:</td>
                        <td><table style="border: 0"><tr>
                            <td><div style="display: inline-block" class="translate">Width</div></td>
                            <td><input id="screen_size_x" type="number" style="width: 60px" value=""/></td>
                            <td><div style="display: inline-block" class="translate">Height</div></td>
                            <td><input id="screen_size_y" type="number" style="width: 60px" value=""/></td>
                            </tr></table>
                        </td>
                        <td>
                            <div class="rib_tool_resolution_toggle"></div>
                        </td>
                        <td>
                            <table style="border: 0">
                                <tr>
                                    <td><label for="screen_default_man" title="Default screen" class="translate translateT">Default:</label></td><td><input class="vis-screen-default" id="screen_default_man" type="checkbox"/></td>
                                    <td><label for="render_always_man"  title="Render always"  class="translate translateT">Render always:</label></td><td><input class="vis-screen-render-always" id="render_always_man" type="checkbox"/></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr id="rib_tools_resolution_fix">
                        <td class="translate">Resolution:</td>
                        <td>
                            <select id="screen_size">
                                <option value="" class="translate">not defined</option>
                                <option value="user" class="translate">User defined</option>
                                <option value="320x460">iPhone 3G, 3GS, 4, 4S - Portrait</option>
                                <option value="480x300">iPhone 3G, 3GS, 4, 4S - Landscape</option>
                                <option value="320x548">iPhone 5, 5S - Portrait</option>
                                <option value="568x300">iPhone 5, 5S - Landscape</option>
                                <option value="768x1004">iPad - Portrait</option>
                                <option value="1024x748">iPad - Landscape</option>
                                <option value="320x533">Samsung S2 - Portrait</option>
                                <option value="533x320">Samsung S2 - Landscape</option>
                                <option value="360x640">Samsung S3, Note 2 - Portrait</option>
                                <option value="640x360">Samsung S3, Note 2 - Landscape</option>
                                <option value="360x640">Samsung S4, S5, Note 3 - Portrait</option>
                                <option value="640x360">Samsung S4, S5, Note 3 - Landscape</option>
                                <option value="384x640">Nexus 4 - Portrait</option>
                                <option value="640x384">Nexus 4 - Landscape</option>
                                <option value="360x640">Nexus 5 - Portrait</option>
                                <option value="640x360">Nexus 5 - Landscape</option>
                                <option value="604x966">Nexus 7 (2012) - Portrait</option>
                                <option value="966x604">Nexus 7 (2012) - Landscape</option>
                                <option value="800x1280">Nexus 10 - Portrait</option>
                                <option value="1280x800">Nexus 10 - Landscape</option>
                                <option value="720x1280">HD - Portrait</option>
                                <option value="1280x720">HD - Landscape</option>
                                <option value="1080x1920">Full HD - Portrait</option>
                                <option value="1920x1080">Full HD - Landscape</option>
                            </select>
                        </td>
                        <td>
                            <div class="rib_tool_resolution_toggle"></div>
                        </td>
                        <td>
                            <table style="border: 0">
                                <tr>
                                    <td><label for="screen_default_fix" title="Default screen" class="translate translateT">Default:</label></td><td><input class="vis-screen-default" id="screen_default_fix" type="checkbox"/></td>
                                    <td><label for="render_always_fix"      title="Render always"  class="translate translateT">Render always:</label></td><td><input class="vis-screen-render-always" id="render_always_fix" type="checkbox"/></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <span style=" display: inline-block;" class="translate">Grid</span>
                        </td>
                        <td style="padding-left: 5px">
                            <select id="snap_type">
                                <option value="0" class="translate">disabled</option>
                                <option value="1" class="translate">elements</option>
                                <option value="2" class="translate">grid</option>
                            </select>
                        </td>
                        <td class="translate" style="padding-left: 5px">grid size</td>
                        <td><input id="grid_size" type="number" value=""></td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <span style="display: inline-block" class="translate">Instance ID</span>
                        </td>
                        <td>
                            <input id="vis_instance"/>
                        </td>
                        <td>
                            <button type="button" class="vis-editor translateB" id="create_instance">create_instance</button>
                        </td>

                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <span style="display: inline-block" class="translate translateT" title="Make available for all users">Available for all:</span>
                        </td>
                        <td>
                            <input type="checkbox" id="vis_access_mode"/>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all" style="display: none">
                <table style="border-spacing: 0">
                    <tr>
                        <td style="width: 80px" class='translate'>Room:</td>
                        <td><select id="wizard_rooms"></select></td>
                        <td style="width: 80px" class='translate'>Function:</td>
                        <td><select id="wizard_funcs"></select></td>
                        <td style="width: 80px" class='translate'>Widget:</td>
                        <td><select id="wizard_widgets"></select></td>
                    </tr>
                </table>
            </div>
        </div>

    </div>
    <div class="ribbon_tab" id="ribbon_dev">
        <div class="ribbon_tab_content ui-widget-content">
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <button id="dev_show_html">Show Widget HTML</button>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="ribbon_field ui-widget-content ui-corner-all">
                <table style="border-spacing: 0">
                    <tr>
                        <td>
                            <button class="vis-editor translateB" id="export_local_view">export views</button>
                        </td>
                        <td>
                            <button class="vis-editor translateB" id="import_local_view">import views</button>
                        </td>
                        <td>
                            <button class="vis-editor translateB" id="clear_local_view">clear cached views</button>
                        </td>
                    </tr>
                </table>
            </div>

        <div class="ribbon_field ui-widget-content ui-corner-all">
            <table style="border-spacing: 0; text-align: center">
                <tr>
                    <td class="translate">dev1</td>
                    <td class="translate">dev2</td>
                    <td class="translate">dev3</td>
                    <td class="translate">dev4</td>
                    <td class="translate">dev5</td>
                    <td class="translate">dev6</td>
                </tr>
                <tr>
                    <td>
                        <input type="number" value="0" step="1" class="vis-editor oid-dev" id="oid_dev1"/>
                    </td>
                    <td>
                        <input type="number" value="0" step="1" class="vis-editor oid-dev" id="oid_dev2"/>
                    </td>
                    <td>
                        <input type="number" value="0" step="1" class="vis-editor oid-dev" id="oid_dev3"/>
                    </td>
                    <td>
                        <input type="number" value="0.0" step="0.1" class="vis-editor oid-dev" id="oid_dev4"/>
                    </td>
                    <td>
                        <input type="number" value="1" step="1" class="vis-editor oid-dev" id="oid_dev5"/>
                    </td>
                    <td>
                        <input value="string" class="vis-editor oid-dev" id="oid_dev6"/>
                    </td>
                </tr>
            </table>
        </div>
        </div>
    </div>
</div>

<div id="panel_body" class="ui-widget-content" style="display: none; height: 100%">
    <div class="ui-widget-content" id="pan_add_wid">
        <div class="ui-state-default" style="height:16px;font-size:16px;padding: 5px;font-weight: bolder;">
            <span class="translate">Add Widget</span>
            <div id="btn_prev_type" title="Show type of widgets" class="translateT"><span class="ui-icon ui-icon-tag"></span></div>
            <div id="btn_prev_zoom" title="Small widgets" class="translateT"><span class="ui-icon ui-icon-zoomout"></span></div>
        </div>
        <input id="filter_set" value="*" style="width: 100%" class="translateT" title="Widgets filter. Double click to clear."/>
        <select id="select_set" style="width: 100%" class="select-set"></select>

        <div id="toolbox" class="toolbox">
            <ul id="context_menu_template" style="position: absolute; display: none; z-index: 999; min-width: 100px">
                <li id="context_menu_template_edit"    class="context-template-submenu"  data-action="edit">
                    <span class="translate">Edit</span>
                </li>
                <li id="context_menu_template_delete"  class="context-template-submenu" data-action="delete">
                    <span class="translate">Delete</span>
                </li>
            </ul>
        </div>

    </div>
    <div id="vis_wrap">
        <div id="view_select" class="ui-widget-content">
            <button id="view_select_left"></button>
            <button id="view_select_list"></button>
            <button id="view_select_right"></button>
            <div id="view_select_tabs_wrap">
                <div id="view_select_tabs"></div>
            </div>
        </div>
        <div id="vis_container" style="width: 100%; height: 100%; overflow: auto" class="ui-widget-content vis_container_edit vis_container">
            <div id="size_x"
                 style="display: none; z-index: 99; position: absolute; top: 0; width:0; border-right: 1px solid red; height: 100%; border-left: 1px solid green;"></div>
            <div id="size_y"
                 style="display:none; z-index: 99; position: absolute; left: 0; height:0; border-bottom: 1px solid red; width: 100%; border-top: 1px solid green;"></div>
            <ul id="context_menu" style="position: absolute; display: none; z-index: 999; min-width: 150px">
                <li id="context_menu_wid"     class="ui-state-disabled"></li>
                <li id="context_menu_select"  class="context-submenu context-menu-common-item" data-action="select">
                    <span class="translate">Select</span>
                </li>
                <li id="context_menu_group"   class="context-menu-common-item" data-action="group">
                    <span class="ui-icon ui-icon-newwin"></span>
                    <span class="translate">to group</span>
                </li>
                <li id="context_menu_ungroup" class="context-menu-common-item" data-action="ungroup">
                    <span class="ui-icon ui-icon-arrow-4-diag"></span>
                    <span class="translate">Ungroup</span>
                </li>
                <li id="context_menu_group2template" class="context-menu-common-item" data-action="group2template">
                    <span class="ui-icon ui-icon-tag"></span>
                    <span class="translate">Make template</span>
                </li>
                <li id="context_menu_copy"    class="context-menu-action context-menu-common-item" data-action="copy">
                    <span class="ui-icon ui-icon-copy"></span>
                    <span class="translate">Copy</span>
                </li>
                <li id="context_menu_cut"     class="context-menu-action context-menu-common-item" data-action="cut">
                    <span class="ui-icon ui-icon-scissors"></span>
                    <span class="translate">Cut</span>
                </li>
                <li id="context_menu_paste"   class="context-menu-common-item" data-action="paste">
                    <span class="ui-icon ui-icon-document"></span>
                    <span class="translate">Paste</span>
                </li>
                <li id="context_menu_delete"  class="context-menu-action context-menu-common-item" data-action="delete">
                    <span class="ui-icon ui-icon-trash"></span>
                    <span class="translate">Delete</span>
                </li>
                <li id="context_menu_more"><span class="translate">More</span>
                    <ul style="min-width: 150px">
                        <li id="context_menu_lock" class="context-menu-action context-menu-common-item" data-action="lock">
                            <span class="ui-icon ui-icon-locked"></span>
                            <span class="translate">Lock</span>
                        </li>
                        <li id="context_menu_unlock" class="context-menu-action context-menu-common-item" data-action="unlock">
                            <span class="ui-icon ui-icon-unlocked"></span>
                            <span class="translate">Unlock</span>
                        </li>
                        <li id="context_menu_front" class="context-menu-action context-menu-common-item" data-action="bringToFront">
                            <span class="ui-icon ui-icon-arrowthick-1-n"></span>
                            <span class="translate">Bring to front</span>
                        </li>
                        <li id="context_menu_back" class="context-menu-action context-menu-common-item" data-action="bringToBack">
                            <span class="ui-icon ui-icon-arrowthick-1-s"></span>
                            <span class="translate">Move to back</span>
                        </li>
                        <li id="context_menu_export" class="context-menu-action context-menu-common-item" data-action="export">
                            <span class="ui-icon ui-icon-arrowthickstop-1-e"></span>
                            <span class="translate">export widgets</span>
                        </li>
                        <li id="context_menu_import">
                            <span class="ui-icon ui-icon-arrowthickstop-1-w"></span>
                            <span class="translate">import widgets</span>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div id="attr_wrap">
        <div id="pan_attr">
            <div class="ui-state-default" style="height: 16px;font-size: 16px;padding: 5px;font-weight: bolder;"><span class="translate">Attributes</span><button id="btn_accordeon" style="float: right;"></button></div>
            <ul style="border-radius: 0; display: inline-block; background: transparent; border: none; margin-bottom: -2px">
                <li>
                    <a href="#tab_view_attr" style="padding: 2px 4px 2px 4px" class="translate">View</a>
                </li>
                <li>
                    <a id="widget_tab" href="#tab_wid_attr" style="padding: 2px 4px 2px 4px" class="translate">Widget</a>
                </li>
                <li>
                    <a id="cssEditor_tab" href="#tab_css_edit" style="padding: 2px 4px 2px 4px" class="translate">CSS</a>
                </li>
                <li>
                    <a id="script_editor_tab" href="#tab_script_edit" style="padding: 2px 4px 2px 4px" class="translate">Scripts</a>
                </li>
            </ul>
            <div class="tab_attr ui-widget-content" id="tab_view_attr">
                <div id="view_inspector">
                    <table style="width: 100%; border: 0">
                        <colgroup>
                            <col width="40%"/>
                            <col width="60%"  style="padding-right: 5px"/>
                            <col width="26px" style=""/>
                        </colgroup>
                        <tbody>
                            <tr><td colspan="3" class="ui-state-default"><span class="translate">group_css_common</span><button class="view-group" style="float:right" data-group="view-css-common"></button></td></tr>
                            <tr class="group-view-css-common">
                                <td class="vis-edit-td-caption translate">comment</td>
                                <td class="vis-edit-td-field" colspan="2"><input id="inspect_view_comment" class="vis-inspect-view vis-edit-textbox"/></td>
                            </tr>
                            <tr class="group-view-css-common">
                                <td class="vis-edit-td-caption translate">class</td>
                                <td class="vis-edit-td-field" colspan="2"><input id="inspect_view_class" class="vis-inspect-view vis-edit-textbox"/></td>

                            </tr>
                            <tr class="group-view-css-common">
                                <td class="vis-edit-td-caption translateT" style="font-style: italic" title="filter_key_tooltip"><span class="translate">filter_key</span></td>
                                <td class="vis-edit-td-field" colspan="2"><input id="inspect_view_filterkey" class="vis-inspect-view vis-edit-textbox"/></td>
                            </tr>
                            <tr class="group-view-css-common">
                                <td class="vis-edit-td-caption translate">Theme</td>
                                <td class="vis-edit-td-field" colspan="2">
                                    <select id="inspect_view_theme" class="vis-edit-textbox" style="width:100%">
                                        <option value="black-tie">black-tie</option>
                                        <option value="blitzer">blitzer</option>
                                        <option value="cupertino">cupertino</option>
                                        <option value="custom-dark">custom-dark</option>
                                        <option value="custom-light">custom-light</option>
                                        <option value="dark-hive">dark-hive</option>
                                        <option value="dot-luv">dot-luv</option>
                                        <option value="eggplant">eggplant</option>
                                        <option value="excite-bike">excite-bike</option>
                                        <option value="flick">flick</option>
                                        <option value="hot-sneaks">hot-sneaks</option>
                                        <option value="humanity">humanity</option>
                                        <option value="overcast">overcast</option>
                                        <option value="redmond">redmond</option>
                                        <option value="smoothness">smoothness</option>
                                        <option value="start">start</option>
                                        <option value="sunny">sunny</option>
                                        <option value="ui-darkness">ui-darkness</option>
                                        <option value="ui-lightness">ui-lightness</option>
                                        <option value="vader">vader</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="group-view-css-common">
                                <td><label class="vis-edit-td-caption translate" for="inspect_view_group">visibility-groups</label></td>
                                <td class="vis-edit-td-field" colspan="2">
                                    <select multiple="multiple" id="inspect_view_group" class="vis-edit-textbox" style="width: 100%"></select>
                                </td>
                            </tr>
                            <tr class="group-view-css-common">
                                <td><label class="vis-edit-td-caption translate" for="inspect_view_group_action">visibility-groups-action</label></td>
                                <td class="vis-edit-td-field" colspan="2">
                                    <select id="inspect_view_group_action" class="vis-edit-textbox" style="width: 100%">
                                        <option value="hide" class="translate">hide</option>
                                        <option value="disabled" class="translate">disabled</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" class="css-inspector-heading ui-state-default"><span class="translate">group_css_background</span><button  style="float:right" class="view-group" data-group="view-css-background"></button></td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td colspan="3" id="inspect_view_bkg_parent"><input id="inspect_view_bkg_def"/></td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td class="translate">Use background</td>
                                <td colspan="2">
                                    <input id="inspect_view_css_only_background" type="checkbox"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>background</td>
                                <td colspan="2">
                                    <input id="inspect_view_css_background" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-color</td>
                                <td ><input id="inspect_view_css_background-color" class="vis-edit-textbox vis-inspect-view-css"/></td>
                                <td><button data-attr="view_css_background-color" class="view-edit-button" data-type="color"></button></td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-image</td>
                                <td colspan="2">
                                    <input id="inspect_view_css_background-image" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-repeat</td>
                                <td  colspan="2">
                                    <input id="inspect_view_css_background-repeat" class="vis-edit-textbox vis-inspect-view-css" data-options="repeat;repeat-x;repeat-y;no-repeat;initial;inherit"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-attachment</td>
                                <td  colspan="2">
                                    <input id="inspect_view_css_background-attachment" class="vis-edit-textbox vis-inspect-view-css" data-options="scroll;fixed;local;initial;inherit"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-position</td>
                                <td  colspan="2">
                                    <input id="inspect_view_css_background-position" class="vis-edit-textbox vis-inspect-view-css" data-options="left top;left center;left bottom;right top;right center;right bottom;center top;center center;center bottom;initial;inherit"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-size</td>
                                <td  colspan="2">
                                    <input id="inspect_view_css_background-size" class="vis-edit-textbox vis-inspect-view-css" data-options="auto;cover;contain;initial;inherit"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-clip</td>
                                <td  colspan="2">
                                    <input id="inspect_view_css_background-clip" class="vis-edit-textbox vis-inspect-view-css" data-options="border-box;padding-box;content-box;initial;inherit"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-background">
                                <td>-origin</td>
                                <td colspan="2">
                                    <input id="inspect_view_css_background-origin" class="vis-edit-textbox vis-inspect-view-css" data-options="border-box;padding-box;content-box;initial;inherit"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" class="css-inspector-heading ui-state-default"><span class="translate">group_css_font_text</span><button style="float:right" class="view-group" data-group="view-css-font-text"></button></td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>color</td>
                                <td>
                                    <input id="inspect_view_css_color" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                                <td><button data-attr="view_css_color" class="view-edit-button" data-type="color"></button></td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>text-shadow</td>
                                <td>
                                    <input id="inspect_view_css_text-shadow" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>font-family</td>
                                <td >
                                    <input id="inspect_view_css_font-family" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>font-style</td>
                                <td >
                                    <input id="inspect_view_css_font-style" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>font-variant</td>
                                <td >
                                    <input id="inspect_view_css_font-variant" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>font-weight</td>
                                <td >
                                    <input id="inspect_view_css_font-weight" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>font-size</td>
                                <td >
                                    <input id="inspect_view_css_font-size" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>line-height</td>
                                <td >
                                    <input id="inspect_view_css_line-height" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>letter-spacing</td>
                                <td >
                                    <input id="inspect_view_css_letter-spacing" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                            <tr class="group-view-css-font-text">
                                <td>word-spacing</td>
                                <td >
                                    <input id="inspect_view_css_word-spacing" class="vis-edit-textbox vis-inspect-view-css"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab_attr ui-widget-content" id="tab_wid_attr">
                <div class="vis-widget-tools" style="margin-top: 3px;">
                    <!--<h4 class="translate">Widget Attributes:</h4>-->
                    <table cellspacing=0 style="width: 100%; border: 0; table-layout: fixed; word-wrap: break-word;">
                        <colgroup>
                            <col width="40%"/>
                            <col width="60%"  style="padding-right: 5px"/>
                            <col width="26px" style=""/>
                            <col width="26px" style=""/>
                        </colgroup>
                        <tbody id="widget_attrs"></tbody>
                    </table>
                </div>
            </div>
            <div class="tab_attr ui-widget-content" id="tab_css_edit">
                <div id="css_editor_head">
                    <select  id="select_css_file" style=" width: 100px;">
                        <option value="vis-common-user" class="translate">Global</option>
                        <option value="vis-user"        class="translate">Project</option>
                    </select>
                    <input id="css_find"/>
                    <button id="css_find_prev" class="translateT" title="Find previous"></button>
                    <button id="css_find_next" class="translateT" title="Find next"></button>
                    <button id="css_file_save" class="translateT" disabled title="Save CSS"></button>
                </div>
                <div id="css_editor"></div>
            </div>
            <div class="tab_attr ui-widget-content" id="tab_script_edit">
                <div id="script_editor_head">
                    <span class="translate" style="padding-top: 3px">Find:</span>
                    <input id="script_find"/>
                    <button id="script_find_prev" class="translateT" title="Find previous"></button>
                    <button id="script_find_next" class="translateT" title="Find next"></button>
                    <button id="script_file_save" class="translateT" disabled title="Save scripts"></button>
                </div>
                <div id="script_editor"></div>

            </div>
        </div>
    </div>
</div>
<div id="dialog-message" title="Message" style="display: none">
    <p>
        <span id="dialog-message-icon" class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span>
        <span id="dialog-message-text"></span>
    </p>
</div>
<div id="dialog-confirm" title="Question" style="display: none">
    <p>
        <span id="dialog-confirm-icon" class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span>
        <span id="dialog-confirm-text" style="padding-left: 20px;"></span>
    </p>
</div>
<div style="display: none;text-align: center" id="dialog_template_warning">
    <table style="height: 100%; width: 100%">
        <tr>
            <td><span id="dialog_template_warning_text" class="translate" style="display: inline-block; padding-left: 10px; text-align: left;">templates_help</span>
            </td>
        </tr>
        <tr>
            <td style="text-align: left; vertical-align: bottom">
                <input type="checkbox" id="dialog_template_warning_is_show" style="display: inline-block; padding-left: 10px" />
                <label class="translate" style="font-size: small" for="dialog_template_warning_is_show">Do not show again</label>
            </td>
        </tr>
    </table>
</div>
<div id="dialog-edit-text" title="Edit text" style="display: none">
    <!--textarea style="width: calc(100% - 5px); height: 96%;resize: none;" id="dialog-edit-text-textarea"></textarea-->
    <div id="dialog-edit-text-textarea" style="width: calc(100% - 5px); height: 96%;"></div>
</div>
<div id="dialog-new-project" class="translateT" title="Create new project" style="overflow: hidden; display: none">
    <table><tr><td class="translate">Name:</td><td><input id="new-project-name" style="width: 250px" /></td></tr></table>
</div>
<div id="dialog-settings" class="translateT" title="VIS Settings" style="overflow: hidden; display: none">
    <table>
        <tr>
            <td class="translate">Reload if sleep longer than:</td>
            <td><select id="reloadOnSleep" style="width: 250px">
                    <option value="0" class="translate">never</option>
                    <option value="30" class="translate">30 seconds</option>
                    <option value="60" class="translate">1 minute</option>
                    <option value="300" class="translate">5 minutes</option>
                    <option value="600" class="translate">10 minutes</option>
                    <option value="1800" class="translate">30 minutes</option>
                    <option value="3600" class="translate">1 hour</option>
                    <option value="7200" class="translate">2 hours</option>
                    <option value="10800" class="translate">3 hours</option>
                    <option value="21600" class="translate">6 hours</option>
                    <option value="43200" class="translate">12 hours</option>
                    <option value="86400" class="translate">1 day</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="translate">Reconnect interval:</td>
            <td><select id="reconnectInterval" style="width: 250px">
                <option value="1000" class="translate">1 second</option>
                <option value="2000" class="translate">2 seconds</option>
                <option value="5000" class="translate">5 seconds</option>
                <option value="10000" class="translate">10 seconds</option>
                <option value="20000" class="translate">20 seconds</option>
                <option value="30000" class="translate">30 seconds</option>
                <option value="60000" class="translate">1 minute</option>
            </select>
            </td>
        </tr>
        <tr>
            <td class="translate">Dark reconnect screen:</td>
            <td><input type="checkbox" id="darkReloadScreen" /></td>
        </tr>
        <tr>
            <td class="translate">Destroy inactive view after:</td>
            <td><select id="destroyViewsAfter" style="width: 250px">
                <option value="0" class="translate">never</option>
                <option value="1" class="translate">1 second</option>
                <option value="5" class="translate">5 seconds</option>
                <option value="10" class="translate">10 seconds</option>
                <option value="20" class="translate">20 seconds</option>
                <option value="30" class="translate">30 seconds</option>
                <option value="60" class="translate">1 minute</option>
                <option value="300" class="translate">5 minutes</option>
                <option value="600" class="translate">10 minutes</option>
                <option value="1800" class="translate">30 minutes</option>
                <option value="3600" class="translate">1 hour</option>
                <option value="7200" class="translate">2 hours</option>
                <option value="10800" class="translate">3 hours</option>
                <option value="21600" class="translate">6 hours</option>
                <option value="43200" class="translate">12 hours</option>
                <option value="86400" class="translate">1 day</option>
            </select>
            </td>
        </tr>
    </table>
</div>
<div id="dialog-template" class="translateT" title="Template Settings" style="overflow: hidden; display: none">
    <table style="width: 750px">
        <tr>
            <td style="width: 150px;"><label class="translate" for="dialog_template_name">Name:</label></td>
            <td style="width: calc(100% - 150px);"><input id="dialog_template_name" style="width: 100%;"/></td>
        </tr>
        <tr>
            <td><label class="translate" for="dialog_template_desc">Description:</label></td>
            <td><input id="dialog_template_desc" style="width: 100%;"/></td>
        </tr>
    </table>
</div>

<div style="display: none" id="uploadPreview"></div>

<div id="growl_informator" class="jGrowl bottom-left" style="z-index:3001"></div>

<div id="server-disconnect" style="left: calc(100% - 350px); padding: 10px; display: block; width: 170px; height: 14px; border-radius: 3px; text-align: center; position: fixed;" class="ui-state-error disconnect-light" >
    <span class="ui-icon ui-icon-alert" style="position: relative; top: 0;left: 0; display: inline-block; float: left; margin-right: .3em;"></span>
    <div class="translate" style="display: inline-block; position: relative;top: 0;left: 0;">No connection</div>
</div>

</body>

</html>
